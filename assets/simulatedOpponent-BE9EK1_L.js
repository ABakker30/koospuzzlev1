import{c as g,a as k,G as C}from"./index-CC91HjcN.js";function I(e,t){const i=1-e/t;let n,s;return i<.3?(n=3e3,s=7e3):i<.7?(n=5e3,s=12e3):(n=7e3,s=15e3),Math.random()<.15?2e3+Math.random()*2e3:Math.random()<.1?s+Math.random()*5e3:n+Math.random()*(s-n)}let p=null;async function b(){return p||(p=new C,await p.load()),p}async function m(e,t=!1){const i=await b(),n=[],s=[];for(const[a,c]of Object.entries(e.inventoryState)){const u=e.placedCount[a]??0;(c===99?99:c-u)>0&&s.push(a)}if(s.length===0)return[];const o=[...e.emptyCells];M(o);const l=t?o:o.slice(0,Math.min(15,o.length)),h=[...s];M(h);for(const a of l){for(const c of h){const u=i.getOrientations(c);if(!u||u.length===0)continue;const r=u.map(f=>({orientationId:f.orientationId,ijkOffsets:f.ijkOffsets})),d=k({containerCells:e.containerCells,occupiedCells:e.occupiedCells,anchor:a,pieceId:c,orientations:r});for(const f of d)n.push({pieceId:c,orientationId:f.orientationId,cells:f.cells,anchor:a});if(n.length>=20)break}if(n.length>=20)break}return n}async function w(e,t,i,n,s){const o=new Set;for(const f of i)for(const y of f.cells)o.add(g(y));const l=t.filter(f=>!o.has(g(f))),h=t.length,a=I(l.length,h);if(l.length===0)return{type:"pass",thinkingDelayMs:2e3};const c={containerCells:e,occupiedCells:o,emptyCells:l,inventoryState:n,placedCount:s};if(Math.random()<.05&&l.length>4)return{type:"hint",thinkingDelayMs:a+2e3};let r=await m(c);if(r.length===0&&(r=await m(c,!0)),r.length===0)return{type:"hint",thinkingDelayMs:a+2e3};let d;return Math.random()<.7&&r.length>1?d=v(r,o):d=r[Math.floor(Math.random()*r.length)],{type:"place",pieceId:d.pieceId,orientationId:d.orientationId,cells:d.cells,thinkingDelayMs:a}}function v(e,t){const i=e.map(o=>{let l=0;for(const h of o.cells){const a=O(h);for(const c of a)t.has(c)&&l++}return{placement:o,score:l}});i.sort((o,l)=>l.score-o.score);const n=Math.min(3,i.length),s=Math.floor(Math.random()*n);return i[s].placement}function O(e){const{i:t,j:i,k:n}=e;return[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1],[1,-1,0],[-1,1,0],[1,0,-1],[-1,0,1],[0,1,-1],[0,-1,1]].map(([o,l,h])=>`${t+o},${i+l},${n+h}`)}function M(e){for(let t=e.length-1;t>0;t--){const i=Math.floor(Math.random()*(t+1));[e[t],e[i]]=[e[i],e[t]]}}export{w as generateSimulatedMove};
