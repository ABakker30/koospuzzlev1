let m,d,p,g=!1;async function k(){if(g)return;console.log("ðŸ”§ [Worker] Loading engine functions...");const e=await import("./hintEngine-B3561dS1.js");m=e.loadHintEnginePiecesDb,d=e.checkSolvableFromPartial,p=e.computeStatsFromPartial,g=!0,console.log("âœ… [Worker] Engine functions loaded")}let s=null;const t=new Set;function u(e){return{...e,emptyCells:[...e.emptyCells].sort((o,n)=>o.i!==n.i?o.i-n.i:o.j!==n.j?o.j-n.j:o.k-n.k),remainingPieces:[...e.remainingPieces].sort(),placedPieces:[...e.placedPieces].sort((o,n)=>(o.uid||o.pieceId||"").localeCompare(n.uid||n.pieceId||""))}}async function h(e,o,n,P){try{if(await k(),s||(console.log("ðŸ”§ [Worker] Loading pieces database..."),s=await m(),console.log("âœ… [Worker] Pieces database loaded")),t.has(e)){t.delete(e);return}const l=u(o);console.log(`ðŸ” [Worker ${e}] Starting solvability check...`);const i=performance.now(),a=await d(l,s);if(t.has(e)){t.delete(e);return}let r={};if(a.mode==="full"&&a.solvable&&(console.log(`ðŸ“Š [Worker ${e}] Computing stats...`),r=await p(l,s),t.has(e))){t.delete(e);return}const f=performance.now()-i;console.log(`âœ… [Worker ${e}] Complete in ${f.toFixed(0)}ms`);const c={requestId:e,result:{...a,...r}};console.log(`ðŸ“¤ [Worker ${e}] Sending response:`,c),self.postMessage(c)}catch(l){console.error(`âŒ [Worker ${e}] Error:`,l);const i={requestId:e,error:String(l)};self.postMessage(i)}}function W(e){console.log(`ðŸ›‘ [Worker] Cancelling request ${e}`),t.add(e)}self.addEventListener("message",e=>{const o=e.data;o.type==="check"?h(o.requestId,o.input,o.timeoutMs,o.emptyThreshold):o.type==="cancel"&&W(o.requestId)});console.log("ðŸš€ [Worker] DLX Worker initialized");
