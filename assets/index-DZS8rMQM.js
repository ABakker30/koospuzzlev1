var Rw=Object.defineProperty;var Aw=(n,e,t)=>e in n?Rw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var dt=(n,e,t)=>Aw(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var _r=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function on(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Pw(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var vy={exports:{}},md={},xy={exports:{}},Mt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ec=Symbol.for("react.element"),kw=Symbol.for("react.portal"),Iw=Symbol.for("react.fragment"),Lw=Symbol.for("react.strict_mode"),Dw=Symbol.for("react.profiler"),Nw=Symbol.for("react.provider"),Ow=Symbol.for("react.context"),Uw=Symbol.for("react.forward_ref"),zw=Symbol.for("react.suspense"),Fw=Symbol.for("react.memo"),jw=Symbol.for("react.lazy"),Qg=Symbol.iterator;function Bw(n){return n===null||typeof n!="object"?null:(n=Qg&&n[Qg]||n["@@iterator"],typeof n=="function"?n:null)}var yy={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_y=Object.assign,by={};function Ia(n,e,t){this.props=n,this.context=e,this.refs=by,this.updater=t||yy}Ia.prototype.isReactComponent={};Ia.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Ia.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Sy(){}Sy.prototype=Ia.prototype;function _m(n,e,t){this.props=n,this.context=e,this.refs=by,this.updater=t||yy}var bm=_m.prototype=new Sy;bm.constructor=_m;_y(bm,Ia.prototype);bm.isPureReactComponent=!0;var e0=Array.isArray,wy=Object.prototype.hasOwnProperty,Sm={current:null},Ey={key:!0,ref:!0,__self:!0,__source:!0};function My(n,e,t){var r,i={},o=null,s=null;if(e!=null)for(r in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)wy.call(e,r)&&!Ey.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=t;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(n&&n.defaultProps)for(r in a=n.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:ec,type:n,key:o,ref:s,props:i,_owner:Sm.current}}function Hw(n,e){return{$$typeof:ec,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function wm(n){return typeof n=="object"&&n!==null&&n.$$typeof===ec}function Ww(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var t0=/\/+/g;function $d(n,e){return typeof n=="object"&&n!==null&&n.key!=null?Ww(""+n.key):e.toString(36)}function hu(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var s=!1;if(n===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(n.$$typeof){case ec:case kw:s=!0}}if(s)return s=n,i=i(s),n=r===""?"."+$d(s,0):r,e0(i)?(t="",n!=null&&(t=n.replace(t0,"$&/")+"/"),hu(i,e,t,"",function(c){return c})):i!=null&&(wm(i)&&(i=Hw(i,t+(!i.key||s&&s.key===i.key?"":(""+i.key).replace(t0,"$&/")+"/")+n)),e.push(i)),1;if(s=0,r=r===""?".":r+":",e0(n))for(var a=0;a<n.length;a++){o=n[a];var l=r+$d(o,a);s+=hu(o,e,t,l,i)}else if(l=Bw(n),typeof l=="function")for(n=l.call(n),a=0;!(o=n.next()).done;)o=o.value,l=r+$d(o,a++),s+=hu(o,e,t,l,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function vc(n,e,t){if(n==null)return n;var r=[],i=0;return hu(n,r,"","",function(o){return e.call(t,o,i++)}),r}function Vw(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Un={current:null},fu={transition:null},$w={ReactCurrentDispatcher:Un,ReactCurrentBatchConfig:fu,ReactCurrentOwner:Sm};function Ty(){throw Error("act(...) is not supported in production builds of React.")}Mt.Children={map:vc,forEach:function(n,e,t){vc(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return vc(n,function(){e++}),e},toArray:function(n){return vc(n,function(e){return e})||[]},only:function(n){if(!wm(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Mt.Component=Ia;Mt.Fragment=Iw;Mt.Profiler=Dw;Mt.PureComponent=_m;Mt.StrictMode=Lw;Mt.Suspense=zw;Mt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$w;Mt.act=Ty;Mt.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=_y({},n.props),i=n.key,o=n.ref,s=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=Sm.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var a=n.type.defaultProps;for(l in e)wy.call(e,l)&&!Ey.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=t;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:ec,type:n.type,key:i,ref:o,props:r,_owner:s}};Mt.createContext=function(n){return n={$$typeof:Ow,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Nw,_context:n},n.Consumer=n};Mt.createElement=My;Mt.createFactory=function(n){var e=My.bind(null,n);return e.type=n,e};Mt.createRef=function(){return{current:null}};Mt.forwardRef=function(n){return{$$typeof:Uw,render:n}};Mt.isValidElement=wm;Mt.lazy=function(n){return{$$typeof:jw,_payload:{_status:-1,_result:n},_init:Vw}};Mt.memo=function(n,e){return{$$typeof:Fw,type:n,compare:e===void 0?null:e}};Mt.startTransition=function(n){var e=fu.transition;fu.transition={};try{n()}finally{fu.transition=e}};Mt.unstable_act=Ty;Mt.useCallback=function(n,e){return Un.current.useCallback(n,e)};Mt.useContext=function(n){return Un.current.useContext(n)};Mt.useDebugValue=function(){};Mt.useDeferredValue=function(n){return Un.current.useDeferredValue(n)};Mt.useEffect=function(n,e){return Un.current.useEffect(n,e)};Mt.useId=function(){return Un.current.useId()};Mt.useImperativeHandle=function(n,e,t){return Un.current.useImperativeHandle(n,e,t)};Mt.useInsertionEffect=function(n,e){return Un.current.useInsertionEffect(n,e)};Mt.useLayoutEffect=function(n,e){return Un.current.useLayoutEffect(n,e)};Mt.useMemo=function(n,e){return Un.current.useMemo(n,e)};Mt.useReducer=function(n,e,t){return Un.current.useReducer(n,e,t)};Mt.useRef=function(n){return Un.current.useRef(n)};Mt.useState=function(n){return Un.current.useState(n)};Mt.useSyncExternalStore=function(n,e,t){return Un.current.useSyncExternalStore(n,e,t)};Mt.useTransition=function(){return Un.current.useTransition()};Mt.version="18.3.1";xy.exports=Mt;var S=xy.exports;const la=on(S);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Gw=S,Xw=Symbol.for("react.element"),Yw=Symbol.for("react.fragment"),qw=Object.prototype.hasOwnProperty,Kw=Gw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Jw={key:!0,ref:!0,__self:!0,__source:!0};function Cy(n,e,t){var r,i={},o=null,s=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(r in e)qw.call(e,r)&&!Jw.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:Xw,type:n,key:o,ref:s,props:i,_owner:Kw.current}}md.Fragment=Yw;md.jsx=Cy;md.jsxs=Cy;vy.exports=md;var h=vy.exports,yf={},Ry={exports:{}},dr={},Ay={exports:{}},Py={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(F,Y){var X=F.length;F.push(Y);e:for(;0<X;){var oe=X-1>>>1,pe=F[oe];if(0<i(pe,Y))F[oe]=Y,F[X]=pe,X=oe;else break e}}function t(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var Y=F[0],X=F.pop();if(X!==Y){F[0]=X;e:for(var oe=0,pe=F.length,De=pe>>>1;oe<De;){var z=2*(oe+1)-1,ve=F[z],j=z+1,ne=F[j];if(0>i(ve,X))j<pe&&0>i(ne,ve)?(F[oe]=ne,F[j]=X,oe=j):(F[oe]=ve,F[z]=X,oe=z);else if(j<pe&&0>i(ne,X))F[oe]=ne,F[j]=X,oe=j;else break e}}return Y}function i(F,Y){var X=F.sortIndex-Y.sortIndex;return X!==0?X:F.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();n.unstable_now=function(){return s.now()-a}}var l=[],c=[],u=1,d=null,f=3,m=!1,v=!1,_=!1,x=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(F){for(var Y=t(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=F)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=t(c)}}function y(F){if(_=!1,g(F),!v)if(t(l)!==null)v=!0,H(E);else{var Y=t(c);Y!==null&&Z(y,Y.startTime-F)}}function E(F,Y){v=!1,_&&(_=!1,p(T),T=-1),m=!0;var X=f;try{for(g(Y),d=t(l);d!==null&&(!(d.expirationTime>Y)||F&&!P());){var oe=d.callback;if(typeof oe=="function"){d.callback=null,f=d.priorityLevel;var pe=oe(d.expirationTime<=Y);Y=n.unstable_now(),typeof pe=="function"?d.callback=pe:d===t(l)&&r(l),g(Y)}else r(l);d=t(l)}if(d!==null)var De=!0;else{var z=t(c);z!==null&&Z(y,z.startTime-Y),De=!1}return De}finally{d=null,f=X,m=!1}}var C=!1,A=null,T=-1,w=5,M=-1;function P(){return!(n.unstable_now()-M<w)}function I(){if(A!==null){var F=n.unstable_now();M=F;var Y=!0;try{Y=A(!0,F)}finally{Y?D():(C=!1,A=null)}}else C=!1}var D;if(typeof b=="function")D=function(){b(I)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,W=$.port2;$.port1.onmessage=I,D=function(){W.postMessage(null)}}else D=function(){x(I,0)};function H(F){A=F,C||(C=!0,D())}function Z(F,Y){T=x(function(){F(n.unstable_now())},Y)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(F){F.callback=null},n.unstable_continueExecution=function(){v||m||(v=!0,H(E))},n.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):w=0<F?Math.floor(1e3/F):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(F){switch(f){case 1:case 2:case 3:var Y=3;break;default:Y=f}var X=f;f=Y;try{return F()}finally{f=X}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(F,Y){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var X=f;f=F;try{return Y()}finally{f=X}},n.unstable_scheduleCallback=function(F,Y,X){var oe=n.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?oe+X:oe):X=oe,F){case 1:var pe=-1;break;case 2:pe=250;break;case 5:pe=1073741823;break;case 4:pe=1e4;break;default:pe=5e3}return pe=X+pe,F={id:u++,callback:Y,priorityLevel:F,startTime:X,expirationTime:pe,sortIndex:-1},X>oe?(F.sortIndex=X,e(c,F),t(l)===null&&F===t(c)&&(_?(p(T),T=-1):_=!0,Z(y,X-oe))):(F.sortIndex=pe,e(l,F),v||m||(v=!0,H(E))),F},n.unstable_shouldYield=P,n.unstable_wrapCallback=function(F){var Y=f;return function(){var X=f;f=Y;try{return F.apply(this,arguments)}finally{f=X}}}})(Py);Ay.exports=Py;var Zw=Ay.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qw=S,ur=Zw;function Xe(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ky=new Set,Rl={};function hs(n,e){ya(n,e),ya(n+"Capture",e)}function ya(n,e){for(Rl[n]=e,n=0;n<e.length;n++)ky.add(e[n])}var Ri=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),_f=Object.prototype.hasOwnProperty,e1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,n0={},r0={};function t1(n){return _f.call(r0,n)?!0:_f.call(n0,n)?!1:e1.test(n)?r0[n]=!0:(n0[n]=!0,!1)}function n1(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function r1(n,e,t,r){if(e===null||typeof e>"u"||n1(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function zn(n,e,t,r,i,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var wn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){wn[n]=new zn(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];wn[e]=new zn(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){wn[n]=new zn(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){wn[n]=new zn(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){wn[n]=new zn(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){wn[n]=new zn(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){wn[n]=new zn(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){wn[n]=new zn(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){wn[n]=new zn(n,5,!1,n.toLowerCase(),null,!1,!1)});var Em=/[\-:]([a-z])/g;function Mm(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(Em,Mm);wn[e]=new zn(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(Em,Mm);wn[e]=new zn(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(Em,Mm);wn[e]=new zn(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){wn[n]=new zn(n,1,!1,n.toLowerCase(),null,!1,!1)});wn.xlinkHref=new zn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){wn[n]=new zn(n,1,!1,n.toLowerCase(),null,!0,!0)});function Tm(n,e,t,r){var i=wn.hasOwnProperty(e)?wn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(r1(e,t,i,r)&&(t=null),r||i===null?t1(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Li=Qw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,xc=Symbol.for("react.element"),$s=Symbol.for("react.portal"),Gs=Symbol.for("react.fragment"),Cm=Symbol.for("react.strict_mode"),bf=Symbol.for("react.profiler"),Iy=Symbol.for("react.provider"),Ly=Symbol.for("react.context"),Rm=Symbol.for("react.forward_ref"),Sf=Symbol.for("react.suspense"),wf=Symbol.for("react.suspense_list"),Am=Symbol.for("react.memo"),Ki=Symbol.for("react.lazy"),Dy=Symbol.for("react.offscreen"),i0=Symbol.iterator;function Wa(n){return n===null||typeof n!="object"?null:(n=i0&&n[i0]||n["@@iterator"],typeof n=="function"?n:null)}var Xt=Object.assign,Gd;function al(n){if(Gd===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);Gd=e&&e[1]||""}return`
`+Gd+n}var Xd=!1;function Yd(n,e){if(!n||Xd)return"";Xd=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(n,[],e)}else{try{e.call()}catch(c){r=c}n.call(e.prototype)}else{try{throw Error()}catch(c){r=c}n()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),o=r.stack.split(`
`),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||i[s]!==o[a]){var l=`
`+i[s].replace(" at new "," at ");return n.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",n.displayName)),l}while(1<=s&&0<=a);break}}}finally{Xd=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?al(n):""}function i1(n){switch(n.tag){case 5:return al(n.type);case 16:return al("Lazy");case 13:return al("Suspense");case 19:return al("SuspenseList");case 0:case 2:case 15:return n=Yd(n.type,!1),n;case 11:return n=Yd(n.type.render,!1),n;case 1:return n=Yd(n.type,!0),n;default:return""}}function Ef(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Gs:return"Fragment";case $s:return"Portal";case bf:return"Profiler";case Cm:return"StrictMode";case Sf:return"Suspense";case wf:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Ly:return(n.displayName||"Context")+".Consumer";case Iy:return(n._context.displayName||"Context")+".Provider";case Rm:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Am:return e=n.displayName||null,e!==null?e:Ef(n.type)||"Memo";case Ki:e=n._payload,n=n._init;try{return Ef(n(e))}catch{}}return null}function o1(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ef(e);case 8:return e===Cm?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function _o(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Ny(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function s1(n){var e=Ny(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(s){r=""+s,o.call(this,s)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(s){r=""+s},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function yc(n){n._valueTracker||(n._valueTracker=s1(n))}function Oy(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=Ny(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function Lu(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Mf(n,e){var t=e.checked;return Xt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function o0(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=_o(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Uy(n,e){e=e.checked,e!=null&&Tm(n,"checked",e,!1)}function Tf(n,e){Uy(n,e);var t=_o(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Cf(n,e.type,t):e.hasOwnProperty("defaultValue")&&Cf(n,e.type,_o(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function s0(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Cf(n,e,t){(e!=="number"||Lu(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var ll=Array.isArray;function ca(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+_o(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Rf(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Xe(91));return Xt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function a0(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Xe(92));if(ll(t)){if(1<t.length)throw Error(Xe(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:_o(t)}}function zy(n,e){var t=_o(e.value),r=_o(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function l0(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function Fy(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Af(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?Fy(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var _c,jy=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(_c=_c||document.createElement("div"),_c.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=_c.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Al(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var pl={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},a1=["Webkit","ms","Moz","O"];Object.keys(pl).forEach(function(n){a1.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),pl[e]=pl[n]})});function By(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||pl.hasOwnProperty(n)&&pl[n]?(""+e).trim():e+"px"}function Hy(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=By(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var l1=Xt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Pf(n,e){if(e){if(l1[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Xe(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Xe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Xe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Xe(62))}}function kf(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var If=null;function Pm(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Lf=null,ua=null,da=null;function c0(n){if(n=rc(n)){if(typeof Lf!="function")throw Error(Xe(280));var e=n.stateNode;e&&(e=_d(e),Lf(n.stateNode,n.type,e))}}function Wy(n){ua?da?da.push(n):da=[n]:ua=n}function Vy(){if(ua){var n=ua,e=da;if(da=ua=null,c0(n),e)for(n=0;n<e.length;n++)c0(e[n])}}function $y(n,e){return n(e)}function Gy(){}var qd=!1;function Xy(n,e,t){if(qd)return n(e,t);qd=!0;try{return $y(n,e,t)}finally{qd=!1,(ua!==null||da!==null)&&(Gy(),Vy())}}function Pl(n,e){var t=n.stateNode;if(t===null)return null;var r=_d(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Xe(231,e,typeof t));return t}var Df=!1;if(Ri)try{var Va={};Object.defineProperty(Va,"passive",{get:function(){Df=!0}}),window.addEventListener("test",Va,Va),window.removeEventListener("test",Va,Va)}catch{Df=!1}function c1(n,e,t,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(t,c)}catch(u){this.onError(u)}}var ml=!1,Du=null,Nu=!1,Nf=null,u1={onError:function(n){ml=!0,Du=n}};function d1(n,e,t,r,i,o,s,a,l){ml=!1,Du=null,c1.apply(u1,arguments)}function h1(n,e,t,r,i,o,s,a,l){if(d1.apply(this,arguments),ml){if(ml){var c=Du;ml=!1,Du=null}else throw Error(Xe(198));Nu||(Nu=!0,Nf=c)}}function fs(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function Yy(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function u0(n){if(fs(n)!==n)throw Error(Xe(188))}function f1(n){var e=n.alternate;if(!e){if(e=fs(n),e===null)throw Error(Xe(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return u0(i),n;if(o===r)return u0(i),e;o=o.sibling}throw Error(Xe(188))}if(t.return!==r.return)t=i,r=o;else{for(var s=!1,a=i.child;a;){if(a===t){s=!0,t=i,r=o;break}if(a===r){s=!0,r=i,t=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===t){s=!0,t=o,r=i;break}if(a===r){s=!0,r=o,t=i;break}a=a.sibling}if(!s)throw Error(Xe(189))}}if(t.alternate!==r)throw Error(Xe(190))}if(t.tag!==3)throw Error(Xe(188));return t.stateNode.current===t?n:e}function qy(n){return n=f1(n),n!==null?Ky(n):null}function Ky(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=Ky(n);if(e!==null)return e;n=n.sibling}return null}var Jy=ur.unstable_scheduleCallback,d0=ur.unstable_cancelCallback,p1=ur.unstable_shouldYield,m1=ur.unstable_requestPaint,Qt=ur.unstable_now,g1=ur.unstable_getCurrentPriorityLevel,km=ur.unstable_ImmediatePriority,Zy=ur.unstable_UserBlockingPriority,Ou=ur.unstable_NormalPriority,v1=ur.unstable_LowPriority,Qy=ur.unstable_IdlePriority,gd=null,Yr=null;function x1(n){if(Yr&&typeof Yr.onCommitFiberRoot=="function")try{Yr.onCommitFiberRoot(gd,n,void 0,(n.current.flags&128)===128)}catch{}}var Dr=Math.clz32?Math.clz32:b1,y1=Math.log,_1=Math.LN2;function b1(n){return n>>>=0,n===0?32:31-(y1(n)/_1|0)|0}var bc=64,Sc=4194304;function cl(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function Uu(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,s=t&268435455;if(s!==0){var a=s&~i;a!==0?r=cl(a):(o&=s,o!==0&&(r=cl(o)))}else s=t&~i,s!==0?r=cl(s):o!==0&&(r=cl(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-Dr(e),i=1<<t,r|=n[t],e&=~i;return r}function S1(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function w1(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var s=31-Dr(o),a=1<<s,l=i[s];l===-1?(!(a&t)||a&r)&&(i[s]=S1(a,e)):l<=e&&(n.expiredLanes|=a),o&=~a}}function Of(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function e_(){var n=bc;return bc<<=1,!(bc&4194240)&&(bc=64),n}function Kd(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function tc(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Dr(e),n[e]=t}function E1(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-Dr(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function Im(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-Dr(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var It=0;function t_(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var n_,Lm,r_,i_,o_,Uf=!1,wc=[],ao=null,lo=null,co=null,kl=new Map,Il=new Map,Qi=[],M1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function h0(n,e){switch(n){case"focusin":case"focusout":ao=null;break;case"dragenter":case"dragleave":lo=null;break;case"mouseover":case"mouseout":co=null;break;case"pointerover":case"pointerout":kl.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Il.delete(e.pointerId)}}function $a(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=rc(e),e!==null&&Lm(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function T1(n,e,t,r,i){switch(e){case"focusin":return ao=$a(ao,n,e,t,r,i),!0;case"dragenter":return lo=$a(lo,n,e,t,r,i),!0;case"mouseover":return co=$a(co,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return kl.set(o,$a(kl.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Il.set(o,$a(Il.get(o)||null,n,e,t,r,i)),!0}return!1}function s_(n){var e=Ko(n.target);if(e!==null){var t=fs(e);if(t!==null){if(e=t.tag,e===13){if(e=Yy(t),e!==null){n.blockedOn=e,o_(n.priority,function(){r_(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function pu(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=zf(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);If=r,t.target.dispatchEvent(r),If=null}else return e=rc(t),e!==null&&Lm(e),n.blockedOn=t,!1;e.shift()}return!0}function f0(n,e,t){pu(n)&&t.delete(e)}function C1(){Uf=!1,ao!==null&&pu(ao)&&(ao=null),lo!==null&&pu(lo)&&(lo=null),co!==null&&pu(co)&&(co=null),kl.forEach(f0),Il.forEach(f0)}function Ga(n,e){n.blockedOn===e&&(n.blockedOn=null,Uf||(Uf=!0,ur.unstable_scheduleCallback(ur.unstable_NormalPriority,C1)))}function Ll(n){function e(i){return Ga(i,n)}if(0<wc.length){Ga(wc[0],n);for(var t=1;t<wc.length;t++){var r=wc[t];r.blockedOn===n&&(r.blockedOn=null)}}for(ao!==null&&Ga(ao,n),lo!==null&&Ga(lo,n),co!==null&&Ga(co,n),kl.forEach(e),Il.forEach(e),t=0;t<Qi.length;t++)r=Qi[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Qi.length&&(t=Qi[0],t.blockedOn===null);)s_(t),t.blockedOn===null&&Qi.shift()}var ha=Li.ReactCurrentBatchConfig,zu=!0;function R1(n,e,t,r){var i=It,o=ha.transition;ha.transition=null;try{It=1,Dm(n,e,t,r)}finally{It=i,ha.transition=o}}function A1(n,e,t,r){var i=It,o=ha.transition;ha.transition=null;try{It=4,Dm(n,e,t,r)}finally{It=i,ha.transition=o}}function Dm(n,e,t,r){if(zu){var i=zf(n,e,t,r);if(i===null)sh(n,e,r,Fu,t),h0(n,r);else if(T1(i,n,e,t,r))r.stopPropagation();else if(h0(n,r),e&4&&-1<M1.indexOf(n)){for(;i!==null;){var o=rc(i);if(o!==null&&n_(o),o=zf(n,e,t,r),o===null&&sh(n,e,r,Fu,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else sh(n,e,r,null,t)}}var Fu=null;function zf(n,e,t,r){if(Fu=null,n=Pm(r),n=Ko(n),n!==null)if(e=fs(n),e===null)n=null;else if(t=e.tag,t===13){if(n=Yy(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Fu=n,null}function a_(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(g1()){case km:return 1;case Zy:return 4;case Ou:case v1:return 16;case Qy:return 536870912;default:return 16}default:return 16}}var ro=null,Nm=null,mu=null;function l_(){if(mu)return mu;var n,e=Nm,t=e.length,r,i="value"in ro?ro.value:ro.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var s=t-n;for(r=1;r<=s&&e[t-r]===i[o-r];r++);return mu=i.slice(n,1<r?1-r:void 0)}function gu(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Ec(){return!0}function p0(){return!1}function hr(n){function e(t,r,i,o,s){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in n)n.hasOwnProperty(a)&&(t=n[a],this[a]=t?t(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Ec:p0,this.isPropagationStopped=p0,this}return Xt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Ec)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Ec)},persist:function(){},isPersistent:Ec}),e}var La={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Om=hr(La),nc=Xt({},La,{view:0,detail:0}),P1=hr(nc),Jd,Zd,Xa,vd=Xt({},nc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Um,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Xa&&(Xa&&n.type==="mousemove"?(Jd=n.screenX-Xa.screenX,Zd=n.screenY-Xa.screenY):Zd=Jd=0,Xa=n),Jd)},movementY:function(n){return"movementY"in n?n.movementY:Zd}}),m0=hr(vd),k1=Xt({},vd,{dataTransfer:0}),I1=hr(k1),L1=Xt({},nc,{relatedTarget:0}),Qd=hr(L1),D1=Xt({},La,{animationName:0,elapsedTime:0,pseudoElement:0}),N1=hr(D1),O1=Xt({},La,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),U1=hr(O1),z1=Xt({},La,{data:0}),g0=hr(z1),F1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},j1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},B1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function H1(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=B1[n])?!!e[n]:!1}function Um(){return H1}var W1=Xt({},nc,{key:function(n){if(n.key){var e=F1[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=gu(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?j1[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Um,charCode:function(n){return n.type==="keypress"?gu(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?gu(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),V1=hr(W1),$1=Xt({},vd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),v0=hr($1),G1=Xt({},nc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Um}),X1=hr(G1),Y1=Xt({},La,{propertyName:0,elapsedTime:0,pseudoElement:0}),q1=hr(Y1),K1=Xt({},vd,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),J1=hr(K1),Z1=[9,13,27,32],zm=Ri&&"CompositionEvent"in window,gl=null;Ri&&"documentMode"in document&&(gl=document.documentMode);var Q1=Ri&&"TextEvent"in window&&!gl,c_=Ri&&(!zm||gl&&8<gl&&11>=gl),x0=" ",y0=!1;function u_(n,e){switch(n){case"keyup":return Z1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function d_(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Xs=!1;function eE(n,e){switch(n){case"compositionend":return d_(e);case"keypress":return e.which!==32?null:(y0=!0,x0);case"textInput":return n=e.data,n===x0&&y0?null:n;default:return null}}function tE(n,e){if(Xs)return n==="compositionend"||!zm&&u_(n,e)?(n=l_(),mu=Nm=ro=null,Xs=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return c_&&e.locale!=="ko"?null:e.data;default:return null}}var nE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _0(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!nE[n.type]:e==="textarea"}function h_(n,e,t,r){Wy(r),e=ju(e,"onChange"),0<e.length&&(t=new Om("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var vl=null,Dl=null;function rE(n){w_(n,0)}function xd(n){var e=Ks(n);if(Oy(e))return n}function iE(n,e){if(n==="change")return e}var f_=!1;if(Ri){var eh;if(Ri){var th="oninput"in document;if(!th){var b0=document.createElement("div");b0.setAttribute("oninput","return;"),th=typeof b0.oninput=="function"}eh=th}else eh=!1;f_=eh&&(!document.documentMode||9<document.documentMode)}function S0(){vl&&(vl.detachEvent("onpropertychange",p_),Dl=vl=null)}function p_(n){if(n.propertyName==="value"&&xd(Dl)){var e=[];h_(e,Dl,n,Pm(n)),Xy(rE,e)}}function oE(n,e,t){n==="focusin"?(S0(),vl=e,Dl=t,vl.attachEvent("onpropertychange",p_)):n==="focusout"&&S0()}function sE(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return xd(Dl)}function aE(n,e){if(n==="click")return xd(e)}function lE(n,e){if(n==="input"||n==="change")return xd(e)}function cE(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ur=typeof Object.is=="function"?Object.is:cE;function Nl(n,e){if(Ur(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!_f.call(e,i)||!Ur(n[i],e[i]))return!1}return!0}function w0(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function E0(n,e){var t=w0(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=w0(t)}}function m_(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?m_(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function g_(){for(var n=window,e=Lu();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Lu(n.document)}return e}function Fm(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function uE(n){var e=g_(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&m_(t.ownerDocument.documentElement,t)){if(r!==null&&Fm(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=E0(t,o);var s=E0(t,r);i&&s&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==s.node||n.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var dE=Ri&&"documentMode"in document&&11>=document.documentMode,Ys=null,Ff=null,xl=null,jf=!1;function M0(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;jf||Ys==null||Ys!==Lu(r)||(r=Ys,"selectionStart"in r&&Fm(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),xl&&Nl(xl,r)||(xl=r,r=ju(Ff,"onSelect"),0<r.length&&(e=new Om("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ys)))}function Mc(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var qs={animationend:Mc("Animation","AnimationEnd"),animationiteration:Mc("Animation","AnimationIteration"),animationstart:Mc("Animation","AnimationStart"),transitionend:Mc("Transition","TransitionEnd")},nh={},v_={};Ri&&(v_=document.createElement("div").style,"AnimationEvent"in window||(delete qs.animationend.animation,delete qs.animationiteration.animation,delete qs.animationstart.animation),"TransitionEvent"in window||delete qs.transitionend.transition);function yd(n){if(nh[n])return nh[n];if(!qs[n])return n;var e=qs[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in v_)return nh[n]=e[t];return n}var x_=yd("animationend"),y_=yd("animationiteration"),__=yd("animationstart"),b_=yd("transitionend"),S_=new Map,T0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function To(n,e){S_.set(n,e),hs(e,[n])}for(var rh=0;rh<T0.length;rh++){var ih=T0[rh],hE=ih.toLowerCase(),fE=ih[0].toUpperCase()+ih.slice(1);To(hE,"on"+fE)}To(x_,"onAnimationEnd");To(y_,"onAnimationIteration");To(__,"onAnimationStart");To("dblclick","onDoubleClick");To("focusin","onFocus");To("focusout","onBlur");To(b_,"onTransitionEnd");ya("onMouseEnter",["mouseout","mouseover"]);ya("onMouseLeave",["mouseout","mouseover"]);ya("onPointerEnter",["pointerout","pointerover"]);ya("onPointerLeave",["pointerout","pointerover"]);hs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));hs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));hs("onBeforeInput",["compositionend","keypress","textInput","paste"]);hs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));hs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));hs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ul="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pE=new Set("cancel close invalid load scroll toggle".split(" ").concat(ul));function C0(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,h1(r,e,void 0,n),n.currentTarget=null}function w_(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;C0(i,a,c),o=l}else for(s=0;s<r.length;s++){if(a=r[s],l=a.instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;C0(i,a,c),o=l}}}if(Nu)throw n=Nf,Nu=!1,Nf=null,n}function Ft(n,e){var t=e[$f];t===void 0&&(t=e[$f]=new Set);var r=n+"__bubble";t.has(r)||(E_(e,n,2,!1),t.add(r))}function oh(n,e,t){var r=0;e&&(r|=4),E_(t,n,r,e)}var Tc="_reactListening"+Math.random().toString(36).slice(2);function Ol(n){if(!n[Tc]){n[Tc]=!0,ky.forEach(function(t){t!=="selectionchange"&&(pE.has(t)||oh(t,!1,n),oh(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Tc]||(e[Tc]=!0,oh("selectionchange",!1,e))}}function E_(n,e,t,r){switch(a_(e)){case 1:var i=R1;break;case 4:i=A1;break;default:i=Dm}t=i.bind(null,e,t,n),i=void 0,!Df||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function sh(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var s=r.tag;if(s===3||s===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(s===4)for(s=r.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;s=s.return}for(;a!==null;){if(s=Ko(a),s===null)return;if(l=s.tag,l===5||l===6){r=o=s;continue e}a=a.parentNode}}r=r.return}Xy(function(){var c=o,u=Pm(t),d=[];e:{var f=S_.get(n);if(f!==void 0){var m=Om,v=n;switch(n){case"keypress":if(gu(t)===0)break e;case"keydown":case"keyup":m=V1;break;case"focusin":v="focus",m=Qd;break;case"focusout":v="blur",m=Qd;break;case"beforeblur":case"afterblur":m=Qd;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=m0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=I1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=X1;break;case x_:case y_:case __:m=N1;break;case b_:m=q1;break;case"scroll":m=P1;break;case"wheel":m=J1;break;case"copy":case"cut":case"paste":m=U1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=v0}var _=(e&4)!==0,x=!_&&n==="scroll",p=_?f!==null?f+"Capture":null:f;_=[];for(var b=c,g;b!==null;){g=b;var y=g.stateNode;if(g.tag===5&&y!==null&&(g=y,p!==null&&(y=Pl(b,p),y!=null&&_.push(Ul(b,y,g)))),x)break;b=b.return}0<_.length&&(f=new m(f,v,null,t,u),d.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=n==="mouseover"||n==="pointerover",m=n==="mouseout"||n==="pointerout",f&&t!==If&&(v=t.relatedTarget||t.fromElement)&&(Ko(v)||v[Ai]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(v=t.relatedTarget||t.toElement,m=c,v=v?Ko(v):null,v!==null&&(x=fs(v),v!==x||v.tag!==5&&v.tag!==6)&&(v=null)):(m=null,v=c),m!==v)){if(_=m0,y="onMouseLeave",p="onMouseEnter",b="mouse",(n==="pointerout"||n==="pointerover")&&(_=v0,y="onPointerLeave",p="onPointerEnter",b="pointer"),x=m==null?f:Ks(m),g=v==null?f:Ks(v),f=new _(y,b+"leave",m,t,u),f.target=x,f.relatedTarget=g,y=null,Ko(u)===c&&(_=new _(p,b+"enter",v,t,u),_.target=g,_.relatedTarget=x,y=_),x=y,m&&v)t:{for(_=m,p=v,b=0,g=_;g;g=ys(g))b++;for(g=0,y=p;y;y=ys(y))g++;for(;0<b-g;)_=ys(_),b--;for(;0<g-b;)p=ys(p),g--;for(;b--;){if(_===p||p!==null&&_===p.alternate)break t;_=ys(_),p=ys(p)}_=null}else _=null;m!==null&&R0(d,f,m,_,!1),v!==null&&x!==null&&R0(d,x,v,_,!0)}}e:{if(f=c?Ks(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var E=iE;else if(_0(f))if(f_)E=lE;else{E=sE;var C=oE}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(E=aE);if(E&&(E=E(n,c))){h_(d,E,t,u);break e}C&&C(n,f,c),n==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&Cf(f,"number",f.value)}switch(C=c?Ks(c):window,n){case"focusin":(_0(C)||C.contentEditable==="true")&&(Ys=C,Ff=c,xl=null);break;case"focusout":xl=Ff=Ys=null;break;case"mousedown":jf=!0;break;case"contextmenu":case"mouseup":case"dragend":jf=!1,M0(d,t,u);break;case"selectionchange":if(dE)break;case"keydown":case"keyup":M0(d,t,u)}var A;if(zm)e:{switch(n){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Xs?u_(n,t)&&(T="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(T="onCompositionStart");T&&(c_&&t.locale!=="ko"&&(Xs||T!=="onCompositionStart"?T==="onCompositionEnd"&&Xs&&(A=l_()):(ro=u,Nm="value"in ro?ro.value:ro.textContent,Xs=!0)),C=ju(c,T),0<C.length&&(T=new g0(T,n,null,t,u),d.push({event:T,listeners:C}),A?T.data=A:(A=d_(t),A!==null&&(T.data=A)))),(A=Q1?eE(n,t):tE(n,t))&&(c=ju(c,"onBeforeInput"),0<c.length&&(u=new g0("onBeforeInput","beforeinput",null,t,u),d.push({event:u,listeners:c}),u.data=A))}w_(d,e)})}function Ul(n,e,t){return{instance:n,listener:e,currentTarget:t}}function ju(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Pl(n,t),o!=null&&r.unshift(Ul(n,o,i)),o=Pl(n,e),o!=null&&r.push(Ul(n,o,i))),n=n.return}return r}function ys(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function R0(n,e,t,r,i){for(var o=e._reactName,s=[];t!==null&&t!==r;){var a=t,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Pl(t,o),l!=null&&s.unshift(Ul(t,l,a))):i||(l=Pl(t,o),l!=null&&s.push(Ul(t,l,a)))),t=t.return}s.length!==0&&n.push({event:e,listeners:s})}var mE=/\r\n?/g,gE=/\u0000|\uFFFD/g;function A0(n){return(typeof n=="string"?n:""+n).replace(mE,`
`).replace(gE,"")}function Cc(n,e,t){if(e=A0(e),A0(n)!==e&&t)throw Error(Xe(425))}function Bu(){}var Bf=null,Hf=null;function Wf(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Vf=typeof setTimeout=="function"?setTimeout:void 0,vE=typeof clearTimeout=="function"?clearTimeout:void 0,P0=typeof Promise=="function"?Promise:void 0,xE=typeof queueMicrotask=="function"?queueMicrotask:typeof P0<"u"?function(n){return P0.resolve(null).then(n).catch(yE)}:Vf;function yE(n){setTimeout(function(){throw n})}function ah(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Ll(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Ll(e)}function uo(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function k0(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Da=Math.random().toString(36).slice(2),Gr="__reactFiber$"+Da,zl="__reactProps$"+Da,Ai="__reactContainer$"+Da,$f="__reactEvents$"+Da,_E="__reactListeners$"+Da,bE="__reactHandles$"+Da;function Ko(n){var e=n[Gr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Ai]||t[Gr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=k0(n);n!==null;){if(t=n[Gr])return t;n=k0(n)}return e}n=t,t=n.parentNode}return null}function rc(n){return n=n[Gr]||n[Ai],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ks(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Xe(33))}function _d(n){return n[zl]||null}var Gf=[],Js=-1;function Co(n){return{current:n}}function jt(n){0>Js||(n.current=Gf[Js],Gf[Js]=null,Js--)}function zt(n,e){Js++,Gf[Js]=n.current,n.current=e}var bo={},Pn=Co(bo),Xn=Co(!1),is=bo;function _a(n,e){var t=n.type.contextTypes;if(!t)return bo;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function Yn(n){return n=n.childContextTypes,n!=null}function Hu(){jt(Xn),jt(Pn)}function I0(n,e,t){if(Pn.current!==bo)throw Error(Xe(168));zt(Pn,e),zt(Xn,t)}function M_(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Xe(108,o1(n)||"Unknown",i));return Xt({},t,r)}function Wu(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||bo,is=Pn.current,zt(Pn,n),zt(Xn,Xn.current),!0}function L0(n,e,t){var r=n.stateNode;if(!r)throw Error(Xe(169));t?(n=M_(n,e,is),r.__reactInternalMemoizedMergedChildContext=n,jt(Xn),jt(Pn),zt(Pn,n)):jt(Xn),zt(Xn,t)}var vi=null,bd=!1,lh=!1;function T_(n){vi===null?vi=[n]:vi.push(n)}function SE(n){bd=!0,T_(n)}function Ro(){if(!lh&&vi!==null){lh=!0;var n=0,e=It;try{var t=vi;for(It=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}vi=null,bd=!1}catch(i){throw vi!==null&&(vi=vi.slice(n+1)),Jy(km,Ro),i}finally{It=e,lh=!1}}return null}var Zs=[],Qs=0,Vu=null,$u=0,gr=[],vr=0,os=null,bi=1,Si="";function Bo(n,e){Zs[Qs++]=$u,Zs[Qs++]=Vu,Vu=n,$u=e}function C_(n,e,t){gr[vr++]=bi,gr[vr++]=Si,gr[vr++]=os,os=n;var r=bi;n=Si;var i=32-Dr(r)-1;r&=~(1<<i),t+=1;var o=32-Dr(e)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,bi=1<<32-Dr(e)+i|t<<i|r,Si=o+n}else bi=1<<o|t<<i|r,Si=n}function jm(n){n.return!==null&&(Bo(n,1),C_(n,1,0))}function Bm(n){for(;n===Vu;)Vu=Zs[--Qs],Zs[Qs]=null,$u=Zs[--Qs],Zs[Qs]=null;for(;n===os;)os=gr[--vr],gr[vr]=null,Si=gr[--vr],gr[vr]=null,bi=gr[--vr],gr[vr]=null}var ar=null,sr=null,Wt=!1,kr=null;function R_(n,e){var t=xr(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function D0(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,ar=n,sr=uo(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,ar=n,sr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=os!==null?{id:bi,overflow:Si}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=xr(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,ar=n,sr=null,!0):!1;default:return!1}}function Xf(n){return(n.mode&1)!==0&&(n.flags&128)===0}function Yf(n){if(Wt){var e=sr;if(e){var t=e;if(!D0(n,e)){if(Xf(n))throw Error(Xe(418));e=uo(t.nextSibling);var r=ar;e&&D0(n,e)?R_(r,t):(n.flags=n.flags&-4097|2,Wt=!1,ar=n)}}else{if(Xf(n))throw Error(Xe(418));n.flags=n.flags&-4097|2,Wt=!1,ar=n}}}function N0(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ar=n}function Rc(n){if(n!==ar)return!1;if(!Wt)return N0(n),Wt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!Wf(n.type,n.memoizedProps)),e&&(e=sr)){if(Xf(n))throw A_(),Error(Xe(418));for(;e;)R_(n,e),e=uo(e.nextSibling)}if(N0(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Xe(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){sr=uo(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}sr=null}}else sr=ar?uo(n.stateNode.nextSibling):null;return!0}function A_(){for(var n=sr;n;)n=uo(n.nextSibling)}function ba(){sr=ar=null,Wt=!1}function Hm(n){kr===null?kr=[n]:kr.push(n)}var wE=Li.ReactCurrentBatchConfig;function Ya(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Xe(309));var r=t.stateNode}if(!r)throw Error(Xe(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=i.refs;s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof n!="string")throw Error(Xe(284));if(!t._owner)throw Error(Xe(290,n))}return n}function Ac(n,e){throw n=Object.prototype.toString.call(e),Error(Xe(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function O0(n){var e=n._init;return e(n._payload)}function P_(n){function e(p,b){if(n){var g=p.deletions;g===null?(p.deletions=[b],p.flags|=16):g.push(b)}}function t(p,b){if(!n)return null;for(;b!==null;)e(p,b),b=b.sibling;return null}function r(p,b){for(p=new Map;b!==null;)b.key!==null?p.set(b.key,b):p.set(b.index,b),b=b.sibling;return p}function i(p,b){return p=mo(p,b),p.index=0,p.sibling=null,p}function o(p,b,g){return p.index=g,n?(g=p.alternate,g!==null?(g=g.index,g<b?(p.flags|=2,b):g):(p.flags|=2,b)):(p.flags|=1048576,b)}function s(p){return n&&p.alternate===null&&(p.flags|=2),p}function a(p,b,g,y){return b===null||b.tag!==6?(b=mh(g,p.mode,y),b.return=p,b):(b=i(b,g),b.return=p,b)}function l(p,b,g,y){var E=g.type;return E===Gs?u(p,b,g.props.children,y,g.key):b!==null&&(b.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Ki&&O0(E)===b.type)?(y=i(b,g.props),y.ref=Ya(p,b,g),y.return=p,y):(y=wu(g.type,g.key,g.props,null,p.mode,y),y.ref=Ya(p,b,g),y.return=p,y)}function c(p,b,g,y){return b===null||b.tag!==4||b.stateNode.containerInfo!==g.containerInfo||b.stateNode.implementation!==g.implementation?(b=gh(g,p.mode,y),b.return=p,b):(b=i(b,g.children||[]),b.return=p,b)}function u(p,b,g,y,E){return b===null||b.tag!==7?(b=ns(g,p.mode,y,E),b.return=p,b):(b=i(b,g),b.return=p,b)}function d(p,b,g){if(typeof b=="string"&&b!==""||typeof b=="number")return b=mh(""+b,p.mode,g),b.return=p,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case xc:return g=wu(b.type,b.key,b.props,null,p.mode,g),g.ref=Ya(p,null,b),g.return=p,g;case $s:return b=gh(b,p.mode,g),b.return=p,b;case Ki:var y=b._init;return d(p,y(b._payload),g)}if(ll(b)||Wa(b))return b=ns(b,p.mode,g,null),b.return=p,b;Ac(p,b)}return null}function f(p,b,g,y){var E=b!==null?b.key:null;if(typeof g=="string"&&g!==""||typeof g=="number")return E!==null?null:a(p,b,""+g,y);if(typeof g=="object"&&g!==null){switch(g.$$typeof){case xc:return g.key===E?l(p,b,g,y):null;case $s:return g.key===E?c(p,b,g,y):null;case Ki:return E=g._init,f(p,b,E(g._payload),y)}if(ll(g)||Wa(g))return E!==null?null:u(p,b,g,y,null);Ac(p,g)}return null}function m(p,b,g,y,E){if(typeof y=="string"&&y!==""||typeof y=="number")return p=p.get(g)||null,a(b,p,""+y,E);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case xc:return p=p.get(y.key===null?g:y.key)||null,l(b,p,y,E);case $s:return p=p.get(y.key===null?g:y.key)||null,c(b,p,y,E);case Ki:var C=y._init;return m(p,b,g,C(y._payload),E)}if(ll(y)||Wa(y))return p=p.get(g)||null,u(b,p,y,E,null);Ac(b,y)}return null}function v(p,b,g,y){for(var E=null,C=null,A=b,T=b=0,w=null;A!==null&&T<g.length;T++){A.index>T?(w=A,A=null):w=A.sibling;var M=f(p,A,g[T],y);if(M===null){A===null&&(A=w);break}n&&A&&M.alternate===null&&e(p,A),b=o(M,b,T),C===null?E=M:C.sibling=M,C=M,A=w}if(T===g.length)return t(p,A),Wt&&Bo(p,T),E;if(A===null){for(;T<g.length;T++)A=d(p,g[T],y),A!==null&&(b=o(A,b,T),C===null?E=A:C.sibling=A,C=A);return Wt&&Bo(p,T),E}for(A=r(p,A);T<g.length;T++)w=m(A,p,T,g[T],y),w!==null&&(n&&w.alternate!==null&&A.delete(w.key===null?T:w.key),b=o(w,b,T),C===null?E=w:C.sibling=w,C=w);return n&&A.forEach(function(P){return e(p,P)}),Wt&&Bo(p,T),E}function _(p,b,g,y){var E=Wa(g);if(typeof E!="function")throw Error(Xe(150));if(g=E.call(g),g==null)throw Error(Xe(151));for(var C=E=null,A=b,T=b=0,w=null,M=g.next();A!==null&&!M.done;T++,M=g.next()){A.index>T?(w=A,A=null):w=A.sibling;var P=f(p,A,M.value,y);if(P===null){A===null&&(A=w);break}n&&A&&P.alternate===null&&e(p,A),b=o(P,b,T),C===null?E=P:C.sibling=P,C=P,A=w}if(M.done)return t(p,A),Wt&&Bo(p,T),E;if(A===null){for(;!M.done;T++,M=g.next())M=d(p,M.value,y),M!==null&&(b=o(M,b,T),C===null?E=M:C.sibling=M,C=M);return Wt&&Bo(p,T),E}for(A=r(p,A);!M.done;T++,M=g.next())M=m(A,p,T,M.value,y),M!==null&&(n&&M.alternate!==null&&A.delete(M.key===null?T:M.key),b=o(M,b,T),C===null?E=M:C.sibling=M,C=M);return n&&A.forEach(function(I){return e(p,I)}),Wt&&Bo(p,T),E}function x(p,b,g,y){if(typeof g=="object"&&g!==null&&g.type===Gs&&g.key===null&&(g=g.props.children),typeof g=="object"&&g!==null){switch(g.$$typeof){case xc:e:{for(var E=g.key,C=b;C!==null;){if(C.key===E){if(E=g.type,E===Gs){if(C.tag===7){t(p,C.sibling),b=i(C,g.props.children),b.return=p,p=b;break e}}else if(C.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===Ki&&O0(E)===C.type){t(p,C.sibling),b=i(C,g.props),b.ref=Ya(p,C,g),b.return=p,p=b;break e}t(p,C);break}else e(p,C);C=C.sibling}g.type===Gs?(b=ns(g.props.children,p.mode,y,g.key),b.return=p,p=b):(y=wu(g.type,g.key,g.props,null,p.mode,y),y.ref=Ya(p,b,g),y.return=p,p=y)}return s(p);case $s:e:{for(C=g.key;b!==null;){if(b.key===C)if(b.tag===4&&b.stateNode.containerInfo===g.containerInfo&&b.stateNode.implementation===g.implementation){t(p,b.sibling),b=i(b,g.children||[]),b.return=p,p=b;break e}else{t(p,b);break}else e(p,b);b=b.sibling}b=gh(g,p.mode,y),b.return=p,p=b}return s(p);case Ki:return C=g._init,x(p,b,C(g._payload),y)}if(ll(g))return v(p,b,g,y);if(Wa(g))return _(p,b,g,y);Ac(p,g)}return typeof g=="string"&&g!==""||typeof g=="number"?(g=""+g,b!==null&&b.tag===6?(t(p,b.sibling),b=i(b,g),b.return=p,p=b):(t(p,b),b=mh(g,p.mode,y),b.return=p,p=b),s(p)):t(p,b)}return x}var Sa=P_(!0),k_=P_(!1),Gu=Co(null),Xu=null,ea=null,Wm=null;function Vm(){Wm=ea=Xu=null}function $m(n){var e=Gu.current;jt(Gu),n._currentValue=e}function qf(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function fa(n,e){Xu=n,Wm=ea=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&($n=!0),n.firstContext=null)}function br(n){var e=n._currentValue;if(Wm!==n)if(n={context:n,memoizedValue:e,next:null},ea===null){if(Xu===null)throw Error(Xe(308));ea=n,Xu.dependencies={lanes:0,firstContext:n}}else ea=ea.next=n;return e}var Jo=null;function Gm(n){Jo===null?Jo=[n]:Jo.push(n)}function I_(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Gm(e)):(t.next=i.next,i.next=t),e.interleaved=t,Pi(n,r)}function Pi(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Ji=!1;function Xm(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function L_(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Mi(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function ho(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,At&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Pi(n,t)}return i=r.interleaved,i===null?(e.next=e,Gm(r)):(e.next=i.next,i.next=e),r.interleaved=e,Pi(n,t)}function vu(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Im(n,t)}}function U0(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var s={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=s:o=o.next=s,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Yu(n,e,t,r){var i=n.updateQueue;Ji=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,s===null?o=c:s.next=c,s=l;var u=n.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==s&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(o!==null){var d=i.baseState;s=0,u=c=l=null,a=o;do{var f=a.lane,m=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=n,_=a;switch(f=e,m=t,_.tag){case 1:if(v=_.payload,typeof v=="function"){d=v.call(m,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=_.payload,f=typeof v=="function"?v.call(m,d,f):v,f==null)break e;d=Xt({},d,f);break e;case 2:Ji=!0}}a.callback!==null&&a.lane!==0&&(n.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=d):u=u.next=m,s|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(u===null&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do s|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);as|=s,n.lanes=s,n.memoizedState=d}}function z0(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(Xe(191,i));i.call(r)}}}var ic={},qr=Co(ic),Fl=Co(ic),jl=Co(ic);function Zo(n){if(n===ic)throw Error(Xe(174));return n}function Ym(n,e){switch(zt(jl,e),zt(Fl,n),zt(qr,ic),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Af(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Af(e,n)}jt(qr),zt(qr,e)}function wa(){jt(qr),jt(Fl),jt(jl)}function D_(n){Zo(jl.current);var e=Zo(qr.current),t=Af(e,n.type);e!==t&&(zt(Fl,n),zt(qr,t))}function qm(n){Fl.current===n&&(jt(qr),jt(Fl))}var Vt=Co(0);function qu(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ch=[];function Km(){for(var n=0;n<ch.length;n++)ch[n]._workInProgressVersionPrimary=null;ch.length=0}var xu=Li.ReactCurrentDispatcher,uh=Li.ReactCurrentBatchConfig,ss=0,$t=null,ln=null,gn=null,Ku=!1,yl=!1,Bl=0,EE=0;function En(){throw Error(Xe(321))}function Jm(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ur(n[t],e[t]))return!1;return!0}function Zm(n,e,t,r,i,o){if(ss=o,$t=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,xu.current=n===null||n.memoizedState===null?RE:AE,n=t(r,i),yl){o=0;do{if(yl=!1,Bl=0,25<=o)throw Error(Xe(301));o+=1,gn=ln=null,e.updateQueue=null,xu.current=PE,n=t(r,i)}while(yl)}if(xu.current=Ju,e=ln!==null&&ln.next!==null,ss=0,gn=ln=$t=null,Ku=!1,e)throw Error(Xe(300));return n}function Qm(){var n=Bl!==0;return Bl=0,n}function Hr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gn===null?$t.memoizedState=gn=n:gn=gn.next=n,gn}function Sr(){if(ln===null){var n=$t.alternate;n=n!==null?n.memoizedState:null}else n=ln.next;var e=gn===null?$t.memoizedState:gn.next;if(e!==null)gn=e,ln=n;else{if(n===null)throw Error(Xe(310));ln=n,n={memoizedState:ln.memoizedState,baseState:ln.baseState,baseQueue:ln.baseQueue,queue:ln.queue,next:null},gn===null?$t.memoizedState=gn=n:gn=gn.next=n}return gn}function Hl(n,e){return typeof e=="function"?e(n):e}function dh(n){var e=Sr(),t=e.queue;if(t===null)throw Error(Xe(311));t.lastRenderedReducer=n;var r=ln,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var s=i.next;i.next=o.next,o.next=s}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var a=s=null,l=null,c=o;do{var u=c.lane;if((ss&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:n(r,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,s=r):l=l.next=d,$t.lanes|=u,as|=u}c=c.next}while(c!==null&&c!==o);l===null?s=r:l.next=a,Ur(r,e.memoizedState)||($n=!0),e.memoizedState=r,e.baseState=s,e.baseQueue=l,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,$t.lanes|=o,as|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function hh(n){var e=Sr(),t=e.queue;if(t===null)throw Error(Xe(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var s=i=i.next;do o=n(o,s.action),s=s.next;while(s!==i);Ur(o,e.memoizedState)||($n=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function N_(){}function O_(n,e){var t=$t,r=Sr(),i=e(),o=!Ur(r.memoizedState,i);if(o&&(r.memoizedState=i,$n=!0),r=r.queue,eg(F_.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||gn!==null&&gn.memoizedState.tag&1){if(t.flags|=2048,Wl(9,z_.bind(null,t,r,i,e),void 0,null),vn===null)throw Error(Xe(349));ss&30||U_(t,e,i)}return i}function U_(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=$t.updateQueue,e===null?(e={lastEffect:null,stores:null},$t.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function z_(n,e,t,r){e.value=t,e.getSnapshot=r,j_(e)&&B_(n)}function F_(n,e,t){return t(function(){j_(e)&&B_(n)})}function j_(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ur(n,t)}catch{return!0}}function B_(n){var e=Pi(n,1);e!==null&&Nr(e,n,1,-1)}function F0(n){var e=Hr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Hl,lastRenderedState:n},e.queue=n,n=n.dispatch=CE.bind(null,$t,n),[e.memoizedState,n]}function Wl(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=$t.updateQueue,e===null?(e={lastEffect:null,stores:null},$t.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function H_(){return Sr().memoizedState}function yu(n,e,t,r){var i=Hr();$t.flags|=n,i.memoizedState=Wl(1|e,t,void 0,r===void 0?null:r)}function Sd(n,e,t,r){var i=Sr();r=r===void 0?null:r;var o=void 0;if(ln!==null){var s=ln.memoizedState;if(o=s.destroy,r!==null&&Jm(r,s.deps)){i.memoizedState=Wl(e,t,o,r);return}}$t.flags|=n,i.memoizedState=Wl(1|e,t,o,r)}function j0(n,e){return yu(8390656,8,n,e)}function eg(n,e){return Sd(2048,8,n,e)}function W_(n,e){return Sd(4,2,n,e)}function V_(n,e){return Sd(4,4,n,e)}function $_(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function G_(n,e,t){return t=t!=null?t.concat([n]):null,Sd(4,4,$_.bind(null,e,n),t)}function tg(){}function X_(n,e){var t=Sr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Jm(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function Y_(n,e){var t=Sr();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Jm(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function q_(n,e,t){return ss&21?(Ur(t,e)||(t=e_(),$t.lanes|=t,as|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,$n=!0),n.memoizedState=t)}function ME(n,e){var t=It;It=t!==0&&4>t?t:4,n(!0);var r=uh.transition;uh.transition={};try{n(!1),e()}finally{It=t,uh.transition=r}}function K_(){return Sr().memoizedState}function TE(n,e,t){var r=po(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},J_(n))Z_(e,t);else if(t=I_(n,e,t,r),t!==null){var i=Nn();Nr(t,n,r,i),Q_(t,e,r)}}function CE(n,e,t){var r=po(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(J_(n))Z_(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,t);if(i.hasEagerState=!0,i.eagerState=a,Ur(a,s)){var l=e.interleaved;l===null?(i.next=i,Gm(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}t=I_(n,e,i,r),t!==null&&(i=Nn(),Nr(t,n,r,i),Q_(t,e,r))}}function J_(n){var e=n.alternate;return n===$t||e!==null&&e===$t}function Z_(n,e){yl=Ku=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function Q_(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,Im(n,t)}}var Ju={readContext:br,useCallback:En,useContext:En,useEffect:En,useImperativeHandle:En,useInsertionEffect:En,useLayoutEffect:En,useMemo:En,useReducer:En,useRef:En,useState:En,useDebugValue:En,useDeferredValue:En,useTransition:En,useMutableSource:En,useSyncExternalStore:En,useId:En,unstable_isNewReconciler:!1},RE={readContext:br,useCallback:function(n,e){return Hr().memoizedState=[n,e===void 0?null:e],n},useContext:br,useEffect:j0,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,yu(4194308,4,$_.bind(null,e,n),t)},useLayoutEffect:function(n,e){return yu(4194308,4,n,e)},useInsertionEffect:function(n,e){return yu(4,2,n,e)},useMemo:function(n,e){var t=Hr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=Hr();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=TE.bind(null,$t,n),[r.memoizedState,n]},useRef:function(n){var e=Hr();return n={current:n},e.memoizedState=n},useState:F0,useDebugValue:tg,useDeferredValue:function(n){return Hr().memoizedState=n},useTransition:function(){var n=F0(!1),e=n[0];return n=ME.bind(null,n[1]),Hr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=$t,i=Hr();if(Wt){if(t===void 0)throw Error(Xe(407));t=t()}else{if(t=e(),vn===null)throw Error(Xe(349));ss&30||U_(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,j0(F_.bind(null,r,o,n),[n]),r.flags|=2048,Wl(9,z_.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=Hr(),e=vn.identifierPrefix;if(Wt){var t=Si,r=bi;t=(r&~(1<<32-Dr(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Bl++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=EE++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},AE={readContext:br,useCallback:X_,useContext:br,useEffect:eg,useImperativeHandle:G_,useInsertionEffect:W_,useLayoutEffect:V_,useMemo:Y_,useReducer:dh,useRef:H_,useState:function(){return dh(Hl)},useDebugValue:tg,useDeferredValue:function(n){var e=Sr();return q_(e,ln.memoizedState,n)},useTransition:function(){var n=dh(Hl)[0],e=Sr().memoizedState;return[n,e]},useMutableSource:N_,useSyncExternalStore:O_,useId:K_,unstable_isNewReconciler:!1},PE={readContext:br,useCallback:X_,useContext:br,useEffect:eg,useImperativeHandle:G_,useInsertionEffect:W_,useLayoutEffect:V_,useMemo:Y_,useReducer:hh,useRef:H_,useState:function(){return hh(Hl)},useDebugValue:tg,useDeferredValue:function(n){var e=Sr();return ln===null?e.memoizedState=n:q_(e,ln.memoizedState,n)},useTransition:function(){var n=hh(Hl)[0],e=Sr().memoizedState;return[n,e]},useMutableSource:N_,useSyncExternalStore:O_,useId:K_,unstable_isNewReconciler:!1};function Rr(n,e){if(n&&n.defaultProps){e=Xt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function Kf(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Xt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var wd={isMounted:function(n){return(n=n._reactInternals)?fs(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Nn(),i=po(n),o=Mi(r,i);o.payload=e,t!=null&&(o.callback=t),e=ho(n,o,i),e!==null&&(Nr(e,n,i,r),vu(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Nn(),i=po(n),o=Mi(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=ho(n,o,i),e!==null&&(Nr(e,n,i,r),vu(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Nn(),r=po(n),i=Mi(t,r);i.tag=2,e!=null&&(i.callback=e),e=ho(n,i,r),e!==null&&(Nr(e,n,r,t),vu(e,n,r))}};function B0(n,e,t,r,i,o,s){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,s):e.prototype&&e.prototype.isPureReactComponent?!Nl(t,r)||!Nl(i,o):!0}function eb(n,e,t){var r=!1,i=bo,o=e.contextType;return typeof o=="object"&&o!==null?o=br(o):(i=Yn(e)?is:Pn.current,r=e.contextTypes,o=(r=r!=null)?_a(n,i):bo),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=wd,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function H0(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&wd.enqueueReplaceState(e,e.state,null)}function Jf(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},Xm(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=br(o):(o=Yn(e)?is:Pn.current,i.context=_a(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Kf(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&wd.enqueueReplaceState(i,i.state,null),Yu(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function Ea(n,e){try{var t="",r=e;do t+=i1(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function fh(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function Zf(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var kE=typeof WeakMap=="function"?WeakMap:Map;function tb(n,e,t){t=Mi(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){Qu||(Qu=!0,lp=r),Zf(n,e)},t}function nb(n,e,t){t=Mi(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){Zf(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){Zf(n,e),typeof r!="function"&&(fo===null?fo=new Set([this]):fo.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),t}function W0(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new kE;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=$E.bind(null,n,e,t),e.then(n,n))}function V0(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function $0(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Mi(-1,1),e.tag=2,ho(t,e,1))),t.lanes|=1),n)}var IE=Li.ReactCurrentOwner,$n=!1;function Ln(n,e,t,r){e.child=n===null?k_(e,null,t,r):Sa(e,n.child,t,r)}function G0(n,e,t,r,i){t=t.render;var o=e.ref;return fa(e,i),r=Zm(n,e,t,r,o,i),t=Qm(),n!==null&&!$n?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ki(n,e,i)):(Wt&&t&&jm(e),e.flags|=1,Ln(n,e,r,i),e.child)}function X0(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!cg(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,rb(n,e,o,r,i)):(n=wu(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var s=o.memoizedProps;if(t=t.compare,t=t!==null?t:Nl,t(s,r)&&n.ref===e.ref)return ki(n,e,i)}return e.flags|=1,n=mo(o,r),n.ref=e.ref,n.return=e,e.child=n}function rb(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(Nl(o,r)&&n.ref===e.ref)if($n=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&($n=!0);else return e.lanes=n.lanes,ki(n,e,i)}return Qf(n,e,t,r,i)}function ib(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},zt(na,rr),rr|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,zt(na,rr),rr|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,zt(na,rr),rr|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,zt(na,rr),rr|=r;return Ln(n,e,i,t),e.child}function ob(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Qf(n,e,t,r,i){var o=Yn(t)?is:Pn.current;return o=_a(e,o),fa(e,i),t=Zm(n,e,t,r,o,i),r=Qm(),n!==null&&!$n?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,ki(n,e,i)):(Wt&&r&&jm(e),e.flags|=1,Ln(n,e,t,i),e.child)}function Y0(n,e,t,r,i){if(Yn(t)){var o=!0;Wu(e)}else o=!1;if(fa(e,i),e.stateNode===null)_u(n,e),eb(e,t,r),Jf(e,t,r,i),r=!0;else if(n===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,c=t.contextType;typeof c=="object"&&c!==null?c=br(c):(c=Yn(t)?is:Pn.current,c=_a(e,c));var u=t.getDerivedStateFromProps,d=typeof u=="function"||typeof s.getSnapshotBeforeUpdate=="function";d||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==r||l!==c)&&H0(e,s,r,c),Ji=!1;var f=e.memoizedState;s.state=f,Yu(e,r,s,i),l=e.memoizedState,a!==r||f!==l||Xn.current||Ji?(typeof u=="function"&&(Kf(e,t,u,r),l=e.memoizedState),(a=Ji||B0(e,t,a,r,f,l,c))?(d||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{s=e.stateNode,L_(n,e),a=e.memoizedProps,c=e.type===e.elementType?a:Rr(e.type,a),s.props=c,d=e.pendingProps,f=s.context,l=t.contextType,typeof l=="object"&&l!==null?l=br(l):(l=Yn(t)?is:Pn.current,l=_a(e,l));var m=t.getDerivedStateFromProps;(u=typeof m=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==d||f!==l)&&H0(e,s,r,l),Ji=!1,f=e.memoizedState,s.state=f,Yu(e,r,s,i);var v=e.memoizedState;a!==d||f!==v||Xn.current||Ji?(typeof m=="function"&&(Kf(e,t,m,r),v=e.memoizedState),(c=Ji||B0(e,t,c,r,f,v,l)||!1)?(u||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(r,v,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(r,v,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=v),s.props=r,s.state=v,s.context=l,r=c):(typeof s.componentDidUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===n.memoizedProps&&f===n.memoizedState||(e.flags|=1024),r=!1)}return ep(n,e,t,r,o,i)}function ep(n,e,t,r,i,o){ob(n,e);var s=(e.flags&128)!==0;if(!r&&!s)return i&&L0(e,t,!1),ki(n,e,o);r=e.stateNode,IE.current=e;var a=s&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&s?(e.child=Sa(e,n.child,null,o),e.child=Sa(e,null,a,o)):Ln(n,e,a,o),e.memoizedState=r.state,i&&L0(e,t,!0),e.child}function sb(n){var e=n.stateNode;e.pendingContext?I0(n,e.pendingContext,e.pendingContext!==e.context):e.context&&I0(n,e.context,!1),Ym(n,e.containerInfo)}function q0(n,e,t,r,i){return ba(),Hm(i),e.flags|=256,Ln(n,e,t,r),e.child}var tp={dehydrated:null,treeContext:null,retryLane:0};function np(n){return{baseLanes:n,cachePool:null,transitions:null}}function ab(n,e,t){var r=e.pendingProps,i=Vt.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=n!==null&&n.memoizedState===null?!1:(i&2)!==0),a?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),zt(Vt,i&1),n===null)return Yf(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=r.children,n=r.fallback,o?(r=e.mode,o=e.child,s={mode:"hidden",children:s},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=Td(s,r,0,null),n=ns(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=np(t),e.memoizedState=tp,n):ng(e,s));if(i=n.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return LE(n,e,s,r,a,i,t);if(o){o=r.fallback,s=e.mode,i=n.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(s&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=mo(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?o=mo(a,o):(o=ns(o,s,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,s=n.child.memoizedState,s=s===null?np(t):{baseLanes:s.baseLanes|t,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=n.childLanes&~t,e.memoizedState=tp,r}return o=n.child,n=o.sibling,r=mo(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function ng(n,e){return e=Td({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Pc(n,e,t,r){return r!==null&&Hm(r),Sa(e,n.child,null,t),n=ng(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function LE(n,e,t,r,i,o,s){if(t)return e.flags&256?(e.flags&=-257,r=fh(Error(Xe(422))),Pc(n,e,s,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=Td({mode:"visible",children:r.children},i,0,null),o=ns(o,i,s,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&Sa(e,n.child,null,s),e.child.memoizedState=np(s),e.memoizedState=tp,o);if(!(e.mode&1))return Pc(n,e,s,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(Xe(419)),r=fh(o,r,void 0),Pc(n,e,s,r)}if(a=(s&n.childLanes)!==0,$n||a){if(r=vn,r!==null){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|s)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Pi(n,i),Nr(r,n,i,-1))}return lg(),r=fh(Error(Xe(421))),Pc(n,e,s,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=GE.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,sr=uo(i.nextSibling),ar=e,Wt=!0,kr=null,n!==null&&(gr[vr++]=bi,gr[vr++]=Si,gr[vr++]=os,bi=n.id,Si=n.overflow,os=e),e=ng(e,r.children),e.flags|=4096,e)}function K0(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),qf(n.return,e,t)}function ph(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function lb(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Ln(n,e,r.children,t),r=Vt.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&K0(n,t,e);else if(n.tag===19)K0(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(zt(Vt,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&qu(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),ph(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&qu(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}ph(e,!0,t,null,o);break;case"together":ph(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function _u(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function ki(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),as|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Xe(153));if(e.child!==null){for(n=e.child,t=mo(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=mo(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function DE(n,e,t){switch(e.tag){case 3:sb(e),ba();break;case 5:D_(e);break;case 1:Yn(e.type)&&Wu(e);break;case 4:Ym(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;zt(Gu,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(zt(Vt,Vt.current&1),e.flags|=128,null):t&e.child.childLanes?ab(n,e,t):(zt(Vt,Vt.current&1),n=ki(n,e,t),n!==null?n.sibling:null);zt(Vt,Vt.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return lb(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),zt(Vt,Vt.current),r)break;return null;case 22:case 23:return e.lanes=0,ib(n,e,t)}return ki(n,e,t)}var cb,rp,ub,db;cb=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};rp=function(){};ub=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Zo(qr.current);var o=null;switch(t){case"input":i=Mf(n,i),r=Mf(n,r),o=[];break;case"select":i=Xt({},i,{value:void 0}),r=Xt({},r,{value:void 0}),o=[];break;case"textarea":i=Rf(n,i),r=Rf(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=Bu)}Pf(t,r);var s;t=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(s in a)a.hasOwnProperty(s)&&(t||(t={}),t[s]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Rl.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(t||(t={}),t[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(t||(t={}),t[s]=l[s])}else t||(o||(o=[]),o.push(c,t)),t=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Rl.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&Ft("scroll",n),o||a===l||(o=[])):(o=o||[]).push(c,l))}t&&(o=o||[]).push("style",t);var c=o;(e.updateQueue=c)&&(e.flags|=4)}};db=function(n,e,t,r){t!==r&&(e.flags|=4)};function qa(n,e){if(!Wt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function Mn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function NE(n,e,t){var r=e.pendingProps;switch(Bm(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mn(e),null;case 1:return Yn(e.type)&&Hu(),Mn(e),null;case 3:return r=e.stateNode,wa(),jt(Xn),jt(Pn),Km(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Rc(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,kr!==null&&(dp(kr),kr=null))),rp(n,e),Mn(e),null;case 5:qm(e);var i=Zo(jl.current);if(t=e.type,n!==null&&e.stateNode!=null)ub(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Xe(166));return Mn(e),null}if(n=Zo(qr.current),Rc(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[Gr]=e,r[zl]=o,n=(e.mode&1)!==0,t){case"dialog":Ft("cancel",r),Ft("close",r);break;case"iframe":case"object":case"embed":Ft("load",r);break;case"video":case"audio":for(i=0;i<ul.length;i++)Ft(ul[i],r);break;case"source":Ft("error",r);break;case"img":case"image":case"link":Ft("error",r),Ft("load",r);break;case"details":Ft("toggle",r);break;case"input":o0(r,o),Ft("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Ft("invalid",r);break;case"textarea":a0(r,o),Ft("invalid",r)}Pf(t,o),i=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&Cc(r.textContent,a,n),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Cc(r.textContent,a,n),i=["children",""+a]):Rl.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&Ft("scroll",r)}switch(t){case"input":yc(r),s0(r,o,!0);break;case"textarea":yc(r),l0(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=Bu)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{s=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Fy(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=s.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=s.createElement(t,{is:r.is}):(n=s.createElement(t),t==="select"&&(s=n,r.multiple?s.multiple=!0:r.size&&(s.size=r.size))):n=s.createElementNS(n,t),n[Gr]=e,n[zl]=r,cb(n,e,!1,!1),e.stateNode=n;e:{switch(s=kf(t,r),t){case"dialog":Ft("cancel",n),Ft("close",n),i=r;break;case"iframe":case"object":case"embed":Ft("load",n),i=r;break;case"video":case"audio":for(i=0;i<ul.length;i++)Ft(ul[i],n);i=r;break;case"source":Ft("error",n),i=r;break;case"img":case"image":case"link":Ft("error",n),Ft("load",n),i=r;break;case"details":Ft("toggle",n),i=r;break;case"input":o0(n,r),i=Mf(n,r),Ft("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Xt({},r,{value:void 0}),Ft("invalid",n);break;case"textarea":a0(n,r),i=Rf(n,r),Ft("invalid",n);break;default:i=r}Pf(t,i),a=i;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?Hy(n,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&jy(n,l)):o==="children"?typeof l=="string"?(t!=="textarea"||l!=="")&&Al(n,l):typeof l=="number"&&Al(n,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Rl.hasOwnProperty(o)?l!=null&&o==="onScroll"&&Ft("scroll",n):l!=null&&Tm(n,o,l,s))}switch(t){case"input":yc(n),s0(n,r,!1);break;case"textarea":yc(n),l0(n);break;case"option":r.value!=null&&n.setAttribute("value",""+_o(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?ca(n,!!r.multiple,o,!1):r.defaultValue!=null&&ca(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Bu)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Mn(e),null;case 6:if(n&&e.stateNode!=null)db(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Xe(166));if(t=Zo(jl.current),Zo(qr.current),Rc(e)){if(r=e.stateNode,t=e.memoizedProps,r[Gr]=e,(o=r.nodeValue!==t)&&(n=ar,n!==null))switch(n.tag){case 3:Cc(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Cc(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[Gr]=e,e.stateNode=r}return Mn(e),null;case 13:if(jt(Vt),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Wt&&sr!==null&&e.mode&1&&!(e.flags&128))A_(),ba(),e.flags|=98560,o=!1;else if(o=Rc(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(Xe(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(Xe(317));o[Gr]=e}else ba(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Mn(e),o=!1}else kr!==null&&(dp(kr),kr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Vt.current&1?cn===0&&(cn=3):lg())),e.updateQueue!==null&&(e.flags|=4),Mn(e),null);case 4:return wa(),rp(n,e),n===null&&Ol(e.stateNode.containerInfo),Mn(e),null;case 10:return $m(e.type._context),Mn(e),null;case 17:return Yn(e.type)&&Hu(),Mn(e),null;case 19:if(jt(Vt),o=e.memoizedState,o===null)return Mn(e),null;if(r=(e.flags&128)!==0,s=o.rendering,s===null)if(r)qa(o,!1);else{if(cn!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(s=qu(n),s!==null){for(e.flags|=128,qa(o,!1),r=s.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,n=s.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return zt(Vt,Vt.current&1|2),e.child}n=n.sibling}o.tail!==null&&Qt()>Ma&&(e.flags|=128,r=!0,qa(o,!1),e.lanes=4194304)}else{if(!r)if(n=qu(s),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),qa(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!Wt)return Mn(e),null}else 2*Qt()-o.renderingStartTime>Ma&&t!==1073741824&&(e.flags|=128,r=!0,qa(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(t=o.last,t!==null?t.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Qt(),e.sibling=null,t=Vt.current,zt(Vt,r?t&1|2:t&1),e):(Mn(e),null);case 22:case 23:return ag(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?rr&1073741824&&(Mn(e),e.subtreeFlags&6&&(e.flags|=8192)):Mn(e),null;case 24:return null;case 25:return null}throw Error(Xe(156,e.tag))}function OE(n,e){switch(Bm(e),e.tag){case 1:return Yn(e.type)&&Hu(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return wa(),jt(Xn),jt(Pn),Km(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return qm(e),null;case 13:if(jt(Vt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Xe(340));ba()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return jt(Vt),null;case 4:return wa(),null;case 10:return $m(e.type._context),null;case 22:case 23:return ag(),null;case 24:return null;default:return null}}var kc=!1,An=!1,UE=typeof WeakSet=="function"?WeakSet:Set,at=null;function ta(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){Kt(n,e,r)}else t.current=null}function ip(n,e,t){try{t()}catch(r){Kt(n,e,r)}}var J0=!1;function zE(n,e){if(Bf=zu,n=g_(),Fm(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var s=0,a=-1,l=-1,c=0,u=0,d=n,f=null;t:for(;;){for(var m;d!==t||i!==0&&d.nodeType!==3||(a=s+i),d!==o||r!==0&&d.nodeType!==3||(l=s+r),d.nodeType===3&&(s+=d.nodeValue.length),(m=d.firstChild)!==null;)f=d,d=m;for(;;){if(d===n)break t;if(f===t&&++c===i&&(a=s),f===o&&++u===r&&(l=s),(m=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=m}t=a===-1||l===-1?null:{start:a,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(Hf={focusedElem:n,selectionRange:t},zu=!1,at=e;at!==null;)if(e=at,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,at=n;else for(;at!==null;){e=at;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var _=v.memoizedProps,x=v.memoizedState,p=e.stateNode,b=p.getSnapshotBeforeUpdate(e.elementType===e.type?_:Rr(e.type,_),x);p.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var g=e.stateNode.containerInfo;g.nodeType===1?g.textContent="":g.nodeType===9&&g.documentElement&&g.removeChild(g.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Xe(163))}}catch(y){Kt(e,e.return,y)}if(n=e.sibling,n!==null){n.return=e.return,at=n;break}at=e.return}return v=J0,J0=!1,v}function _l(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&ip(e,t,o)}i=i.next}while(i!==r)}}function Ed(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function op(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function hb(n){var e=n.alternate;e!==null&&(n.alternate=null,hb(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[Gr],delete e[zl],delete e[$f],delete e[_E],delete e[bE])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function fb(n){return n.tag===5||n.tag===3||n.tag===4}function Z0(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||fb(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function sp(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Bu));else if(r!==4&&(n=n.child,n!==null))for(sp(n,e,t),n=n.sibling;n!==null;)sp(n,e,t),n=n.sibling}function ap(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(ap(n,e,t),n=n.sibling;n!==null;)ap(n,e,t),n=n.sibling}var _n=null,Ar=!1;function zi(n,e,t){for(t=t.child;t!==null;)pb(n,e,t),t=t.sibling}function pb(n,e,t){if(Yr&&typeof Yr.onCommitFiberUnmount=="function")try{Yr.onCommitFiberUnmount(gd,t)}catch{}switch(t.tag){case 5:An||ta(t,e);case 6:var r=_n,i=Ar;_n=null,zi(n,e,t),_n=r,Ar=i,_n!==null&&(Ar?(n=_n,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):_n.removeChild(t.stateNode));break;case 18:_n!==null&&(Ar?(n=_n,t=t.stateNode,n.nodeType===8?ah(n.parentNode,t):n.nodeType===1&&ah(n,t),Ll(n)):ah(_n,t.stateNode));break;case 4:r=_n,i=Ar,_n=t.stateNode.containerInfo,Ar=!0,zi(n,e,t),_n=r,Ar=i;break;case 0:case 11:case 14:case 15:if(!An&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&ip(t,e,s),i=i.next}while(i!==r)}zi(n,e,t);break;case 1:if(!An&&(ta(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(a){Kt(t,e,a)}zi(n,e,t);break;case 21:zi(n,e,t);break;case 22:t.mode&1?(An=(r=An)||t.memoizedState!==null,zi(n,e,t),An=r):zi(n,e,t);break;default:zi(n,e,t)}}function Q0(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new UE),e.forEach(function(r){var i=XE.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function wr(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:_n=a.stateNode,Ar=!1;break e;case 3:_n=a.stateNode.containerInfo,Ar=!0;break e;case 4:_n=a.stateNode.containerInfo,Ar=!0;break e}a=a.return}if(_n===null)throw Error(Xe(160));pb(o,s,i),_n=null,Ar=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Kt(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)mb(e,n),e=e.sibling}function mb(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(wr(e,n),jr(n),r&4){try{_l(3,n,n.return),Ed(3,n)}catch(_){Kt(n,n.return,_)}try{_l(5,n,n.return)}catch(_){Kt(n,n.return,_)}}break;case 1:wr(e,n),jr(n),r&512&&t!==null&&ta(t,t.return);break;case 5:if(wr(e,n),jr(n),r&512&&t!==null&&ta(t,t.return),n.flags&32){var i=n.stateNode;try{Al(i,"")}catch(_){Kt(n,n.return,_)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,s=t!==null?t.memoizedProps:o,a=n.type,l=n.updateQueue;if(n.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&Uy(i,o),kf(a,s);var c=kf(a,o);for(s=0;s<l.length;s+=2){var u=l[s],d=l[s+1];u==="style"?Hy(i,d):u==="dangerouslySetInnerHTML"?jy(i,d):u==="children"?Al(i,d):Tm(i,u,d,c)}switch(a){case"input":Tf(i,o);break;case"textarea":zy(i,o);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var m=o.value;m!=null?ca(i,!!o.multiple,m,!1):f!==!!o.multiple&&(o.defaultValue!=null?ca(i,!!o.multiple,o.defaultValue,!0):ca(i,!!o.multiple,o.multiple?[]:"",!1))}i[zl]=o}catch(_){Kt(n,n.return,_)}}break;case 6:if(wr(e,n),jr(n),r&4){if(n.stateNode===null)throw Error(Xe(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(_){Kt(n,n.return,_)}}break;case 3:if(wr(e,n),jr(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Ll(e.containerInfo)}catch(_){Kt(n,n.return,_)}break;case 4:wr(e,n),jr(n);break;case 13:wr(e,n),jr(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(og=Qt())),r&4&&Q0(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?(An=(c=An)||u,wr(e,n),An=c):wr(e,n),jr(n),r&8192){if(c=n.memoizedState!==null,(n.stateNode.isHidden=c)&&!u&&n.mode&1)for(at=n,u=n.child;u!==null;){for(d=at=u;at!==null;){switch(f=at,m=f.child,f.tag){case 0:case 11:case 14:case 15:_l(4,f,f.return);break;case 1:ta(f,f.return);var v=f.stateNode;if(typeof v.componentWillUnmount=="function"){r=f,t=f.return;try{e=r,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(_){Kt(r,t,_)}}break;case 5:ta(f,f.return);break;case 22:if(f.memoizedState!==null){tv(d);continue}}m!==null?(m.return=f,at=m):tv(d)}u=u.sibling}e:for(u=null,d=n;;){if(d.tag===5){if(u===null){u=d;try{i=d.stateNode,c?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,l=d.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=By("display",s))}catch(_){Kt(n,n.return,_)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(_){Kt(n,n.return,_)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===n)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===n)break e;for(;d.sibling===null;){if(d.return===null||d.return===n)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:wr(e,n),jr(n),r&4&&Q0(n);break;case 21:break;default:wr(e,n),jr(n)}}function jr(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(fb(t)){var r=t;break e}t=t.return}throw Error(Xe(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Al(i,""),r.flags&=-33);var o=Z0(n);ap(n,o,i);break;case 3:case 4:var s=r.stateNode.containerInfo,a=Z0(n);sp(n,a,s);break;default:throw Error(Xe(161))}}catch(l){Kt(n,n.return,l)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function FE(n,e,t){at=n,gb(n)}function gb(n,e,t){for(var r=(n.mode&1)!==0;at!==null;){var i=at,o=i.child;if(i.tag===22&&r){var s=i.memoizedState!==null||kc;if(!s){var a=i.alternate,l=a!==null&&a.memoizedState!==null||An;a=kc;var c=An;if(kc=s,(An=l)&&!c)for(at=i;at!==null;)s=at,l=s.child,s.tag===22&&s.memoizedState!==null?nv(i):l!==null?(l.return=s,at=l):nv(i);for(;o!==null;)at=o,gb(o),o=o.sibling;at=i,kc=a,An=c}ev(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,at=o):ev(n)}}function ev(n){for(;at!==null;){var e=at;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:An||Ed(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!An)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Rr(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&z0(e,o,r);break;case 3:var s=e.updateQueue;if(s!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}z0(e,s,t)}break;case 5:var a=e.stateNode;if(t===null&&e.flags&4){t=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&t.focus();break;case"img":l.src&&(t.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Ll(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Xe(163))}An||e.flags&512&&op(e)}catch(f){Kt(e,e.return,f)}}if(e===n){at=null;break}if(t=e.sibling,t!==null){t.return=e.return,at=t;break}at=e.return}}function tv(n){for(;at!==null;){var e=at;if(e===n){at=null;break}var t=e.sibling;if(t!==null){t.return=e.return,at=t;break}at=e.return}}function nv(n){for(;at!==null;){var e=at;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Ed(4,e)}catch(l){Kt(e,t,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Kt(e,i,l)}}var o=e.return;try{op(e)}catch(l){Kt(e,o,l)}break;case 5:var s=e.return;try{op(e)}catch(l){Kt(e,s,l)}}}catch(l){Kt(e,e.return,l)}if(e===n){at=null;break}var a=e.sibling;if(a!==null){a.return=e.return,at=a;break}at=e.return}}var jE=Math.ceil,Zu=Li.ReactCurrentDispatcher,rg=Li.ReactCurrentOwner,yr=Li.ReactCurrentBatchConfig,At=0,vn=null,rn=null,Sn=0,rr=0,na=Co(0),cn=0,Vl=null,as=0,Md=0,ig=0,bl=null,Wn=null,og=0,Ma=1/0,mi=null,Qu=!1,lp=null,fo=null,Ic=!1,io=null,ed=0,Sl=0,cp=null,bu=-1,Su=0;function Nn(){return At&6?Qt():bu!==-1?bu:bu=Qt()}function po(n){return n.mode&1?At&2&&Sn!==0?Sn&-Sn:wE.transition!==null?(Su===0&&(Su=e_()),Su):(n=It,n!==0||(n=window.event,n=n===void 0?16:a_(n.type)),n):1}function Nr(n,e,t,r){if(50<Sl)throw Sl=0,cp=null,Error(Xe(185));tc(n,t,r),(!(At&2)||n!==vn)&&(n===vn&&(!(At&2)&&(Md|=t),cn===4&&eo(n,Sn)),qn(n,r),t===1&&At===0&&!(e.mode&1)&&(Ma=Qt()+500,bd&&Ro()))}function qn(n,e){var t=n.callbackNode;w1(n,e);var r=Uu(n,n===vn?Sn:0);if(r===0)t!==null&&d0(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&d0(t),e===1)n.tag===0?SE(rv.bind(null,n)):T_(rv.bind(null,n)),xE(function(){!(At&6)&&Ro()}),t=null;else{switch(t_(r)){case 1:t=km;break;case 4:t=Zy;break;case 16:t=Ou;break;case 536870912:t=Qy;break;default:t=Ou}t=Eb(t,vb.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function vb(n,e){if(bu=-1,Su=0,At&6)throw Error(Xe(327));var t=n.callbackNode;if(pa()&&n.callbackNode!==t)return null;var r=Uu(n,n===vn?Sn:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=td(n,r);else{e=r;var i=At;At|=2;var o=yb();(vn!==n||Sn!==e)&&(mi=null,Ma=Qt()+500,ts(n,e));do try{WE();break}catch(a){xb(n,a)}while(!0);Vm(),Zu.current=o,At=i,rn!==null?e=0:(vn=null,Sn=0,e=cn)}if(e!==0){if(e===2&&(i=Of(n),i!==0&&(r=i,e=up(n,i))),e===1)throw t=Vl,ts(n,0),eo(n,r),qn(n,Qt()),t;if(e===6)eo(n,r);else{if(i=n.current.alternate,!(r&30)&&!BE(i)&&(e=td(n,r),e===2&&(o=Of(n),o!==0&&(r=o,e=up(n,o))),e===1))throw t=Vl,ts(n,0),eo(n,r),qn(n,Qt()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(Xe(345));case 2:Ho(n,Wn,mi);break;case 3:if(eo(n,r),(r&130023424)===r&&(e=og+500-Qt(),10<e)){if(Uu(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Nn(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=Vf(Ho.bind(null,n,Wn,mi),e);break}Ho(n,Wn,mi);break;case 4:if(eo(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var s=31-Dr(r);o=1<<s,s=e[s],s>i&&(i=s),r&=~o}if(r=i,r=Qt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*jE(r/1960))-r,10<r){n.timeoutHandle=Vf(Ho.bind(null,n,Wn,mi),r);break}Ho(n,Wn,mi);break;case 5:Ho(n,Wn,mi);break;default:throw Error(Xe(329))}}}return qn(n,Qt()),n.callbackNode===t?vb.bind(null,n):null}function up(n,e){var t=bl;return n.current.memoizedState.isDehydrated&&(ts(n,e).flags|=256),n=td(n,e),n!==2&&(e=Wn,Wn=t,e!==null&&dp(e)),n}function dp(n){Wn===null?Wn=n:Wn.push.apply(Wn,n)}function BE(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!Ur(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function eo(n,e){for(e&=~ig,e&=~Md,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Dr(e),r=1<<t;n[t]=-1,e&=~r}}function rv(n){if(At&6)throw Error(Xe(327));pa();var e=Uu(n,0);if(!(e&1))return qn(n,Qt()),null;var t=td(n,e);if(n.tag!==0&&t===2){var r=Of(n);r!==0&&(e=r,t=up(n,r))}if(t===1)throw t=Vl,ts(n,0),eo(n,e),qn(n,Qt()),t;if(t===6)throw Error(Xe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Ho(n,Wn,mi),qn(n,Qt()),null}function sg(n,e){var t=At;At|=1;try{return n(e)}finally{At=t,At===0&&(Ma=Qt()+500,bd&&Ro())}}function ls(n){io!==null&&io.tag===0&&!(At&6)&&pa();var e=At;At|=1;var t=yr.transition,r=It;try{if(yr.transition=null,It=1,n)return n()}finally{It=r,yr.transition=t,At=e,!(At&6)&&Ro()}}function ag(){rr=na.current,jt(na)}function ts(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,vE(t)),rn!==null)for(t=rn.return;t!==null;){var r=t;switch(Bm(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Hu();break;case 3:wa(),jt(Xn),jt(Pn),Km();break;case 5:qm(r);break;case 4:wa();break;case 13:jt(Vt);break;case 19:jt(Vt);break;case 10:$m(r.type._context);break;case 22:case 23:ag()}t=t.return}if(vn=n,rn=n=mo(n.current,null),Sn=rr=e,cn=0,Vl=null,ig=Md=as=0,Wn=bl=null,Jo!==null){for(e=0;e<Jo.length;e++)if(t=Jo[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var s=o.next;o.next=i,r.next=s}t.pending=r}Jo=null}return n}function xb(n,e){do{var t=rn;try{if(Vm(),xu.current=Ju,Ku){for(var r=$t.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Ku=!1}if(ss=0,gn=ln=$t=null,yl=!1,Bl=0,rg.current=null,t===null||t.return===null){cn=1,Vl=e,rn=null;break}e:{var o=n,s=t.return,a=t,l=e;if(e=Sn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=V0(s);if(m!==null){m.flags&=-257,$0(m,s,a,o,e),m.mode&1&&W0(o,c,e),e=m,l=c;var v=e.updateQueue;if(v===null){var _=new Set;_.add(l),e.updateQueue=_}else v.add(l);break e}else{if(!(e&1)){W0(o,c,e),lg();break e}l=Error(Xe(426))}}else if(Wt&&a.mode&1){var x=V0(s);if(x!==null){!(x.flags&65536)&&(x.flags|=256),$0(x,s,a,o,e),Hm(Ea(l,a));break e}}o=l=Ea(l,a),cn!==4&&(cn=2),bl===null?bl=[o]:bl.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var p=tb(o,l,e);U0(o,p);break e;case 1:a=l;var b=o.type,g=o.stateNode;if(!(o.flags&128)&&(typeof b.getDerivedStateFromError=="function"||g!==null&&typeof g.componentDidCatch=="function"&&(fo===null||!fo.has(g)))){o.flags|=65536,e&=-e,o.lanes|=e;var y=nb(o,a,e);U0(o,y);break e}}o=o.return}while(o!==null)}bb(t)}catch(E){e=E,rn===t&&t!==null&&(rn=t=t.return);continue}break}while(!0)}function yb(){var n=Zu.current;return Zu.current=Ju,n===null?Ju:n}function lg(){(cn===0||cn===3||cn===2)&&(cn=4),vn===null||!(as&268435455)&&!(Md&268435455)||eo(vn,Sn)}function td(n,e){var t=At;At|=2;var r=yb();(vn!==n||Sn!==e)&&(mi=null,ts(n,e));do try{HE();break}catch(i){xb(n,i)}while(!0);if(Vm(),At=t,Zu.current=r,rn!==null)throw Error(Xe(261));return vn=null,Sn=0,cn}function HE(){for(;rn!==null;)_b(rn)}function WE(){for(;rn!==null&&!p1();)_b(rn)}function _b(n){var e=wb(n.alternate,n,rr);n.memoizedProps=n.pendingProps,e===null?bb(n):rn=e,rg.current=null}function bb(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=OE(t,e),t!==null){t.flags&=32767,rn=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{cn=6,rn=null;return}}else if(t=NE(t,e,rr),t!==null){rn=t;return}if(e=e.sibling,e!==null){rn=e;return}rn=e=n}while(e!==null);cn===0&&(cn=5)}function Ho(n,e,t){var r=It,i=yr.transition;try{yr.transition=null,It=1,VE(n,e,t,r)}finally{yr.transition=i,It=r}return null}function VE(n,e,t,r){do pa();while(io!==null);if(At&6)throw Error(Xe(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Xe(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(E1(n,o),n===vn&&(rn=vn=null,Sn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Ic||(Ic=!0,Eb(Ou,function(){return pa(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=yr.transition,yr.transition=null;var s=It;It=1;var a=At;At|=4,rg.current=null,zE(n,t),mb(t,n),uE(Hf),zu=!!Bf,Hf=Bf=null,n.current=t,FE(t),m1(),At=a,It=s,yr.transition=o}else n.current=t;if(Ic&&(Ic=!1,io=n,ed=i),o=n.pendingLanes,o===0&&(fo=null),x1(t.stateNode),qn(n,Qt()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(Qu)throw Qu=!1,n=lp,lp=null,n;return ed&1&&n.tag!==0&&pa(),o=n.pendingLanes,o&1?n===cp?Sl++:(Sl=0,cp=n):Sl=0,Ro(),null}function pa(){if(io!==null){var n=t_(ed),e=yr.transition,t=It;try{if(yr.transition=null,It=16>n?16:n,io===null)var r=!1;else{if(n=io,io=null,ed=0,At&6)throw Error(Xe(331));var i=At;for(At|=4,at=n.current;at!==null;){var o=at,s=o.child;if(at.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(at=c;at!==null;){var u=at;switch(u.tag){case 0:case 11:case 15:_l(8,u,o)}var d=u.child;if(d!==null)d.return=u,at=d;else for(;at!==null;){u=at;var f=u.sibling,m=u.return;if(hb(u),u===c){at=null;break}if(f!==null){f.return=m,at=f;break}at=m}}}var v=o.alternate;if(v!==null){var _=v.child;if(_!==null){v.child=null;do{var x=_.sibling;_.sibling=null,_=x}while(_!==null)}}at=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,at=s;else e:for(;at!==null;){if(o=at,o.flags&2048)switch(o.tag){case 0:case 11:case 15:_l(9,o,o.return)}var p=o.sibling;if(p!==null){p.return=o.return,at=p;break e}at=o.return}}var b=n.current;for(at=b;at!==null;){s=at;var g=s.child;if(s.subtreeFlags&2064&&g!==null)g.return=s,at=g;else e:for(s=b;at!==null;){if(a=at,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ed(9,a)}}catch(E){Kt(a,a.return,E)}if(a===s){at=null;break e}var y=a.sibling;if(y!==null){y.return=a.return,at=y;break e}at=a.return}}if(At=i,Ro(),Yr&&typeof Yr.onPostCommitFiberRoot=="function")try{Yr.onPostCommitFiberRoot(gd,n)}catch{}r=!0}return r}finally{It=t,yr.transition=e}}return!1}function iv(n,e,t){e=Ea(t,e),e=tb(n,e,1),n=ho(n,e,1),e=Nn(),n!==null&&(tc(n,1,e),qn(n,e))}function Kt(n,e,t){if(n.tag===3)iv(n,n,t);else for(;e!==null;){if(e.tag===3){iv(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(fo===null||!fo.has(r))){n=Ea(t,n),n=nb(e,n,1),e=ho(e,n,1),n=Nn(),e!==null&&(tc(e,1,n),qn(e,n));break}}e=e.return}}function $E(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Nn(),n.pingedLanes|=n.suspendedLanes&t,vn===n&&(Sn&t)===t&&(cn===4||cn===3&&(Sn&130023424)===Sn&&500>Qt()-og?ts(n,0):ig|=t),qn(n,e)}function Sb(n,e){e===0&&(n.mode&1?(e=Sc,Sc<<=1,!(Sc&130023424)&&(Sc=4194304)):e=1);var t=Nn();n=Pi(n,e),n!==null&&(tc(n,e,t),qn(n,t))}function GE(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),Sb(n,t)}function XE(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(Xe(314))}r!==null&&r.delete(e),Sb(n,t)}var wb;wb=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Xn.current)$n=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return $n=!1,DE(n,e,t);$n=!!(n.flags&131072)}else $n=!1,Wt&&e.flags&1048576&&C_(e,$u,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;_u(n,e),n=e.pendingProps;var i=_a(e,Pn.current);fa(e,t),i=Zm(null,e,r,n,i,t);var o=Qm();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Yn(r)?(o=!0,Wu(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Xm(e),i.updater=wd,e.stateNode=i,i._reactInternals=e,Jf(e,r,n,t),e=ep(null,e,r,!0,o,t)):(e.tag=0,Wt&&o&&jm(e),Ln(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(_u(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=qE(r),n=Rr(r,n),i){case 0:e=Qf(null,e,r,n,t);break e;case 1:e=Y0(null,e,r,n,t);break e;case 11:e=G0(null,e,r,n,t);break e;case 14:e=X0(null,e,r,Rr(r.type,n),t);break e}throw Error(Xe(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rr(r,i),Qf(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rr(r,i),Y0(n,e,r,i,t);case 3:e:{if(sb(e),n===null)throw Error(Xe(387));r=e.pendingProps,o=e.memoizedState,i=o.element,L_(n,e),Yu(e,r,null,t);var s=e.memoizedState;if(r=s.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=Ea(Error(Xe(423)),e),e=q0(n,e,r,t,i);break e}else if(r!==i){i=Ea(Error(Xe(424)),e),e=q0(n,e,r,t,i);break e}else for(sr=uo(e.stateNode.containerInfo.firstChild),ar=e,Wt=!0,kr=null,t=k_(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ba(),r===i){e=ki(n,e,t);break e}Ln(n,e,r,t)}e=e.child}return e;case 5:return D_(e),n===null&&Yf(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,s=i.children,Wf(r,i)?s=null:o!==null&&Wf(r,o)&&(e.flags|=32),ob(n,e),Ln(n,e,s,t),e.child;case 6:return n===null&&Yf(e),null;case 13:return ab(n,e,t);case 4:return Ym(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=Sa(e,null,r,t):Ln(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rr(r,i),G0(n,e,r,i,t);case 7:return Ln(n,e,e.pendingProps,t),e.child;case 8:return Ln(n,e,e.pendingProps.children,t),e.child;case 12:return Ln(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,s=i.value,zt(Gu,r._currentValue),r._currentValue=s,o!==null)if(Ur(o.value,s)){if(o.children===i.children&&!Xn.current){e=ki(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(o.tag===1){l=Mi(-1,t&-t),l.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),qf(o.return,t,e),a.lanes|=t;break}l=l.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(Xe(341));s.lanes|=t,a=s.alternate,a!==null&&(a.lanes|=t),qf(s,t,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}Ln(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,fa(e,t),i=br(i),r=r(i),e.flags|=1,Ln(n,e,r,t),e.child;case 14:return r=e.type,i=Rr(r,e.pendingProps),i=Rr(r.type,i),X0(n,e,r,i,t);case 15:return rb(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Rr(r,i),_u(n,e),e.tag=1,Yn(r)?(n=!0,Wu(e)):n=!1,fa(e,t),eb(e,r,i),Jf(e,r,i,t),ep(null,e,r,!0,n,t);case 19:return lb(n,e,t);case 22:return ib(n,e,t)}throw Error(Xe(156,e.tag))};function Eb(n,e){return Jy(n,e)}function YE(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(n,e,t,r){return new YE(n,e,t,r)}function cg(n){return n=n.prototype,!(!n||!n.isReactComponent)}function qE(n){if(typeof n=="function")return cg(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Rm)return 11;if(n===Am)return 14}return 2}function mo(n,e){var t=n.alternate;return t===null?(t=xr(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function wu(n,e,t,r,i,o){var s=2;if(r=n,typeof n=="function")cg(n)&&(s=1);else if(typeof n=="string")s=5;else e:switch(n){case Gs:return ns(t.children,i,o,e);case Cm:s=8,i|=8;break;case bf:return n=xr(12,t,e,i|2),n.elementType=bf,n.lanes=o,n;case Sf:return n=xr(13,t,e,i),n.elementType=Sf,n.lanes=o,n;case wf:return n=xr(19,t,e,i),n.elementType=wf,n.lanes=o,n;case Dy:return Td(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Iy:s=10;break e;case Ly:s=9;break e;case Rm:s=11;break e;case Am:s=14;break e;case Ki:s=16,r=null;break e}throw Error(Xe(130,n==null?n:typeof n,""))}return e=xr(s,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function ns(n,e,t,r){return n=xr(7,n,r,e),n.lanes=t,n}function Td(n,e,t,r){return n=xr(22,n,r,e),n.elementType=Dy,n.lanes=t,n.stateNode={isHidden:!1},n}function mh(n,e,t){return n=xr(6,n,null,e),n.lanes=t,n}function gh(n,e,t){return e=xr(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function KE(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Kd(0),this.expirationTimes=Kd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kd(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function ug(n,e,t,r,i,o,s,a,l){return n=new KE(n,e,t,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=xr(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xm(o),n}function JE(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$s,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function Mb(n){if(!n)return bo;n=n._reactInternals;e:{if(fs(n)!==n||n.tag!==1)throw Error(Xe(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Yn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Xe(171))}if(n.tag===1){var t=n.type;if(Yn(t))return M_(n,t,e)}return e}function Tb(n,e,t,r,i,o,s,a,l){return n=ug(t,r,!0,n,i,o,s,a,l),n.context=Mb(null),t=n.current,r=Nn(),i=po(t),o=Mi(r,i),o.callback=e??null,ho(t,o,i),n.current.lanes=i,tc(n,i,r),qn(n,r),n}function Cd(n,e,t,r){var i=e.current,o=Nn(),s=po(i);return t=Mb(t),e.context===null?e.context=t:e.pendingContext=t,e=Mi(o,s),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=ho(i,e,s),n!==null&&(Nr(n,i,s,o),vu(n,i,s)),s}function nd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function ov(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function dg(n,e){ov(n,e),(n=n.alternate)&&ov(n,e)}function ZE(){return null}var Cb=typeof reportError=="function"?reportError:function(n){console.error(n)};function hg(n){this._internalRoot=n}Rd.prototype.render=hg.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Xe(409));Cd(n,e,null,null)};Rd.prototype.unmount=hg.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;ls(function(){Cd(null,n,null,null)}),e[Ai]=null}};function Rd(n){this._internalRoot=n}Rd.prototype.unstable_scheduleHydration=function(n){if(n){var e=i_();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Qi.length&&e!==0&&e<Qi[t].priority;t++);Qi.splice(t,0,n),t===0&&s_(n)}};function fg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Ad(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function sv(){}function QE(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var c=nd(s);o.call(c)}}var s=Tb(e,r,n,0,null,!1,!1,"",sv);return n._reactRootContainer=s,n[Ai]=s.current,Ol(n.nodeType===8?n.parentNode:n),ls(),s}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=nd(l);a.call(c)}}var l=ug(n,0,!1,null,null,!1,!1,"",sv);return n._reactRootContainer=l,n[Ai]=l.current,Ol(n.nodeType===8?n.parentNode:n),ls(function(){Cd(e,l,t,r)}),l}function Pd(n,e,t,r,i){var o=t._reactRootContainer;if(o){var s=o;if(typeof i=="function"){var a=i;i=function(){var l=nd(s);a.call(l)}}Cd(e,s,n,i)}else s=QE(t,e,n,i,r);return nd(s)}n_=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=cl(e.pendingLanes);t!==0&&(Im(e,t|1),qn(e,Qt()),!(At&6)&&(Ma=Qt()+500,Ro()))}break;case 13:ls(function(){var r=Pi(n,1);if(r!==null){var i=Nn();Nr(r,n,1,i)}}),dg(n,1)}};Lm=function(n){if(n.tag===13){var e=Pi(n,134217728);if(e!==null){var t=Nn();Nr(e,n,134217728,t)}dg(n,134217728)}};r_=function(n){if(n.tag===13){var e=po(n),t=Pi(n,e);if(t!==null){var r=Nn();Nr(t,n,e,r)}dg(n,e)}};i_=function(){return It};o_=function(n,e){var t=It;try{return It=n,e()}finally{It=t}};Lf=function(n,e,t){switch(e){case"input":if(Tf(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=_d(r);if(!i)throw Error(Xe(90));Oy(r),Tf(r,i)}}}break;case"textarea":zy(n,t);break;case"select":e=t.value,e!=null&&ca(n,!!t.multiple,e,!1)}};$y=sg;Gy=ls;var e2={usingClientEntryPoint:!1,Events:[rc,Ks,_d,Wy,Vy,sg]},Ka={findFiberByHostInstance:Ko,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},t2={bundleType:Ka.bundleType,version:Ka.version,rendererPackageName:Ka.rendererPackageName,rendererConfig:Ka.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Li.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=qy(n),n===null?null:n.stateNode},findFiberByHostInstance:Ka.findFiberByHostInstance||ZE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lc.isDisabled&&Lc.supportsFiber)try{gd=Lc.inject(t2),Yr=Lc}catch{}}dr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=e2;dr.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fg(e))throw Error(Xe(200));return JE(n,e,null,t)};dr.createRoot=function(n,e){if(!fg(n))throw Error(Xe(299));var t=!1,r="",i=Cb;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=ug(n,1,!1,null,null,t,!1,r,i),n[Ai]=e.current,Ol(n.nodeType===8?n.parentNode:n),new hg(e)};dr.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Xe(188)):(n=Object.keys(n).join(","),Error(Xe(268,n)));return n=qy(e),n=n===null?null:n.stateNode,n};dr.flushSync=function(n){return ls(n)};dr.hydrate=function(n,e,t){if(!Ad(e))throw Error(Xe(200));return Pd(null,n,e,!0,t)};dr.hydrateRoot=function(n,e,t){if(!fg(n))throw Error(Xe(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",s=Cb;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),e=Tb(e,null,n,1,t??null,i,!1,o,s),n[Ai]=e.current,Ol(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Rd(e)};dr.render=function(n,e,t){if(!Ad(e))throw Error(Xe(200));return Pd(null,n,e,!1,t)};dr.unmountComponentAtNode=function(n){if(!Ad(n))throw Error(Xe(40));return n._reactRootContainer?(ls(function(){Pd(null,null,n,!1,function(){n._reactRootContainer=null,n[Ai]=null})}),!0):!1};dr.unstable_batchedUpdates=sg;dr.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!Ad(t))throw Error(Xe(200));if(n==null||n._reactInternals===void 0)throw Error(Xe(38));return Pd(n,e,t,!1,r)};dr.version="18.3.1-next-f1338f8080-20240426";function Rb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Rb)}catch(n){console.error(n)}}Rb(),Ry.exports=dr;var pg=Ry.exports,av=pg;yf.createRoot=av.createRoot,yf.hydrateRoot=av.hydrateRoot;/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var lv="popstate";function n2(n={}){function e(r,i){let{pathname:o,search:s,hash:a}=r.location;return hp("",{pathname:o,search:s,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function t(r,i){return typeof i=="string"?i:$l(i)}return i2(e,t,null,n)}function Gt(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function zr(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function r2(){return Math.random().toString(36).substring(2,10)}function cv(n,e){return{usr:n.state,key:n.key,idx:e}}function hp(n,e,t=null,r){return{pathname:typeof n=="string"?n:n.pathname,search:"",hash:"",...typeof e=="string"?Na(e):e,state:t,key:e&&e.key||r||r2()}}function $l({pathname:n="/",search:e="",hash:t=""}){return e&&e!=="?"&&(n+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(n+=t.charAt(0)==="#"?t:"#"+t),n}function Na(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substring(t),n=n.substring(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substring(r),n=n.substring(0,r)),n&&(e.pathname=n)}return e}function i2(n,e,t,r={}){let{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,a="POP",l=null,c=u();c==null&&(c=0,s.replaceState({...s.state,idx:c},""));function u(){return(s.state||{idx:null}).idx}function d(){a="POP";let x=u(),p=x==null?null:x-c;c=x,l&&l({action:a,location:_.location,delta:p})}function f(x,p){a="PUSH";let b=hp(_.location,x,p);c=u()+1;let g=cv(b,c),y=_.createHref(b);try{s.pushState(g,"",y)}catch(E){if(E instanceof DOMException&&E.name==="DataCloneError")throw E;i.location.assign(y)}o&&l&&l({action:a,location:_.location,delta:1})}function m(x,p){a="REPLACE";let b=hp(_.location,x,p);c=u();let g=cv(b,c),y=_.createHref(b);s.replaceState(g,"",y),o&&l&&l({action:a,location:_.location,delta:0})}function v(x){return o2(x)}let _={get action(){return a},get location(){return n(i,s)},listen(x){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(lv,d),l=x,()=>{i.removeEventListener(lv,d),l=null}},createHref(x){return e(i,x)},createURL:v,encodeLocation(x){let p=v(x);return{pathname:p.pathname,search:p.search,hash:p.hash}},push:f,replace:m,go(x){return s.go(x)}};return _}function o2(n,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Gt(t,"No window.location.(origin|href) available to create URL");let r=typeof n=="string"?n:$l(n);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=t+r),new URL(r,t)}function Ab(n,e,t="/"){return s2(n,e,t,!1)}function s2(n,e,t,r){let i=typeof e=="string"?Na(e):e,o=Ii(i.pathname||"/",t);if(o==null)return null;let s=Pb(n);a2(s);let a=null;for(let l=0;a==null&&l<s.length;++l){let c=x2(o);a=g2(s[l],c,r)}return a}function Pb(n,e=[],t=[],r="",i=!1){let o=(s,a,l=i,c)=>{let u={relativePath:c===void 0?s.path||"":c,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(r)&&l)return;Gt(u.relativePath.startsWith(r),`Absolute route path "${u.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(r.length)}let d=Ti([r,u.relativePath]),f=t.concat(u);s.children&&s.children.length>0&&(Gt(s.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),Pb(s.children,e,f,d,l)),!(s.path==null&&!s.index)&&e.push({path:d,score:p2(d,s.index),routesMeta:f})};return n.forEach((s,a)=>{var l;if(s.path===""||!((l=s.path)!=null&&l.includes("?")))o(s,a);else for(let c of kb(s.path))o(s,a,!0,c)}),e}function kb(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let s=kb(r.join("/")),a=[];return a.push(...s.map(l=>l===""?o:[o,l].join("/"))),i&&a.push(...s),a.map(l=>n.startsWith("/")&&l===""?"/":l)}function a2(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:m2(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}var l2=/^:[\w-]+$/,c2=3,u2=2,d2=1,h2=10,f2=-2,uv=n=>n==="*";function p2(n,e){let t=n.split("/"),r=t.length;return t.some(uv)&&(r+=f2),e&&(r+=u2),t.filter(i=>!uv(i)).reduce((i,o)=>i+(l2.test(o)?c2:o===""?d2:h2),r)}function m2(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function g2(n,e,t=!1){let{routesMeta:r}=n,i={},o="/",s=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=o==="/"?e:e.slice(o.length)||"/",d=rd({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!d&&c&&t&&!r[r.length-1].route.index&&(d=rd({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!d)return null;Object.assign(i,d.params),s.push({params:i,pathname:Ti([o,d.pathname]),pathnameBase:S2(Ti([o,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(o=Ti([o,d.pathnameBase]))}return s}function rd(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=v2(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce((c,{paramName:u,isOptional:d},f)=>{if(u==="*"){let v=a[f]||"";s=o.slice(0,o.length-v.length).replace(/(.)\/+$/,"$1")}const m=a[f];return d&&!m?c[u]=void 0:c[u]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:o,pathnameBase:s,pattern:n}}function v2(n,e=!1,t=!0){zr(n==="*"||!n.endsWith("*")||n.endsWith("/*"),`Route path "${n}" will be treated as if it were "${n.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${n.replace(/\*$/,"/*")}".`);let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(s,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function x2(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return zr(!1,`The URL path "${n}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),n}}function Ii(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function y2(n,e="/"){let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?Na(n):n;return{pathname:t?t.startsWith("/")?t:_2(t,e):e,search:w2(r),hash:E2(i)}}function _2(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function vh(n,e,t,r){return`Cannot include a '${n}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function b2(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Ib(n){let e=b2(n);return e.map((t,r)=>r===e.length-1?t.pathname:t.pathnameBase)}function Lb(n,e,t,r=!1){let i;typeof n=="string"?i=Na(n):(i={...n},Gt(!i.pathname||!i.pathname.includes("?"),vh("?","pathname","search",i)),Gt(!i.pathname||!i.pathname.includes("#"),vh("#","pathname","hash",i)),Gt(!i.search||!i.search.includes("#"),vh("#","search","hash",i)));let o=n===""||i.pathname==="",s=o?"/":i.pathname,a;if(s==null)a=t;else{let d=e.length-1;if(!r&&s.startsWith("..")){let f=s.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?e[d]:"/"}let l=y2(i,a),c=s&&s!=="/"&&s.endsWith("/"),u=(o||s===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var Ti=n=>n.join("/").replace(/\/\/+/g,"/"),S2=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),w2=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,E2=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function M2(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}var Db=["POST","PUT","PATCH","DELETE"];new Set(Db);var T2=["GET",...Db];new Set(T2);var Oa=S.createContext(null);Oa.displayName="DataRouter";var kd=S.createContext(null);kd.displayName="DataRouterState";S.createContext(!1);var Nb=S.createContext({isTransitioning:!1});Nb.displayName="ViewTransition";var C2=S.createContext(new Map);C2.displayName="Fetchers";var R2=S.createContext(null);R2.displayName="Await";var Qr=S.createContext(null);Qr.displayName="Navigation";var oc=S.createContext(null);oc.displayName="Location";var ei=S.createContext({outlet:null,matches:[],isDataRoute:!1});ei.displayName="Route";var mg=S.createContext(null);mg.displayName="RouteError";function A2(n,{relative:e}={}){Gt(sc(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:r}=S.useContext(Qr),{hash:i,pathname:o,search:s}=lc(n,{relative:e}),a=o;return t!=="/"&&(a=o==="/"?t:Ti([t,o])),r.createHref({pathname:a,search:s,hash:i})}function sc(){return S.useContext(oc)!=null}function Di(){return Gt(sc(),"useLocation() may be used only in the context of a <Router> component."),S.useContext(oc).location}var Ob="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Ub(n){S.useContext(Qr).static||S.useLayoutEffect(n)}function Jn(){let{isDataRoute:n}=S.useContext(ei);return n?H2():P2()}function P2(){Gt(sc(),"useNavigate() may be used only in the context of a <Router> component.");let n=S.useContext(Oa),{basename:e,navigator:t}=S.useContext(Qr),{matches:r}=S.useContext(ei),{pathname:i}=Di(),o=JSON.stringify(Ib(r)),s=S.useRef(!1);return Ub(()=>{s.current=!0}),S.useCallback((l,c={})=>{if(zr(s.current,Ob),!s.current)return;if(typeof l=="number"){t.go(l);return}let u=Lb(l,JSON.parse(o),i,c.relative==="path");n==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:Ti([e,u.pathname])),(c.replace?t.replace:t.push)(u,c.state,c)},[e,t,o,i,n])}S.createContext(null);function ac(){let{matches:n}=S.useContext(ei),e=n[n.length-1];return e?e.params:{}}function lc(n,{relative:e}={}){let{matches:t}=S.useContext(ei),{pathname:r}=Di(),i=JSON.stringify(Ib(t));return S.useMemo(()=>Lb(n,JSON.parse(i),r,e==="path"),[n,i,r,e])}function k2(n,e){return zb(n,e)}function zb(n,e,t,r,i){var b;Gt(sc(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:o}=S.useContext(Qr),{matches:s}=S.useContext(ei),a=s[s.length-1],l=a?a.params:{},c=a?a.pathname:"/",u=a?a.pathnameBase:"/",d=a&&a.route;{let g=d&&d.path||"";Fb(c,!d||g.endsWith("*")||g.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${g}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${g}"> to <Route path="${g==="/"?"*":`${g}/*`}">.`)}let f=Di(),m;if(e){let g=typeof e=="string"?Na(e):e;Gt(u==="/"||((b=g.pathname)==null?void 0:b.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${g.pathname}" was given in the \`location\` prop.`),m=g}else m=f;let v=m.pathname||"/",_=v;if(u!=="/"){let g=u.replace(/^\//,"").split("/");_="/"+v.replace(/^\//,"").split("/").slice(g.length).join("/")}let x=Ab(n,{pathname:_});zr(d||x!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),zr(x==null||x[x.length-1].route.element!==void 0||x[x.length-1].route.Component!==void 0||x[x.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let p=O2(x&&x.map(g=>Object.assign({},g,{params:Object.assign({},l,g.params),pathname:Ti([u,o.encodeLocation?o.encodeLocation(g.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:g.pathname]),pathnameBase:g.pathnameBase==="/"?u:Ti([u,o.encodeLocation?o.encodeLocation(g.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:g.pathnameBase])})),s,t,r,i);return e&&p?S.createElement(oc.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},p):p}function I2(){let n=B2(),e=M2(n)?`${n.status} ${n.statusText}`:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r},o={padding:"2px 4px",backgroundColor:r},s=null;return console.error("Error handled by React Router default ErrorBoundary:",n),s=S.createElement(S.Fragment,null,S.createElement("p",null," Hey developer "),S.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",S.createElement("code",{style:o},"ErrorBoundary")," or"," ",S.createElement("code",{style:o},"errorElement")," prop on your route.")),S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},e),t?S.createElement("pre",{style:i},t):null,s)}var L2=S.createElement(I2,null),D2=class extends S.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,e){return e.location!==n.location||e.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:e.error,location:e.location,revalidation:n.revalidation||e.revalidation}}componentDidCatch(n,e){this.props.unstable_onError?this.props.unstable_onError(n,e):console.error("React Router caught the following error during render",n)}render(){return this.state.error!==void 0?S.createElement(ei.Provider,{value:this.props.routeContext},S.createElement(mg.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function N2({routeContext:n,match:e,children:t}){let r=S.useContext(Oa);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),S.createElement(ei.Provider,{value:n},t)}function O2(n,e=[],t=null,r=null,i=null){if(n==null){if(!t)return null;if(t.errors)n=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)n=t.matches;else return null}let o=n,s=t==null?void 0:t.errors;if(s!=null){let c=o.findIndex(u=>u.route.id&&(s==null?void 0:s[u.route.id])!==void 0);Gt(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(s).join(",")}`),o=o.slice(0,Math.min(o.length,c+1))}let a=!1,l=-1;if(t)for(let c=0;c<o.length;c++){let u=o[c];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(l=c),u.route.id){let{loaderData:d,errors:f}=t,m=u.route.loader&&!d.hasOwnProperty(u.route.id)&&(!f||f[u.route.id]===void 0);if(u.route.lazy||m){a=!0,l>=0?o=o.slice(0,l+1):o=[o[0]];break}}}return o.reduceRight((c,u,d)=>{let f,m=!1,v=null,_=null;t&&(f=s&&u.route.id?s[u.route.id]:void 0,v=u.route.errorElement||L2,a&&(l<0&&d===0?(Fb("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),m=!0,_=null):l===d&&(m=!0,_=u.route.hydrateFallbackElement||null)));let x=e.concat(o.slice(0,d+1)),p=()=>{let b;return f?b=v:m?b=_:u.route.Component?b=S.createElement(u.route.Component,null):u.route.element?b=u.route.element:b=c,S.createElement(N2,{match:u,routeContext:{outlet:c,matches:x,isDataRoute:t!=null},children:b})};return t&&(u.route.ErrorBoundary||u.route.errorElement||d===0)?S.createElement(D2,{location:t.location,revalidation:t.revalidation,component:v,error:f,children:p(),routeContext:{outlet:null,matches:x,isDataRoute:!0},unstable_onError:r}):p()},null)}function gg(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function U2(n){let e=S.useContext(Oa);return Gt(e,gg(n)),e}function z2(n){let e=S.useContext(kd);return Gt(e,gg(n)),e}function F2(n){let e=S.useContext(ei);return Gt(e,gg(n)),e}function vg(n){let e=F2(n),t=e.matches[e.matches.length-1];return Gt(t.route.id,`${n} can only be used on routes that contain a unique "id"`),t.route.id}function j2(){return vg("useRouteId")}function B2(){var r;let n=S.useContext(mg),e=z2("useRouteError"),t=vg("useRouteError");return n!==void 0?n:(r=e.errors)==null?void 0:r[t]}function H2(){let{router:n}=U2("useNavigate"),e=vg("useNavigate"),t=S.useRef(!1);return Ub(()=>{t.current=!0}),S.useCallback(async(i,o={})=>{zr(t.current,Ob),t.current&&(typeof i=="number"?n.navigate(i):await n.navigate(i,{fromRouteId:e,...o}))},[n,e])}var dv={};function Fb(n,e,t){!e&&!dv[n]&&(dv[n]=!0,zr(!1,t))}S.memo(W2);function W2({routes:n,future:e,state:t,unstable_onError:r}){return zb(n,void 0,t,r,e)}function mr(n){Gt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function V2({basename:n="/",children:e=null,location:t,navigationType:r="POP",navigator:i,static:o=!1}){Gt(!sc(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let s=n.replace(/^\/*/,"/"),a=S.useMemo(()=>({basename:s,navigator:i,static:o,future:{}}),[s,i,o]);typeof t=="string"&&(t=Na(t));let{pathname:l="/",search:c="",hash:u="",state:d=null,key:f="default"}=t,m=S.useMemo(()=>{let v=Ii(l,s);return v==null?null:{location:{pathname:v,search:c,hash:u,state:d,key:f},navigationType:r}},[s,l,c,u,d,f,r]);return zr(m!=null,`<Router basename="${s}"> is not able to match the URL "${l}${c}${u}" because it does not start with the basename, so the <Router> won't render anything.`),m==null?null:S.createElement(Qr.Provider,{value:a},S.createElement(oc.Provider,{children:e,value:m}))}function $2({children:n,location:e}){return k2(fp(n),e)}function fp(n,e=[]){let t=[];return S.Children.forEach(n,(r,i)=>{if(!S.isValidElement(r))return;let o=[...e,i];if(r.type===S.Fragment){t.push.apply(t,fp(r.props.children,o));return}Gt(r.type===mr,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Gt(!r.props.index||!r.props.children,"An index route cannot have child routes.");let s={id:r.props.id||o.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(s.children=fp(r.props.children,o)),t.push(s)}),t}var Eu="get",Mu="application/x-www-form-urlencoded";function Id(n){return n!=null&&typeof n.tagName=="string"}function G2(n){return Id(n)&&n.tagName.toLowerCase()==="button"}function X2(n){return Id(n)&&n.tagName.toLowerCase()==="form"}function Y2(n){return Id(n)&&n.tagName.toLowerCase()==="input"}function q2(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function K2(n,e){return n.button===0&&(!e||e==="_self")&&!q2(n)}function pp(n=""){return new URLSearchParams(typeof n=="string"||Array.isArray(n)||n instanceof URLSearchParams?n:Object.keys(n).reduce((e,t)=>{let r=n[t];return e.concat(Array.isArray(r)?r.map(i=>[t,i]):[[t,r]])},[]))}function J2(n,e){let t=pp(n);return e&&e.forEach((r,i)=>{t.has(i)||e.getAll(i).forEach(o=>{t.append(i,o)})}),t}var Dc=null;function Z2(){if(Dc===null)try{new FormData(document.createElement("form"),0),Dc=!1}catch{Dc=!0}return Dc}var Q2=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function xh(n){return n!=null&&!Q2.has(n)?(zr(!1,`"${n}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Mu}"`),null):n}function eM(n,e){let t,r,i,o,s;if(X2(n)){let a=n.getAttribute("action");r=a?Ii(a,e):null,t=n.getAttribute("method")||Eu,i=xh(n.getAttribute("enctype"))||Mu,o=new FormData(n)}else if(G2(n)||Y2(n)&&(n.type==="submit"||n.type==="image")){let a=n.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=n.getAttribute("formaction")||a.getAttribute("action");if(r=l?Ii(l,e):null,t=n.getAttribute("formmethod")||a.getAttribute("method")||Eu,i=xh(n.getAttribute("formenctype"))||xh(a.getAttribute("enctype"))||Mu,o=new FormData(a,n),!Z2()){let{name:c,type:u,value:d}=n;if(u==="image"){let f=c?`${c}.`:"";o.append(`${f}x`,"0"),o.append(`${f}y`,"0")}else c&&o.append(c,d)}}else{if(Id(n))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=Eu,r=null,i=Mu,s=n}return o&&i==="text/plain"&&(s=o,o=void 0),{action:r,method:t.toLowerCase(),encType:i,formData:o,body:s}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function xg(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function tM(n,e,t){let r=typeof n=="string"?new URL(n,typeof window>"u"?"server://singlefetch/":window.location.origin):n;return r.pathname==="/"?r.pathname=`_root.${t}`:e&&Ii(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${t}`,r}async function nM(n,e){if(n.id in e)return e[n.id];try{let t=await import(n.module);return e[n.id]=t,t}catch(t){return console.error(`Error loading route module \`${n.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function rM(n){return n==null?!1:n.href==null?n.rel==="preload"&&typeof n.imageSrcSet=="string"&&typeof n.imageSizes=="string":typeof n.rel=="string"&&typeof n.href=="string"}async function iM(n,e,t){let r=await Promise.all(n.map(async i=>{let o=e.routes[i.route.id];if(o){let s=await nM(o,t);return s.links?s.links():[]}return[]}));return lM(r.flat(1).filter(rM).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function hv(n,e,t,r,i,o){let s=(l,c)=>t[c]?l.route.id!==t[c].route.id:!0,a=(l,c)=>{var u;return t[c].pathname!==l.pathname||((u=t[c].route.path)==null?void 0:u.endsWith("*"))&&t[c].params["*"]!==l.params["*"]};return o==="assets"?e.filter((l,c)=>s(l,c)||a(l,c)):o==="data"?e.filter((l,c)=>{var d;let u=r.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(s(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:((d=t[0])==null?void 0:d.params)||{},nextUrl:new URL(n,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function oM(n,e,{includeHydrateFallback:t}={}){return sM(n.map(r=>{let i=e.routes[r.route.id];if(!i)return[];let o=[i.module];return i.clientActionModule&&(o=o.concat(i.clientActionModule)),i.clientLoaderModule&&(o=o.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(o=o.concat(i.hydrateFallbackModule)),i.imports&&(o=o.concat(i.imports)),o}).flat(1))}function sM(n){return[...new Set(n)]}function aM(n){let e={},t=Object.keys(n).sort();for(let r of t)e[r]=n[r];return e}function lM(n,e){let t=new Set;return new Set(e),n.reduce((r,i)=>{let o=JSON.stringify(aM(i));return t.has(o)||(t.add(o),r.push({key:o,link:i})),r},[])}function jb(){let n=S.useContext(Oa);return xg(n,"You must render this element inside a <DataRouterContext.Provider> element"),n}function cM(){let n=S.useContext(kd);return xg(n,"You must render this element inside a <DataRouterStateContext.Provider> element"),n}var yg=S.createContext(void 0);yg.displayName="FrameworkContext";function Bb(){let n=S.useContext(yg);return xg(n,"You must render this element inside a <HydratedRouter> element"),n}function uM(n,e){let t=S.useContext(yg),[r,i]=S.useState(!1),[o,s]=S.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:d}=e,f=S.useRef(null);S.useEffect(()=>{if(n==="render"&&s(!0),n==="viewport"){let _=p=>{p.forEach(b=>{s(b.isIntersecting)})},x=new IntersectionObserver(_,{threshold:.5});return f.current&&x.observe(f.current),()=>{x.disconnect()}}},[n]),S.useEffect(()=>{if(r){let _=setTimeout(()=>{s(!0)},100);return()=>{clearTimeout(_)}}},[r]);let m=()=>{i(!0)},v=()=>{i(!1),s(!1)};return t?n!=="intent"?[o,f,{}]:[o,f,{onFocus:Ja(a,m),onBlur:Ja(l,v),onMouseEnter:Ja(c,m),onMouseLeave:Ja(u,v),onTouchStart:Ja(d,m)}]:[!1,f,{}]}function Ja(n,e){return t=>{n&&n(t),t.defaultPrevented||e(t)}}function dM({page:n,...e}){let{router:t}=jb(),r=S.useMemo(()=>Ab(t.routes,n,t.basename),[t.routes,n,t.basename]);return r?S.createElement(fM,{page:n,matches:r,...e}):null}function hM(n){let{manifest:e,routeModules:t}=Bb(),[r,i]=S.useState([]);return S.useEffect(()=>{let o=!1;return iM(n,e,t).then(s=>{o||i(s)}),()=>{o=!0}},[n,e,t]),r}function fM({page:n,matches:e,...t}){let r=Di(),{manifest:i,routeModules:o}=Bb(),{basename:s}=jb(),{loaderData:a,matches:l}=cM(),c=S.useMemo(()=>hv(n,e,l,i,r,"data"),[n,e,l,i,r]),u=S.useMemo(()=>hv(n,e,l,i,r,"assets"),[n,e,l,i,r]),d=S.useMemo(()=>{if(n===r.pathname+r.search+r.hash)return[];let v=new Set,_=!1;if(e.forEach(p=>{var g;let b=i.routes[p.route.id];!b||!b.hasLoader||(!c.some(y=>y.route.id===p.route.id)&&p.route.id in a&&((g=o[p.route.id])!=null&&g.shouldRevalidate)||b.hasClientLoader?_=!0:v.add(p.route.id))}),v.size===0)return[];let x=tM(n,s,"data");return _&&v.size>0&&x.searchParams.set("_routes",e.filter(p=>v.has(p.route.id)).map(p=>p.route.id).join(",")),[x.pathname+x.search]},[s,a,r,i,c,e,n,o]),f=S.useMemo(()=>oM(u,i),[u,i]),m=hM(u);return S.createElement(S.Fragment,null,d.map(v=>S.createElement("link",{key:v,rel:"prefetch",as:"fetch",href:v,...t})),f.map(v=>S.createElement("link",{key:v,rel:"modulepreload",href:v,...t})),m.map(({key:v,link:_})=>S.createElement("link",{key:v,nonce:t.nonce,..._})))}function pM(...n){return e=>{n.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var Hb=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Hb&&(window.__reactRouterVersion="7.9.3")}catch{}function mM({basename:n,children:e,window:t}){let r=S.useRef();r.current==null&&(r.current=n2({window:t,v5Compat:!0}));let i=r.current,[o,s]=S.useState({action:i.action,location:i.location}),a=S.useCallback(l=>{S.startTransition(()=>s(l))},[s]);return S.useLayoutEffect(()=>i.listen(a),[i,a]),S.createElement(V2,{basename:n,children:e,location:o.location,navigationType:o.action,navigator:i})}var Wb=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Vb=S.forwardRef(function({onClick:e,discover:t="render",prefetch:r="none",relative:i,reloadDocument:o,replace:s,state:a,target:l,to:c,preventScrollReset:u,viewTransition:d,...f},m){let{basename:v}=S.useContext(Qr),_=typeof c=="string"&&Wb.test(c),x,p=!1;if(typeof c=="string"&&_&&(x=c,Hb))try{let w=new URL(window.location.href),M=c.startsWith("//")?new URL(w.protocol+c):new URL(c),P=Ii(M.pathname,v);M.origin===w.origin&&P!=null?c=P+M.search+M.hash:p=!0}catch{zr(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let b=A2(c,{relative:i}),[g,y,E]=uM(r,f),C=yM(c,{replace:s,state:a,target:l,preventScrollReset:u,relative:i,viewTransition:d});function A(w){e&&e(w),w.defaultPrevented||C(w)}let T=S.createElement("a",{...f,...E,href:x||b,onClick:p||o?e:A,ref:pM(m,y),target:l,"data-discover":!_&&t==="render"?"true":void 0});return g&&!_?S.createElement(S.Fragment,null,T,S.createElement(dM,{page:b})):T});Vb.displayName="Link";var gM=S.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:r="",end:i=!1,style:o,to:s,viewTransition:a,children:l,...c},u){let d=lc(s,{relative:c.relative}),f=Di(),m=S.useContext(kd),{navigator:v,basename:_}=S.useContext(Qr),x=m!=null&&MM(d)&&a===!0,p=v.encodeLocation?v.encodeLocation(d).pathname:d.pathname,b=f.pathname,g=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;t||(b=b.toLowerCase(),g=g?g.toLowerCase():null,p=p.toLowerCase()),g&&_&&(g=Ii(g,_)||g);const y=p!=="/"&&p.endsWith("/")?p.length-1:p.length;let E=b===p||!i&&b.startsWith(p)&&b.charAt(y)==="/",C=g!=null&&(g===p||!i&&g.startsWith(p)&&g.charAt(p.length)==="/"),A={isActive:E,isPending:C,isTransitioning:x},T=E?e:void 0,w;typeof r=="function"?w=r(A):w=[r,E?"active":null,C?"pending":null,x?"transitioning":null].filter(Boolean).join(" ");let M=typeof o=="function"?o(A):o;return S.createElement(Vb,{...c,"aria-current":T,className:w,ref:u,style:M,to:s,viewTransition:a},typeof l=="function"?l(A):l)});gM.displayName="NavLink";var vM=S.forwardRef(({discover:n="render",fetcherKey:e,navigate:t,reloadDocument:r,replace:i,state:o,method:s=Eu,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:d,...f},m)=>{let v=wM(),_=EM(a,{relative:c}),x=s.toLowerCase()==="get"?"get":"post",p=typeof a=="string"&&Wb.test(a),b=g=>{if(l&&l(g),g.defaultPrevented)return;g.preventDefault();let y=g.nativeEvent.submitter,E=(y==null?void 0:y.getAttribute("formmethod"))||s;v(y||g.currentTarget,{fetcherKey:e,method:E,navigate:t,replace:i,state:o,relative:c,preventScrollReset:u,viewTransition:d})};return S.createElement("form",{ref:m,method:x,action:_,onSubmit:r?l:b,...f,"data-discover":!p&&n==="render"?"true":void 0})});vM.displayName="Form";function xM(n){return`${n} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function $b(n){let e=S.useContext(Oa);return Gt(e,xM(n)),e}function yM(n,{target:e,replace:t,state:r,preventScrollReset:i,relative:o,viewTransition:s}={}){let a=Jn(),l=Di(),c=lc(n,{relative:o});return S.useCallback(u=>{if(K2(u,e)){u.preventDefault();let d=t!==void 0?t:$l(l)===$l(c);a(n,{replace:d,state:r,preventScrollReset:i,relative:o,viewTransition:s})}},[l,a,c,t,r,e,n,i,o,s])}function _M(n){zr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=S.useRef(pp(n)),t=S.useRef(!1),r=Di(),i=S.useMemo(()=>J2(r.search,t.current?null:e.current),[r.search]),o=Jn(),s=S.useCallback((a,l)=>{const c=pp(typeof a=="function"?a(new URLSearchParams(i)):a);t.current=!0,o("?"+c,l)},[o,i]);return[i,s]}var bM=0,SM=()=>`__${String(++bM)}__`;function wM(){let{router:n}=$b("useSubmit"),{basename:e}=S.useContext(Qr),t=j2();return S.useCallback(async(r,i={})=>{let{action:o,method:s,encType:a,formData:l,body:c}=eM(r,e);if(i.navigate===!1){let u=i.fetcherKey||SM();await n.fetch(u,t,i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,flushSync:i.flushSync})}else await n.navigate(i.action||o,{preventScrollReset:i.preventScrollReset,formData:l,body:c,formMethod:i.method||s,formEncType:i.encType||a,replace:i.replace,state:i.state,fromRouteId:t,flushSync:i.flushSync,viewTransition:i.viewTransition})},[n,e,t])}function EM(n,{relative:e}={}){let{basename:t}=S.useContext(Qr),r=S.useContext(ei);Gt(r,"useFormAction must be used inside a RouteContext");let[i]=r.matches.slice(-1),o={...lc(n||".",{relative:e})},s=Di();if(n==null){o.search=s.search;let a=new URLSearchParams(o.search),l=a.getAll("index");if(l.some(u=>u==="")){a.delete("index"),l.filter(d=>d).forEach(d=>a.append("index",d));let u=a.toString();o.search=u?`?${u}`:""}}return(!n||n===".")&&i.route.index&&(o.search=o.search?o.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(o.pathname=o.pathname==="/"?t:Ti([t,o.pathname])),$l(o)}function MM(n,{relative:e}={}){let t=S.useContext(Nb);Gt(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=$b("useViewTransitionState"),i=lc(n,{relative:e});if(!t.isTransitioning)return!1;let o=Ii(t.currentLocation.pathname,r)||t.currentLocation.pathname,s=Ii(t.nextLocation.pathname,r)||t.nextLocation.pathname;return rd(i.pathname,s)!=null||rd(i.pathname,o)!=null}class TM{constructor(){dt(this,"activeState",null);dt(this,"lastKnownRefs",{lastShapeRef:null,lastSolutionRef:null})}getActiveState(){return this.activeState}setActiveState(e){if(!e||typeof e!="object")throw new Error("ActiveState must be an object");if(e.schema!=="koos.state")throw new Error('ActiveState schema must be "koos.state"');if(e.version!==1)throw new Error("ActiveState version must be 1");if(typeof e.shapeRef!="string"||!e.shapeRef)throw new Error("ActiveState shapeRef must be a non-empty string");if(!Array.isArray(e.placements))throw new Error("ActiveState placements must be an array");for(const t of e.placements){if(!t.pieceId||typeof t.pieceId!="string")throw new Error("Each placement must have a valid pieceId");if(!Array.isArray(t.anchorIJK)||t.anchorIJK.length!==3)throw new Error("Each placement must have anchorIJK as [i, j, k]");if(typeof t.orientationIndex!="number")throw new Error("Each placement must have a numeric orientationIndex")}this.activeState=e,this.lastKnownRefs.lastShapeRef=e.shapeRef,console.log(" ActiveState set:",{shapeRef:e.shapeRef.substring(0,24)+"...",placements:e.placements.length})}clearActiveState(){this.activeState=null,console.log(" ActiveState cleared")}getStateKind(){return!this.activeState||this.activeState.placements.length===0?"empty":"partial"}getLastShapeRef(){return this.lastKnownRefs.lastShapeRef}setLastShapeRef(e){this.lastKnownRefs.lastShapeRef=e}getLastSolutionRef(){return this.lastKnownRefs.lastSolutionRef}setLastSolutionRef(e){this.lastKnownRefs.lastSolutionRef=e}createEmptyState(e){return{schema:"koos.state",version:1,shapeRef:e,placements:[]}}}const Fi=new TM,CM=S.createContext(void 0),RM=({children:n})=>{const[e,t]=S.useState(Fi.getActiveState()),[r,i]=S.useState(Fi.getLastShapeRef()),[o,s]=S.useState(Fi.getLastSolutionRef()),a=S.useCallback(m=>{try{Fi.setActiveState(m),t(m),i(m.shapeRef)}catch(v){throw console.error(" Failed to set active state:",v),v}},[]),l=S.useCallback(()=>{Fi.clearActiveState(),t(null)},[]),c=S.useCallback(()=>Fi.getStateKind(),[e]),u=S.useCallback(m=>{Fi.setLastShapeRef(m),i(m)},[]),d=S.useCallback(m=>{Fi.setLastSolutionRef(m),s(m)},[]),f={activeState:e,setActiveState:a,clearActiveState:l,getStateKind:c,lastShapeRef:r,lastSolutionRef:o,setLastShapeRef:u,setLastSolutionRef:d};return h.jsx(CM.Provider,{value:f,children:n})},AM="modulepreload",PM=function(n){return"/"+n},fv={},So=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=PM(l),l in fv)return;fv[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const d=document.createElement("link");if(d.rel=c?"stylesheet":AM,c||(d.as="script"),d.crossOrigin="",d.href=l,a&&d.setAttribute("nonce",a),document.head.appendChild(d),c)return new Promise((f,m)=>{d.addEventListener("load",f),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return i.then(s=>{for(const a of s||[])a.status==="rejected"&&o(a.reason);return e().catch(o)})},kM=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>So(async()=>{const{default:r}=await Promise.resolve().then(()=>Ua);return{default:r}},[]).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class _g extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class pv extends _g{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class mv extends _g{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class gv extends _g{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var mp;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(mp||(mp={}));var IM=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class LM{constructor(e,{headers:t={},customFetch:r,region:i=mp.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=kM(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return IM(this,arguments,void 0,function*(t,r={}){var i;try{const{headers:o,method:s,body:a,signal:l}=r;let c={},{region:u}=r;u||(u=this.region);const d=new URL(`${this.url}/${t}`);u&&u!=="any"&&(c["x-region"]=u,d.searchParams.set("forceFunctionRegion",u));let f;a&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(c["Content-Type"]="application/octet-stream",f=a):typeof a=="string"?(c["Content-Type"]="text/plain",f=a):typeof FormData<"u"&&a instanceof FormData?f=a:(c["Content-Type"]="application/json",f=JSON.stringify(a)));const m=yield this.fetch(d.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},c),this.headers),o),body:f,signal:l}).catch(p=>{throw p.name==="AbortError"?p:new pv(p)}),v=m.headers.get("x-relay-error");if(v&&v==="true")throw new mv(m);if(!m.ok)throw new gv(m);let _=((i=m.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),x;return _==="application/json"?x=yield m.json():_==="application/octet-stream"?x=yield m.blob():_==="text/event-stream"?x=m:_==="multipart/form-data"?x=yield m.formData():x=yield m.text(),{data:x,error:null,response:m}}catch(o){return o instanceof Error&&o.name==="AbortError"?{data:null,error:new pv(o)}:{data:null,error:o,response:o instanceof gv||o instanceof mv?o.context:void 0}}})}}var Vn={},bg={},Ld={},cc={},Dd={},Nd={},DM=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Ta=DM();const NM=Ta.fetch,Gb=Ta.fetch.bind(Ta),Xb=Ta.Headers,OM=Ta.Request,UM=Ta.Response,Ua=Object.freeze(Object.defineProperty({__proto__:null,Headers:Xb,Request:OM,Response:UM,default:Gb,fetch:NM},Symbol.toStringTag,{value:"Module"})),zM=Pw(Ua);var Od={};Object.defineProperty(Od,"__esModule",{value:!0});let FM=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Od.default=FM;var Yb=_r&&_r.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Nd,"__esModule",{value:!0});const jM=Yb(zM),BM=Yb(Od);let HM=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=jM.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let i=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var s,a,l,c;let u=null,d=null,f=null,m=o.status,v=o.statusText;if(o.ok){if(this.method!=="HEAD"){const b=await o.text();b===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((s=this.headers.get("Accept"))===null||s===void 0)&&s.includes("application/vnd.pgrst.plan+text"))?d=b:d=JSON.parse(b))}const x=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),p=(l=o.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");x&&p&&p.length>1&&(f=parseInt(p[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(u={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,f=null,m=406,v="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const x=await o.text();try{u=JSON.parse(x),Array.isArray(u)&&o.status===404&&(d=[],u=null,m=200,v="OK")}catch{o.status===404&&x===""?(m=204,v="No Content"):u={message:x}}if(u&&this.isMaybeSingle&&(!((c=u==null?void 0:u.details)===null||c===void 0)&&c.includes("0 rows"))&&(u=null,m=200,v="OK"),u&&this.shouldThrowOnError)throw new BM.default(u)}return{error:u,data:d,count:f,status:m,statusText:v}});return this.shouldThrowOnError||(i=i.catch(o=>{var s,a,l;return{error:{message:`${(s=o==null?void 0:o.name)!==null&&s!==void 0?s:"FetchError"}: ${o==null?void 0:o.message}`,details:`${(a=o==null?void 0:o.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=o==null?void 0:o.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}};Nd.default=HM;var WM=_r&&_r.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Dd,"__esModule",{value:!0});const VM=WM(Nd);let $M=class extends VM.default{select(e){let t=!1;const r=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:i,referencedTable:o=i}={}){const s=o?`${o}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:i=r}={}){const o=typeof i>"u"?"offset":`${i}.offset`,s=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(s,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:i=!1,wal:o=!1,format:s="text"}={}){var a;const l=[e?"analyze":null,t?"verbose":null,r?"settings":null,i?"buffers":null,o?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${s}; for="${c}"; options=${l};`),s==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};Dd.default=$M;var GM=_r&&_r.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(cc,"__esModule",{value:!0});const XM=GM(Dd);let YM=class extends XM.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:i}={}){let o="";i==="plain"?o="pl":i==="phrase"?o="ph":i==="websearch"&&(o="w");const s=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${o}fts${s}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const i=r?`${r}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};cc.default=YM;var qM=_r&&_r.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ld,"__esModule",{value:!0});const Za=qM(cc);let KM=class{constructor(e,{headers:t={},schema:r,fetch:i}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=i}select(e,t){const{head:r=!1,count:i}=t??{},o=r?"HEAD":"GET";let s=!1;const a=(e??"*").split("").map(l=>/\s/.test(l)&&!s?"":(l==='"'&&(s=!s),l)).join("");return this.url.searchParams.set("select",a),i&&this.headers.append("Prefer",`count=${i}`),new Za.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var i;const o="POST";if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const s=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(s.length>0){const a=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Za.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:i,defaultToNull:o=!0}={}){var s;const a="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),i&&this.headers.append("Prefer",`count=${i}`),o||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const l=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Za.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}update(e,{count:t}={}){var r;const i="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Za.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Za.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};Ld.default=KM;var qb=_r&&_r.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(bg,"__esModule",{value:!0});const JM=qb(Ld),ZM=qb(cc);let QM=class Kb{constructor(e,{headers:t={},schema:r,fetch:i}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new JM.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Kb(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:i=!1,count:o}={}){var s;let a;const l=new URL(`${this.url}/rpc/${e}`);let c;r||i?(a=r?"HEAD":"GET",Object.entries(t).filter(([d,f])=>f!==void 0).map(([d,f])=>[d,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([d,f])=>{l.searchParams.append(d,f)})):(a="POST",c=t);const u=new Headers(this.headers);return o&&u.set("Prefer",`count=${o}`),new ZM.default({method:a,url:l,headers:u,schema:this.schemaName,body:c,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}};bg.default=QM;var za=_r&&_r.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Vn,"__esModule",{value:!0});Vn.PostgrestError=Vn.PostgrestBuilder=Vn.PostgrestTransformBuilder=Vn.PostgrestFilterBuilder=Vn.PostgrestQueryBuilder=Vn.PostgrestClient=void 0;const Jb=za(bg);Vn.PostgrestClient=Jb.default;const Zb=za(Ld);Vn.PostgrestQueryBuilder=Zb.default;const Qb=za(cc);Vn.PostgrestFilterBuilder=Qb.default;const eS=za(Dd);Vn.PostgrestTransformBuilder=eS.default;const tS=za(Nd);Vn.PostgrestBuilder=tS.default;const nS=za(Od);Vn.PostgrestError=nS.default;var eT=Vn.default={PostgrestClient:Jb.default,PostgrestQueryBuilder:Zb.default,PostgrestFilterBuilder:Qb.default,PostgrestTransformBuilder:eS.default,PostgrestBuilder:tS.default,PostgrestError:nS.default};const{PostgrestClient:tT,PostgrestQueryBuilder:oU,PostgrestFilterBuilder:sU,PostgrestTransformBuilder:aU,PostgrestBuilder:lU,PostgrestError:cU}=eT;class nT{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const r=t.node,i=parseInt(r.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const rT="2.75.0",iT=`realtime-js/${rT}`,oT="1.0.0",gp=1e4,sT=1e3,aT=100;var wl;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(wl||(wl={}));var an;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(an||(an={}));var Pr;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Pr||(Pr={}));var vp;(function(n){n.websocket="websocket"})(vp||(vp={}));var $o;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})($o||($o={}));class lT{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const i=t.getUint8(1),o=t.getUint8(2);let s=this.HEADER_LENGTH+2;const a=r.decode(e.slice(s,s+i));s=s+i;const l=r.decode(e.slice(s,s+o));s=s+o;const c=JSON.parse(r.decode(e.slice(s,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}}class rS{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ut;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Ut||(Ut={}));const vv=(n,e,t={})=>{var r;const i=(r=t.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((o,s)=>(o[s]=cT(s,n,e,i),o),{}):{}},cT=(n,e,t,r)=>{const i=e.find(a=>a.name===n),o=i==null?void 0:i.type,s=t[n];return o&&!r.includes(o)?iS(o,s):xp(s)},iS=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return fT(e,t)}switch(n){case Ut.bool:return uT(e);case Ut.float4:case Ut.float8:case Ut.int2:case Ut.int4:case Ut.int8:case Ut.numeric:case Ut.oid:return dT(e);case Ut.json:case Ut.jsonb:return hT(e);case Ut.timestamp:return pT(e);case Ut.abstime:case Ut.date:case Ut.daterange:case Ut.int4range:case Ut.int8range:case Ut.money:case Ut.reltime:case Ut.text:case Ut.time:case Ut.timestamptz:case Ut.timetz:case Ut.tsrange:case Ut.tstzrange:return xp(e);default:return xp(e)}},xp=n=>n,uT=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},dT=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},hT=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},fT=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let o;const s=n.slice(1,t);try{o=JSON.parse("["+s+"]")}catch{o=s?s.split(","):[]}return o.map(a=>iS(e,a))}return n},pT=n=>typeof n=="string"?n.replace(" ","T"):n,oS=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class yh{constructor(e,t,r={},i=gp){this.channel=e,this.event=t,this.payload=r,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var xv;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(xv||(xv={}));class El{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},i=>{const{onJoin:o,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=El.syncState(this.state,i,o,s),this.pendingDiffs.forEach(l=>{this.state=El.syncDiff(this.state,l,o,s)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},i=>{const{onJoin:o,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=El.syncDiff(this.state,i,o,s),a())}),this.onJoin((i,o,s)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:o,newPresences:s})}),this.onLeave((i,o,s)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:o,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,i){const o=this.cloneDeep(e),s=this.transformState(t),a={},l={};return this.map(o,(c,u)=>{s[c]||(l[c]=u)}),this.map(s,(c,u)=>{const d=o[c];if(d){const f=u.map(x=>x.presence_ref),m=d.map(x=>x.presence_ref),v=u.filter(x=>m.indexOf(x.presence_ref)<0),_=d.filter(x=>f.indexOf(x.presence_ref)<0);v.length>0&&(a[c]=v),_.length>0&&(l[c]=_)}else a[c]=u}),this.syncDiff(o,{joins:a,leaves:l},r,i)}static syncDiff(e,t,r,i){const{joins:o,leaves:s}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),i||(i=()=>{}),this.map(o,(a,l)=>{var c;const u=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),u.length>0){const d=e[a].map(m=>m.presence_ref),f=u.filter(m=>d.indexOf(m.presence_ref)<0);e[a].unshift(...f)}r(a,u,l)}),this.map(s,(a,l)=>{let c=e[a];if(!c)return;const u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),e[a]=c,i(a,c,l),c.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const i=e[r];return"metas"in i?t[r]=i.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[r]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var yv;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(yv||(yv={}));var Ml;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Ml||(Ml={}));var gi;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(gi||(gi={}));class Sg{constructor(e,t={config:{}},r){var i,o;if(this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=an.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new yh(this,Pr.join,this.params,this.timeout),this.rejoinTimer=new rS(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=an.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=an.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=an.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=an.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=an.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Pr.reply,{},(s,a)=>{this._trigger(this._replyEventName(a),s)}),this.presence=new El(this),this.broadcastEndpointURL=oS(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var r,i,o;if(this.socket.isConnected()||this.socket.connect(),this.state==an.closed){const{config:{broadcast:s,presence:a,private:l}}=this.params,c=(i=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(m=>m.filter))!==null&&i!==void 0?i:[],u=!!this.bindings[Ml.PRESENCE]&&this.bindings[Ml.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,d={},f={broadcast:s,presence:Object.assign(Object.assign({},a),{enabled:u}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(m=>e==null?void 0:e(gi.CHANNEL_ERROR,m)),this._onClose(()=>e==null?void 0:e(gi.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:m})=>{var v;if(this.socket.setAuth(),m===void 0){e==null||e(gi.SUBSCRIBED);return}else{const _=this.bindings.postgres_changes,x=(v=_==null?void 0:_.length)!==null&&v!==void 0?v:0,p=[];for(let b=0;b<x;b++){const g=_[b],{filter:{event:y,schema:E,table:C,filter:A}}=g,T=m&&m[b];if(T&&T.event===y&&T.schema===E&&T.table===C&&T.filter===A)p.push(Object.assign(Object.assign({},g),{id:T.id}));else{this.unsubscribe(),this.state=an.errored,e==null||e(gi.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(gi.SUBSCRIBED);return}}).receive("error",m=>{this.state=an.errored,e==null||e(gi.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(m).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(gi.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===an.joined&&e===Ml.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,i;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:s}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:s,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((i=c.body)===null||i===void 0?void 0:i.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var s,a,l;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(s=this.params)===null||s===void 0?void 0:s.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("error",()=>o("error")),c.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=an.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Pr.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(i=>{r=new yh(this,Pr.leave,{},e),r.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=an.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const i=new AbortController,o=setTimeout(()=>i.abort(),r),s=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(o),s}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new yh(this,e,t,r);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>aT){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var i,o;const s=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Pr;if(r&&[a,l,c,u].indexOf(s)>=0&&r!==this._joinRef())return;let f=this._onMessage(s,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(m=>{var v,_,x;return((v=m.filter)===null||v===void 0?void 0:v.event)==="*"||((x=(_=m.filter)===null||_===void 0?void 0:_.event)===null||x===void 0?void 0:x.toLocaleLowerCase())===s}).map(m=>m.callback(f,r)):(o=this.bindings[s])===null||o===void 0||o.filter(m=>{var v,_,x,p,b,g;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in m){const y=m.id,E=(v=m.filter)===null||v===void 0?void 0:v.event;return y&&((_=t.ids)===null||_===void 0?void 0:_.includes(y))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((x=t.data)===null||x===void 0?void 0:x.type.toLocaleLowerCase()))}else{const y=(b=(p=m==null?void 0:m.filter)===null||p===void 0?void 0:p.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return y==="*"||y===((g=t==null?void 0:t.event)===null||g===void 0?void 0:g.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===s}).map(m=>{if(typeof f=="object"&&"ids"in f){const v=f.data,{schema:_,table:x,commit_timestamp:p,type:b,errors:g}=v;f=Object.assign(Object.assign({},{schema:_,table:x,commit_timestamp:p,eventType:b,new:{},old:{},errors:g}),this._getPayloadRecords(v))}m.callback(f,r)})}_isClosed(){return this.state===an.closed}_isJoined(){return this.state===an.joined}_isJoining(){return this.state===an.joining}_isLeaving(){return this.state===an.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const i=e.toLocaleLowerCase(),o={type:i,filter:t,callback:r};return this.bindings[i]?this.bindings[i].push(o):this.bindings[i]=[o],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(i=>{var o;return!(((o=i.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&Sg.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Pr.close,{},e)}_onError(e){this._on(Pr.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=an.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=vv(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=vv(e.columns,e.old_record)),t}}const _h=()=>{},Nc={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},mT=[1e3,2e3,5e3,1e4],gT=1e4,vT=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class xT{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=gp,this.transport=null,this.heartbeatIntervalMs=Nc.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=_h,this.ref=0,this.reconnectTimer=null,this.logger=_h,this.conn=null,this.sendBuffer=[],this.serializer=new lT,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let o;return i?o=i:typeof fetch>"u"?o=(...s)=>So(async()=>{const{default:a}=await Promise.resolve().then(()=>Ua);return{default:a}},void 0).then(({default:a})=>a(...s)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...s)=>o(...s)},!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${vp.websocket}`,this.httpEndpoint=oS(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=nT.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:oT}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case wl.connecting:return $o.Connecting;case wl.open:return $o.Open;case wl.closing:return $o.Closing;default:return $o.Closed}}isConnected(){return this.connectionState()===$o.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,i=this.getChannels().find(o=>o.topic===r);if(i)return i;{const o=new Sg(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:r,payload:i,ref:o}=e,s=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${t} ${r} (${o})`,i),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(sT,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Nc.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:i,payload:o,ref:s}=t,a=s?`(${s})`:"",l=o.status||"";this.log("receive",`${l} ${r} ${i} ${a}`.trim(),o),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(i,o,s)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Pr.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${r}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([vT],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const i={access_token:t,version:iT};t&&r.updateJoinPayload(i),r.joinedOnce&&r._isJoined()&&r._push(Pr.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new rS(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Nc.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,i,o,s,a,l,c,u;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:gp,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:Nc.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(s=e==null?void 0:e.accessToken)!==null&&s!==void 0?s:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:_h,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e==null?void 0:e.reconnectAfterMs)!==null&&l!==void 0?l:d=>mT[d-1]||gT,this.encode=(c=e==null?void 0:e.encode)!==null&&c!==void 0?c:(d,f)=>f(JSON.stringify(d)),this.decode=(u=e==null?void 0:e.decode)!==null&&u!==void 0?u:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class wg extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function nn(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class yT extends wg{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class yp extends wg{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var _T=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const sS=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>So(async()=>{const{default:r}=await Promise.resolve().then(()=>Ua);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},bT=()=>_T(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield So(()=>Promise.resolve().then(()=>Ua),void 0)).Response:Response}),_p=n=>{if(Array.isArray(n))return n.map(t=>_p(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const i=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[i]=_p(r)}),e},ST=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var ps=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const bh=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),wT=(n,e,t)=>ps(void 0,void 0,void 0,function*(){const r=yield bT();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(i=>{const o=n.status||500,s=(i==null?void 0:i.statusCode)||o+"";e(new yT(bh(i),o,s))}).catch(i=>{e(new yp(bh(i),i))}):e(new yp(bh(n),n))}),ET=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"||!r?i:(ST(r)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(r)):i.body=r,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function uc(n,e,t,r,i,o){return ps(this,void 0,void 0,function*(){return new Promise((s,a)=>{n(t,ET(e,r,i,o)).then(l=>{if(!l.ok)throw l;return r!=null&&r.noResolveJson?l:l.json()}).then(l=>s(l)).catch(l=>wT(l,a,r))})})}function id(n,e,t,r){return ps(this,void 0,void 0,function*(){return uc(n,"GET",e,t,r)})}function Wr(n,e,t,r,i){return ps(this,void 0,void 0,function*(){return uc(n,"POST",e,r,i,t)})}function bp(n,e,t,r,i){return ps(this,void 0,void 0,function*(){return uc(n,"PUT",e,r,i,t)})}function MT(n,e,t,r){return ps(this,void 0,void 0,function*(){return uc(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function aS(n,e,t,r,i){return ps(this,void 0,void 0,function*(){return uc(n,"DELETE",e,r,i,t)})}var TT=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class CT{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}then(e,t){return this.execute().then(e,t)}execute(){return TT(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(nn(e))return{data:null,error:e};throw e}})}}var RT=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class AT{constructor(e,t){this.downloadFn=e,this.shouldThrowOnError=t}asStream(){return new CT(this.downloadFn,this.shouldThrowOnError)}then(e,t){return this.execute().then(e,t)}execute(){return RT(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(nn(e))return{data:null,error:e};throw e}})}}var Fn=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const PT={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_v={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class kT{constructor(e,t={},r,i){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=sS(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,i){return Fn(this,void 0,void 0,function*(){try{let o;const s=Object.assign(Object.assign({},_v),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(s.upsert)});const l=s.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",s.cacheControl),l&&o.append("metadata",this.encodeMetadata(l)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.append("cacheControl",s.cacheControl),l&&o.append("metadata",this.encodeMetadata(l))):(o=r,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),d=yield(e=="PUT"?bp:Wr)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:a},s!=null&&s.duplex?{duplex:s.duplex}:{}));return{data:{path:c,id:d.Id,fullPath:d.Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(nn(o))return{data:null,error:o};throw o}})}upload(e,t,r){return Fn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,i){return Fn(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),s=this._getFinalPath(o),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",t);try{let l;const c=Object.assign({upsert:_v.upsert},i),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const d=yield bp(this.fetch,a.toString(),l,{headers:u});return{data:{path:o,fullPath:d.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(nn(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return Fn(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const o=yield Wr(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:i}),s=new URL(this.url+o.url),a=s.searchParams.get("token");if(!a)throw new wg("No token returned by API");return{data:{signedUrl:s.toString(),path:e,token:a},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(nn(r))return{data:null,error:r};throw r}})}update(e,t,r){return Fn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return Fn(this,void 0,void 0,function*(){try{return{data:yield Wr(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(nn(i))return{data:null,error:i};throw i}})}copy(e,t,r){return Fn(this,void 0,void 0,function*(){try{return{data:{path:(yield Wr(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(nn(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,r){return Fn(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),o=yield Wr(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const s=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${s}`)},{data:o,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(nn(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,r){return Fn(this,void 0,void 0,function*(){try{const i=yield Wr(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:i.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${o}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(nn(i))return{data:null,error:i};throw i}})}download(e,t){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),s=o?`?${o}`:"",a=this._getFinalPath(e),l=()=>id(this.fetch,`${this.url}/${i}/${a}${s}`,{headers:this.headers,noResolveJson:!0});return new AT(l,this.shouldThrowOnError)}info(e){return Fn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield id(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:_p(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(nn(r))return{data:null,error:r};throw r}})}exists(e){return Fn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield MT(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(nn(r)&&r instanceof yp){const i=r.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),i=[],o=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&i.push(o);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});l!==""&&i.push(l);let c=i.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return Fn(this,void 0,void 0,function*(){try{return{data:yield aS(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(nn(t))return{data:null,error:t};throw t}})}list(e,t,r){return Fn(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},PT),t),{prefix:e||""});return{data:yield Wr(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},r),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(nn(i))return{data:null,error:i};throw i}})}listV2(e,t){return Fn(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Wr(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(nn(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const IT="2.75.0",LT={"X-Client-Info":`storage-js/${IT}`};var _s=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class DT{constructor(e,t={},r,i){this.shouldThrowOnError=!1;const o=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href.replace(/\/$/,""),this.headers=Object.assign(Object.assign({},LT),t),this.fetch=sS(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return _s(this,void 0,void 0,function*(){try{return{data:yield id(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(nn(e))return{data:null,error:e};throw e}})}getBucket(e){return _s(this,void 0,void 0,function*(){try{return{data:yield id(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(nn(t))return{data:null,error:t};throw t}})}createBucket(e){return _s(this,arguments,void 0,function*(t,r={public:!1}){try{return{data:yield Wr(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(nn(i))return{data:null,error:i};throw i}})}updateBucket(e,t){return _s(this,void 0,void 0,function*(){try{return{data:yield bp(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(nn(r))return{data:null,error:r};throw r}})}emptyBucket(e){return _s(this,void 0,void 0,function*(){try{return{data:yield Wr(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(nn(t))return{data:null,error:t};throw t}})}deleteBucket(e){return _s(this,void 0,void 0,function*(){try{return{data:yield aS(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(nn(t))return{data:null,error:t};throw t}})}}class NT extends DT{constructor(e,t={},r,i){super(e,t,r,i)}from(e){return new kT(this.url,this.headers,e,this.fetch)}}const OT="2.75.0";let dl="";typeof Deno<"u"?dl="deno":typeof document<"u"?dl="web":typeof navigator<"u"&&navigator.product==="ReactNative"?dl="react-native":dl="node";const UT={"X-Client-Info":`supabase-js-${dl}/${OT}`},zT={headers:UT},FT={schema:"public"},jT={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},BT={};var HT=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};const WT=n=>{let e;return n?e=n:typeof fetch>"u"?e=Gb:e=fetch,(...t)=>e(...t)},VT=()=>typeof Headers>"u"?Xb:Headers,$T=(n,e,t)=>{const r=WT(t),i=VT();return(o,s)=>HT(void 0,void 0,void 0,function*(){var a;const l=(a=yield e())!==null&&a!==void 0?a:n;let c=new i(s==null?void 0:s.headers);return c.has("apikey")||c.set("apikey",n),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(o,Object.assign(Object.assign({},s),{headers:c}))})};var GT=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};function XT(n){return n.endsWith("/")?n:n+"/"}function YT(n,e){var t,r;const{db:i,auth:o,realtime:s,global:a}=n,{db:l,auth:c,realtime:u,global:d}=e,f={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},c),o),realtime:Object.assign(Object.assign({},u),s),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(r=a==null?void 0:a.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>GT(this,void 0,void 0,function*(){return""})};return n.accessToken?f.accessToken=n.accessToken:delete f.accessToken,f}function qT(n){const e=n==null?void 0:n.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(XT(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const lS="2.75.0",Hs=30*1e3,Sp=3,Sh=Sp*Hs,KT="http://localhost:9999",JT="supabase.auth.token",ZT={"X-Client-Info":`gotrue-js/${lS}`},wp="X-Supabase-Api-Version",cS={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},QT=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,eC=10*60*1e3;class Gl extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function ht(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class tC extends Gl{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function nC(n){return ht(n)&&n.name==="AuthApiError"}class Go extends Gl{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ao extends Gl{constructor(e,t,r,i){super(e,r,i),this.name=t,this.status=r}}class Yi extends Ao{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function rC(n){return ht(n)&&n.name==="AuthSessionMissingError"}class bs extends Ao{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Oc extends Ao{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Uc extends Ao{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function iC(n){return ht(n)&&n.name==="AuthImplicitGrantRedirectError"}class bv extends Ao{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ep extends Ao{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function wh(n){return ht(n)&&n.name==="AuthRetryableFetchError"}class Sv extends Ao{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class Mp extends Ao{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const od="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),wv=` 	
\r=`.split(""),oC=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<wv.length;e+=1)n[wv[e].charCodeAt(0)]=-2;for(let e=0;e<od.length;e+=1)n[od[e].charCodeAt(0)]=e;return n})();function Ev(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(od[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(od[r]),e.queuedBits-=6}}function uS(n,e,t){const r=oC[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Mv(n){const e=[],t=s=>{e.push(String.fromCodePoint(s))},r={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},o=s=>{lC(s,r,t)};for(let s=0;s<n.length;s+=1)uS(n.charCodeAt(s),i,o);return e.join("")}function sC(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function aC(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const i=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}sC(r,e)}}function lC(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ma(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};for(let i=0;i<n.length;i+=1)uS(n.charCodeAt(i),t,r);return new Uint8Array(e)}function cC(n){const e=[];return aC(n,t=>e.push(t)),new Uint8Array(e)}function Qo(n){const e=[],t={queue:0,queuedBits:0},r=i=>{e.push(i)};return n.forEach(i=>Ev(i,t,r)),Ev(null,t,r),e.join("")}function uC(n){return Math.round(Date.now()/1e3)+n}function dC(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const tr=()=>typeof window<"u"&&typeof document<"u",ko={tested:!1,writable:!1},dS=()=>{if(!tr())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ko.tested)return ko.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ko.tested=!0,ko.writable=!0}catch{ko.tested=!0,ko.writable=!1}return ko.writable};function hC(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,o)=>{e[o]=i})}catch{}return t.searchParams.forEach((r,i)=>{e[i]=r}),e}const hS=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>So(async()=>{const{default:r}=await Promise.resolve().then(()=>Ua);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},fC=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",Ws=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},Io=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ji=async(n,e)=>{await n.removeItem(e)};class Ud{constructor(){this.promise=new Ud.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ud.promiseConstructor=Promise;function Eh(n){const e=n.split(".");if(e.length!==3)throw new Mp("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!QT.test(e[r]))throw new Mp("JWT not in base64url format");return{header:JSON.parse(Mv(e[0])),payload:JSON.parse(Mv(e[1])),signature:ma(e[2]),raw:{header:e[0],payload:e[1]}}}async function pC(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function mC(n,e){return new Promise((r,i)=>{(async()=>{for(let o=0;o<1/0;o++)try{const s=await n(o);if(!e(o,null,s)){r(s);return}}catch(s){if(!e(o,s)){i(s);return}}})()})}function gC(n){return("0"+n.toString(16)).substr(-2)}function vC(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let i="";for(let o=0;o<56;o++)i+=t.charAt(Math.floor(Math.random()*r));return i}return crypto.getRandomValues(e),Array.from(e,gC).join("")}async function xC(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(r);return Array.from(i).map(o=>String.fromCharCode(o)).join("")}async function yC(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await xC(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ss(n,e,t=!1){const r=vC();let i=r;t&&(i+="/PASSWORD_RECOVERY"),await Ws(n,`${e}-code-verifier`,i);const o=await yC(r);return[o,r===o?"plain":"s256"]}const _C=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function bC(n){const e=n.headers.get(wp);if(!e||!e.match(_C))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function SC(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function wC(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const EC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ws(n){if(!EC.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Mh(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Tv(n){return JSON.parse(JSON.stringify(n))}var MC=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};const Wo=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),TC=[502,503,504];async function Cv(n){var e;if(!fC(n))throw new Ep(Wo(n),0);if(TC.includes(n.status))throw new Ep(Wo(n),n.status);let t;try{t=await n.json()}catch(o){throw new Go(Wo(o),o)}let r;const i=bC(n);if(i&&i.getTime()>=cS["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Sv(Wo(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Yi}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,s)=>o&&typeof s=="string",!0))throw new Sv(Wo(t),n.status,t.weak_password.reasons);throw new tC(Wo(t),n.status||500,r)}const CC=(n,e,t,r)=>{const i={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(r),Object.assign(Object.assign({},i),t))};async function xt(n,e,t,r){var i;const o=Object.assign({},r==null?void 0:r.headers);o[wp]||(o[wp]=cS["2024-01-01"].name),r!=null&&r.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const s=(i=r==null?void 0:r.query)!==null&&i!==void 0?i:{};r!=null&&r.redirectTo&&(s.redirect_to=r.redirectTo);const a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await RC(n,e,t+a,{headers:o,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function RC(n,e,t,r,i,o){const s=CC(e,r,i,o);let a;try{a=await n(t,Object.assign({},s))}catch(l){throw console.error(l),new Ep(Wo(l),0)}if(a.ok||await Cv(a),r!=null&&r.noResolveJson)return a;try{return await a.json()}catch(l){await Cv(l)}}function Cr(n){var e;let t=null;kC(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=uC(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Rv(n){const e=Cr(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function to(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function AC(n){return{data:n,error:null}}function PC(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:o}=n,s=MC(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:r,redirect_to:i,verification_type:o},l=Object.assign({},s);return{data:{properties:a,user:l},error:null}}function Av(n){return n}function kC(n){return n.access_token&&n.refresh_token&&n.expires_in}const Th=["global","local","others"];var IC=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class LC{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=hS(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=Th[0]){if(Th.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Th.join(", ")}`);try{return await xt(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ht(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await xt(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:to})}catch(r){if(ht(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=IC(e,["options"]),i=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(i.new_email=r==null?void 0:r.newEmail,delete i.newEmail),await xt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:PC,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(ht(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await xt(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:to})}catch(t){if(ht(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,i,o,s,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await xt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""},xform:Av});if(u.error)throw u.error;const d=await u.json(),f=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,m=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return m.length>0&&(m.forEach(v=>{const _=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(v.split(";")[1].split("=")[1]);c[`${x}Page`]=_}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(ht(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){ws(e);try{return await xt(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:to})}catch(t){if(ht(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ws(e);try{return await xt(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:to})}catch(r){if(ht(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ws(e);try{return await xt(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:to})}catch(r){if(ht(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ws(e.userId);try{const{data:t,error:r}=await xt(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:r}}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ws(e.userId),ws(e.id);try{return{data:await xt(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,r,i,o,s,a,l;try{const c={nextPage:null,lastPage:0,total:0},u=await xt(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&o!==void 0?o:""},xform:Av});if(u.error)throw u.error;const d=await u.json(),f=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,m=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return m.length>0&&(m.forEach(v=>{const _=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),x=JSON.parse(v.split(";")[1].split("=")[1]);c[`${x}Page`]=_}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(ht(c))return{data:{clients:[]},error:c};throw c}}async _createOAuthClient(e){try{return await xt(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await xt(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _deleteOAuthClient(e){try{return await xt(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await xt(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(ht(t))return{data:null,error:t};throw t}}}function Pv(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}const Es={debug:!!(globalThis&&dS()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class fS extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class DC extends fS{}async function NC(n,e,t){Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Es.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async i=>{if(i){Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,i.name);try{return await t()}finally{Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,i.name)}}else{if(e===0)throw Es.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new DC(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Es.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function OC(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function pS(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function UC(n){return parseInt(n,16)}function zC(n){const e=new TextEncoder().encode(n);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function FC(n){var e;const{chainId:t,domain:r,expirationTime:i,issuedAt:o=new Date,nonce:s,notBefore:a,requestId:l,resources:c,scheme:u,uri:d,version:f}=n;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(s&&s.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${s}`);if(!d)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=n.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const m=pS(n.address),v=u?`${u}://${r}`:r,_=n.statement?`${n.statement}
`:"",x=`${v} wants you to sign in with your Ethereum account:
${m}

${_}`;let p=`URI: ${d}
Version: ${f}
Chain ID: ${t}${s?`
Nonce: ${s}`:""}
Issued At: ${o.toISOString()}`;if(i&&(p+=`
Expiration Time: ${i.toISOString()}`),a&&(p+=`
Not Before: ${a.toISOString()}`),l&&(p+=`
Request ID: ${l}`),c){let b=`
Resources:`;for(const g of c){if(!g||typeof g!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${g}`);b+=`
- ${g}`}p+=b}return`${x}
${p}`}class tn extends Error{constructor({message:e,code:t,cause:r,name:i}){var o;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(o=i??(r instanceof Error?r.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=t}}class sd extends tn{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function jC({error:n,options:e}){var t,r,i;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new tn({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((t=o.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new tn({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(e.mediation==="conditional"&&((r=o.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new tn({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((i=o.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new tn({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new tn({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new tn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return o.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new tn({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new tn({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const s=window.location.hostname;if(gS(s)){if(o.rp.id!==s)return new tn({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new tn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new tn({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new tn({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new tn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function BC({error:n,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(e.signal instanceof AbortSignal)return new tn({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new tn({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const r=window.location.hostname;if(gS(r)){if(t.rpId!==r)return new tn({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new tn({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new tn({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new tn({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}var mS=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t};class HC{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const WC=new HC;function VC(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:e,user:t,excludeCredentials:r}=n,i=mS(n,["challenge","user","excludeCredentials"]),o=ma(e).buffer,s=Object.assign(Object.assign({},t),{id:ma(t.id).buffer}),a=Object.assign(Object.assign({},i),{challenge:o,user:s});if(r&&r.length>0){a.excludeCredentials=new Array(r.length);for(let l=0;l<r.length;l++){const c=r[l];a.excludeCredentials[l]=Object.assign(Object.assign({},c),{id:ma(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return a}function $C(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:e,allowCredentials:t}=n,r=mS(n,["challenge","allowCredentials"]),i=ma(e).buffer,o=Object.assign(Object.assign({},r),{challenge:i});if(t&&t.length>0){o.allowCredentials=new Array(t.length);for(let s=0;s<t.length;s++){const a=t[s];o.allowCredentials[s]=Object.assign(Object.assign({},a),{id:ma(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return o}function GC(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n;return{id:n.id,rawId:n.id,response:{attestationObject:Qo(new Uint8Array(n.response.attestationObject)),clientDataJSON:Qo(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function XC(n){var e;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const t=n,r=n.getClientExtensionResults(),i=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:Qo(new Uint8Array(i.authenticatorData)),clientDataJSON:Qo(new Uint8Array(i.clientDataJSON)),signature:Qo(new Uint8Array(i.signature)),userHandle:i.userHandle?Qo(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function gS(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function kv(){var n,e;return!!(tr()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator==null?void 0:navigator.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function YC(n){try{const e=await navigator.credentials.create(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new sd("Browser returned unexpected credential type",e)}:{data:null,error:new sd("Empty credential response",e)}}catch(e){return{data:null,error:jC({error:e,options:n})}}}async function qC(n){try{const e=await navigator.credentials.get(n);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new sd("Browser returned unexpected credential type",e)}:{data:null,error:new sd("Empty credential response",e)}}catch(e){return{data:null,error:BC({error:e,options:n})}}}const KC={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"none"},JC={userVerification:"preferred",hints:["security-key"]};function ad(...n){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),r={};for(const i of n)if(i)for(const o in i){const s=i[o];if(s!==void 0)if(Array.isArray(s))r[o]=s;else if(t(s))r[o]=s;else if(e(s)){const a=r[o];e(a)?r[o]=ad(a,s):r[o]=ad(s)}else r[o]=s}return r}function ZC(n,e){return ad(KC,n,e||{})}function QC(n,e){return ad(JC,n,e||{})}class e5{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:r,signal:i},o){try{const{data:s,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!s)return{data:null,error:a};const l=i??WC.createNewAbortSignal();if(s.webauthn.type==="create"){const{user:c}=s.webauthn.credential_options.publicKey;c.name||(c.name=`${c.id}:${r}`),c.displayName||(c.displayName=c.name)}switch(s.webauthn.type){case"create":{const c=ZC(s.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:u,error:d}=await YC({publicKey:c,signal:l});return u?{data:{factorId:e,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}case"request":{const c=QC(s.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:u,error:d}=await qC(Object.assign(Object.assign({},s.webauthn.credential_options),{publicKey:c,signal:l}));return u?{data:{factorId:e,challengeId:s.id,webauthn:{type:s.webauthn.type,credential_response:u}},error:null}:{data:null,error:d}}}}catch(s){return ht(s)?{data:null,error:s}:{data:null,error:new Go("Unexpected error in challenge",s)}}}async _verify({challengeId:e,factorId:t,webauthn:r}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i}},o){if(!t)return{data:null,error:new Gl("rpId is required for WebAuthn authentication")};try{if(!kv())return{data:null,error:new Go("Browser does not support WebAuthn",null)};const{data:s,error:a}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:r},signal:i},{request:o});if(!s)return{data:null,error:a};const{webauthn:l}=s;return this._verify({factorId:e,challengeId:s.challengeId,webauthn:{type:l.type,rpId:t,rpOrigins:r,credential_response:l.credential_response}})}catch(s){return ht(s)?{data:null,error:s}:{data:null,error:new Go("Unexpected error in authenticate",s)}}}async _register({friendlyName:e,rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:i},o){if(!t)return{data:null,error:new Gl("rpId is required for WebAuthn registration")};try{if(!kv())return{data:null,error:new Go("Browser does not support WebAuthn",null)};const{data:s,error:a}=await this._enroll({friendlyName:e});if(!s)return await this.client.mfa.listFactors().then(u=>{var d;return(d=u.data)===null||d===void 0?void 0:d.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(u=>u?this.client.mfa.unenroll({factorId:u==null?void 0:u.id}):void 0),{data:null,error:a};const{data:l,error:c}=await this._challenge({factorId:s.id,friendlyName:s.friendly_name,webauthn:{rpId:t,rpOrigins:r},signal:i},{create:o});return l?this._verify({factorId:s.id,challengeId:l.challengeId,webauthn:{rpId:t,rpOrigins:r,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:c}}catch(s){return ht(s)?{data:null,error:s}:{data:null,error:new Go("Unexpected error in register",s)}}}}OC();const t5={url:KT,storageKey:JT,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ZT,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Iv(n,e,t){return await t()}const Ms={};class Xl{get jwks(){var e,t;return(t=(e=Ms[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Ms[this.storageKey]=Object.assign(Object.assign({},Ms[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Ms[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Ms[this.storageKey]=Object.assign(Object.assign({},Ms[this.storageKey]),{cachedAt:e})}constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Xl.nextInstanceID,Xl.nextInstanceID+=1,this.instanceID>0&&tr()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},t5),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new LC({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=hS(i.fetch),this.lock=i.lock||Iv,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:tr()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=NC:this.lock=Iv,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new e5(this)},this.persistSession?(i.storage?this.storage=i.storage:dS()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Pv(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Pv(this.memoryStorage)),tr()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${lS}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=hC(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),tr()&&this.detectSessionInUrl&&r!=="none"){const{data:i,error:o}=await this._getSessionFromURL(t,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),iC(o)){const l=(e=o.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:s,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",s,"redirect type",a),await this._saveSession(s),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",s):await this._notifyAllSubscribers("SIGNED_IN",s)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return ht(t)?{error:t}:{error:new Go("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,i;try{const o=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:Cr}),{data:s,error:a}=o;if(a||!s)return{data:{user:null,session:null},error:a};const l=s.session,c=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(ht(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,r,i;try{let o;if("email"in e){const{email:u,password:d,options:f}=e;let m=null,v=null;this.flowType==="pkce"&&([m,v]=await Ss(this.storage,this.storageKey)),o=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:u,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:m,code_challenge_method:v},xform:Cr})}else if("phone"in e){const{phone:u,password:d,options:f}=e;o=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:d,data:(r=f==null?void 0:f.data)!==null&&r!==void 0?r:{},channel:(i=f==null?void 0:f.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:Cr})}else throw new Oc("You must provide either an email or phone number and a password");const{data:s,error:a}=o;if(a||!s)return{data:{user:null,session:null},error:a};const l=s.session,c=s.user;return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(ht(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:s,options:a}=e;t=await xt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:s,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Rv})}else if("phone"in e){const{phone:o,password:s,options:a}=e;t=await xt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:s,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Rv})}else throw new Oc("You must provide either an email or phone number and a password");const{data:r,error:i}=t;return i?{data:{user:null,session:null},error:i}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new bs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:i})}catch(t){if(ht(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,i,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,r,i,o,s,a,l,c,u,d,f;let m,v;if("message"in e)m=e.message,v=e.signature;else{const{chain:_,wallet:x,statement:p,options:b}=e;let g;if(tr())if(typeof x=="object")g=x;else{const w=window;if("ethereum"in w&&typeof w.ethereum=="object"&&"request"in w.ethereum&&typeof w.ethereum.request=="function")g=w.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(b!=null&&b.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=x}const y=new URL((t=b==null?void 0:b.url)!==null&&t!==void 0?t:window.location.href),E=await g.request({method:"eth_requestAccounts"}).then(w=>w).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!E||E.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const C=pS(E[0]);let A=(r=b==null?void 0:b.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!A){const w=await g.request({method:"eth_chainId"});A=UC(w)}const T={domain:y.host,address:C,statement:p,uri:y.href,version:"1",chainId:A,nonce:(i=b==null?void 0:b.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(s=(o=b==null?void 0:b.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&s!==void 0?s:new Date,expirationTime:(a=b==null?void 0:b.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=b==null?void 0:b.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=b==null?void 0:b.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(u=b==null?void 0:b.signInWithEthereum)===null||u===void 0?void 0:u.resources};m=FC(T),v=await g.request({method:"personal_sign",params:[zC(m),C]})}try{const{data:_,error:x}=await xt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:m,signature:v},!((d=e.options)===null||d===void 0)&&d.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:Cr});if(x)throw x;return!_||!_.session||!_.user?{data:{user:null,session:null},error:new bs}:(_.session&&(await this._saveSession(_.session),await this._notifyAllSubscribers("SIGNED_IN",_.session)),{data:Object.assign({},_),error:x})}catch(_){if(ht(_))return{data:{user:null,session:null},error:_};throw _}}async signInWithSolana(e){var t,r,i,o,s,a,l,c,u,d,f,m;let v,_;if("message"in e)v=e.message,_=e.signature;else{const{chain:x,wallet:p,statement:b,options:g}=e;let y;if(tr())if(typeof p=="object")y=p;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))y=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof p!="object"||!(g!=null&&g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");y=p}const E=new URL((t=g==null?void 0:g.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in y&&y.signIn){const C=await y.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},g==null?void 0:g.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),b?{statement:b}:null));let A;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")A=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)A=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)v=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),_=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in y)||typeof y.signMessage!="function"||!("publicKey"in y)||typeof y!="object"||!y.publicKey||!("toBase58"in y.publicKey)||typeof y.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${E.host} wants you to sign in with your Solana account:`,y.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(i=(r=g==null?void 0:g.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((o=g==null?void 0:g.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...!((s=g==null?void 0:g.signInWithSolana)===null||s===void 0)&&s.expirationTime?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...!((a=g==null?void 0:g.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...!((l=g==null?void 0:g.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...!((c=g==null?void 0:g.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...!((d=(u=g==null?void 0:g.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||d===void 0)&&d.length?["Resources",...g.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const C=await y.signMessage(new TextEncoder().encode(v),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=C}}try{const{data:x,error:p}=await xt(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:Qo(_)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:Cr});if(p)throw p;return!x||!x.session||!x.user?{data:{user:null,session:null},error:new bs}:(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("SIGNED_IN",x.session)),{data:Object.assign({},x),error:p})}catch(x){if(ht(x))return{data:{user:null,session:null},error:x};throw x}}async _exchangeCodeForSession(e){const t=await Io(this.storage,`${this.storageKey}-code-verifier`),[r,i]=(t??"").split("/");try{const{data:o,error:s}=await xt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:Cr});if(await ji(this.storage,`${this.storageKey}-code-verifier`),s)throw s;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new bs}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:i??null}),error:s})}catch(o){if(ht(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:r,token:i,access_token:o,nonce:s}=e,a=await xt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:i,access_token:o,nonce:s,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:Cr}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new bs}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(t){if(ht(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,i,o,s;try{if("email"in e){const{email:a,options:l}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await Ss(this.storage,this.storageKey));const{error:d}=await xt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=l==null?void 0:l.data)!==null&&t!==void 0?t:{},create_user:(r=l==null?void 0:l.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:l==null?void 0:l.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:a,options:l}=e,{data:c,error:u}=await xt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=l==null?void 0:l.data)!==null&&i!==void 0?i:{},create_user:(o=l==null?void 0:l.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(s=l==null?void 0:l.channel)!==null&&s!==void 0?s:"sms"}});return{data:{user:null,session:null,messageId:c==null?void 0:c.message_id},error:u}}throw new Oc("You must provide either an email or phone number.")}catch(a){if(ht(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,r;try{let i,o;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:s,error:a}=await xt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:i,xform:Cr});if(a)throw a;if(!s)throw new Error("An error occurred on token verification.");const l=s.session,c=s.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(i){if(ht(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,r,i;try{let o=null,s=null;return this.flowType==="pkce"&&([o,s]=await Ss(this.storage,this.storageKey)),await xt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:s}),headers:this.headers,xform:AC})}catch(o){if(ht(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new Yi;const{error:i}=await xt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(ht(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:i,options:o}=e,{error:s}=await xt(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return{data:{user:null,session:null},error:s}}else if("phone"in e){const{phone:r,type:i,options:o}=e,{data:s,error:a}=await xt(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:i,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return{data:{user:null,session:null,messageId:s==null?void 0:s.message_id},error:a}}throw new Oc("You must provide either an email or phone number and a type")}catch(t){if(ht(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Io(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Sh:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const s=await Io(this.userStorage,this.storageKey+"-user");s!=null&&s.user?e.user=s.user:e.user=Mh()}if(this.storage.isServer&&e.user){let s=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,u)=>(!s&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),s=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,u))})}return{data:{session:e},error:null}}const{data:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await xt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:to}):await this._useSession(async t=>{var r,i,o;const{data:s,error:a}=t;if(a)throw a;return!(!((r=s.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Yi}:await xt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(i=s.session)===null||i===void 0?void 0:i.access_token)!==null&&o!==void 0?o:void 0,xform:to})})}catch(t){if(ht(t))return rC(t)&&(await this._removeSession(),await ji(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:i,error:o}=r;if(o)throw o;if(!i.session)throw new Yi;const s=i.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Ss(this.storage,this.storageKey));const{data:c,error:u}=await xt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:s.access_token,xform:to});if(u)throw u;return s.user=c.user,await this._saveSession(s),await this._notifyAllSubscribers("USER_UPDATED",s),{data:{user:s.user},error:null}})}catch(r){if(ht(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Yi;const t=Date.now()/1e3;let r=t,i=!0,o=null;const{payload:s}=Eh(e.access_token);if(s.exp&&(r=s.exp,i=r<=t),i){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};o=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;o={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(ht(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:s,error:a}=t;if(a)throw a;e=(r=s.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new Yi;const{data:i,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(ht(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!tr())throw new Uc("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Uc(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new bv("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Uc("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new bv("No code detected.");const{data:b,error:g}=await this._exchangeCodeForSession(e.code);if(g)throw g;const y=new URL(window.location.href);return y.searchParams.delete("code"),window.history.replaceState(window.history.state,"",y.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:i,access_token:o,refresh_token:s,expires_in:a,expires_at:l,token_type:c}=e;if(!o||!a||!s||!c)throw new Uc("No session defined in URL");const u=Math.round(Date.now()/1e3),d=parseInt(a);let f=u+d;l&&(f=parseInt(l));const m=f-u;m*1e3<=Hs&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${d}s`);const v=f-d;u-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,f,u):u-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,f,u);const{data:_,error:x}=await this._getUser(o);if(x)throw x;const p={provider_token:r,provider_refresh_token:i,access_token:o,expires_in:d,expires_at:f,refresh_token:s,token_type:c,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:p,redirectType:e.type},error:null}}catch(r){if(ht(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Io(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:i,error:o}=t;if(o)return{error:o};const s=(r=i.session)===null||r===void 0?void 0:r.access_token;if(s){const{error:a}=await this.admin.signOut(s,e);if(a&&!(nC(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await ji(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=dC(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,i;try{const{data:{session:o},error:s}=t;if(s)throw s;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let r=null,i=null;this.flowType==="pkce"&&([r,i]=await Ss(this.storage,this.storageKey,!0));try{return await xt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(ht(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(ht(t))return{data:null,error:t};throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:r,error:i}=await this._useSession(async o=>{var s,a,l,c,u;const{data:d,error:f}=o;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(s=e.options)===null||s===void 0?void 0:s.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await xt(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(c=d.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(i)throw i;return tr()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(ht(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var r;try{const{error:i,data:{session:o}}=t;if(i)throw i;const{options:s,provider:a,token:l,access_token:c,nonce:u}=e,d=await xt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=o==null?void 0:o.access_token)!==null&&r!==void 0?r:void 0,body:{provider:a,id_token:l,access_token:c,nonce:u,link_identity:!0,gotrue_meta_security:{captcha_token:s==null?void 0:s.captchaToken}},xform:Cr}),{data:f,error:m}=d;return m?{data:{user:null,session:null},error:m}:!f||!f.session||!f.user?{data:{user:null,session:null},error:new bs}:(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),{data:f,error:m})}catch(i){if(ht(i))return{data:{user:null,session:null},error:i};throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,i;const{data:o,error:s}=t;if(s)throw s;return await xt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await mC(async i=>(i>0&&await pC(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await xt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Cr})),(i,o)=>{const s=200*Math.pow(2,i);return o&&wh(o)&&Date.now()+s-r<Hs})}catch(r){if(this._debug(t,"error",r),ht(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),tr()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const i=await Io(this.storage,this.storageKey);if(i&&this.userStorage){let s=await Io(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!s&&(s={user:i.user},await Ws(this.userStorage,this.storageKey+"-user",s)),i.user=(e=s==null?void 0:s.user)!==null&&e!==void 0?e:Mh()}else if(i&&!i.user&&!i.user){const s=await Io(this.storage,this.storageKey+"-user");s&&(s!=null&&s.user)?(i.user=s.user,await ji(this.storage,this.storageKey+"-user"),await Ws(this.storage,this.storageKey,i)):i.user=Mh()}if(this._debug(r,"session from storage",i),!this._isValidSession(i)){this._debug(r,"session is not valid"),i!==null&&await this._removeSession();return}const o=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Sh;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Sh}s`),o){if(this.autoRefreshToken&&i.refresh_token){const{error:s}=await this._callRefreshToken(i.refresh_token);s&&(console.error(s),wh(s)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",s),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:s,error:a}=await this._getUser(i.access_token);!a&&(s!=null&&s.user)?(i.user=s.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(s){console.error("Error getting user data:",s),this._debug(r,"error getting user data, skipping SIGNED_IN notification",s)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(r,"error",i),console.error(i);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new Yi;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ud;const{data:o,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!o.session)throw new Yi;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const a={data:o.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(o){if(this._debug(i,"error",o),ht(o)){const s={data:null,error:o};return wh(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(s),s}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,r=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],s=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(l){o.push(l)}});if(await Promise.all(s),o.length>0){for(let a=0;a<o.length;a+=1)console.error(o[a]);throw o[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await Ws(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const o=Tv(i);await Ws(this.storage,this.storageKey,o)}else{const i=Tv(t);await Ws(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await ji(this.storage,this.storageKey),await ji(this.storage,this.storageKey+"-code-verifier"),await ji(this.storage,this.storageKey+"-user"),this.userStorage&&await ji(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&tr()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Hs);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((r.expires_at*1e3-e)/Hs);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Hs}ms, refresh threshold is ${Sp} ticks`),i<=Sp&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof fS)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!tr()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const i=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&i.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&i.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,s]=await Ss(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(s)}`});i.push(a.toString())}if(r!=null&&r.queryParams){const o=new URLSearchParams(r.queryParams);i.push(o.toString())}return r!=null&&r.skipBrowserRedirect&&i.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:i,error:o}=t;return o?{data:null,error:o}:await xt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,i;const{data:o,error:s}=t;if(s)return{data:null,error:s};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:c}=await xt(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=o==null?void 0:o.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&l.type==="totp"&&(!((i=l==null?void 0:l.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(ht(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:o}=t;if(o)return{data:null,error:o};const s=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?GC(e.webauthn.credential_response):XC(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await xt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:s,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(t){if(ht(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:i,error:o}=t;if(o)return{data:null,error:o};const s=await xt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});if(s.error)return s;const{data:a}=s;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:VC(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:$C(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(ht(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:r}=await this.getUser();if(r)return{data:null,error:r};const i={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])i.all.push(o),o.status==="verified"&&i[o.factor_type].push(o);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:i},error:o}=e;if(o)return{data:null,error:o};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=Eh(i.access_token);let a=null;s.aal&&(a=s.aal);let l=a;((r=(t=i.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");const u=s.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(a=>a.kid===e);if(r)return r;const i=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+eC>i)return r;const{data:o,error:s}=await xt(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(s)throw s;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=i,r=o.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:m,error:v}=await this.getSession();if(v||!m.session)return{data:null,error:v};r=m.session.access_token}const{header:i,payload:o,signature:s,raw:{header:a,payload:l}}=Eh(r);t!=null&&t.allowExpired||SC(o.exp);const c=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!c){const{error:m}=await this.getUser(r);if(m)throw m;return{data:{claims:o,header:i,signature:s},error:null}}const u=wC(i.alg),d=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,d,s,cC(`${a}.${l}`)))throw new Mp("Invalid JWT signature");return{data:{claims:o,header:i,signature:s},error:null}}catch(r){if(ht(r))return{data:null,error:r};throw r}}}Xl.nextInstanceID=0;const n5=Xl;class r5 extends n5{constructor(e){super(e)}}var i5=function(n,e,t,r){function i(o){return o instanceof t?o:new t(function(s){s(o)})}return new(t||(t=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):i(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})};class o5{constructor(e,t,r){var i,o,s;this.supabaseUrl=e,this.supabaseKey=t;const a=qT(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);const l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:FT,realtime:BT,auth:Object.assign(Object.assign({},jT),{storageKey:l}),global:zT},u=YT(r??{},c);this.storageKey=(i=u.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(o=u.global.headers)!==null&&o!==void 0?o:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=u.auth)!==null&&s!==void 0?s:{},this.headers,u.global.fetch),this.fetch=$T(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new tT(new URL("rest/v1",a).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new NT(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new LM(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){return i5(this,void 0,void 0,function*(){var e,t;if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,userStorage:o,storageKey:s,flowType:a,lock:l,debug:c},u,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new r5({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),u),storageKey:s,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:i,userStorage:o,flowType:a,lock:l,debug:c,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(m=>m.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new xT(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const s5=(n,e,t)=>new o5(n,e,t);function a5(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}a5()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const l5=void 0,c5=void 0;throw console.error("Missing Supabase environment variables:",{VITE_SUPABASE_URL:" Missing",VITE_SUPABASE_ANON_KEY:" Missing"}),new Error("Supabase configuration is missing. Please set VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY environment variables. For local development, copy .env.example to .env and fill in your credentials.");const bt=s5(l5,c5,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"}}),vS=S.createContext(void 0),dc=()=>{const n=S.useContext(vS);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},u5=({children:n})=>{const[e,t]=S.useState(null),[r,i]=S.useState(!0);S.useEffect(()=>{console.log(" AuthContext initializing..."),o();const{data:d}=bt.auth.onAuthStateChange((f,m)=>{console.log(" Auth state changed:",f,"Session:",!!m),m!=null&&m.user?(console.log(" User email from session:",m.user.email),s(m.user).catch(v=>{console.error("Failed to handle auth user:",v)})):(console.log(" No session, user logged out"),t(null))});return console.log(" Auth listener registered"),()=>{console.log(" Auth listener unsubscribing"),d==null||d.subscription.unsubscribe()}},[]);const o=async()=>{console.log(" Checking for existing session..."),i(!0);try{const d=new Promise((x,p)=>setTimeout(()=>p(new Error("Session check timeout")),3e3)),f=bt.auth.getSession(),m=await Promise.race([f,d]),{data:{session:v},error:_}=m;console.log(" Session check result:",{hasSession:!!v,error:_}),v!=null&&v.user?(console.log(" Found existing session for:",v.user.email),await s(v.user)):console.log(" No existing session found")}catch(d){d.message==="Session check timeout"?console.warn(" Session check timed out - continuing without auth"):console.error(" Failed to check session:",d)}finally{i(!1),console.log(" Auth initialization complete")}},s=async d=>{var f;try{console.log(" Handling auth user:",d.email);const m=new Promise((p,b)=>setTimeout(()=>b(new Error("DB timeout")),3e3)),v=bt.from("users").select("*").eq("id",d.id).maybeSingle(),{data:_,error:x}=await Promise.race([v,m]);if(x&&console.error(" Error querying user:",x),_){const{error:p}=await bt.from("users").update({lastactiveat:new Date().toISOString()}).eq("id",d.id);p&&console.error("Failed to update last active:",p),t(_),console.log(" Session restored:",_.username)}else{console.log(" New user detected, creating user record...");const p=d.user_metadata,b={id:d.id,email:d.email,username:p.username||((f=d.email)==null?void 0:f.split("@")[0])||"user",preferredlanguage:p.preferredLanguage||"English",region:null,termsaccepted:p.termsAccepted||!0,allownotifications:p.allowNotifications||!1,usertype:"regular"},g=bt.from("users").insert(b).select().maybeSingle(),y=new Promise((A,T)=>setTimeout(()=>T(new Error("DB insert timeout")),3e3)),{data:E,error:C}=await Promise.race([g,y]);if(C){if(console.error(" Failed to create user record:",C),console.error("Error code:",C.code),console.error("Error message:",C.message),console.error("Error details:",C.details),console.error("User data attempted:",b),C.code==="23505"){console.log(" User already exists, fetching existing user...");const{data:A}=await bt.from("users").select("*").eq("id",d.id).maybeSingle();A&&(t(A),console.log(" Fetched existing user:",A.username))}}else E&&(t(E),console.log(" New user created:",E.username))}}catch(m){m.message==="DB timeout"||m.message==="DB insert timeout"?console.warn(" Database query timed out in handleAuthUser - user not persisted"):console.error("Failed to handle auth user:",m)}},u={user:e,isLoading:r,isAuthenticated:e!==null,login:async(d,f,m,v,_)=>{try{const{error:x}=await bt.auth.signInWithOtp({email:d,options:{emailRedirectTo:`${window.location.origin}/auth/callback`,shouldCreateUser:!0,data:{username:f,preferredLanguage:m,termsAccepted:v,allowNotifications:_}}});if(x)throw x;console.log(" Magic link sent to:",d)}catch(x){throw console.error("Failed to send magic link:",x),x}},logout:async()=>{try{await bt.auth.signOut(),t(null),console.log(" User logged out")}catch(d){console.error("Logout failed:",d)}},updateLastActive:async()=>{if(e){const d={...e,lastactiveat:new Date().toISOString()};t(d),await bt.from("users").update({lastactiveat:d.lastactiveat}).eq("id",e.id)}}};return h.jsx(vS.Provider,{value:u,children:n})},d5="50.14.0",h5={version:d5},ld=h5.version,Tp="app_version";function f5(){return ld}function p5(){const n=localStorage.getItem(Tp);return n?n!==ld:(localStorage.setItem(Tp,ld),!1)}function m5(){localStorage.setItem(Tp,ld)}function g5(){"caches"in window&&caches.keys().then(n=>{n.forEach(e=>caches.delete(e))}),m5(),window.location.reload()}const v5=()=>{const[n,e]=S.useState(!1),[t,r]=S.useState(!1);S.useEffect(()=>{p5()&&e(!0)},[]);const i=()=>{r(!0),g5()},o=()=>{e(!1)};return n?h.jsxs("div",{style:{position:"fixed",bottom:"20px",right:"20px",background:"linear-gradient(135deg, #10b981, #059669)",color:"#fff",borderRadius:"12px",padding:"16px 20px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",zIndex:1e5,maxWidth:"400px",display:"flex",flexDirection:"column",gap:"12px",border:"2px solid rgba(255, 255, 255, 0.2)"},children:[h.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[h.jsx("span",{style:{fontSize:"24px"},children:""}),h.jsxs("div",{style:{flex:1},children:[h.jsx("div",{style:{fontWeight:700,fontSize:"16px",marginBottom:"4px"},children:"Update Available!"}),h.jsxs("div",{style:{fontSize:"14px",opacity:.9},children:["v",f5()," is ready"]})]}),h.jsx("button",{onClick:o,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"24px",height:"24px",cursor:"pointer",color:"#fff",fontSize:"16px",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:s=>s.currentTarget.style.background="rgba(255, 255, 255, 0.3)",onMouseLeave:s=>s.currentTarget.style.background="rgba(255, 255, 255, 0.2)",children:""})]}),h.jsx("button",{onClick:i,disabled:t,style:{background:"#fff",color:"#059669",border:"none",borderRadius:"8px",padding:"12px 16px",fontSize:"14px",fontWeight:700,cursor:t?"wait":"pointer",transition:"all 0.2s",opacity:t?.7:1},onMouseEnter:s=>!t&&(s.currentTarget.style.transform="translateY(-2px)"),onMouseLeave:s=>!t&&(s.currentTarget.style.transform="translateY(0)"),children:t?"Updating...":"Update Now"}),h.jsx("div",{style:{fontSize:"12px",opacity:.8,textAlign:"center",marginTop:"4px"},children:"New features and improvements await!"})]}):null},x5=()=>{const n=Jn(),{user:e,logout:t}=dc(),[r,i]=S.useState(!1),[o,s]=S.useState(null);return h.jsxs("div",{style:{minHeight:"100vh",width:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",color:"#fff",display:"flex",flexDirection:"column",alignItems:"center",padding:"clamp(0.5rem, 2vw, 1.5rem)",paddingTop:"clamp(1.5rem, 5vh, 3rem)",position:"relative",boxSizing:"border-box"},children:[h.jsx("div",{style:{position:"fixed",top:"clamp(0.5rem, 2vh, 1.5rem)",right:"clamp(0.5rem, 2vw, 1.5rem)",zIndex:9999},children:e?h.jsxs("div",{style:{position:"relative"},children:[h.jsxs("button",{onClick:()=>i(!r),style:{padding:"clamp(0.5rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem)",fontSize:"clamp(0.875rem, 2.5vw, 1rem)",fontWeight:700,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.8)",borderRadius:"12px",color:"#fff",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 8px 24px rgba(0,0,0,0.4)",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.3)",a.currentTarget.style.transform="scale(1.05)"},onMouseLeave:a=>{a.currentTarget.style.background="linear-gradient(135deg, #667eea 0%, #764ba2 100%)",a.currentTarget.style.transform="scale(1)"},children:[h.jsx("span",{children:""}),h.jsx("span",{children:"Profile"})]}),r&&h.jsxs(h.Fragment,{children:[h.jsx("div",{style:{position:"fixed",inset:0,zIndex:9998},onClick:()=>i(!1)}),h.jsxs("div",{style:{position:"absolute",top:"calc(100% + 8px)",right:0,background:"rgba(0, 0, 0, 0.95)",backdropFilter:"blur(20px)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"12px",padding:"8px",minWidth:"200px",boxShadow:"0 8px 24px rgba(0,0,0,0.5)",zIndex:9999},children:[h.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid rgba(255,255,255,0.2)",marginBottom:"8px"},children:[h.jsx("div",{style:{fontSize:"0.875rem",color:"rgba(255,255,255,0.7)"},children:"Signed in as"}),h.jsx("div",{style:{fontSize:"1rem",fontWeight:600,color:"#fff",marginTop:"4px"},children:e.email})]}),h.jsxs("button",{onClick:()=>{t(),i(!1)},style:{width:"100%",padding:"12px 16px",background:"transparent",border:"none",color:"#fff",textAlign:"left",cursor:"pointer",borderRadius:"8px",fontSize:"0.9rem",transition:"background 0.2s",display:"flex",alignItems:"center",gap:"12px"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.1)"},onMouseLeave:a=>{a.currentTarget.style.background="transparent"},children:[h.jsx("span",{children:""}),h.jsx("span",{children:"Sign Out"})]})]})]})]}):h.jsx("button",{onClick:()=>n("/login"),style:{padding:"clamp(0.5rem, 2vw, 0.75rem) clamp(1rem, 3vw, 1.5rem)",fontSize:"clamp(0.875rem, 2.5vw, 1rem)",fontWeight:700,background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.8)",borderRadius:"12px",color:"#fff",cursor:"pointer",transition:"all 0.2s",boxShadow:"0 8px 24px rgba(0,0,0,0.4)"},onMouseEnter:a=>{a.currentTarget.style.background="rgba(255,255,255,0.3)",a.currentTarget.style.transform="scale(1.05)"},onMouseLeave:a=>{a.currentTarget.style.background="rgba(255,255,255,0.2)",a.currentTarget.style.transform="scale(1)"},children:"Sign In"})}),h.jsx("h1",{style:{fontSize:"clamp(1.75rem, 6vw, 2.75rem)",fontWeight:800,margin:"clamp(0.25rem, 1.5vh, 1rem) 0 clamp(0.25rem, 1vh, 0.75rem) 0",color:"#fff",textShadow:"0 4px 20px rgba(0,0,0,0.3), 0 0 40px rgba(255,255,255,0.3)",textAlign:"center",letterSpacing:"0.1em",lineHeight:1.2},children:"KOOS PUZZLE"}),h.jsx("p",{style:{fontSize:"clamp(0.9rem, 2vw, 1.05rem)",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 10px rgba(0,0,0,0.2)",marginBottom:"clamp(1.5rem, 4vh, 2.5rem)",textAlign:"center",maxWidth:"700px",padding:"0 1rem",lineHeight:1.6},children:"Welcome! Choose your path to explore the world of 3D sphere puzzles."}),h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 280px))",justifyContent:"center",gap:"clamp(0.75rem, 2vw, 1.25rem)",width:"100%",maxWidth:"1200px",padding:"0 clamp(0.75rem, 2vw, 1.5rem)",marginBottom:"clamp(1rem, 3vh, 2rem)"},children:[h.jsxs("div",{onClick:()=>n("/gallery?tab=puzzles"),onMouseEnter:()=>s("solve"),onMouseLeave:()=>s(null),style:{background:o==="solve"?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"24px",border:"3px solid rgba(255,255,255,0.5)",boxShadow:o==="solve"?"0 20px 60px rgba(0,0,0,0.4), 0 0 60px rgba(102, 126, 234, 0.5)":"0 15px 40px rgba(0,0,0,0.3)",padding:"clamp(1rem, 2.5vw, 1.75rem)",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:o==="solve"?"translateY(-8px) scale(1.02)":"translateY(0) scale(1)",display:"flex",flexDirection:"column",alignItems:"center",gap:"clamp(0.5rem, 1.5vw, 0.875rem)",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"clamp(2.5rem, 5vw, 3.5rem)",filter:o==="solve"?"brightness(1.2) drop-shadow(0 0 20px rgba(102,126,234,0.8))":"brightness(1)",transition:"all 0.3s"},children:""}),h.jsx("h2",{style:{fontSize:"clamp(1.25rem, 3vw, 1.5rem)",fontWeight:800,color:"#fff",textShadow:"0 4px 15px rgba(0,0,0,0.3)",margin:0},children:"Solve a Puzzle"}),h.jsx("p",{style:{fontSize:"clamp(0.875rem, 2vw, 1rem)",color:"rgba(255,255,255,0.9)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",lineHeight:1.6,margin:0},children:"Choose from our collection and put your spatial reasoning to the test"})]}),h.jsxs("div",{onClick:()=>n("/create"),onMouseEnter:()=>s("create"),onMouseLeave:()=>s(null),style:{background:o==="create"?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"24px",border:"3px solid rgba(255,255,255,0.5)",boxShadow:o==="create"?"0 20px 60px rgba(0,0,0,0.4), 0 0 60px rgba(118, 75, 162, 0.5)":"0 15px 40px rgba(0,0,0,0.3)",padding:"clamp(1rem, 2.5vw, 1.75rem)",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:o==="create"?"translateY(-8px) scale(1.02)":"translateY(0) scale(1)",display:"flex",flexDirection:"column",alignItems:"center",gap:"clamp(0.5rem, 1.5vw, 0.875rem)",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"clamp(2.5rem, 5vw, 3.5rem)",filter:o==="create"?"brightness(1.2) drop-shadow(0 0 20px rgba(118,75,162,0.8))":"brightness(1)",transition:"all 0.3s"},children:""}),h.jsx("h2",{style:{fontSize:"clamp(1.25rem, 3vw, 1.5rem)",fontWeight:800,color:"#fff",textShadow:"0 4px 15px rgba(0,0,0,0.3)",margin:0},children:"Create a Puzzle"}),h.jsx("p",{style:{fontSize:"clamp(0.875rem, 2vw, 1rem)",color:"rgba(255,255,255,0.9)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",lineHeight:1.6,margin:0},children:"Design your own unique 3D puzzle and share it with the world"})]}),h.jsxs("div",{onClick:()=>n("/gallery?tab=movies"),onMouseEnter:()=>s("solutions"),onMouseLeave:()=>s(null),style:{background:o==="solutions"?"rgba(255,255,255,0.35)":"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"24px",border:"3px solid rgba(255,255,255,0.5)",boxShadow:o==="solutions"?"0 20px 60px rgba(0,0,0,0.4), 0 0 60px rgba(240, 147, 251, 0.5)":"0 15px 40px rgba(0,0,0,0.3)",padding:"clamp(1rem, 2.5vw, 1.75rem)",cursor:"pointer",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",transform:o==="solutions"?"translateY(-8px) scale(1.02)":"translateY(0) scale(1)",display:"flex",flexDirection:"column",alignItems:"center",gap:"clamp(0.5rem, 1.5vw, 0.875rem)",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"clamp(2.5rem, 5vw, 3.5rem)",filter:o==="solutions"?"brightness(1.2) drop-shadow(0 0 20px rgba(240,147,251,0.8))":"brightness(1)",transition:"all 0.3s"},children:""}),h.jsx("h2",{style:{fontSize:"clamp(1.25rem, 3vw, 1.5rem)",fontWeight:800,color:"#fff",textShadow:"0 4px 15px rgba(0,0,0,0.3)",margin:0},children:"View Solutions"}),h.jsx("p",{style:{fontSize:"clamp(0.875rem, 2vw, 1rem)",color:"rgba(255,255,255,0.9)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",lineHeight:1.6,margin:0},children:"Explore how others have solved puzzles and get inspired"})]})]})]})},y5=()=>{const n=Jn(),{login:e}=dc(),[t,r]=S.useState(()=>localStorage.getItem("rememberedEmail")||""),[i,o]=S.useState(!1),[s,a]=S.useState(null),[l,c]=S.useState(!1),u=async d=>{var m,v;if(d.preventDefault(),a(null),!t){a("Please enter your email address");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){a("Please enter a valid email address");return}o(!0);try{console.log(" Attempting to send magic link to:",t),await e(t,t.split("@")[0],"English",!0,!1),localStorage.setItem("rememberedEmail",t),console.log(" Magic link request completed successfully"),c(!0),o(!1)}catch(_){console.error(" Login error:",_),(m=_.message)!=null&&m.includes("rate limit")?a("Please wait 60 seconds before requesting another magic link."):(v=_.message)!=null&&v.includes("Email rate limit")?a("Too many requests. Please wait a few minutes and try again."):a(_.message||"Failed to send magic link. Please try again."),o(!1)}};return l?h.jsx("div",{style:{minHeight:"100dvh",width:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",padding:"0"},children:h.jsxs("div",{style:{maxWidth:"500px",width:"calc(100vw - 2rem)",margin:"1rem",backgroundColor:"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"20px",padding:"clamp(1.5rem, 5vw, 3rem)",textAlign:"center",border:"3px solid rgba(255,255,255,0.4)",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",boxSizing:"border-box"},children:[h.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),h.jsx("h2",{style:{fontSize:"2rem",marginBottom:"1rem",color:"#fff",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:"Check Your Email"}),h.jsxs("p",{style:{fontSize:"1.1rem",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",marginBottom:"2rem",lineHeight:"1.6"},children:["We've sent a magic link to ",h.jsx("strong",{children:t}),h.jsx("br",{}),"Click the link in your email to sign in."]}),h.jsx("button",{onClick:()=>n("/"),style:{padding:"0.75rem 2rem",fontSize:"1rem",fontWeight:600,background:"rgba(255,255,255,0.3)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.5)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:d=>d.currentTarget.style.background="rgba(255,255,255,0.5)",onMouseLeave:d=>d.currentTarget.style.background="rgba(255,255,255,0.3)",children:"Return to Home"})]})}):h.jsx("div",{style:{minHeight:"100dvh",width:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",padding:"0"},children:h.jsxs("div",{style:{maxWidth:"500px",width:"calc(100vw - 2rem)",margin:"1rem",backgroundColor:"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"20px",padding:"clamp(1.5rem, 5vw, 3rem)",border:"3px solid rgba(255,255,255,0.4)",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",boxSizing:"border-box"},children:[h.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:800,marginBottom:"0.5rem",color:"#fff",textShadow:"0 4px 20px rgba(0,0,0,0.3), 0 0 30px rgba(255,255,255,0.3)",textAlign:"center"},children:"Welcome to KOOS"}),h.jsx("p",{style:{textAlign:"center",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",marginBottom:"2rem",fontSize:"0.95rem"},children:"Enter your email to sign in"}),s&&h.jsx("div",{style:{padding:"1rem",backgroundColor:"rgba(255,255,255,0.25)",backdropFilter:"blur(10px)",border:"2px solid rgba(239,68,68,0.5)",boxShadow:"0 4px 16px rgba(239,68,68,0.3)",borderRadius:"8px",marginBottom:"1.5rem",color:"#ef4444"},children:s}),h.jsxs("form",{onSubmit:u,children:[h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:600,color:"rgba(255,255,255,0.8)"},children:"Email Address *"}),h.jsx("input",{type:"email",value:t,onChange:d=>r(d.target.value),placeholder:"your@email.com",required:!0,style:{width:"100%",padding:"0.75rem",backgroundColor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.4)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",fontSize:"1rem",outline:"none",transition:"all 0.2s",boxSizing:"border-box"},onFocus:d=>d.currentTarget.style.background="rgba(255,255,255,0.35)",onBlur:d=>d.currentTarget.style.background="rgba(255,255,255,0.2)"})]}),h.jsx("button",{type:"submit",disabled:i,style:{width:"100%",padding:"1rem",fontSize:"1.1rem",fontWeight:600,background:i?"rgba(255,107,107,0.5)":"linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)",boxShadow:"0 8px 24px rgba(255,107,107,0.4)",textShadow:"0 2px 4px rgba(0,0,0,0.2)",border:"none",borderRadius:"8px",color:"#fff",cursor:i?"not-allowed":"pointer",transition:"transform 0.2s",opacity:i?.7:1},onMouseEnter:d=>!i&&(d.currentTarget.style.transform="scale(1.02)"),onMouseLeave:d=>!i&&(d.currentTarget.style.transform="scale(1)"),children:i?"Sending Magic Link...":"Continue with Email"}),h.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",color:"rgba(255,255,255,0.5)"},children:"We'll send you a magic link to sign in without a password"})]}),h.jsxs("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.9rem",color:"rgba(255,255,255,0.8)"},children:["Don't have an account?"," ",h.jsx("button",{onClick:()=>n("/signup"),style:{background:"none",border:"none",color:"#feca57",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem",fontWeight:600,padding:0},children:"Create Account"})]}),h.jsx("button",{onClick:()=>n("/"),style:{width:"100%",marginTop:"1rem",padding:"0.75rem",fontSize:"1rem",fontWeight:600,background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.4)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",textShadow:"0 2px 4px rgba(0,0,0,0.2)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:d=>{d.currentTarget.style.background="rgba(255,255,255,0.35)",d.currentTarget.style.color="#fff"},onMouseLeave:d=>{d.currentTarget.style.background="rgba(255,255,255,0.2)",d.currentTarget.style.color="#fff"},children:"Back to Home"})]})})},_5=["English","Spanish","French","German","Italian","Portuguese","Dutch","Chinese","Japanese","Russian"],b5=()=>{const n=Jn(),{login:e}=dc(),[t,r]=S.useState(()=>localStorage.getItem("rememberedEmail")||""),[i,o]=S.useState(""),[s,a]=S.useState("English"),[l,c]=S.useState(!1),[u,d]=S.useState(!1),[f,m]=S.useState(!1),[v,_]=S.useState(null),[x,p]=S.useState(!1),b=async g=>{var E,C;if(g.preventDefault(),_(null),!t||!i){_("Please fill in all required fields");return}if(!l){_("You must accept the Terms & Conditions to continue");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)){_("Please enter a valid email address");return}m(!0);try{console.log(" Creating account and sending magic link to:",t),await e(t,i,s,l,u),localStorage.setItem("rememberedEmail",t),console.log(" Magic link sent successfully"),p(!0),m(!1)}catch(A){console.error(" Signup error:",A),(E=A.message)!=null&&E.includes("rate limit")?_("Please wait 60 seconds before requesting another magic link."):(C=A.message)!=null&&C.includes("Email rate limit")?_("Too many requests. Please wait a few minutes and try again."):_(A.message||"Failed to send magic link. Please try again."),m(!1)}};return x?h.jsx("div",{style:{minHeight:"100dvh",width:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",padding:"0"},children:h.jsxs("div",{style:{maxWidth:"500px",width:"calc(100vw - 2rem)",margin:"1rem",backgroundColor:"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"20px",padding:"clamp(1.5rem, 5vw, 3rem)",textAlign:"center",border:"3px solid rgba(255,255,255,0.4)",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",boxSizing:"border-box"},children:[h.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),h.jsx("h2",{style:{fontSize:"2rem",marginBottom:"1rem",color:"#fff",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:"Check Your Email"}),h.jsxs("p",{style:{fontSize:"1.1rem",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",marginBottom:"2rem",lineHeight:"1.6"},children:["We've sent a magic link to ",h.jsx("strong",{children:t}),h.jsx("br",{}),"Click the link to complete your account setup."]}),h.jsx("button",{onClick:()=>n("/"),style:{padding:"0.75rem 2rem",fontSize:"1rem",fontWeight:600,background:"rgba(255,255,255,0.3)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.5)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:g=>g.currentTarget.style.background="rgba(255,255,255,0.5)",onMouseLeave:g=>g.currentTarget.style.background="rgba(255,255,255,0.3)",children:"Return to Home"})]})}):h.jsx("div",{style:{minHeight:"100dvh",width:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",padding:"0"},children:h.jsxs("div",{style:{maxWidth:"500px",width:"calc(100vw - 2rem)",margin:"1rem",backgroundColor:"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"20px",padding:"clamp(1.5rem, 5vw, 3rem)",border:"3px solid rgba(255,255,255,0.4)",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",boxSizing:"border-box"},children:[h.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:800,marginBottom:"0.5rem",color:"#fff",textShadow:"0 4px 20px rgba(0,0,0,0.3), 0 0 30px rgba(255,255,255,0.3)",textAlign:"center"},children:"Create Account"}),h.jsx("p",{style:{textAlign:"center",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",marginBottom:"2rem",fontSize:"0.95rem"},children:"Join the KOOS Puzzle community"}),v&&h.jsx("div",{style:{padding:"1rem",backgroundColor:"rgba(255,255,255,0.25)",backdropFilter:"blur(10px)",border:"2px solid rgba(239,68,68,0.5)",boxShadow:"0 4px 16px rgba(239,68,68,0.3)",borderRadius:"8px",marginBottom:"1.5rem",color:"#ef4444"},children:v}),h.jsxs("form",{onSubmit:b,children:[h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:600,color:"rgba(255,255,255,0.8)"},children:"Email Address *"}),h.jsx("input",{type:"email",value:t,onChange:g=>r(g.target.value),placeholder:"your@email.com",required:!0,style:{width:"100%",padding:"0.75rem",backgroundColor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.4)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",fontSize:"1rem",outline:"none",transition:"all 0.2s",boxSizing:"border-box"},onFocus:g=>g.currentTarget.style.background="rgba(255,255,255,0.35)",onBlur:g=>g.currentTarget.style.background="rgba(255,255,255,0.2)"})]}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:600,color:"rgba(255,255,255,0.8)"},children:"Username *"}),h.jsx("input",{type:"text",value:i,onChange:g=>o(g.target.value),placeholder:"Choose a username",required:!0,style:{width:"100%",padding:"0.75rem",backgroundColor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.4)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",fontSize:"1rem",outline:"none",transition:"all 0.2s",boxSizing:"border-box"},onFocus:g=>g.currentTarget.style.background="rgba(255,255,255,0.35)",onBlur:g=>g.currentTarget.style.background="rgba(255,255,255,0.2)"})]}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",fontWeight:600,color:"rgba(255,255,255,0.8)"},children:"Preferred Language *"}),h.jsx("select",{value:s,onChange:g=>a(g.target.value),required:!0,style:{width:"100%",padding:"0.75rem",backgroundColor:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.4)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",fontSize:"1rem",outline:"none",cursor:"pointer",boxSizing:"border-box"},children:_5.map(g=>h.jsx("option",{value:g,style:{background:"#764ba2",color:"#fff"},children:g},g))})]}),h.jsx("div",{style:{marginBottom:"1rem"},children:h.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:"0.9rem",color:"rgba(255,255,255,0.8)"},children:[h.jsx("input",{type:"checkbox",checked:l,onChange:g=>c(g.target.checked),required:!0,style:{marginRight:"0.75rem",cursor:"pointer",width:"18px",height:"18px"}}),"I accept the Terms & Conditions *"]})}),h.jsx("div",{style:{marginBottom:"2rem"},children:h.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer",fontSize:"0.9rem",color:"rgba(255,255,255,0.8)"},children:[h.jsx("input",{type:"checkbox",checked:u,onChange:g=>d(g.target.checked),style:{marginRight:"0.75rem",cursor:"pointer",width:"18px",height:"18px"}}),"Receive updates about new puzzles and movies"]})}),h.jsx("button",{type:"submit",disabled:f,style:{width:"100%",padding:"1rem",fontSize:"1.1rem",fontWeight:600,background:f?"rgba(255,107,107,0.5)":"linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)",boxShadow:"0 8px 24px rgba(255,107,107,0.4)",textShadow:"0 2px 4px rgba(0,0,0,0.2)",border:"none",borderRadius:"8px",color:"#fff",cursor:f?"not-allowed":"pointer",transition:"transform 0.2s",opacity:f?.7:1},onMouseEnter:g=>!f&&(g.currentTarget.style.transform="scale(1.02)"),onMouseLeave:g=>!f&&(g.currentTarget.style.transform="scale(1)"),children:f?"Creating Account...":"Create Account"})]}),h.jsxs("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.9rem",color:"rgba(255,255,255,0.8)"},children:["Already have an account?"," ",h.jsx("button",{onClick:()=>n("/login"),style:{background:"none",border:"none",color:"#feca57",textDecoration:"underline",cursor:"pointer",fontSize:"0.9rem",fontWeight:600,padding:0},children:"Login"})]}),h.jsx("button",{onClick:()=>n("/"),style:{width:"100%",marginTop:"1rem",padding:"0.75rem",fontSize:"1rem",fontWeight:600,background:"rgba(255,255,255,0.2)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.4)",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",borderRadius:"8px",color:"#fff",textShadow:"0 2px 4px rgba(0,0,0,0.2)",cursor:"pointer",transition:"all 0.2s"},onMouseEnter:g=>{g.currentTarget.style.background="rgba(255,255,255,0.35)"},onMouseLeave:g=>{g.currentTarget.style.background="rgba(255,255,255,0.2)"},children:"Back to Home"})]})})},S5=()=>{const n=Jn(),[e,t]=S.useState("loading"),[r,i]=S.useState("Processing magic link...");S.useEffect(()=>{o()},[]);const o=async()=>{console.log(" Starting auth callback...");try{const s=new Promise((l,c)=>setTimeout(()=>c(new Error("Authentication timeout - please try again")),3e4)),a=(async()=>{console.log(" Exchanging auth code from URL..."),console.log("Full URL:",window.location.href),console.log("URL Hash:",window.location.hash),console.log("URL Search:",window.location.search);const l=new URLSearchParams(window.location.hash.substring(1)),c=new URLSearchParams(window.location.search),u=l.get("error_code")||c.get("error_code"),d=l.get("error_description")||c.get("error_description"),f=c.get("code");if(console.log("Parsed params:",{hasCode:!!f,errorCode:u,errorDesc:d,code:(f==null?void 0:f.substring(0,20))+"..."}),u==="otp_expired")throw new Error("Magic link has expired. Please request a new one. (Links expire after 60 seconds)");if(u)throw new Error(d||"Authentication failed. Please try again.");if(!f)throw new Error("Invalid magic link format. Please request a new one.");console.log(" Valid auth code detected"),console.log(" Exchanging code for session...");const{data:m,error:v}=await bt.auth.exchangeCodeForSession(f);if(v)throw console.error(" Code exchange failed:",v),new Error(v.message||"Failed to complete login. Please try again.");if(!m.session)throw new Error("No session created. Please try again.");console.log(" Session established:",m.session.user.email),t("success"),i("Login successful! Taking you to the gallery..."),await new Promise(_=>setTimeout(_,1e3)),n("/gallery")})();await Promise.race([a,s])}catch(s){console.error(" Auth callback error:",s),t("error"),i(s.message||"Authentication failed. Please try again.")}};return h.jsx("div",{style:{minHeight:"100dvh",width:"100%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center",padding:"0"},children:h.jsxs("div",{style:{maxWidth:"500px",width:"calc(100vw - 2rem)",margin:"1rem",backgroundColor:"rgba(255,255,255,0.25)",backdropFilter:"blur(20px)",borderRadius:"20px",padding:"clamp(1.5rem, 5vw, 3rem)",border:"3px solid rgba(255,255,255,0.4)",boxShadow:"0 20px 60px rgba(0,0,0,0.3)",textAlign:"center",boxSizing:"border-box"},children:[e==="loading"&&h.jsxs(h.Fragment,{children:[h.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),h.jsx("h2",{style:{fontSize:"2rem",marginBottom:"1rem",color:"#fff",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:"Verifying Login"}),h.jsx("p",{style:{fontSize:"1.1rem",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 8px rgba(0,0,0,0.2)"},children:r})]}),e==="success"&&h.jsxs(h.Fragment,{children:[h.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),h.jsx("h2",{style:{fontSize:"2rem",marginBottom:"1rem",color:"#fff",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:"Success!"}),h.jsx("p",{style:{fontSize:"1.1rem",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",marginBottom:"2rem"},children:r})]}),e==="error"&&h.jsxs(h.Fragment,{children:[h.jsx("div",{style:{fontSize:"4rem",marginBottom:"1rem"},children:""}),h.jsx("h2",{style:{fontSize:"2rem",marginBottom:"1rem",color:"#fff",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:"Oops!"}),h.jsx("p",{style:{fontSize:"1.1rem",color:"rgba(255,255,255,0.95)",textShadow:"0 2px 8px rgba(0,0,0,0.2)",marginBottom:"2rem"},children:r}),h.jsx("button",{onClick:()=>n("/login"),style:{padding:"0.75rem 2rem",fontSize:"1rem",fontWeight:600,background:"linear-gradient(135deg, #ff6b6b 0%, #feca57 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",boxShadow:"0 8px 24px rgba(255,107,107,0.4)",textShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:"Try Again"})]})]})})};function ms(n){const{i:e,j:t,k:r}=n;return{x:.5*(e+t),y:.5*(e+r),z:.5*(t+r)}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Eg="180",ga={ROTATE:0,DOLLY:1,PAN:2},ra={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},w5=0,Lv=1,E5=2,xS=1,yS=2,pi=3,wo=0,Kn=1,xi=2,go=0,va=1,Dv=2,Nv=3,Ov=4,M5=5,Xo=100,T5=101,C5=102,R5=103,A5=104,P5=200,k5=201,I5=202,L5=203,Cp=204,Rp=205,D5=206,N5=207,O5=208,U5=209,z5=210,F5=211,j5=212,B5=213,H5=214,Ap=0,Pp=1,kp=2,Ca=3,Ip=4,Lp=5,Dp=6,Np=7,_S=0,W5=1,V5=2,vo=0,$5=1,G5=2,X5=3,bS=4,Y5=5,q5=6,K5=7,SS=300,Ra=301,Aa=302,Op=303,Up=304,zd=306,zp=1e3,wi=1001,Fp=1002,lr=1003,J5=1004,zc=1005,Dn=1006,Ch=1007,oo=1008,Kr=1009,wS=1010,ES=1011,Yl=1012,Mg=1013,cs=1014,Gn=1015,Ei=1016,Tg=1017,Cg=1018,ql=1020,MS=35902,TS=35899,CS=1021,RS=1022,Lr=1023,Kl=1026,Jl=1027,Rg=1028,Ag=1029,AS=1030,Pg=1031,kg=1033,Tu=33776,Cu=33777,Ru=33778,Au=33779,jp=35840,Bp=35841,Hp=35842,Wp=35843,Vp=36196,$p=37492,Gp=37496,Xp=37808,Yp=37809,qp=37810,Kp=37811,Jp=37812,Zp=37813,Qp=37814,em=37815,tm=37816,nm=37817,rm=37818,im=37819,om=37820,sm=37821,am=36492,lm=36494,cm=36495,um=36283,dm=36284,hm=36285,fm=36286,Z5=3200,Q5=3201,PS=0,eR=1,no="",ir="srgb",us="srgb-linear",cd="linear",Lt="srgb",Ts=7680,Uv=519,tR=512,nR=513,rR=514,kS=515,iR=516,oR=517,sR=518,aR=519,zv=35044,lR=35048,Fv="300 es",Xr=2e3,ud=2001;class gs{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const r=t[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,s=i.length;o<s;o++)i[o].call(this,e);e.target=null}}}const Tn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Pu=Math.PI/180,pm=180/Math.PI;function hc(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Tn[n&255]+Tn[n>>8&255]+Tn[n>>16&255]+Tn[n>>24&255]+"-"+Tn[e&255]+Tn[e>>8&255]+"-"+Tn[e>>16&15|64]+Tn[e>>24&255]+"-"+Tn[t&63|128]+Tn[t>>8&255]+"-"+Tn[t>>16&255]+Tn[t>>24&255]+Tn[r&255]+Tn[r>>8&255]+Tn[r>>16&255]+Tn[r>>24&255]).toLowerCase()}function Et(n,e,t){return Math.max(e,Math.min(t,n))}function cR(n,e){return(n%e+e)%e}function Rh(n,e,t){return(1-t)*n+t*e}function Qa(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function jn(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const uR={DEG2RAD:Pu};class gt{constructor(e=0,t=0){gt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Et(this.x,e.x,t.x),this.y=Et(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Et(this.x,e,t),this.y=Et(this.y,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Et(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Et(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,s=this.y-e.y;return this.x=o*r-s*i+e.x,this.y=o*i+s*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Jr{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,o,s,a){let l=r[i+0],c=r[i+1],u=r[i+2],d=r[i+3];const f=o[s+0],m=o[s+1],v=o[s+2],_=o[s+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d;return}if(a===1){e[t+0]=f,e[t+1]=m,e[t+2]=v,e[t+3]=_;return}if(d!==_||l!==f||c!==m||u!==v){let x=1-a;const p=l*f+c*m+u*v+d*_,b=p>=0?1:-1,g=1-p*p;if(g>Number.EPSILON){const E=Math.sqrt(g),C=Math.atan2(E,p*b);x=Math.sin(x*C)/E,a=Math.sin(a*C)/E}const y=a*b;if(l=l*x+f*y,c=c*x+m*y,u=u*x+v*y,d=d*x+_*y,x===1-a){const E=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=E,c*=E,u*=E,d*=E}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,r,i,o,s){const a=r[i],l=r[i+1],c=r[i+2],u=r[i+3],d=o[s],f=o[s+1],m=o[s+2],v=o[s+3];return e[t]=a*v+u*d+l*m-c*f,e[t+1]=l*v+u*f+c*d-a*m,e[t+2]=c*v+u*m+a*f-l*d,e[t+3]=u*v-a*d-l*f-c*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,o=e._z,s=e._order,a=Math.cos,l=Math.sin,c=a(r/2),u=a(i/2),d=a(o/2),f=l(r/2),m=l(i/2),v=l(o/2);switch(s){case"XYZ":this._x=f*u*d+c*m*v,this._y=c*m*d-f*u*v,this._z=c*u*v+f*m*d,this._w=c*u*d-f*m*v;break;case"YXZ":this._x=f*u*d+c*m*v,this._y=c*m*d-f*u*v,this._z=c*u*v-f*m*d,this._w=c*u*d+f*m*v;break;case"ZXY":this._x=f*u*d-c*m*v,this._y=c*m*d+f*u*v,this._z=c*u*v+f*m*d,this._w=c*u*d-f*m*v;break;case"ZYX":this._x=f*u*d-c*m*v,this._y=c*m*d+f*u*v,this._z=c*u*v-f*m*d,this._w=c*u*d+f*m*v;break;case"YZX":this._x=f*u*d+c*m*v,this._y=c*m*d+f*u*v,this._z=c*u*v-f*m*d,this._w=c*u*d-f*m*v;break;case"XZY":this._x=f*u*d-c*m*v,this._y=c*m*d-f*u*v,this._z=c*u*v+f*m*d,this._w=c*u*d+f*m*v;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],o=t[8],s=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],f=r+a+d;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(u-l)*m,this._y=(o-c)*m,this._z=(s-i)*m}else if(r>a&&r>d){const m=2*Math.sqrt(1+r-a-d);this._w=(u-l)/m,this._x=.25*m,this._y=(i+s)/m,this._z=(o+c)/m}else if(a>d){const m=2*Math.sqrt(1+a-r-d);this._w=(o-c)/m,this._x=(i+s)/m,this._y=.25*m,this._z=(l+u)/m}else{const m=2*Math.sqrt(1+d-r-a);this._w=(s-i)/m,this._x=(o+c)/m,this._y=(l+u)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Et(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,o=e._z,s=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=r*u+s*a+i*c-o*l,this._y=i*u+s*l+o*a-r*c,this._z=o*u+s*c+r*l-i*a,this._w=s*u-r*a-i*l-o*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,o=this._z,s=this._w;let a=s*e._w+r*e._x+i*e._y+o*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=s,this._x=r,this._y=i,this._z=o,this;const l=1-a*a;if(l<=Number.EPSILON){const m=1-t;return this._w=m*s+t*this._w,this._x=m*r+t*this._x,this._y=m*i+t*this._y,this._z=m*o+t*this._z,this.normalize(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,f=Math.sin(t*u)/c;return this._w=s*d+this._w*f,this._x=r*d+this._x*f,this._y=i*d+this._y*f,this._z=o*d+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),o=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ae{constructor(e=0,t=0,r=0){ae.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(jv.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(jv.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=e.elements,s=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*s,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*s,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*s,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,o=e.x,s=e.y,a=e.z,l=e.w,c=2*(s*i-a*r),u=2*(a*t-o*i),d=2*(o*r-s*t);return this.x=t+l*c+s*d-a*u,this.y=r+l*u+a*c-o*d,this.z=i+l*d+o*u-s*c,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Et(this.x,e.x,t.x),this.y=Et(this.y,e.y,t.y),this.z=Et(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Et(this.x,e,t),this.y=Et(this.y,e,t),this.z=Et(this.z,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Et(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,o=e.z,s=t.x,a=t.y,l=t.z;return this.x=i*l-o*a,this.y=o*s-r*l,this.z=r*a-i*s,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Ah.copy(this).projectOnVector(e),this.sub(Ah)}reflect(e){return this.sub(Ah.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(Et(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Ah=new ae,jv=new Jr;class yt{constructor(e,t,r,i,o,s,a,l,c){yt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,l,c)}set(e,t,r,i,o,s,a,l,c){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=o,u[5]=l,u[6]=r,u[7]=s,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[3],l=r[6],c=r[1],u=r[4],d=r[7],f=r[2],m=r[5],v=r[8],_=i[0],x=i[3],p=i[6],b=i[1],g=i[4],y=i[7],E=i[2],C=i[5],A=i[8];return o[0]=s*_+a*b+l*E,o[3]=s*x+a*g+l*C,o[6]=s*p+a*y+l*A,o[1]=c*_+u*b+d*E,o[4]=c*x+u*g+d*C,o[7]=c*p+u*y+d*A,o[2]=f*_+m*b+v*E,o[5]=f*x+m*g+v*C,o[8]=f*p+m*y+v*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*s*u-t*a*c-r*o*u+r*a*l+i*o*c-i*s*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*s-a*c,f=a*l-u*o,m=c*o-s*l,v=t*d+r*f+i*m;if(v===0)return this.set(0,0,0,0,0,0,0,0,0);const _=1/v;return e[0]=d*_,e[1]=(i*c-u*r)*_,e[2]=(a*r-i*s)*_,e[3]=f*_,e[4]=(u*t-i*l)*_,e[5]=(i*o-a*t)*_,e[6]=m*_,e[7]=(r*l-c*t)*_,e[8]=(s*t-r*o)*_,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,o,s,a){const l=Math.cos(o),c=Math.sin(o);return this.set(r*l,r*c,-r*(l*s+c*a)+s+e,-i*c,i*l,-i*(-c*s+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(Ph.makeScale(e,t)),this}rotate(e){return this.premultiply(Ph.makeRotation(-e)),this}translate(e,t){return this.premultiply(Ph.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Ph=new yt;function IS(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function dd(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function dR(){const n=dd("canvas");return n.style.display="block",n}const Bv={};function Zl(n){n in Bv||(Bv[n]=!0,console.warn(n))}function hR(n,e,t){return new Promise(function(r,i){function o(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(o,t);break;default:r()}}setTimeout(o,t)})}const Hv=new yt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Wv=new yt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function fR(){const n={enabled:!0,workingColorSpace:us,spaces:{},convert:function(i,o,s){return this.enabled===!1||o===s||!o||!s||(this.spaces[o].transfer===Lt&&(i.r=Ci(i.r),i.g=Ci(i.g),i.b=Ci(i.b)),this.spaces[o].primaries!==this.spaces[s].primaries&&(i.applyMatrix3(this.spaces[o].toXYZ),i.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===Lt&&(i.r=xa(i.r),i.g=xa(i.g),i.b=xa(i.b))),i},workingToColorSpace:function(i,o){return this.convert(i,this.workingColorSpace,o)},colorSpaceToWorking:function(i,o){return this.convert(i,o,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===no?cd:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,o=this.workingColorSpace){return i.fromArray(this.spaces[o].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,o,s){return i.copy(this.spaces[o].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,o){return Zl("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(i,o)},toWorkingColorSpace:function(i,o){return Zl("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(i,o)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[us]:{primaries:e,whitePoint:r,transfer:cd,toXYZ:Hv,fromXYZ:Wv,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:ir},outputColorSpaceConfig:{drawingBufferColorSpace:ir}},[ir]:{primaries:e,whitePoint:r,transfer:Lt,toXYZ:Hv,fromXYZ:Wv,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:ir}}}),n}const Pt=fR();function Ci(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function xa(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Cs;class pR{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{Cs===void 0&&(Cs=dd("canvas")),Cs.width=e.width,Cs.height=e.height;const i=Cs.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=Cs}return r.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=dd("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),o=i.data;for(let s=0;s<o.length;s++)o[s]=Ci(o[s]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(Ci(t[r]/255)*255):t[r]=Ci(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let mR=0;class Ig{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:mR++}),this.uuid=hc(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let s=0,a=i.length;s<a;s++)i[s].isDataTexture?o.push(kh(i[s].image)):o.push(kh(i[s]))}else o=kh(i);r.url=o}return t||(e.images[this.uuid]=r),r}}function kh(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?pR.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let gR=0;const Ih=new ae;class On extends gs{constructor(e=On.DEFAULT_IMAGE,t=On.DEFAULT_MAPPING,r=wi,i=wi,o=Dn,s=oo,a=Lr,l=Kr,c=On.DEFAULT_ANISOTROPY,u=no){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:gR++}),this.uuid=hc(),this.name="",this.source=new Ig(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=s,this.anisotropy=c,this.format=a,this.internalFormat=null,this.type=l,this.offset=new gt(0,0),this.repeat=new gt(1,1),this.center=new gt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new yt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Ih).x}get height(){return this.source.getSize(Ih).y}get depth(){return this.source.getSize(Ih).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==SS)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case zp:e.x=e.x-Math.floor(e.x);break;case wi:e.x=e.x<0?0:1;break;case Fp:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case zp:e.y=e.y-Math.floor(e.y);break;case wi:e.y=e.y<0?0:1;break;case Fp:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}On.DEFAULT_IMAGE=null;On.DEFAULT_MAPPING=SS;On.DEFAULT_ANISOTROPY=1;class Jt{constructor(e=0,t=0,r=0,i=1){Jt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=this.w,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i+s[12]*o,this.y=s[1]*t+s[5]*r+s[9]*i+s[13]*o,this.z=s[2]*t+s[6]*r+s[10]*i+s[14]*o,this.w=s[3]*t+s[7]*r+s[11]*i+s[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,o;const l=e.elements,c=l[0],u=l[4],d=l[8],f=l[1],m=l[5],v=l[9],_=l[2],x=l[6],p=l[10];if(Math.abs(u-f)<.01&&Math.abs(d-_)<.01&&Math.abs(v-x)<.01){if(Math.abs(u+f)<.1&&Math.abs(d+_)<.1&&Math.abs(v+x)<.1&&Math.abs(c+m+p-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const g=(c+1)/2,y=(m+1)/2,E=(p+1)/2,C=(u+f)/4,A=(d+_)/4,T=(v+x)/4;return g>y&&g>E?g<.01?(r=0,i=.707106781,o=.707106781):(r=Math.sqrt(g),i=C/r,o=A/r):y>E?y<.01?(r=.707106781,i=0,o=.707106781):(i=Math.sqrt(y),r=C/i,o=T/i):E<.01?(r=.707106781,i=.707106781,o=0):(o=Math.sqrt(E),r=A/o,i=T/o),this.set(r,i,o,t),this}let b=Math.sqrt((x-v)*(x-v)+(d-_)*(d-_)+(f-u)*(f-u));return Math.abs(b)<.001&&(b=1),this.x=(x-v)/b,this.y=(d-_)/b,this.z=(f-u)/b,this.w=Math.acos((c+m+p-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Et(this.x,e.x,t.x),this.y=Et(this.y,e.y,t.y),this.z=Et(this.z,e.z,t.z),this.w=Et(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Et(this.x,e,t),this.y=Et(this.y,e,t),this.z=Et(this.z,e,t),this.w=Et(this.w,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Et(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class vR extends gs{constructor(e=1,t=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Dn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=r.depth,this.scissor=new Jt(0,0,e,t),this.scissorTest=!1,this.viewport=new Jt(0,0,e,t);const i={width:e,height:t,depth:r.depth},o=new On(i);this.textures=[];const s=r.count;for(let a=0;a<s;a++)this.textures[a]=o.clone(),this.textures[a].isRenderTargetTexture=!0,this.textures[a].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(e={}){const t={minFilter:Dn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let r=0;r<this.textures.length;r++)this.textures[r].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,o=this.textures.length;i<o;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new Ig(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ds extends vR{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class LS extends On{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=lr,this.minFilter=lr,this.wrapR=wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class xR extends On{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=lr,this.minFilter=lr,this.wrapR=wi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Po{constructor(e=new ae(1/0,1/0,1/0),t=new ae(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Er.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Er.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Er.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const o=r.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let s=0,a=o.count;s<a;s++)e.isMesh===!0?e.getVertexPosition(s,Er):Er.fromBufferAttribute(o,s),Er.applyMatrix4(e.matrixWorld),this.expandByPoint(Er);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Fc.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Fc.copy(r.boundingBox)),Fc.applyMatrix4(e.matrixWorld),this.union(Fc)}const i=e.children;for(let o=0,s=i.length;o<s;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Er),Er.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(el),jc.subVectors(this.max,el),Rs.subVectors(e.a,el),As.subVectors(e.b,el),Ps.subVectors(e.c,el),Bi.subVectors(As,Rs),Hi.subVectors(Ps,As),Lo.subVectors(Rs,Ps);let t=[0,-Bi.z,Bi.y,0,-Hi.z,Hi.y,0,-Lo.z,Lo.y,Bi.z,0,-Bi.x,Hi.z,0,-Hi.x,Lo.z,0,-Lo.x,-Bi.y,Bi.x,0,-Hi.y,Hi.x,0,-Lo.y,Lo.x,0];return!Lh(t,Rs,As,Ps,jc)||(t=[1,0,0,0,1,0,0,0,1],!Lh(t,Rs,As,Ps,jc))?!1:(Bc.crossVectors(Bi,Hi),t=[Bc.x,Bc.y,Bc.z],Lh(t,Rs,As,Ps,jc))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Er).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Er).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ai[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ai[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ai[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ai[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ai[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ai[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ai[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ai[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ai),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const ai=[new ae,new ae,new ae,new ae,new ae,new ae,new ae,new ae],Er=new ae,Fc=new Po,Rs=new ae,As=new ae,Ps=new ae,Bi=new ae,Hi=new ae,Lo=new ae,el=new ae,jc=new ae,Bc=new ae,Do=new ae;function Lh(n,e,t,r,i){for(let o=0,s=n.length-3;o<=s;o+=3){Do.fromArray(n,o);const a=i.x*Math.abs(Do.x)+i.y*Math.abs(Do.y)+i.z*Math.abs(Do.z),l=e.dot(Do),c=t.dot(Do),u=r.dot(Do);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const yR=new Po,tl=new ae,Dh=new ae;class fc{constructor(e=new ae,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):yR.setFromPoints(e).getCenter(r);let i=0;for(let o=0,s=e.length;o<s;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;tl.subVectors(e,this.center);const t=tl.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(tl,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(Dh.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(tl.copy(e.center).add(Dh)),this.expandByPoint(tl.copy(e.center).sub(Dh))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const li=new ae,Nh=new ae,Hc=new ae,Wi=new ae,Oh=new ae,Wc=new ae,Uh=new ae;class Lg{constructor(e=new ae,t=new ae(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,li)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=li.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(li.copy(this.origin).addScaledVector(this.direction,t),li.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){Nh.copy(e).add(t).multiplyScalar(.5),Hc.copy(t).sub(e).normalize(),Wi.copy(this.origin).sub(Nh);const o=e.distanceTo(t)*.5,s=-this.direction.dot(Hc),a=Wi.dot(this.direction),l=-Wi.dot(Hc),c=Wi.lengthSq(),u=Math.abs(1-s*s);let d,f,m,v;if(u>0)if(d=s*l-a,f=s*a-l,v=o*u,d>=0)if(f>=-v)if(f<=v){const _=1/u;d*=_,f*=_,m=d*(d+s*f+2*a)+f*(s*d+f+2*l)+c}else f=o,d=Math.max(0,-(s*f+a)),m=-d*d+f*(f+2*l)+c;else f=-o,d=Math.max(0,-(s*f+a)),m=-d*d+f*(f+2*l)+c;else f<=-v?(d=Math.max(0,-(-s*o+a)),f=d>0?-o:Math.min(Math.max(-o,-l),o),m=-d*d+f*(f+2*l)+c):f<=v?(d=0,f=Math.min(Math.max(-o,-l),o),m=f*(f+2*l)+c):(d=Math.max(0,-(s*o+a)),f=d>0?o:Math.min(Math.max(-o,-l),o),m=-d*d+f*(f+2*l)+c);else f=s>0?-o:o,d=Math.max(0,-(s*f+a)),m=-d*d+f*(f+2*l)+c;return r&&r.copy(this.origin).addScaledVector(this.direction,d),i&&i.copy(Nh).addScaledVector(Hc,f),m}intersectSphere(e,t){li.subVectors(e.center,this.origin);const r=li.dot(this.direction),i=li.dot(li)-r*r,o=e.radius*e.radius;if(i>o)return null;const s=Math.sqrt(o-i),a=r-s,l=r+s;return l<0?null:a<0?this.at(l,t):this.at(a,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,o,s,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,f=this.origin;return c>=0?(r=(e.min.x-f.x)*c,i=(e.max.x-f.x)*c):(r=(e.max.x-f.x)*c,i=(e.min.x-f.x)*c),u>=0?(o=(e.min.y-f.y)*u,s=(e.max.y-f.y)*u):(o=(e.max.y-f.y)*u,s=(e.min.y-f.y)*u),r>s||o>i||((o>r||isNaN(r))&&(r=o),(s<i||isNaN(i))&&(i=s),d>=0?(a=(e.min.z-f.z)*d,l=(e.max.z-f.z)*d):(a=(e.max.z-f.z)*d,l=(e.min.z-f.z)*d),r>l||a>i)||((a>r||r!==r)&&(r=a),(l<i||i!==i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,li)!==null}intersectTriangle(e,t,r,i,o){Oh.subVectors(t,e),Wc.subVectors(r,e),Uh.crossVectors(Oh,Wc);let s=this.direction.dot(Uh),a;if(s>0){if(i)return null;a=1}else if(s<0)a=-1,s=-s;else return null;Wi.subVectors(this.origin,e);const l=a*this.direction.dot(Wc.crossVectors(Wi,Wc));if(l<0)return null;const c=a*this.direction.dot(Oh.cross(Wi));if(c<0||l+c>s)return null;const u=-a*Wi.dot(Uh);return u<0?null:this.at(u/s,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class kt{constructor(e,t,r,i,o,s,a,l,c,u,d,f,m,v,_,x){kt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,s,a,l,c,u,d,f,m,v,_,x)}set(e,t,r,i,o,s,a,l,c,u,d,f,m,v,_,x){const p=this.elements;return p[0]=e,p[4]=t,p[8]=r,p[12]=i,p[1]=o,p[5]=s,p[9]=a,p[13]=l,p[2]=c,p[6]=u,p[10]=d,p[14]=f,p[3]=m,p[7]=v,p[11]=_,p[15]=x,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new kt().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/ks.setFromMatrixColumn(e,0).length(),o=1/ks.setFromMatrixColumn(e,1).length(),s=1/ks.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*s,t[9]=r[9]*s,t[10]=r[10]*s,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,o=e.z,s=Math.cos(r),a=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(o),d=Math.sin(o);if(e.order==="XYZ"){const f=s*u,m=s*d,v=a*u,_=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=m+v*c,t[5]=f-_*c,t[9]=-a*l,t[2]=_-f*c,t[6]=v+m*c,t[10]=s*l}else if(e.order==="YXZ"){const f=l*u,m=l*d,v=c*u,_=c*d;t[0]=f+_*a,t[4]=v*a-m,t[8]=s*c,t[1]=s*d,t[5]=s*u,t[9]=-a,t[2]=m*a-v,t[6]=_+f*a,t[10]=s*l}else if(e.order==="ZXY"){const f=l*u,m=l*d,v=c*u,_=c*d;t[0]=f-_*a,t[4]=-s*d,t[8]=v+m*a,t[1]=m+v*a,t[5]=s*u,t[9]=_-f*a,t[2]=-s*c,t[6]=a,t[10]=s*l}else if(e.order==="ZYX"){const f=s*u,m=s*d,v=a*u,_=a*d;t[0]=l*u,t[4]=v*c-m,t[8]=f*c+_,t[1]=l*d,t[5]=_*c+f,t[9]=m*c-v,t[2]=-c,t[6]=a*l,t[10]=s*l}else if(e.order==="YZX"){const f=s*l,m=s*c,v=a*l,_=a*c;t[0]=l*u,t[4]=_-f*d,t[8]=v*d+m,t[1]=d,t[5]=s*u,t[9]=-a*u,t[2]=-c*u,t[6]=m*d+v,t[10]=f-_*d}else if(e.order==="XZY"){const f=s*l,m=s*c,v=a*l,_=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=f*d+_,t[5]=s*u,t[9]=m*d-v,t[2]=v*d-m,t[6]=a*u,t[10]=_*d+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_R,e,bR)}lookAt(e,t,r){const i=this.elements;return Zn.subVectors(e,t),Zn.lengthSq()===0&&(Zn.z=1),Zn.normalize(),Vi.crossVectors(r,Zn),Vi.lengthSq()===0&&(Math.abs(r.z)===1?Zn.x+=1e-4:Zn.z+=1e-4,Zn.normalize(),Vi.crossVectors(r,Zn)),Vi.normalize(),Vc.crossVectors(Zn,Vi),i[0]=Vi.x,i[4]=Vc.x,i[8]=Zn.x,i[1]=Vi.y,i[5]=Vc.y,i[9]=Zn.y,i[2]=Vi.z,i[6]=Vc.z,i[10]=Zn.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,s=r[0],a=r[4],l=r[8],c=r[12],u=r[1],d=r[5],f=r[9],m=r[13],v=r[2],_=r[6],x=r[10],p=r[14],b=r[3],g=r[7],y=r[11],E=r[15],C=i[0],A=i[4],T=i[8],w=i[12],M=i[1],P=i[5],I=i[9],D=i[13],$=i[2],W=i[6],H=i[10],Z=i[14],F=i[3],Y=i[7],X=i[11],oe=i[15];return o[0]=s*C+a*M+l*$+c*F,o[4]=s*A+a*P+l*W+c*Y,o[8]=s*T+a*I+l*H+c*X,o[12]=s*w+a*D+l*Z+c*oe,o[1]=u*C+d*M+f*$+m*F,o[5]=u*A+d*P+f*W+m*Y,o[9]=u*T+d*I+f*H+m*X,o[13]=u*w+d*D+f*Z+m*oe,o[2]=v*C+_*M+x*$+p*F,o[6]=v*A+_*P+x*W+p*Y,o[10]=v*T+_*I+x*H+p*X,o[14]=v*w+_*D+x*Z+p*oe,o[3]=b*C+g*M+y*$+E*F,o[7]=b*A+g*P+y*W+E*Y,o[11]=b*T+g*I+y*H+E*X,o[15]=b*w+g*D+y*Z+E*oe,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],s=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],f=e[10],m=e[14],v=e[3],_=e[7],x=e[11],p=e[15];return v*(+o*l*d-i*c*d-o*a*f+r*c*f+i*a*m-r*l*m)+_*(+t*l*m-t*c*f+o*s*f-i*s*m+i*c*u-o*l*u)+x*(+t*c*d-t*a*m-o*s*d+r*s*m+o*a*u-r*c*u)+p*(-i*a*u-t*l*d+t*a*f+i*s*d-r*s*f+r*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],f=e[10],m=e[11],v=e[12],_=e[13],x=e[14],p=e[15],b=d*x*c-_*f*c+_*l*m-a*x*m-d*l*p+a*f*p,g=v*f*c-u*x*c-v*l*m+s*x*m+u*l*p-s*f*p,y=u*_*c-v*d*c+v*a*m-s*_*m-u*a*p+s*d*p,E=v*d*l-u*_*l-v*a*f+s*_*f+u*a*x-s*d*x,C=t*b+r*g+i*y+o*E;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/C;return e[0]=b*A,e[1]=(_*f*o-d*x*o-_*i*m+r*x*m+d*i*p-r*f*p)*A,e[2]=(a*x*o-_*l*o+_*i*c-r*x*c-a*i*p+r*l*p)*A,e[3]=(d*l*o-a*f*o-d*i*c+r*f*c+a*i*m-r*l*m)*A,e[4]=g*A,e[5]=(u*x*o-v*f*o+v*i*m-t*x*m-u*i*p+t*f*p)*A,e[6]=(v*l*o-s*x*o-v*i*c+t*x*c+s*i*p-t*l*p)*A,e[7]=(s*f*o-u*l*o+u*i*c-t*f*c-s*i*m+t*l*m)*A,e[8]=y*A,e[9]=(v*d*o-u*_*o-v*r*m+t*_*m+u*r*p-t*d*p)*A,e[10]=(s*_*o-v*a*o+v*r*c-t*_*c-s*r*p+t*a*p)*A,e[11]=(u*a*o-s*d*o-u*r*c+t*d*c+s*r*m-t*a*m)*A,e[12]=E*A,e[13]=(u*_*i-v*d*i+v*r*f-t*_*f-u*r*x+t*d*x)*A,e[14]=(v*a*i-s*_*i-v*r*l+t*_*l+s*r*x-t*a*x)*A,e[15]=(s*d*i-u*a*i+u*r*l-t*d*l-s*r*f+t*a*f)*A,this}scale(e){const t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),o=1-r,s=e.x,a=e.y,l=e.z,c=o*s,u=o*a;return this.set(c*s+r,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+r,u*l-i*s,0,c*l-i*a,u*l+i*s,o*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,o,s){return this.set(1,r,o,0,e,1,s,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,o=t._x,s=t._y,a=t._z,l=t._w,c=o+o,u=s+s,d=a+a,f=o*c,m=o*u,v=o*d,_=s*u,x=s*d,p=a*d,b=l*c,g=l*u,y=l*d,E=r.x,C=r.y,A=r.z;return i[0]=(1-(_+p))*E,i[1]=(m+y)*E,i[2]=(v-g)*E,i[3]=0,i[4]=(m-y)*C,i[5]=(1-(f+p))*C,i[6]=(x+b)*C,i[7]=0,i[8]=(v+g)*A,i[9]=(x-b)*A,i[10]=(1-(f+_))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let o=ks.set(i[0],i[1],i[2]).length();const s=ks.set(i[4],i[5],i[6]).length(),a=ks.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],Mr.copy(this);const c=1/o,u=1/s,d=1/a;return Mr.elements[0]*=c,Mr.elements[1]*=c,Mr.elements[2]*=c,Mr.elements[4]*=u,Mr.elements[5]*=u,Mr.elements[6]*=u,Mr.elements[8]*=d,Mr.elements[9]*=d,Mr.elements[10]*=d,t.setFromRotationMatrix(Mr),r.x=o,r.y=s,r.z=a,this}makePerspective(e,t,r,i,o,s,a=Xr,l=!1){const c=this.elements,u=2*o/(t-e),d=2*o/(r-i),f=(t+e)/(t-e),m=(r+i)/(r-i);let v,_;if(l)v=o/(s-o),_=s*o/(s-o);else if(a===Xr)v=-(s+o)/(s-o),_=-2*s*o/(s-o);else if(a===ud)v=-s/(s-o),_=-s*o/(s-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=f,c[12]=0,c[1]=0,c[5]=d,c[9]=m,c[13]=0,c[2]=0,c[6]=0,c[10]=v,c[14]=_,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,r,i,o,s,a=Xr,l=!1){const c=this.elements,u=2/(t-e),d=2/(r-i),f=-(t+e)/(t-e),m=-(r+i)/(r-i);let v,_;if(l)v=1/(s-o),_=s/(s-o);else if(a===Xr)v=-2/(s-o),_=-(s+o)/(s-o);else if(a===ud)v=-1/(s-o),_=-o/(s-o);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=u,c[4]=0,c[8]=0,c[12]=f,c[1]=0,c[5]=d,c[9]=0,c[13]=m,c[2]=0,c[6]=0,c[10]=v,c[14]=_,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const ks=new ae,Mr=new kt,_R=new ae(0,0,0),bR=new ae(1,1,1),Vi=new ae,Vc=new ae,Zn=new ae,Vv=new kt,$v=new Jr;class Zr{constructor(e=0,t=0,r=0,i=Zr.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,o=i[0],s=i[4],a=i[8],l=i[1],c=i[5],u=i[9],d=i[2],f=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(Et(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,m),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-Et(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,o),this._z=0);break;case"ZXY":this._x=Math.asin(Et(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-d,m),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(l,o));break;case"ZYX":this._y=Math.asin(-Et(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(l,o)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(Et(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,o)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-Et(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-u,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return Vv.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Vv,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return $v.setFromEuler(this),this.setFromQuaternion($v,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Zr.DEFAULT_ORDER="XYZ";class Dg{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let SR=0;const Gv=new ae,Is=new Jr,ci=new kt,$c=new ae,nl=new ae,wR=new ae,ER=new Jr,Xv=new ae(1,0,0),Yv=new ae(0,1,0),qv=new ae(0,0,1),Kv={type:"added"},MR={type:"removed"},Ls={type:"childadded",child:null},zh={type:"childremoved",child:null};class xn extends gs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:SR++}),this.uuid=hc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=xn.DEFAULT_UP.clone();const e=new ae,t=new Zr,r=new Jr,i=new ae(1,1,1);function o(){r.setFromEuler(t,!1)}function s(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new kt},normalMatrix:{value:new yt}}),this.matrix=new kt,this.matrixWorld=new kt,this.matrixAutoUpdate=xn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Dg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Is.setFromAxisAngle(e,t),this.quaternion.multiply(Is),this}rotateOnWorldAxis(e,t){return Is.setFromAxisAngle(e,t),this.quaternion.premultiply(Is),this}rotateX(e){return this.rotateOnAxis(Xv,e)}rotateY(e){return this.rotateOnAxis(Yv,e)}rotateZ(e){return this.rotateOnAxis(qv,e)}translateOnAxis(e,t){return Gv.copy(e).applyQuaternion(this.quaternion),this.position.add(Gv.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Xv,e)}translateY(e){return this.translateOnAxis(Yv,e)}translateZ(e){return this.translateOnAxis(qv,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(ci.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?$c.copy(e):$c.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),nl.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ci.lookAt(nl,$c,this.up):ci.lookAt($c,nl,this.up),this.quaternion.setFromRotationMatrix(ci),i&&(ci.extractRotation(i.matrixWorld),Is.setFromRotationMatrix(ci),this.quaternion.premultiply(Is.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Kv),Ls.child=e,this.dispatchEvent(Ls),Ls.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(MR),zh.child=e,this.dispatchEvent(zh),zh.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),ci.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),ci.multiply(e.parent.matrixWorld)),e.applyMatrix4(ci),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Kv),Ls.child=e,this.dispatchEvent(Ls),Ls.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(e,t);if(s!==void 0)return s}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let o=0,s=i.length;o<s;o++)i[o].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nl,e,wR),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(nl,ER,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let o=0,s=i.length;o<s;o++)i[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(a=>({...a,boundingBox:a.boundingBox?a.boundingBox.toJSON():void 0,boundingSphere:a.boundingSphere?a.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(a=>({...a})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function o(a,l){return a[l.uuid]===void 0&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++){const d=l[c];o(e.shapes,d)}else o(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(o(e.materials,this.material[l]));i.material=a}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const l=this.animations[a];i.animations.push(o(e.animations,l))}}if(t){const a=s(e.geometries),l=s(e.materials),c=s(e.textures),u=s(e.images),d=s(e.shapes),f=s(e.skeletons),m=s(e.animations),v=s(e.nodes);a.length>0&&(r.geometries=a),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),d.length>0&&(r.shapes=d),f.length>0&&(r.skeletons=f),m.length>0&&(r.animations=m),v.length>0&&(r.nodes=v)}return r.object=i,r;function s(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}xn.DEFAULT_UP=new ae(0,1,0);xn.DEFAULT_MATRIX_AUTO_UPDATE=!0;xn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Tr=new ae,ui=new ae,Fh=new ae,di=new ae,Ds=new ae,Ns=new ae,Jv=new ae,jh=new ae,Bh=new ae,Hh=new ae,Wh=new Jt,Vh=new Jt,$h=new Jt;class Ir{constructor(e=new ae,t=new ae,r=new ae){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Tr.subVectors(e,t),i.cross(Tr);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,r,i,o){Tr.subVectors(i,t),ui.subVectors(r,t),Fh.subVectors(e,t);const s=Tr.dot(Tr),a=Tr.dot(ui),l=Tr.dot(Fh),c=ui.dot(ui),u=ui.dot(Fh),d=s*c-a*a;if(d===0)return o.set(0,0,0),null;const f=1/d,m=(c*l-a*u)*f,v=(s*u-a*l)*f;return o.set(1-m-v,v,m)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,di)===null?!1:di.x>=0&&di.y>=0&&di.x+di.y<=1}static getInterpolation(e,t,r,i,o,s,a,l){return this.getBarycoord(e,t,r,i,di)===null?(l.x=0,l.y=0,"z"in l&&(l.z=0),"w"in l&&(l.w=0),null):(l.setScalar(0),l.addScaledVector(o,di.x),l.addScaledVector(s,di.y),l.addScaledVector(a,di.z),l)}static getInterpolatedAttribute(e,t,r,i,o,s){return Wh.setScalar(0),Vh.setScalar(0),$h.setScalar(0),Wh.fromBufferAttribute(e,t),Vh.fromBufferAttribute(e,r),$h.fromBufferAttribute(e,i),s.setScalar(0),s.addScaledVector(Wh,o.x),s.addScaledVector(Vh,o.y),s.addScaledVector($h,o.z),s}static isFrontFacing(e,t,r,i){return Tr.subVectors(r,t),ui.subVectors(e,t),Tr.cross(ui).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Tr.subVectors(this.c,this.b),ui.subVectors(this.a,this.b),Tr.cross(ui).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ir.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ir.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,o){return Ir.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}containsPoint(e){return Ir.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ir.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,o=this.c;let s,a;Ds.subVectors(i,r),Ns.subVectors(o,r),jh.subVectors(e,r);const l=Ds.dot(jh),c=Ns.dot(jh);if(l<=0&&c<=0)return t.copy(r);Bh.subVectors(e,i);const u=Ds.dot(Bh),d=Ns.dot(Bh);if(u>=0&&d<=u)return t.copy(i);const f=l*d-u*c;if(f<=0&&l>=0&&u<=0)return s=l/(l-u),t.copy(r).addScaledVector(Ds,s);Hh.subVectors(e,o);const m=Ds.dot(Hh),v=Ns.dot(Hh);if(v>=0&&m<=v)return t.copy(o);const _=m*c-l*v;if(_<=0&&c>=0&&v<=0)return a=c/(c-v),t.copy(r).addScaledVector(Ns,a);const x=u*v-m*d;if(x<=0&&d-u>=0&&m-v>=0)return Jv.subVectors(o,i),a=(d-u)/(d-u+(m-v)),t.copy(i).addScaledVector(Jv,a);const p=1/(x+_+f);return s=_*p,a=f*p,t.copy(r).addScaledVector(Ds,s).addScaledVector(Ns,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const DS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$i={h:0,s:0,l:0},Gc={h:0,s:0,l:0};function Gh(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class pt{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ir){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Pt.colorSpaceToWorking(this,t),this}setRGB(e,t,r,i=Pt.workingColorSpace){return this.r=e,this.g=t,this.b=r,Pt.colorSpaceToWorking(this,i),this}setHSL(e,t,r,i=Pt.workingColorSpace){if(e=cR(e,1),t=Et(t,0,1),r=Et(r,0,1),t===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+t):r+t-r*t,s=2*r-o;this.r=Gh(s,o,e+1/3),this.g=Gh(s,o,e),this.b=Gh(s,o,e-1/3)}return Pt.colorSpaceToWorking(this,i),this}setStyle(e,t=ir){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const s=i[1],a=i[2];switch(s){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return r(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],s=o.length;if(s===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(s===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ir){const r=DS[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ci(e.r),this.g=Ci(e.g),this.b=Ci(e.b),this}copyLinearToSRGB(e){return this.r=xa(e.r),this.g=xa(e.g),this.b=xa(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ir){return Pt.workingToColorSpace(Cn.copy(this),e),Math.round(Et(Cn.r*255,0,255))*65536+Math.round(Et(Cn.g*255,0,255))*256+Math.round(Et(Cn.b*255,0,255))}getHexString(e=ir){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Pt.workingColorSpace){Pt.workingToColorSpace(Cn.copy(this),t);const r=Cn.r,i=Cn.g,o=Cn.b,s=Math.max(r,i,o),a=Math.min(r,i,o);let l,c;const u=(a+s)/2;if(a===s)l=0,c=0;else{const d=s-a;switch(c=u<=.5?d/(s+a):d/(2-s-a),s){case r:l=(i-o)/d+(i<o?6:0);break;case i:l=(o-r)/d+2;break;case o:l=(r-i)/d+4;break}l/=6}return e.h=l,e.s=c,e.l=u,e}getRGB(e,t=Pt.workingColorSpace){return Pt.workingToColorSpace(Cn.copy(this),t),e.r=Cn.r,e.g=Cn.g,e.b=Cn.b,e}getStyle(e=ir){Pt.workingToColorSpace(Cn.copy(this),e);const t=Cn.r,r=Cn.g,i=Cn.b;return e!==ir?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL($i),this.setHSL($i.h+e,$i.s+t,$i.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL($i),e.getHSL(Gc);const r=Rh($i.h,Gc.h,t),i=Rh($i.s,Gc.s,t),o=Rh($i.l,Gc.l,t);return this.setHSL(r,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*r+o[6]*i,this.g=o[1]*t+o[4]*r+o[7]*i,this.b=o[2]*t+o[5]*r+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Cn=new pt;pt.NAMES=DS;let TR=0;class Fa extends gs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:TR++}),this.uuid=hc(),this.name="",this.type="Material",this.blending=va,this.side=wo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Cp,this.blendDst=Rp,this.blendEquation=Xo,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new pt(0,0,0),this.blendAlpha=0,this.depthFunc=Ca,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Uv,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Ts,this.stencilZFail=Ts,this.stencilZPass=Ts,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(r.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(r.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==va&&(r.blending=this.blending),this.side!==wo&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==Cp&&(r.blendSrc=this.blendSrc),this.blendDst!==Rp&&(r.blendDst=this.blendDst),this.blendEquation!==Xo&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Ca&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Uv&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Ts&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Ts&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Ts&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(o){const s=[];for(const a in o){const l=o[a];delete l.metadata,s.push(l)}return s}if(t){const o=i(e.textures),s=i(e.images);o.length>0&&(r.textures=o),s.length>0&&(r.images=s)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let o=0;o!==i;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class NS extends Fa{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new pt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Zr,this.combine=_S,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const yi=CR();function CR(){const n=new ArrayBuffer(4),e=new Float32Array(n),t=new Uint32Array(n),r=new Uint32Array(512),i=new Uint32Array(512);for(let l=0;l<256;++l){const c=l-127;c<-27?(r[l]=0,r[l|256]=32768,i[l]=24,i[l|256]=24):c<-14?(r[l]=1024>>-c-14,r[l|256]=1024>>-c-14|32768,i[l]=-c-1,i[l|256]=-c-1):c<=15?(r[l]=c+15<<10,r[l|256]=c+15<<10|32768,i[l]=13,i[l|256]=13):c<128?(r[l]=31744,r[l|256]=64512,i[l]=24,i[l|256]=24):(r[l]=31744,r[l|256]=64512,i[l]=13,i[l|256]=13)}const o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let l=1;l<1024;++l){let c=l<<13,u=0;for(;!(c&8388608);)c<<=1,u-=8388608;c&=-8388609,u+=947912704,o[l]=c|u}for(let l=1024;l<2048;++l)o[l]=939524096+(l-1024<<13);for(let l=1;l<31;++l)s[l]=l<<23;s[31]=1199570944,s[32]=2147483648;for(let l=33;l<63;++l)s[l]=2147483648+(l-32<<23);s[63]=3347054592;for(let l=1;l<64;++l)l!==32&&(a[l]=1024);return{floatView:e,uint32View:t,baseTable:r,shiftTable:i,mantissaTable:o,exponentTable:s,offsetTable:a}}function RR(n){Math.abs(n)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),n=Et(n,-65504,65504),yi.floatView[0]=n;const e=yi.uint32View[0],t=e>>23&511;return yi.baseTable[t]+((e&8388607)>>yi.shiftTable[t])}function AR(n){const e=n>>10;return yi.uint32View[0]=yi.mantissaTable[yi.offsetTable[e]+(n&1023)]+yi.exponentTable[e],yi.floatView[0]}class Xc{static toHalfFloat(e){return RR(e)}static fromHalfFloat(e){return AR(e)}}const en=new ae,Yc=new gt;let PR=0;class Or{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:PR++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=zv,this.updateRanges=[],this.gpuType=Gn,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Yc.fromBufferAttribute(this,t),Yc.applyMatrix3(e),this.setXY(t,Yc.x,Yc.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)en.fromBufferAttribute(this,t),en.applyMatrix3(e),this.setXYZ(t,en.x,en.y,en.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)en.fromBufferAttribute(this,t),en.applyMatrix4(e),this.setXYZ(t,en.x,en.y,en.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)en.fromBufferAttribute(this,t),en.applyNormalMatrix(e),this.setXYZ(t,en.x,en.y,en.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)en.fromBufferAttribute(this,t),en.transformDirection(e),this.setXYZ(t,en.x,en.y,en.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Qa(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=jn(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Qa(t,this.array)),t}setX(e,t){return this.normalized&&(t=jn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Qa(t,this.array)),t}setY(e,t){return this.normalized&&(t=jn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Qa(t,this.array)),t}setZ(e,t){return this.normalized&&(t=jn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Qa(t,this.array)),t}setW(e,t){return this.normalized&&(t=jn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=jn(t,this.array),r=jn(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=jn(t,this.array),r=jn(r,this.array),i=jn(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,o){return e*=this.itemSize,this.normalized&&(t=jn(t,this.array),r=jn(r,this.array),i=jn(i,this.array),o=jn(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==zv&&(e.usage=this.usage),e}}class OS extends Or{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class US extends Or{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class cr extends Or{constructor(e,t,r){super(new Float32Array(e),t,r)}}let kR=0;const pr=new kt,Xh=new xn,Os=new ae,Qn=new Po,rl=new Po,fn=new ae;class Ni extends gs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:kR++}),this.uuid=hc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(IS(e)?US:OS)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new yt().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return pr.makeRotationFromQuaternion(e),this.applyMatrix4(pr),this}rotateX(e){return pr.makeRotationX(e),this.applyMatrix4(pr),this}rotateY(e){return pr.makeRotationY(e),this.applyMatrix4(pr),this}rotateZ(e){return pr.makeRotationZ(e),this.applyMatrix4(pr),this}translate(e,t,r){return pr.makeTranslation(e,t,r),this.applyMatrix4(pr),this}scale(e,t,r){return pr.makeScale(e,t,r),this.applyMatrix4(pr),this}lookAt(e){return Xh.lookAt(e),Xh.updateMatrix(),this.applyMatrix4(Xh.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Os).negate(),this.translate(Os.x,Os.y,Os.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,o=e.length;i<o;i++){const s=e[i];r.push(s.x,s.y,s.z||0)}this.setAttribute("position",new cr(r,3))}else{const r=Math.min(e.length,t.count);for(let i=0;i<r;i++){const o=e[i];t.setXYZ(i,o.x,o.y,o.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Po);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ae(-1/0,-1/0,-1/0),new ae(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const o=t[r];Qn.setFromBufferAttribute(o),this.morphTargetsRelative?(fn.addVectors(this.boundingBox.min,Qn.min),this.boundingBox.expandByPoint(fn),fn.addVectors(this.boundingBox.max,Qn.max),this.boundingBox.expandByPoint(fn)):(this.boundingBox.expandByPoint(Qn.min),this.boundingBox.expandByPoint(Qn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new fc);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ae,1/0);return}if(e){const r=this.boundingSphere.center;if(Qn.setFromBufferAttribute(e),t)for(let o=0,s=t.length;o<s;o++){const a=t[o];rl.setFromBufferAttribute(a),this.morphTargetsRelative?(fn.addVectors(Qn.min,rl.min),Qn.expandByPoint(fn),fn.addVectors(Qn.max,rl.max),Qn.expandByPoint(fn)):(Qn.expandByPoint(rl.min),Qn.expandByPoint(rl.max))}Qn.getCenter(r);let i=0;for(let o=0,s=e.count;o<s;o++)fn.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(fn));if(t)for(let o=0,s=t.length;o<s;o++){const a=t[o],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)fn.fromBufferAttribute(a,c),l&&(Os.fromBufferAttribute(e,c),fn.add(Os)),i=Math.max(i,r.distanceToSquared(fn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Or(new Float32Array(4*r.count),4));const s=this.getAttribute("tangent"),a=[],l=[];for(let T=0;T<r.count;T++)a[T]=new ae,l[T]=new ae;const c=new ae,u=new ae,d=new ae,f=new gt,m=new gt,v=new gt,_=new ae,x=new ae;function p(T,w,M){c.fromBufferAttribute(r,T),u.fromBufferAttribute(r,w),d.fromBufferAttribute(r,M),f.fromBufferAttribute(o,T),m.fromBufferAttribute(o,w),v.fromBufferAttribute(o,M),u.sub(c),d.sub(c),m.sub(f),v.sub(f);const P=1/(m.x*v.y-v.x*m.y);isFinite(P)&&(_.copy(u).multiplyScalar(v.y).addScaledVector(d,-m.y).multiplyScalar(P),x.copy(d).multiplyScalar(m.x).addScaledVector(u,-v.x).multiplyScalar(P),a[T].add(_),a[w].add(_),a[M].add(_),l[T].add(x),l[w].add(x),l[M].add(x))}let b=this.groups;b.length===0&&(b=[{start:0,count:e.count}]);for(let T=0,w=b.length;T<w;++T){const M=b[T],P=M.start,I=M.count;for(let D=P,$=P+I;D<$;D+=3)p(e.getX(D+0),e.getX(D+1),e.getX(D+2))}const g=new ae,y=new ae,E=new ae,C=new ae;function A(T){E.fromBufferAttribute(i,T),C.copy(E);const w=a[T];g.copy(w),g.sub(E.multiplyScalar(E.dot(w))).normalize(),y.crossVectors(C,w);const P=y.dot(l[T])<0?-1:1;s.setXYZW(T,g.x,g.y,g.z,P)}for(let T=0,w=b.length;T<w;++T){const M=b[T],P=M.start,I=M.count;for(let D=P,$=P+I;D<$;D+=3)A(e.getX(D+0)),A(e.getX(D+1)),A(e.getX(D+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Or(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let f=0,m=r.count;f<m;f++)r.setXYZ(f,0,0,0);const i=new ae,o=new ae,s=new ae,a=new ae,l=new ae,c=new ae,u=new ae,d=new ae;if(e)for(let f=0,m=e.count;f<m;f+=3){const v=e.getX(f+0),_=e.getX(f+1),x=e.getX(f+2);i.fromBufferAttribute(t,v),o.fromBufferAttribute(t,_),s.fromBufferAttribute(t,x),u.subVectors(s,o),d.subVectors(i,o),u.cross(d),a.fromBufferAttribute(r,v),l.fromBufferAttribute(r,_),c.fromBufferAttribute(r,x),a.add(u),l.add(u),c.add(u),r.setXYZ(v,a.x,a.y,a.z),r.setXYZ(_,l.x,l.y,l.z),r.setXYZ(x,c.x,c.y,c.z)}else for(let f=0,m=t.count;f<m;f+=3)i.fromBufferAttribute(t,f+0),o.fromBufferAttribute(t,f+1),s.fromBufferAttribute(t,f+2),u.subVectors(s,o),d.subVectors(i,o),u.cross(d),r.setXYZ(f+0,u.x,u.y,u.z),r.setXYZ(f+1,u.x,u.y,u.z),r.setXYZ(f+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)fn.fromBufferAttribute(e,t),fn.normalize(),e.setXYZ(t,fn.x,fn.y,fn.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,f=new c.constructor(l.length*u);let m=0,v=0;for(let _=0,x=l.length;_<x;_++){a.isInterleavedBufferAttribute?m=l[_]*a.data.stride+a.offset:m=l[_]*u;for(let p=0;p<u;p++)f[v++]=c[m++]}return new Or(f,u,d)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Ni,r=this.index.array,i=this.attributes;for(const a in i){const l=i[a],c=e(l,r);t.setAttribute(a,c)}const o=this.morphAttributes;for(const a in o){const l=[],c=o[a];for(let u=0,d=c.length;u<d;u++){const f=c[u],m=e(f,r);l.push(m)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let a=0,l=s.length;a<l;a++){const c=s[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const l=this.parameters;for(const c in l)l[c]!==void 0&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r){const c=r[l];e.data.attributes[l]=c.toJSON(e.data)}const i={};let o=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,f=c.length;d<f;d++){const m=c[d];u.push(m.toJSON(e.data))}u.length>0&&(i[l]=u,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return a!==null&&(e.data.boundingSphere=a.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const c in i){const u=i[c];this.setAttribute(c,u.clone(t))}const o=e.morphAttributes;for(const c in o){const u=[],d=o[c];for(let f=0,m=d.length;f<m;f++)u.push(d[f].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const s=e.groups;for(let c=0,u=s.length;c<u;c++){const d=s[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());const l=e.boundingSphere;return l!==null&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Zv=new kt,No=new Lg,qc=new fc,Qv=new ae,Kc=new ae,Jc=new ae,Zc=new ae,Yh=new ae,Qc=new ae,ex=new ae,eu=new ae;class bn extends xn{constructor(e=new Ni,t=new NS){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,s=i.length;o<s;o++){const a=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=o}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,o=r.morphAttributes.position,s=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const a=this.morphTargetInfluences;if(o&&a){Qc.set(0,0,0);for(let l=0,c=o.length;l<c;l++){const u=a[l],d=o[l];u!==0&&(Yh.fromBufferAttribute(d,e),s?Qc.addScaledVector(Yh,u):Qc.addScaledVector(Yh.sub(t),u))}t.add(Qc)}return t}raycast(e,t){const r=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),qc.copy(r.boundingSphere),qc.applyMatrix4(o),No.copy(e.ray).recast(e.near),!(qc.containsPoint(No.origin)===!1&&(No.intersectSphere(qc,Qv)===null||No.origin.distanceToSquared(Qv)>(e.far-e.near)**2))&&(Zv.copy(o).invert(),No.copy(e.ray).applyMatrix4(Zv),!(r.boundingBox!==null&&No.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,No)))}_computeIntersections(e,t,r){let i;const o=this.geometry,s=this.material,a=o.index,l=o.attributes.position,c=o.attributes.uv,u=o.attributes.uv1,d=o.attributes.normal,f=o.groups,m=o.drawRange;if(a!==null)if(Array.isArray(s))for(let v=0,_=f.length;v<_;v++){const x=f[v],p=s[x.materialIndex],b=Math.max(x.start,m.start),g=Math.min(a.count,Math.min(x.start+x.count,m.start+m.count));for(let y=b,E=g;y<E;y+=3){const C=a.getX(y),A=a.getX(y+1),T=a.getX(y+2);i=tu(this,p,e,r,c,u,d,C,A,T),i&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=x.materialIndex,t.push(i))}}else{const v=Math.max(0,m.start),_=Math.min(a.count,m.start+m.count);for(let x=v,p=_;x<p;x+=3){const b=a.getX(x),g=a.getX(x+1),y=a.getX(x+2);i=tu(this,s,e,r,c,u,d,b,g,y),i&&(i.faceIndex=Math.floor(x/3),t.push(i))}}else if(l!==void 0)if(Array.isArray(s))for(let v=0,_=f.length;v<_;v++){const x=f[v],p=s[x.materialIndex],b=Math.max(x.start,m.start),g=Math.min(l.count,Math.min(x.start+x.count,m.start+m.count));for(let y=b,E=g;y<E;y+=3){const C=y,A=y+1,T=y+2;i=tu(this,p,e,r,c,u,d,C,A,T),i&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=x.materialIndex,t.push(i))}}else{const v=Math.max(0,m.start),_=Math.min(l.count,m.start+m.count);for(let x=v,p=_;x<p;x+=3){const b=x,g=x+1,y=x+2;i=tu(this,s,e,r,c,u,d,b,g,y),i&&(i.faceIndex=Math.floor(x/3),t.push(i))}}}}function IR(n,e,t,r,i,o,s,a){let l;if(e.side===Kn?l=r.intersectTriangle(s,o,i,!0,a):l=r.intersectTriangle(i,o,s,e.side===wo,a),l===null)return null;eu.copy(a),eu.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(eu);return c<t.near||c>t.far?null:{distance:c,point:eu.clone(),object:n}}function tu(n,e,t,r,i,o,s,a,l,c){n.getVertexPosition(a,Kc),n.getVertexPosition(l,Jc),n.getVertexPosition(c,Zc);const u=IR(n,e,t,r,Kc,Jc,Zc,ex);if(u){const d=new ae;Ir.getBarycoord(ex,Kc,Jc,Zc,d),i&&(u.uv=Ir.getInterpolatedAttribute(i,a,l,c,d,new gt)),o&&(u.uv1=Ir.getInterpolatedAttribute(o,a,l,c,d,new gt)),s&&(u.normal=Ir.getInterpolatedAttribute(s,a,l,c,d,new ae),u.normal.dot(r.direction)>0&&u.normal.multiplyScalar(-1));const f={a,b:l,c,normal:new ae,materialIndex:0};Ir.getNormal(Kc,Jc,Zc,f.normal),u.face=f,u.barycoord=d}return u}class pc extends Ni{constructor(e=1,t=1,r=1,i=1,o=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:s};const a=this;i=Math.floor(i),o=Math.floor(o),s=Math.floor(s);const l=[],c=[],u=[],d=[];let f=0,m=0;v("z","y","x",-1,-1,r,t,e,s,o,0),v("z","y","x",1,-1,r,t,-e,s,o,1),v("x","z","y",1,1,e,r,t,i,s,2),v("x","z","y",1,-1,e,r,-t,i,s,3),v("x","y","z",1,-1,e,t,r,i,o,4),v("x","y","z",-1,-1,e,t,-r,i,o,5),this.setIndex(l),this.setAttribute("position",new cr(c,3)),this.setAttribute("normal",new cr(u,3)),this.setAttribute("uv",new cr(d,2));function v(_,x,p,b,g,y,E,C,A,T,w){const M=y/A,P=E/T,I=y/2,D=E/2,$=C/2,W=A+1,H=T+1;let Z=0,F=0;const Y=new ae;for(let X=0;X<H;X++){const oe=X*P-D;for(let pe=0;pe<W;pe++){const De=pe*M-I;Y[_]=De*b,Y[x]=oe*g,Y[p]=$,c.push(Y.x,Y.y,Y.z),Y[_]=0,Y[x]=0,Y[p]=C>0?1:-1,u.push(Y.x,Y.y,Y.z),d.push(pe/A),d.push(1-X/T),Z+=1}}for(let X=0;X<T;X++)for(let oe=0;oe<A;oe++){const pe=f+oe+W*X,De=f+oe+W*(X+1),z=f+(oe+1)+W*(X+1),ve=f+(oe+1)+W*X;l.push(pe,De,ve),l.push(De,z,ve),F+=6}a.addGroup(m,F,w),m+=F,f+=Z}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new pc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Pa(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function kn(n){const e={};for(let t=0;t<n.length;t++){const r=Pa(n[t]);for(const i in r)e[i]=r[i]}return e}function LR(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function zS(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Pt.workingColorSpace}const DR={clone:Pa,merge:kn};var NR=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,OR=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Eo extends Fa{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=NR,this.fragmentShader=OR,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Pa(e.uniforms),this.uniformsGroups=LR(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const s=this.uniforms[i].value;s&&s.isTexture?t.uniforms[i]={type:"t",value:s.toJSON(e).uuid}:s&&s.isColor?t.uniforms[i]={type:"c",value:s.getHex()}:s&&s.isVector2?t.uniforms[i]={type:"v2",value:s.toArray()}:s&&s.isVector3?t.uniforms[i]={type:"v3",value:s.toArray()}:s&&s.isVector4?t.uniforms[i]={type:"v4",value:s.toArray()}:s&&s.isMatrix3?t.uniforms[i]={type:"m3",value:s.toArray()}:s&&s.isMatrix4?t.uniforms[i]={type:"m4",value:s.toArray()}:t.uniforms[i]={value:s}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class FS extends xn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new kt,this.projectionMatrix=new kt,this.projectionMatrixInverse=new kt,this.coordinateSystem=Xr,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Gi=new ae,tx=new gt,nx=new gt;class or extends FS{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=pm*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Pu*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return pm*2*Math.atan(Math.tan(Pu*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){Gi.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Gi.x,Gi.y).multiplyScalar(-e/Gi.z),Gi.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Gi.x,Gi.y).multiplyScalar(-e/Gi.z)}getViewSize(e,t){return this.getViewBounds(e,tx,nx),t.subVectors(nx,tx)}setViewOffset(e,t,r,i,o,s){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Pu*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,o=-.5*i;const s=this.view;if(this.view!==null&&this.view.enabled){const l=s.fullWidth,c=s.fullHeight;o+=s.offsetX*i/l,t-=s.offsetY*r/c,i*=s.width/l,r*=s.height/c}const a=this.filmOffset;a!==0&&(o+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-r,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Us=-90,zs=1;class UR extends xn{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new or(Us,zs,e,t);i.layers=this.layers,this.add(i);const o=new or(Us,zs,e,t);o.layers=this.layers,this.add(o);const s=new or(Us,zs,e,t);s.layers=this.layers,this.add(s);const a=new or(Us,zs,e,t);a.layers=this.layers,this.add(a);const l=new or(Us,zs,e,t);l.layers=this.layers,this.add(l);const c=new or(Us,zs,e,t);c.layers=this.layers,this.add(c)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,o,s,a,l]=t;for(const c of t)this.remove(c);if(e===Xr)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),s.up.set(0,0,1),s.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),l.up.set(0,1,0),l.lookAt(0,0,-1);else if(e===ud)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),s.up.set(0,0,-1),s.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),l.up.set(0,-1,0),l.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const c of t)this.add(c),c.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,s,a,l,c,u]=this.children,d=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),v=e.xr.enabled;e.xr.enabled=!1;const _=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,o),e.setRenderTarget(r,1,i),e.render(t,s),e.setRenderTarget(r,2,i),e.render(t,a),e.setRenderTarget(r,3,i),e.render(t,l),e.setRenderTarget(r,4,i),e.render(t,c),r.texture.generateMipmaps=_,e.setRenderTarget(r,5,i),e.render(t,u),e.setRenderTarget(d,f,m),e.xr.enabled=v,r.texture.needsPMREMUpdate=!0}}class jS extends On{constructor(e=[],t=Ra,r,i,o,s,a,l,c,u){super(e,t,r,i,o,s,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class zR extends ds{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new jS(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new pc(5,5,5),o=new Eo({name:"CubemapFromEquirect",uniforms:Pa(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:Kn,blending:go});o.uniforms.tEquirect.value=t;const s=new bn(i,o),a=t.minFilter;return t.minFilter===oo&&(t.minFilter=Dn),new UR(1,10,this).update(e,s),t.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(e,t=!0,r=!0,i=!0){const o=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,r,i);e.setRenderTarget(o)}}class ia extends xn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const FR={type:"move"};class qh{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new ia,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new ia,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ae,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ae),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new ia,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ae,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ae),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,o=null,s=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(c&&e.hand){s=!0;for(const _ of e.hand.values()){const x=t.getJointPose(_,r),p=this._getHandJoint(c,_);x!==null&&(p.matrix.fromArray(x.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,p.jointRadius=x.radius),p.visible=x!==null}const u=c.joints["index-finger-tip"],d=c.joints["thumb-tip"],f=u.position.distanceTo(d.position),m=.02,v=.005;c.inputState.pinching&&f>m+v?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&f<=m-v&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else l!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,r),o!==null&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,o.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(o.linearVelocity)):l.hasLinearVelocity=!1,o.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(o.angularVelocity)):l.hasAngularVelocity=!1));a!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&o!==null&&(i=o),i!==null&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(FR)))}return a!==null&&(a.visible=i!==null),l!==null&&(l.visible=o!==null),c!==null&&(c.visible=s!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new ia;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class BS extends xn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Zr,this.environmentIntensity=1,this.environmentRotation=new Zr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class HS extends On{constructor(e=null,t=1,r=1,i,o,s,a,l,c=lr,u=lr,d,f){super(null,s,a,l,c,u,i,o,d,f),this.isDataTexture=!0,this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class mm extends Or{constructor(e,t,r,i=1){super(e,t,r),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const Fs=new kt,rx=new kt,nu=[],ix=new Po,jR=new kt,il=new bn,ol=new fc;class hd extends bn{constructor(e,t,r){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new mm(new Float32Array(r*16),16),this.instanceColor=null,this.morphTexture=null,this.count=r,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<r;i++)this.setMatrixAt(i,jR)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Po),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Fs),ix.copy(e.boundingBox).applyMatrix4(Fs),this.boundingBox.union(ix)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new fc),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let r=0;r<t;r++)this.getMatrixAt(r,Fs),ol.copy(e.boundingSphere).applyMatrix4(Fs),this.boundingSphere.union(ol)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const r=t.morphTargetInfluences,i=this.morphTexture.source.data.data,o=r.length+1,s=e*o+1;for(let a=0;a<r.length;a++)r[a]=i[s+a]}raycast(e,t){const r=this.matrixWorld,i=this.count;if(il.geometry=this.geometry,il.material=this.material,il.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ol.copy(this.boundingSphere),ol.applyMatrix4(r),e.ray.intersectsSphere(ol)!==!1))for(let o=0;o<i;o++){this.getMatrixAt(o,Fs),rx.multiplyMatrices(r,Fs),il.matrixWorld=rx,il.raycast(e,nu);for(let s=0,a=nu.length;s<a;s++){const l=nu[s];l.instanceId=o,l.object=this,t.push(l)}nu.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new mm(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const r=t.morphTargetInfluences,i=r.length+1;this.morphTexture===null&&(this.morphTexture=new HS(new Float32Array(i*this.count),i,this.count,Rg,Gn));const o=this.morphTexture.source.data.data;let s=0;for(let c=0;c<r.length;c++)s+=r[c];const a=this.geometry.morphTargetsRelative?1:1-s,l=i*e;o[l]=a,o.set(r,l+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const Kh=new ae,BR=new ae,HR=new yt;class Zi{constructor(e=new ae(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=Kh.subVectors(r,t).cross(BR.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(Kh),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(e.start).addScaledVector(r,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||HR.getNormalMatrix(e),i=this.coplanarPoint(Kh).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Oo=new fc,WR=new gt(.5,.5),ru=new ae;class Ng{constructor(e=new Zi,t=new Zi,r=new Zi,i=new Zi,o=new Zi,s=new Zi){this.planes=[e,t,r,i,o,s]}set(e,t,r,i,o,s){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(o),a[5].copy(s),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=Xr,r=!1){const i=this.planes,o=e.elements,s=o[0],a=o[1],l=o[2],c=o[3],u=o[4],d=o[5],f=o[6],m=o[7],v=o[8],_=o[9],x=o[10],p=o[11],b=o[12],g=o[13],y=o[14],E=o[15];if(i[0].setComponents(c-s,m-u,p-v,E-b).normalize(),i[1].setComponents(c+s,m+u,p+v,E+b).normalize(),i[2].setComponents(c+a,m+d,p+_,E+g).normalize(),i[3].setComponents(c-a,m-d,p-_,E-g).normalize(),r)i[4].setComponents(l,f,x,y).normalize(),i[5].setComponents(c-l,m-f,p-x,E-y).normalize();else if(i[4].setComponents(c-l,m-f,p-x,E-y).normalize(),t===Xr)i[5].setComponents(c+l,m+f,p+x,E+y).normalize();else if(t===ud)i[5].setComponents(l,f,x,y).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Oo.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Oo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Oo)}intersectsSprite(e){Oo.center.set(0,0,0);const t=WR.distanceTo(e.center);return Oo.radius=.7071067811865476+t,Oo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Oo)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(ru.x=i.normal.x>0?e.max.x:e.min.x,ru.y=i.normal.y>0?e.max.y:e.min.y,ru.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(ru)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class WS extends On{constructor(e,t,r=cs,i,o,s,a=lr,l=lr,c,u=Kl,d=1){if(u!==Kl&&u!==Jl)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const f={width:e,height:t,depth:d};super(f,i,o,s,a,l,u,r,c),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Ig(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class VS extends On{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Og extends Ni{constructor(e=1,t=1,r=1,i=32,o=1,s=!1,a=0,l=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:a,thetaLength:l};const c=this;i=Math.floor(i),o=Math.floor(o);const u=[],d=[],f=[],m=[];let v=0;const _=[],x=r/2;let p=0;b(),s===!1&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(u),this.setAttribute("position",new cr(d,3)),this.setAttribute("normal",new cr(f,3)),this.setAttribute("uv",new cr(m,2));function b(){const y=new ae,E=new ae;let C=0;const A=(t-e)/r;for(let T=0;T<=o;T++){const w=[],M=T/o,P=M*(t-e)+e;for(let I=0;I<=i;I++){const D=I/i,$=D*l+a,W=Math.sin($),H=Math.cos($);E.x=P*W,E.y=-M*r+x,E.z=P*H,d.push(E.x,E.y,E.z),y.set(W,A,H).normalize(),f.push(y.x,y.y,y.z),m.push(D,1-M),w.push(v++)}_.push(w)}for(let T=0;T<i;T++)for(let w=0;w<o;w++){const M=_[w][T],P=_[w+1][T],I=_[w+1][T+1],D=_[w][T+1];(e>0||w!==0)&&(u.push(M,P,D),C+=3),(t>0||w!==o-1)&&(u.push(P,I,D),C+=3)}c.addGroup(p,C,0),p+=C}function g(y){const E=v,C=new gt,A=new ae;let T=0;const w=y===!0?e:t,M=y===!0?1:-1;for(let I=1;I<=i;I++)d.push(0,x*M,0),f.push(0,M,0),m.push(.5,.5),v++;const P=v;for(let I=0;I<=i;I++){const $=I/i*l+a,W=Math.cos($),H=Math.sin($);A.x=w*H,A.y=x*M,A.z=w*W,d.push(A.x,A.y,A.z),f.push(0,M,0),C.x=W*.5+.5,C.y=H*.5*M+.5,m.push(C.x,C.y),v++}for(let I=0;I<i;I++){const D=E+I,$=P+I;y===!0?u.push($,$+1,D):u.push($+1,$,D),T+=3}c.addGroup(p,T,y===!0?1:2),p+=T}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Og(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Fd extends Ni{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const o=e/2,s=t/2,a=Math.floor(r),l=Math.floor(i),c=a+1,u=l+1,d=e/a,f=t/l,m=[],v=[],_=[],x=[];for(let p=0;p<u;p++){const b=p*f-s;for(let g=0;g<c;g++){const y=g*d-o;v.push(y,-b,0),_.push(0,0,1),x.push(g/a),x.push(1-p/l)}}for(let p=0;p<l;p++)for(let b=0;b<a;b++){const g=b+c*p,y=b+c*(p+1),E=b+1+c*(p+1),C=b+1+c*p;m.push(g,y,C),m.push(y,E,C)}this.setIndex(m),this.setAttribute("position",new cr(v,3)),this.setAttribute("normal",new cr(_,3)),this.setAttribute("uv",new cr(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fd(e.width,e.height,e.widthSegments,e.heightSegments)}}class xo extends Ni{constructor(e=1,t=32,r=16,i=0,o=Math.PI*2,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:o,thetaStart:s,thetaLength:a},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const l=Math.min(s+a,Math.PI);let c=0;const u=[],d=new ae,f=new ae,m=[],v=[],_=[],x=[];for(let p=0;p<=r;p++){const b=[],g=p/r;let y=0;p===0&&s===0?y=.5/t:p===r&&l===Math.PI&&(y=-.5/t);for(let E=0;E<=t;E++){const C=E/t;d.x=-e*Math.cos(i+C*o)*Math.sin(s+g*a),d.y=e*Math.cos(s+g*a),d.z=e*Math.sin(i+C*o)*Math.sin(s+g*a),v.push(d.x,d.y,d.z),f.copy(d).normalize(),_.push(f.x,f.y,f.z),x.push(C+y,1-g),b.push(c++)}u.push(b)}for(let p=0;p<r;p++)for(let b=0;b<t;b++){const g=u[p][b+1],y=u[p][b],E=u[p+1][b],C=u[p+1][b+1];(p!==0||s>0)&&m.push(g,y,C),(p!==r-1||l<Math.PI)&&m.push(y,E,C)}this.setIndex(m),this.setAttribute("position",new cr(v,3)),this.setAttribute("normal",new cr(_,3)),this.setAttribute("uv",new cr(x,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xo(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Ug extends Fa{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new pt(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class In extends Fa{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new pt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new pt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=PS,this.normalScale=new gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Zr,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class VR extends Fa{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Z5,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class $R extends Fa{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const ox={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class GR{constructor(e,t,r){const i=this;let o=!1,s=0,a=0,l;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.abortController=new AbortController,this.itemStart=function(u){a++,o===!1&&i.onStart!==void 0&&i.onStart(u,s,a),o=!0},this.itemEnd=function(u){s++,i.onProgress!==void 0&&i.onProgress(u,s,a),s===a&&(o=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(u){i.onError!==void 0&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return d!==-1&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,f=c.length;d<f;d+=2){const m=c[d],v=c[d+1];if(m.global&&(m.lastIndex=0),m.test(u))return v}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const XR=new GR;class zg{constructor(e){this.manager=e!==void 0?e:XR,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,o){r.load(e,i,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}zg.DEFAULT_MATERIAL_NAME="__DEFAULT";const hi={};class YR extends Error{constructor(e,t){super(e),this.response=t}}class qR extends zg{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=ox.get(`file:${e}`);if(o!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(o),this.manager.itemEnd(e)},0),o;if(hi[e]!==void 0){hi[e].push({onLoad:t,onProgress:r,onError:i});return}hi[e]=[],hi[e].push({onLoad:t,onProgress:r,onError:i});const s=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),a=this.mimeType,l=this.responseType;fetch(s).then(c=>{if(c.status===200||c.status===0){if(c.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||c.body===void 0||c.body.getReader===void 0)return c;const u=hi[e],d=c.body.getReader(),f=c.headers.get("X-File-Size")||c.headers.get("Content-Length"),m=f?parseInt(f):0,v=m!==0;let _=0;const x=new ReadableStream({start(p){b();function b(){d.read().then(({done:g,value:y})=>{if(g)p.close();else{_+=y.byteLength;const E=new ProgressEvent("progress",{lengthComputable:v,loaded:_,total:m});for(let C=0,A=u.length;C<A;C++){const T=u[C];T.onProgress&&T.onProgress(E)}p.enqueue(y),b()}},g=>{p.error(g)})}}});return new Response(x)}else throw new YR(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`,c)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return c.json();default:if(a==="")return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),f=d&&d[1]?d[1].toLowerCase():void 0,m=new TextDecoder(f);return c.arrayBuffer().then(v=>m.decode(v))}}}).then(c=>{ox.add(`file:${e}`,c);const u=hi[e];delete hi[e];for(let d=0,f=u.length;d<f;d++){const m=u[d];m.onLoad&&m.onLoad(c)}}).catch(c=>{const u=hi[e];if(u===void 0)throw this.manager.itemError(e),c;delete hi[e];for(let d=0,f=u.length;d<f;d++){const m=u[d];m.onError&&m.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class KR extends zg{constructor(e){super(e)}load(e,t,r,i){const o=this,s=new HS,a=new qR(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(o.withCredentials),a.load(e,function(l){let c;try{c=o.parse(l)}catch(u){if(i!==void 0)i(u);else{console.error(u);return}}c.image!==void 0?s.image=c.image:c.data!==void 0&&(s.image.width=c.width,s.image.height=c.height,s.image.data=c.data),s.wrapS=c.wrapS!==void 0?c.wrapS:wi,s.wrapT=c.wrapT!==void 0?c.wrapT:wi,s.magFilter=c.magFilter!==void 0?c.magFilter:Dn,s.minFilter=c.minFilter!==void 0?c.minFilter:Dn,s.anisotropy=c.anisotropy!==void 0?c.anisotropy:1,c.colorSpace!==void 0&&(s.colorSpace=c.colorSpace),c.flipY!==void 0&&(s.flipY=c.flipY),c.format!==void 0&&(s.format=c.format),c.type!==void 0&&(s.type=c.type),c.mipmaps!==void 0&&(s.mipmaps=c.mipmaps,s.minFilter=oo),c.mipmapCount===1&&(s.minFilter=Dn),c.generateMipmaps!==void 0&&(s.generateMipmaps=c.generateMipmaps),s.needsUpdate=!0,t&&t(s,c)},r,i),s}}class $S extends xn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new pt(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}const Jh=new kt,sx=new ae,ax=new ae;class JR{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new gt(512,512),this.mapType=Kr,this.map=null,this.mapPass=null,this.matrix=new kt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Ng,this._frameExtents=new gt(1,1),this._viewportCount=1,this._viewports=[new Jt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;sx.setFromMatrixPosition(e.matrixWorld),t.position.copy(sx),ax.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(ax),t.updateMatrixWorld(),Jh.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Jh,t.coordinateSystem,t.reversedDepth),t.reversedDepth?r.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(Jh)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class GS extends FS{constructor(e=-1,t=1,r=1,i=-1,o=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=o,this.far=s,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,o,s){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=r-e,s=r+e,a=i+t,l=i-t;if(this.view!==null&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=c*this.view.offsetX,s=o+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(o,s,a,l,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class ZR extends JR{constructor(){super(new GS(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class _i extends $S{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(xn.DEFAULT_UP),this.updateMatrix(),this.target=new xn,this.shadow=new ZR}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class XS extends $S{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class QR extends or{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}const lx=new kt;class YS{constructor(e,t,r=0,i=1/0){this.ray=new Lg(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Dg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return lx.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(lx),this}intersectObject(e,t=!0,r=[]){return gm(e,this,r,t),r.sort(cx),r}intersectObjects(e,t=!0,r=[]){for(let i=0,o=e.length;i<o;i++)gm(e[i],this,r,t);return r.sort(cx),r}}function cx(n,e){return n.distance-e.distance}function gm(n,e,t,r){let i=!0;if(n.layers.test(e.layers)&&n.raycast(e,t)===!1&&(i=!1),i===!0&&r===!0){const o=n.children;for(let s=0,a=o.length;s<a;s++)gm(o[s],e,t,!0)}}class ux{constructor(e=1,t=0,r=0){this.radius=e,this.phi=t,this.theta=r}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Et(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(Et(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class eA extends gs{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function dx(n,e,t,r){const i=tA(r);switch(t){case CS:return n*e;case Rg:return n*e/i.components*i.byteLength;case Ag:return n*e/i.components*i.byteLength;case AS:return n*e*2/i.components*i.byteLength;case Pg:return n*e*2/i.components*i.byteLength;case RS:return n*e*3/i.components*i.byteLength;case Lr:return n*e*4/i.components*i.byteLength;case kg:return n*e*4/i.components*i.byteLength;case Tu:case Cu:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Ru:case Au:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Bp:case Wp:return Math.max(n,16)*Math.max(e,8)/4;case jp:case Hp:return Math.max(n,8)*Math.max(e,8)/2;case Vp:case $p:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Gp:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Xp:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case Yp:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case qp:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case Kp:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case Jp:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case Zp:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Qp:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case em:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case tm:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case nm:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case rm:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case im:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case om:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case sm:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case am:case lm:case cm:return Math.ceil(n/4)*Math.ceil(e/4)*16;case um:case dm:return Math.ceil(n/4)*Math.ceil(e/4)*8;case hm:case fm:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function tA(n){switch(n){case Kr:case wS:return{byteLength:1,components:1};case Yl:case ES:case Ei:return{byteLength:2,components:1};case Tg:case Cg:return{byteLength:2,components:4};case cs:case Mg:case Gn:return{byteLength:4,components:1};case MS:case TS:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Eg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Eg);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function qS(){let n=null,e=!1,t=null,r=null;function i(o,s){t(o,s),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function nA(n){const e=new WeakMap;function t(a,l){const c=a.array,u=a.usage,d=c.byteLength,f=n.createBuffer();n.bindBuffer(l,f),n.bufferData(l,c,u),a.onUploadCallback();let m;if(c instanceof Float32Array)m=n.FLOAT;else if(typeof Float16Array<"u"&&c instanceof Float16Array)m=n.HALF_FLOAT;else if(c instanceof Uint16Array)a.isFloat16BufferAttribute?m=n.HALF_FLOAT:m=n.UNSIGNED_SHORT;else if(c instanceof Int16Array)m=n.SHORT;else if(c instanceof Uint32Array)m=n.UNSIGNED_INT;else if(c instanceof Int32Array)m=n.INT;else if(c instanceof Int8Array)m=n.BYTE;else if(c instanceof Uint8Array)m=n.UNSIGNED_BYTE;else if(c instanceof Uint8ClampedArray)m=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+c);return{buffer:f,type:m,bytesPerElement:c.BYTES_PER_ELEMENT,version:a.version,size:d}}function r(a,l,c){const u=l.array,d=l.updateRanges;if(n.bindBuffer(c,a),d.length===0)n.bufferSubData(c,0,u);else{d.sort((m,v)=>m.start-v.start);let f=0;for(let m=1;m<d.length;m++){const v=d[f],_=d[m];_.start<=v.start+v.count+1?v.count=Math.max(v.count,_.start+_.count-v.start):(++f,d[f]=_)}d.length=f+1;for(let m=0,v=d.length;m<v;m++){const _=d[m];n.bufferSubData(c,_.start*u.BYTES_PER_ELEMENT,u,_.start,_.count)}l.clearUpdateRanges()}l.onUploadCallback()}function i(a){return a.isInterleavedBufferAttribute&&(a=a.data),e.get(a)}function o(a){a.isInterleavedBufferAttribute&&(a=a.data);const l=e.get(a);l&&(n.deleteBuffer(l.buffer),e.delete(a))}function s(a,l){if(a.isInterleavedBufferAttribute&&(a=a.data),a.isGLBufferAttribute){const u=e.get(a);(!u||u.version<a.version)&&e.set(a,{buffer:a.buffer,type:a.type,bytesPerElement:a.elementSize,version:a.version});return}const c=e.get(a);if(c===void 0)e.set(a,t(a,l));else if(c.version<a.version){if(c.size!==a.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(c.buffer,a,l),c.version=a.version}}return{get:i,remove:o,update:s}}var rA=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,iA=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,oA=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,sA=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,aA=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,lA=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,cA=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,uA=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,dA=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,hA=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,fA=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,pA=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,mA=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,gA=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,vA=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,xA=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,yA=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,_A=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,bA=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,SA=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,wA=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,EA=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,MA=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,TA=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,CA=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,RA=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,AA=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,PA=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,kA=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,IA=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,LA="gl_FragColor = linearToOutputTexel( gl_FragColor );",DA=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,NA=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,OA=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,UA=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,zA=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,FA=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,jA=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,BA=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,HA=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,WA=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,VA=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,$A=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,GA=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,XA=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,YA=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,qA=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,KA=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,JA=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,ZA=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,QA=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,eP=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,tP=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,nP=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,rP=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,iP=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,oP=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,sP=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,aP=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,lP=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,cP=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,uP=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,dP=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,hP=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fP=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,pP=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,mP=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,gP=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,vP=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,xP=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,yP=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,_P=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,bP=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,SP=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,wP=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,EP=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,MP=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,TP=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,CP=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,RP=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,AP=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,PP=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,kP=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,IP=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,LP=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,DP=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,NP=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,OP=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,UP=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,zP=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,FP=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,jP=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,BP=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,HP=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,WP=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,VP=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,$P=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,GP=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,XP=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,YP=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,qP=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,KP=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,JP=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,ZP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,QP=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,ek=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,tk=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const nk=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,rk=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ik=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ok=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,sk=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,ak=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lk=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,ck=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,uk=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,dk=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,hk=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fk=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,pk=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,mk=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,gk=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,vk=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,xk=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,yk=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_k=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,bk=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Sk=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,wk=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Ek=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Mk=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Tk=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Ck=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Rk=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Ak=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Pk=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,kk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Ik=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Lk=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Dk=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Nk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,_t={alphahash_fragment:rA,alphahash_pars_fragment:iA,alphamap_fragment:oA,alphamap_pars_fragment:sA,alphatest_fragment:aA,alphatest_pars_fragment:lA,aomap_fragment:cA,aomap_pars_fragment:uA,batching_pars_vertex:dA,batching_vertex:hA,begin_vertex:fA,beginnormal_vertex:pA,bsdfs:mA,iridescence_fragment:gA,bumpmap_pars_fragment:vA,clipping_planes_fragment:xA,clipping_planes_pars_fragment:yA,clipping_planes_pars_vertex:_A,clipping_planes_vertex:bA,color_fragment:SA,color_pars_fragment:wA,color_pars_vertex:EA,color_vertex:MA,common:TA,cube_uv_reflection_fragment:CA,defaultnormal_vertex:RA,displacementmap_pars_vertex:AA,displacementmap_vertex:PA,emissivemap_fragment:kA,emissivemap_pars_fragment:IA,colorspace_fragment:LA,colorspace_pars_fragment:DA,envmap_fragment:NA,envmap_common_pars_fragment:OA,envmap_pars_fragment:UA,envmap_pars_vertex:zA,envmap_physical_pars_fragment:qA,envmap_vertex:FA,fog_vertex:jA,fog_pars_vertex:BA,fog_fragment:HA,fog_pars_fragment:WA,gradientmap_pars_fragment:VA,lightmap_pars_fragment:$A,lights_lambert_fragment:GA,lights_lambert_pars_fragment:XA,lights_pars_begin:YA,lights_toon_fragment:KA,lights_toon_pars_fragment:JA,lights_phong_fragment:ZA,lights_phong_pars_fragment:QA,lights_physical_fragment:eP,lights_physical_pars_fragment:tP,lights_fragment_begin:nP,lights_fragment_maps:rP,lights_fragment_end:iP,logdepthbuf_fragment:oP,logdepthbuf_pars_fragment:sP,logdepthbuf_pars_vertex:aP,logdepthbuf_vertex:lP,map_fragment:cP,map_pars_fragment:uP,map_particle_fragment:dP,map_particle_pars_fragment:hP,metalnessmap_fragment:fP,metalnessmap_pars_fragment:pP,morphinstance_vertex:mP,morphcolor_vertex:gP,morphnormal_vertex:vP,morphtarget_pars_vertex:xP,morphtarget_vertex:yP,normal_fragment_begin:_P,normal_fragment_maps:bP,normal_pars_fragment:SP,normal_pars_vertex:wP,normal_vertex:EP,normalmap_pars_fragment:MP,clearcoat_normal_fragment_begin:TP,clearcoat_normal_fragment_maps:CP,clearcoat_pars_fragment:RP,iridescence_pars_fragment:AP,opaque_fragment:PP,packing:kP,premultiplied_alpha_fragment:IP,project_vertex:LP,dithering_fragment:DP,dithering_pars_fragment:NP,roughnessmap_fragment:OP,roughnessmap_pars_fragment:UP,shadowmap_pars_fragment:zP,shadowmap_pars_vertex:FP,shadowmap_vertex:jP,shadowmask_pars_fragment:BP,skinbase_vertex:HP,skinning_pars_vertex:WP,skinning_vertex:VP,skinnormal_vertex:$P,specularmap_fragment:GP,specularmap_pars_fragment:XP,tonemapping_fragment:YP,tonemapping_pars_fragment:qP,transmission_fragment:KP,transmission_pars_fragment:JP,uv_pars_fragment:ZP,uv_pars_vertex:QP,uv_vertex:ek,worldpos_vertex:tk,background_vert:nk,background_frag:rk,backgroundCube_vert:ik,backgroundCube_frag:ok,cube_vert:sk,cube_frag:ak,depth_vert:lk,depth_frag:ck,distanceRGBA_vert:uk,distanceRGBA_frag:dk,equirect_vert:hk,equirect_frag:fk,linedashed_vert:pk,linedashed_frag:mk,meshbasic_vert:gk,meshbasic_frag:vk,meshlambert_vert:xk,meshlambert_frag:yk,meshmatcap_vert:_k,meshmatcap_frag:bk,meshnormal_vert:Sk,meshnormal_frag:wk,meshphong_vert:Ek,meshphong_frag:Mk,meshphysical_vert:Tk,meshphysical_frag:Ck,meshtoon_vert:Rk,meshtoon_frag:Ak,points_vert:Pk,points_frag:kk,shadow_vert:Ik,shadow_frag:Lk,sprite_vert:Dk,sprite_frag:Nk},tt={common:{diffuse:{value:new pt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new yt},alphaMap:{value:null},alphaMapTransform:{value:new yt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new yt}},envmap:{envMap:{value:null},envMapRotation:{value:new yt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new yt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new yt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new yt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new yt},normalScale:{value:new gt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new yt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new yt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new yt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new yt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new pt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new pt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new yt},alphaTest:{value:0},uvTransform:{value:new yt}},sprite:{diffuse:{value:new pt(16777215)},opacity:{value:1},center:{value:new gt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new yt},alphaMap:{value:null},alphaMapTransform:{value:new yt},alphaTest:{value:0}}},$r={basic:{uniforms:kn([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.fog]),vertexShader:_t.meshbasic_vert,fragmentShader:_t.meshbasic_frag},lambert:{uniforms:kn([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new pt(0)}}]),vertexShader:_t.meshlambert_vert,fragmentShader:_t.meshlambert_frag},phong:{uniforms:kn([tt.common,tt.specularmap,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,tt.lights,{emissive:{value:new pt(0)},specular:{value:new pt(1118481)},shininess:{value:30}}]),vertexShader:_t.meshphong_vert,fragmentShader:_t.meshphong_frag},standard:{uniforms:kn([tt.common,tt.envmap,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.roughnessmap,tt.metalnessmap,tt.fog,tt.lights,{emissive:{value:new pt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:_t.meshphysical_vert,fragmentShader:_t.meshphysical_frag},toon:{uniforms:kn([tt.common,tt.aomap,tt.lightmap,tt.emissivemap,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.gradientmap,tt.fog,tt.lights,{emissive:{value:new pt(0)}}]),vertexShader:_t.meshtoon_vert,fragmentShader:_t.meshtoon_frag},matcap:{uniforms:kn([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,tt.fog,{matcap:{value:null}}]),vertexShader:_t.meshmatcap_vert,fragmentShader:_t.meshmatcap_frag},points:{uniforms:kn([tt.points,tt.fog]),vertexShader:_t.points_vert,fragmentShader:_t.points_frag},dashed:{uniforms:kn([tt.common,tt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_t.linedashed_vert,fragmentShader:_t.linedashed_frag},depth:{uniforms:kn([tt.common,tt.displacementmap]),vertexShader:_t.depth_vert,fragmentShader:_t.depth_frag},normal:{uniforms:kn([tt.common,tt.bumpmap,tt.normalmap,tt.displacementmap,{opacity:{value:1}}]),vertexShader:_t.meshnormal_vert,fragmentShader:_t.meshnormal_frag},sprite:{uniforms:kn([tt.sprite,tt.fog]),vertexShader:_t.sprite_vert,fragmentShader:_t.sprite_frag},background:{uniforms:{uvTransform:{value:new yt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:_t.background_vert,fragmentShader:_t.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new yt}},vertexShader:_t.backgroundCube_vert,fragmentShader:_t.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:_t.cube_vert,fragmentShader:_t.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_t.equirect_vert,fragmentShader:_t.equirect_frag},distanceRGBA:{uniforms:kn([tt.common,tt.displacementmap,{referencePosition:{value:new ae},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_t.distanceRGBA_vert,fragmentShader:_t.distanceRGBA_frag},shadow:{uniforms:kn([tt.lights,tt.fog,{color:{value:new pt(0)},opacity:{value:1}}]),vertexShader:_t.shadow_vert,fragmentShader:_t.shadow_frag}};$r.physical={uniforms:kn([$r.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new yt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new yt},clearcoatNormalScale:{value:new gt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new yt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new yt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new yt},sheen:{value:0},sheenColor:{value:new pt(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new yt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new yt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new yt},transmissionSamplerSize:{value:new gt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new yt},attenuationDistance:{value:0},attenuationColor:{value:new pt(0)},specularColor:{value:new pt(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new yt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new yt},anisotropyVector:{value:new gt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new yt}}]),vertexShader:_t.meshphysical_vert,fragmentShader:_t.meshphysical_frag};const iu={r:0,b:0,g:0},Uo=new Zr,Ok=new kt;function Uk(n,e,t,r,i,o,s){const a=new pt(0);let l=o===!0?0:1,c,u,d=null,f=0,m=null;function v(g){let y=g.isScene===!0?g.background:null;return y&&y.isTexture&&(y=(g.backgroundBlurriness>0?t:e).get(y)),y}function _(g){let y=!1;const E=v(g);E===null?p(a,l):E&&E.isColor&&(p(E,1),y=!0);const C=n.xr.getEnvironmentBlendMode();C==="additive"?r.buffers.color.setClear(0,0,0,1,s):C==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,s),(n.autoClear||y)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function x(g,y){const E=v(y);E&&(E.isCubeTexture||E.mapping===zd)?(u===void 0&&(u=new bn(new pc(1,1,1),new Eo({name:"BackgroundCubeMaterial",uniforms:Pa($r.backgroundCube.uniforms),vertexShader:$r.backgroundCube.vertexShader,fragmentShader:$r.backgroundCube.fragmentShader,side:Kn,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(C,A,T){this.matrixWorld.copyPosition(T.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(u)),Uo.copy(y.backgroundRotation),Uo.x*=-1,Uo.y*=-1,Uo.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Uo.y*=-1,Uo.z*=-1),u.material.uniforms.envMap.value=E,u.material.uniforms.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,u.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,u.material.uniforms.backgroundRotation.value.setFromMatrix4(Ok.makeRotationFromEuler(Uo)),u.material.toneMapped=Pt.getTransfer(E.colorSpace)!==Lt,(d!==E||f!==E.version||m!==n.toneMapping)&&(u.material.needsUpdate=!0,d=E,f=E.version,m=n.toneMapping),u.layers.enableAll(),g.unshift(u,u.geometry,u.material,0,0,null)):E&&E.isTexture&&(c===void 0&&(c=new bn(new Fd(2,2),new Eo({name:"BackgroundMaterial",uniforms:Pa($r.background.uniforms),vertexShader:$r.background.vertexShader,fragmentShader:$r.background.fragmentShader,side:wo,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(c)),c.material.uniforms.t2D.value=E,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,c.material.toneMapped=Pt.getTransfer(E.colorSpace)!==Lt,E.matrixAutoUpdate===!0&&E.updateMatrix(),c.material.uniforms.uvTransform.value.copy(E.matrix),(d!==E||f!==E.version||m!==n.toneMapping)&&(c.material.needsUpdate=!0,d=E,f=E.version,m=n.toneMapping),c.layers.enableAll(),g.unshift(c,c.geometry,c.material,0,0,null))}function p(g,y){g.getRGB(iu,zS(n)),r.buffers.color.setClear(iu.r,iu.g,iu.b,y,s)}function b(){u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0),c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0)}return{getClearColor:function(){return a},setClearColor:function(g,y=1){a.set(g),l=y,p(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(g){l=g,p(a,l)},render:_,addToRenderList:x,dispose:b}}function zk(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=f(null);let o=i,s=!1;function a(M,P,I,D,$){let W=!1;const H=d(D,I,P);o!==H&&(o=H,c(o.object)),W=m(M,D,I,$),W&&v(M,D,I,$),$!==null&&e.update($,n.ELEMENT_ARRAY_BUFFER),(W||s)&&(s=!1,y(M,P,I,D),$!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get($).buffer))}function l(){return n.createVertexArray()}function c(M){return n.bindVertexArray(M)}function u(M){return n.deleteVertexArray(M)}function d(M,P,I){const D=I.wireframe===!0;let $=r[M.id];$===void 0&&($={},r[M.id]=$);let W=$[P.id];W===void 0&&(W={},$[P.id]=W);let H=W[D];return H===void 0&&(H=f(l()),W[D]=H),H}function f(M){const P=[],I=[],D=[];for(let $=0;$<t;$++)P[$]=0,I[$]=0,D[$]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:P,enabledAttributes:I,attributeDivisors:D,object:M,attributes:{},index:null}}function m(M,P,I,D){const $=o.attributes,W=P.attributes;let H=0;const Z=I.getAttributes();for(const F in Z)if(Z[F].location>=0){const X=$[F];let oe=W[F];if(oe===void 0&&(F==="instanceMatrix"&&M.instanceMatrix&&(oe=M.instanceMatrix),F==="instanceColor"&&M.instanceColor&&(oe=M.instanceColor)),X===void 0||X.attribute!==oe||oe&&X.data!==oe.data)return!0;H++}return o.attributesNum!==H||o.index!==D}function v(M,P,I,D){const $={},W=P.attributes;let H=0;const Z=I.getAttributes();for(const F in Z)if(Z[F].location>=0){let X=W[F];X===void 0&&(F==="instanceMatrix"&&M.instanceMatrix&&(X=M.instanceMatrix),F==="instanceColor"&&M.instanceColor&&(X=M.instanceColor));const oe={};oe.attribute=X,X&&X.data&&(oe.data=X.data),$[F]=oe,H++}o.attributes=$,o.attributesNum=H,o.index=D}function _(){const M=o.newAttributes;for(let P=0,I=M.length;P<I;P++)M[P]=0}function x(M){p(M,0)}function p(M,P){const I=o.newAttributes,D=o.enabledAttributes,$=o.attributeDivisors;I[M]=1,D[M]===0&&(n.enableVertexAttribArray(M),D[M]=1),$[M]!==P&&(n.vertexAttribDivisor(M,P),$[M]=P)}function b(){const M=o.newAttributes,P=o.enabledAttributes;for(let I=0,D=P.length;I<D;I++)P[I]!==M[I]&&(n.disableVertexAttribArray(I),P[I]=0)}function g(M,P,I,D,$,W,H){H===!0?n.vertexAttribIPointer(M,P,I,$,W):n.vertexAttribPointer(M,P,I,D,$,W)}function y(M,P,I,D){_();const $=D.attributes,W=I.getAttributes(),H=P.defaultAttributeValues;for(const Z in W){const F=W[Z];if(F.location>=0){let Y=$[Z];if(Y===void 0&&(Z==="instanceMatrix"&&M.instanceMatrix&&(Y=M.instanceMatrix),Z==="instanceColor"&&M.instanceColor&&(Y=M.instanceColor)),Y!==void 0){const X=Y.normalized,oe=Y.itemSize,pe=e.get(Y);if(pe===void 0)continue;const De=pe.buffer,z=pe.type,ve=pe.bytesPerElement,j=z===n.INT||z===n.UNSIGNED_INT||Y.gpuType===Mg;if(Y.isInterleavedBufferAttribute){const ne=Y.data,Ee=ne.stride,me=Y.offset;if(ne.isInstancedInterleavedBuffer){for(let te=0;te<F.locationSize;te++)p(F.location+te,ne.meshPerAttribute);M.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=ne.meshPerAttribute*ne.count)}else for(let te=0;te<F.locationSize;te++)x(F.location+te);n.bindBuffer(n.ARRAY_BUFFER,De);for(let te=0;te<F.locationSize;te++)g(F.location+te,oe/F.locationSize,z,X,Ee*ve,(me+oe/F.locationSize*te)*ve,j)}else{if(Y.isInstancedBufferAttribute){for(let ne=0;ne<F.locationSize;ne++)p(F.location+ne,Y.meshPerAttribute);M.isInstancedMesh!==!0&&D._maxInstanceCount===void 0&&(D._maxInstanceCount=Y.meshPerAttribute*Y.count)}else for(let ne=0;ne<F.locationSize;ne++)x(F.location+ne);n.bindBuffer(n.ARRAY_BUFFER,De);for(let ne=0;ne<F.locationSize;ne++)g(F.location+ne,oe/F.locationSize,z,X,oe*ve,oe/F.locationSize*ne*ve,j)}}else if(H!==void 0){const X=H[Z];if(X!==void 0)switch(X.length){case 2:n.vertexAttrib2fv(F.location,X);break;case 3:n.vertexAttrib3fv(F.location,X);break;case 4:n.vertexAttrib4fv(F.location,X);break;default:n.vertexAttrib1fv(F.location,X)}}}}b()}function E(){T();for(const M in r){const P=r[M];for(const I in P){const D=P[I];for(const $ in D)u(D[$].object),delete D[$];delete P[I]}delete r[M]}}function C(M){if(r[M.id]===void 0)return;const P=r[M.id];for(const I in P){const D=P[I];for(const $ in D)u(D[$].object),delete D[$];delete P[I]}delete r[M.id]}function A(M){for(const P in r){const I=r[P];if(I[M.id]===void 0)continue;const D=I[M.id];for(const $ in D)u(D[$].object),delete D[$];delete I[M.id]}}function T(){w(),s=!0,o!==i&&(o=i,c(o.object))}function w(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:a,reset:T,resetDefaultState:w,dispose:E,releaseStatesOfGeometry:C,releaseStatesOfProgram:A,initAttributes:_,enableAttribute:x,disableUnusedAttributes:b}}function Fk(n,e,t){let r;function i(c){r=c}function o(c,u){n.drawArrays(r,c,u),t.update(u,r,1)}function s(c,u,d){d!==0&&(n.drawArraysInstanced(r,c,u,d),t.update(u,r,d))}function a(c,u,d){if(d===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,c,0,u,0,d);let m=0;for(let v=0;v<d;v++)m+=u[v];t.update(m,r,1)}function l(c,u,d,f){if(d===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let v=0;v<c.length;v++)s(c[v],u[v],f[v]);else{m.multiDrawArraysInstancedWEBGL(r,c,0,u,0,f,0,d);let v=0;for(let _=0;_<d;_++)v+=u[_]*f[_];t.update(v,r,1)}}this.setMode=i,this.render=o,this.renderInstances=s,this.renderMultiDraw=a,this.renderMultiDrawInstances=l}function jk(n,e,t,r){let i;function o(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function s(A){return!(A!==Lr&&r.convert(A)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function a(A){const T=A===Ei&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(A!==Kr&&r.convert(A)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&A!==Gn&&!T)}function l(A){if(A==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let c=t.precision!==void 0?t.precision:"highp";const u=l(c);u!==c&&(console.warn("THREE.WebGLRenderer:",c,"not supported, using",u,"instead."),c=u);const d=t.logarithmicDepthBuffer===!0,f=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),m=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),v=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),_=n.getParameter(n.MAX_TEXTURE_SIZE),x=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),p=n.getParameter(n.MAX_VERTEX_ATTRIBS),b=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),g=n.getParameter(n.MAX_VARYING_VECTORS),y=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),E=v>0,C=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:l,textureFormatReadable:s,textureTypeReadable:a,precision:c,logarithmicDepthBuffer:d,reversedDepthBuffer:f,maxTextures:m,maxVertexTextures:v,maxTextureSize:_,maxCubemapSize:x,maxAttributes:p,maxVertexUniforms:b,maxVaryings:g,maxFragmentUniforms:y,vertexTextures:E,maxSamples:C}}function Bk(n){const e=this;let t=null,r=0,i=!1,o=!1;const s=new Zi,a=new yt,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,f){const m=d.length!==0||f||r!==0||i;return i=f,r=d.length,m},this.beginShadows=function(){o=!0,u(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(d,f){t=u(d,f,0)},this.setState=function(d,f,m){const v=d.clippingPlanes,_=d.clipIntersection,x=d.clipShadows,p=n.get(d);if(!i||v===null||v.length===0||o&&!x)o?u(null):c();else{const b=o?0:r,g=b*4;let y=p.clippingState||null;l.value=y,y=u(v,f,g,m);for(let E=0;E!==g;++E)y[E]=t[E];p.clippingState=y,this.numIntersection=_?this.numPlanes:0,this.numPlanes+=b}};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(d,f,m,v){const _=d!==null?d.length:0;let x=null;if(_!==0){if(x=l.value,v!==!0||x===null){const p=m+_*4,b=f.matrixWorldInverse;a.getNormalMatrix(b),(x===null||x.length<p)&&(x=new Float32Array(p));for(let g=0,y=m;g!==_;++g,y+=4)s.copy(d[g]).applyMatrix4(b,a),s.normal.toArray(x,y),x[y+3]=s.constant}l.value=x,l.needsUpdate=!0}return e.numPlanes=_,e.numIntersection=0,x}}function Hk(n){let e=new WeakMap;function t(s,a){return a===Op?s.mapping=Ra:a===Up&&(s.mapping=Aa),s}function r(s){if(s&&s.isTexture){const a=s.mapping;if(a===Op||a===Up)if(e.has(s)){const l=e.get(s).texture;return t(l,s.mapping)}else{const l=s.image;if(l&&l.height>0){const c=new zR(l.height);return c.fromEquirectangularTexture(n,s),e.set(s,c),s.addEventListener("dispose",i),t(c.texture,s.mapping)}else return null}}return s}function i(s){const a=s.target;a.removeEventListener("dispose",i);const l=e.get(a);l!==void 0&&(e.delete(a),l.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}const oa=4,hx=[.125,.215,.35,.446,.526,.582],Yo=20,Zh=new GS,fx=new pt;let Qh=null,ef=0,tf=0,nf=!1;const Vo=(1+Math.sqrt(5))/2,js=1/Vo,px=[new ae(-Vo,js,0),new ae(Vo,js,0),new ae(-js,0,Vo),new ae(js,0,Vo),new ae(0,Vo,-js),new ae(0,Vo,js),new ae(-1,1,-1),new ae(1,1,-1),new ae(-1,1,1),new ae(1,1,1)],Wk=new ae;class vm{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100,o={}){const{size:s=256,position:a=Wk}=o;Qh=this._renderer.getRenderTarget(),ef=this._renderer.getActiveCubeFace(),tf=this._renderer.getActiveMipmapLevel(),nf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(s);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,r,i,l,a),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=vx(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=gx(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Qh,ef,tf),this._renderer.xr.enabled=nf,e.scissorTest=!1,ou(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Ra||e.mapping===Aa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Qh=this._renderer.getRenderTarget(),ef=this._renderer.getActiveCubeFace(),tf=this._renderer.getActiveMipmapLevel(),nf=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:Dn,minFilter:Dn,generateMipmaps:!1,type:Ei,format:Lr,colorSpace:us,depthBuffer:!1},i=mx(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=mx(e,t,r);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=Vk(o)),this._blurMaterial=$k(o,e,t)}return i}_compileMaterial(e){const t=new bn(this._lodPlanes[0],e);this._renderer.compile(t,Zh)}_sceneToCubeUV(e,t,r,i,o){const l=new or(90,1,t,r),c=[1,-1,1,1,1,1],u=[1,1,1,-1,-1,-1],d=this._renderer,f=d.autoClear,m=d.toneMapping;d.getClearColor(fx),d.toneMapping=vo,d.autoClear=!1,d.state.buffers.depth.getReversed()&&(d.setRenderTarget(i),d.clearDepth(),d.setRenderTarget(null));const _=new NS({name:"PMREM.Background",side:Kn,depthWrite:!1,depthTest:!1}),x=new bn(new pc,_);let p=!1;const b=e.background;b?b.isColor&&(_.color.copy(b),e.background=null,p=!0):(_.color.copy(fx),p=!0);for(let g=0;g<6;g++){const y=g%3;y===0?(l.up.set(0,c[g],0),l.position.set(o.x,o.y,o.z),l.lookAt(o.x+u[g],o.y,o.z)):y===1?(l.up.set(0,0,c[g]),l.position.set(o.x,o.y,o.z),l.lookAt(o.x,o.y+u[g],o.z)):(l.up.set(0,c[g],0),l.position.set(o.x,o.y,o.z),l.lookAt(o.x,o.y,o.z+u[g]));const E=this._cubeSize;ou(i,y*E,g>2?E:0,E,E),d.setRenderTarget(i),p&&d.render(x,l),d.render(e,l)}x.geometry.dispose(),x.material.dispose(),d.toneMapping=m,d.autoClear=f,e.background=b}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===Ra||e.mapping===Aa;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=vx()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=gx());const o=i?this._cubemapMaterial:this._equirectMaterial,s=new bn(this._lodPlanes[0],o),a=o.uniforms;a.envMap.value=e;const l=this._cubeSize;ou(t,0,0,3*l,2*l),r.setRenderTarget(t),r.render(s,Zh)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let o=1;o<i;o++){const s=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),a=px[(i-o-1)%px.length];this._blur(e,o-1,o,s,a)}t.autoClear=r}_blur(e,t,r,i,o){const s=this._pingPongRenderTarget;this._halfBlur(e,s,t,r,i,"latitudinal",o),this._halfBlur(s,e,r,r,i,"longitudinal",o)}_halfBlur(e,t,r,i,o,s,a){const l=this._renderer,c=this._blurMaterial;s!=="latitudinal"&&s!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,d=new bn(this._lodPlanes[i],c),f=c.uniforms,m=this._sizeLods[r]-1,v=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*Yo-1),_=o/v,x=isFinite(o)?1+Math.floor(u*_):Yo;x>Yo&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${x} samples when the maximum is set to ${Yo}`);const p=[];let b=0;for(let A=0;A<Yo;++A){const T=A/_,w=Math.exp(-T*T/2);p.push(w),A===0?b+=w:A<x&&(b+=2*w)}for(let A=0;A<p.length;A++)p[A]=p[A]/b;f.envMap.value=e.texture,f.samples.value=x,f.weights.value=p,f.latitudinal.value=s==="latitudinal",a&&(f.poleAxis.value=a);const{_lodMax:g}=this;f.dTheta.value=v,f.mipInt.value=g-r;const y=this._sizeLods[i],E=3*y*(i>g-oa?i-g+oa:0),C=4*(this._cubeSize-y);ou(t,E,C,3*y,2*y),l.setRenderTarget(t),l.render(d,Zh)}}function Vk(n){const e=[],t=[],r=[];let i=n;const o=n-oa+1+hx.length;for(let s=0;s<o;s++){const a=Math.pow(2,i);t.push(a);let l=1/a;s>n-oa?l=hx[s-n+oa-1]:s===0&&(l=0),r.push(l);const c=1/(a-2),u=-c,d=1+c,f=[u,u,d,u,d,d,u,u,d,d,u,d],m=6,v=6,_=3,x=2,p=1,b=new Float32Array(_*v*m),g=new Float32Array(x*v*m),y=new Float32Array(p*v*m);for(let C=0;C<m;C++){const A=C%3*2/3-1,T=C>2?0:-1,w=[A,T,0,A+2/3,T,0,A+2/3,T+1,0,A,T,0,A+2/3,T+1,0,A,T+1,0];b.set(w,_*v*C),g.set(f,x*v*C);const M=[C,C,C,C,C,C];y.set(M,p*v*C)}const E=new Ni;E.setAttribute("position",new Or(b,_)),E.setAttribute("uv",new Or(g,x)),E.setAttribute("faceIndex",new Or(y,p)),e.push(E),i>oa&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function mx(n,e,t){const r=new ds(n,e,t);return r.texture.mapping=zd,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function ou(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function $k(n,e,t){const r=new Float32Array(Yo),i=new ae(0,1,0);return new Eo({name:"SphericalGaussianBlur",defines:{n:Yo,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Fg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:go,depthTest:!1,depthWrite:!1})}function gx(){return new Eo({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Fg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:go,depthTest:!1,depthWrite:!1})}function vx(){return new Eo({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Fg(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:go,depthTest:!1,depthWrite:!1})}function Fg(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Gk(n){let e=new WeakMap,t=null;function r(a){if(a&&a.isTexture){const l=a.mapping,c=l===Op||l===Up,u=l===Ra||l===Aa;if(c||u){let d=e.get(a);const f=d!==void 0?d.texture.pmremVersion:0;if(a.isRenderTargetTexture&&a.pmremVersion!==f)return t===null&&(t=new vm(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),d.texture;if(d!==void 0)return d.texture;{const m=a.image;return c&&m&&m.height>0||u&&m&&i(m)?(t===null&&(t=new vm(n)),d=c?t.fromEquirectangular(a):t.fromCubemap(a),d.texture.pmremVersion=a.pmremVersion,e.set(a,d),a.addEventListener("dispose",o),d.texture):null}}}return a}function i(a){let l=0;const c=6;for(let u=0;u<c;u++)a[u]!==void 0&&l++;return l===c}function o(a){const l=a.target;l.removeEventListener("dispose",o);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:s}}function Xk(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&Zl("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function Yk(n,e,t,r){const i={},o=new WeakMap;function s(d){const f=d.target;f.index!==null&&e.remove(f.index);for(const v in f.attributes)e.remove(f.attributes[v]);f.removeEventListener("dispose",s),delete i[f.id];const m=o.get(f);m&&(e.remove(m),o.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function a(d,f){return i[f.id]===!0||(f.addEventListener("dispose",s),i[f.id]=!0,t.memory.geometries++),f}function l(d){const f=d.attributes;for(const m in f)e.update(f[m],n.ARRAY_BUFFER)}function c(d){const f=[],m=d.index,v=d.attributes.position;let _=0;if(m!==null){const b=m.array;_=m.version;for(let g=0,y=b.length;g<y;g+=3){const E=b[g+0],C=b[g+1],A=b[g+2];f.push(E,C,C,A,A,E)}}else if(v!==void 0){const b=v.array;_=v.version;for(let g=0,y=b.length/3-1;g<y;g+=3){const E=g+0,C=g+1,A=g+2;f.push(E,C,C,A,A,E)}}else return;const x=new(IS(f)?US:OS)(f,1);x.version=_;const p=o.get(d);p&&e.remove(p),o.set(d,x)}function u(d){const f=o.get(d);if(f){const m=d.index;m!==null&&f.version<m.version&&c(d)}else c(d);return o.get(d)}return{get:a,update:l,getWireframeAttribute:u}}function qk(n,e,t){let r;function i(f){r=f}let o,s;function a(f){o=f.type,s=f.bytesPerElement}function l(f,m){n.drawElements(r,m,o,f*s),t.update(m,r,1)}function c(f,m,v){v!==0&&(n.drawElementsInstanced(r,m,o,f*s,v),t.update(m,r,v))}function u(f,m,v){if(v===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,m,0,o,f,0,v);let x=0;for(let p=0;p<v;p++)x+=m[p];t.update(x,r,1)}function d(f,m,v,_){if(v===0)return;const x=e.get("WEBGL_multi_draw");if(x===null)for(let p=0;p<f.length;p++)c(f[p]/s,m[p],_[p]);else{x.multiDrawElementsInstancedWEBGL(r,m,0,o,f,0,_,0,v);let p=0;for(let b=0;b<v;b++)p+=m[b]*_[b];t.update(p,r,1)}}this.setMode=i,this.setIndex=a,this.render=l,this.renderInstances=c,this.renderMultiDraw=u,this.renderMultiDrawInstances=d}function Kk(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,s,a){switch(t.calls++,s){case n.TRIANGLES:t.triangles+=a*(o/3);break;case n.LINES:t.lines+=a*(o/2);break;case n.LINE_STRIP:t.lines+=a*(o-1);break;case n.LINE_LOOP:t.lines+=a*o;break;case n.POINTS:t.points+=a*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",s);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function Jk(n,e,t){const r=new WeakMap,i=new Jt;function o(s,a,l){const c=s.morphTargetInfluences,u=a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color,d=u!==void 0?u.length:0;let f=r.get(a);if(f===void 0||f.count!==d){let M=function(){T.dispose(),r.delete(a),a.removeEventListener("dispose",M)};var m=M;f!==void 0&&f.texture.dispose();const v=a.morphAttributes.position!==void 0,_=a.morphAttributes.normal!==void 0,x=a.morphAttributes.color!==void 0,p=a.morphAttributes.position||[],b=a.morphAttributes.normal||[],g=a.morphAttributes.color||[];let y=0;v===!0&&(y=1),_===!0&&(y=2),x===!0&&(y=3);let E=a.attributes.position.count*y,C=1;E>e.maxTextureSize&&(C=Math.ceil(E/e.maxTextureSize),E=e.maxTextureSize);const A=new Float32Array(E*C*4*d),T=new LS(A,E,C,d);T.type=Gn,T.needsUpdate=!0;const w=y*4;for(let P=0;P<d;P++){const I=p[P],D=b[P],$=g[P],W=E*C*4*P;for(let H=0;H<I.count;H++){const Z=H*w;v===!0&&(i.fromBufferAttribute(I,H),A[W+Z+0]=i.x,A[W+Z+1]=i.y,A[W+Z+2]=i.z,A[W+Z+3]=0),_===!0&&(i.fromBufferAttribute(D,H),A[W+Z+4]=i.x,A[W+Z+5]=i.y,A[W+Z+6]=i.z,A[W+Z+7]=0),x===!0&&(i.fromBufferAttribute($,H),A[W+Z+8]=i.x,A[W+Z+9]=i.y,A[W+Z+10]=i.z,A[W+Z+11]=$.itemSize===4?i.w:1)}}f={count:d,texture:T,size:new gt(E,C)},r.set(a,f),a.addEventListener("dispose",M)}if(s.isInstancedMesh===!0&&s.morphTexture!==null)l.getUniforms().setValue(n,"morphTexture",s.morphTexture,t);else{let v=0;for(let x=0;x<c.length;x++)v+=c[x];const _=a.morphTargetsRelative?1:1-v;l.getUniforms().setValue(n,"morphTargetBaseInfluence",_),l.getUniforms().setValue(n,"morphTargetInfluences",c)}l.getUniforms().setValue(n,"morphTargetsTexture",f.texture,t),l.getUniforms().setValue(n,"morphTargetsTextureSize",f.size)}return{update:o}}function Zk(n,e,t,r){let i=new WeakMap;function o(l){const c=r.render.frame,u=l.geometry,d=e.get(l,u);if(i.get(d)!==c&&(e.update(d),i.set(d,c)),l.isInstancedMesh&&(l.hasEventListener("dispose",a)===!1&&l.addEventListener("dispose",a),i.get(l)!==c&&(t.update(l.instanceMatrix,n.ARRAY_BUFFER),l.instanceColor!==null&&t.update(l.instanceColor,n.ARRAY_BUFFER),i.set(l,c))),l.isSkinnedMesh){const f=l.skeleton;i.get(f)!==c&&(f.update(),i.set(f,c))}return d}function s(){i=new WeakMap}function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),c.instanceColor!==null&&t.remove(c.instanceColor)}return{update:o,dispose:s}}const KS=new On,xx=new WS(1,1),JS=new LS,ZS=new xR,QS=new jS,yx=[],_x=[],bx=new Float32Array(16),Sx=new Float32Array(9),wx=new Float32Array(4);function ja(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let o=yx[i];if(o===void 0&&(o=new Float32Array(i),yx[i]=o),e!==0){r.toArray(o,0);for(let s=1,a=0;s!==e;++s)a+=t,n[s].toArray(o,a)}return o}function un(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function dn(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function jd(n,e){let t=_x[e];t===void 0&&(t=new Int32Array(e),_x[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function Qk(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function eI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(un(t,e))return;n.uniform2fv(this.addr,e),dn(t,e)}}function tI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(un(t,e))return;n.uniform3fv(this.addr,e),dn(t,e)}}function nI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(un(t,e))return;n.uniform4fv(this.addr,e),dn(t,e)}}function rI(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(un(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),dn(t,e)}else{if(un(t,r))return;wx.set(r),n.uniformMatrix2fv(this.addr,!1,wx),dn(t,r)}}function iI(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(un(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),dn(t,e)}else{if(un(t,r))return;Sx.set(r),n.uniformMatrix3fv(this.addr,!1,Sx),dn(t,r)}}function oI(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(un(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),dn(t,e)}else{if(un(t,r))return;bx.set(r),n.uniformMatrix4fv(this.addr,!1,bx),dn(t,r)}}function sI(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function aI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(un(t,e))return;n.uniform2iv(this.addr,e),dn(t,e)}}function lI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(un(t,e))return;n.uniform3iv(this.addr,e),dn(t,e)}}function cI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(un(t,e))return;n.uniform4iv(this.addr,e),dn(t,e)}}function uI(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function dI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(un(t,e))return;n.uniform2uiv(this.addr,e),dn(t,e)}}function hI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(un(t,e))return;n.uniform3uiv(this.addr,e),dn(t,e)}}function fI(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(un(t,e))return;n.uniform4uiv(this.addr,e),dn(t,e)}}function pI(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let o;this.type===n.SAMPLER_2D_SHADOW?(xx.compareFunction=kS,o=xx):o=KS,t.setTexture2D(e||o,i)}function mI(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||ZS,i)}function gI(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||QS,i)}function vI(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||JS,i)}function xI(n){switch(n){case 5126:return Qk;case 35664:return eI;case 35665:return tI;case 35666:return nI;case 35674:return rI;case 35675:return iI;case 35676:return oI;case 5124:case 35670:return sI;case 35667:case 35671:return aI;case 35668:case 35672:return lI;case 35669:case 35673:return cI;case 5125:return uI;case 36294:return dI;case 36295:return hI;case 36296:return fI;case 35678:case 36198:case 36298:case 36306:case 35682:return pI;case 35679:case 36299:case 36307:return mI;case 35680:case 36300:case 36308:case 36293:return gI;case 36289:case 36303:case 36311:case 36292:return vI}}function yI(n,e){n.uniform1fv(this.addr,e)}function _I(n,e){const t=ja(e,this.size,2);n.uniform2fv(this.addr,t)}function bI(n,e){const t=ja(e,this.size,3);n.uniform3fv(this.addr,t)}function SI(n,e){const t=ja(e,this.size,4);n.uniform4fv(this.addr,t)}function wI(n,e){const t=ja(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function EI(n,e){const t=ja(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function MI(n,e){const t=ja(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function TI(n,e){n.uniform1iv(this.addr,e)}function CI(n,e){n.uniform2iv(this.addr,e)}function RI(n,e){n.uniform3iv(this.addr,e)}function AI(n,e){n.uniform4iv(this.addr,e)}function PI(n,e){n.uniform1uiv(this.addr,e)}function kI(n,e){n.uniform2uiv(this.addr,e)}function II(n,e){n.uniform3uiv(this.addr,e)}function LI(n,e){n.uniform4uiv(this.addr,e)}function DI(n,e,t){const r=this.cache,i=e.length,o=jd(t,i);un(r,o)||(n.uniform1iv(this.addr,o),dn(r,o));for(let s=0;s!==i;++s)t.setTexture2D(e[s]||KS,o[s])}function NI(n,e,t){const r=this.cache,i=e.length,o=jd(t,i);un(r,o)||(n.uniform1iv(this.addr,o),dn(r,o));for(let s=0;s!==i;++s)t.setTexture3D(e[s]||ZS,o[s])}function OI(n,e,t){const r=this.cache,i=e.length,o=jd(t,i);un(r,o)||(n.uniform1iv(this.addr,o),dn(r,o));for(let s=0;s!==i;++s)t.setTextureCube(e[s]||QS,o[s])}function UI(n,e,t){const r=this.cache,i=e.length,o=jd(t,i);un(r,o)||(n.uniform1iv(this.addr,o),dn(r,o));for(let s=0;s!==i;++s)t.setTexture2DArray(e[s]||JS,o[s])}function zI(n){switch(n){case 5126:return yI;case 35664:return _I;case 35665:return bI;case 35666:return SI;case 35674:return wI;case 35675:return EI;case 35676:return MI;case 5124:case 35670:return TI;case 35667:case 35671:return CI;case 35668:case 35672:return RI;case 35669:case 35673:return AI;case 5125:return PI;case 36294:return kI;case 36295:return II;case 36296:return LI;case 35678:case 36198:case 36298:case 36306:case 35682:return DI;case 35679:case 36299:case 36307:return NI;case 35680:case 36300:case 36308:case 36293:return OI;case 36289:case 36303:case 36311:case 36292:return UI}}class FI{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=xI(t.type)}}class jI{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=zI(t.type)}}class BI{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let o=0,s=i.length;o!==s;++o){const a=i[o];a.setValue(e,t[a.id],r)}}}const rf=/(\w+)(\])?(\[|\.)?/g;function Ex(n,e){n.seq.push(e),n.map[e.id]=e}function HI(n,e,t){const r=n.name,i=r.length;for(rf.lastIndex=0;;){const o=rf.exec(r),s=rf.lastIndex;let a=o[1];const l=o[2]==="]",c=o[3];if(l&&(a=a|0),c===void 0||c==="["&&s+2===i){Ex(t,c===void 0?new FI(a,n,e):new jI(a,n,e));break}else{let d=t.map[a];d===void 0&&(d=new BI(a),Ex(t,d)),t=d}}}class ku{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const o=e.getActiveUniform(t,i),s=e.getUniformLocation(t,o.name);HI(o,s,this)}}setValue(e,t,r,i){const o=this.map[t];o!==void 0&&o.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let o=0,s=t.length;o!==s;++o){const a=t[o],l=r[a.id];l.needsUpdate!==!1&&a.setValue(e,l.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,o=e.length;i!==o;++i){const s=e[i];s.id in t&&r.push(s)}return r}}function Mx(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const WI=37297;let VI=0;function $I(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let s=i;s<o;s++){const a=s+1;r.push(`${a===e?">":" "} ${a}: ${t[s]}`)}return r.join(`
`)}const Tx=new yt;function GI(n){Pt._getMatrix(Tx,Pt.workingColorSpace,n);const e=`mat3( ${Tx.elements.map(t=>t.toFixed(4))} )`;switch(Pt.getTransfer(n)){case cd:return[e,"LinearTransferOETF"];case Lt:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function Cx(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),o=(n.getShaderInfoLog(e)||"").trim();if(r&&o==="")return"";const s=/ERROR: 0:(\d+)/.exec(o);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+o+`

`+$I(n.getShaderSource(e),a)}else return o}function XI(n,e){const t=GI(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function YI(n,e){let t;switch(e){case $5:t="Linear";break;case G5:t="Reinhard";break;case X5:t="Cineon";break;case bS:t="ACESFilmic";break;case q5:t="AgX";break;case K5:t="Neutral";break;case Y5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const su=new ae;function qI(){Pt.getLuminanceCoefficients(su);const n=su.x.toFixed(4),e=su.y.toFixed(4),t=su.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function KI(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(hl).join(`
`)}function JI(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function ZI(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const o=n.getActiveAttrib(e,i),s=o.name;let a=1;o.type===n.FLOAT_MAT2&&(a=2),o.type===n.FLOAT_MAT3&&(a=3),o.type===n.FLOAT_MAT4&&(a=4),t[s]={type:o.type,location:n.getAttribLocation(e,s),locationSize:a}}return t}function hl(n){return n!==""}function Rx(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Ax(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const QI=/^[ \t]*#include +<([\w\d./]+)>/gm;function xm(n){return n.replace(QI,tL)}const eL=new Map;function tL(n,e){let t=_t[e];if(t===void 0){const r=eL.get(e);if(r!==void 0)t=_t[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return xm(t)}const nL=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Px(n){return n.replace(nL,rL)}function rL(n,e,t,r){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function kx(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function iL(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===xS?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===yS?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===pi&&(e="SHADOWMAP_TYPE_VSM"),e}function oL(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Ra:case Aa:e="ENVMAP_TYPE_CUBE";break;case zd:e="ENVMAP_TYPE_CUBE_UV";break}return e}function sL(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Aa:e="ENVMAP_MODE_REFRACTION";break}return e}function aL(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case _S:e="ENVMAP_BLENDING_MULTIPLY";break;case W5:e="ENVMAP_BLENDING_MIX";break;case V5:e="ENVMAP_BLENDING_ADD";break}return e}function lL(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function cL(n,e,t,r){const i=n.getContext(),o=t.defines;let s=t.vertexShader,a=t.fragmentShader;const l=iL(t),c=oL(t),u=sL(t),d=aL(t),f=lL(t),m=KI(t),v=JI(o),_=i.createProgram();let x,p,b=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(x=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(hl).join(`
`),x.length>0&&(x+=`
`),p=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v].filter(hl).join(`
`),p.length>0&&(p+=`
`)):(x=[kx(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(hl).join(`
`),p=[kx(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,v,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==vo?"#define TONE_MAPPING":"",t.toneMapping!==vo?_t.tonemapping_pars_fragment:"",t.toneMapping!==vo?YI("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",_t.colorspace_pars_fragment,XI("linearToOutputTexel",t.outputColorSpace),qI(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(hl).join(`
`)),s=xm(s),s=Rx(s,t),s=Ax(s,t),a=xm(a),a=Rx(a,t),a=Ax(a,t),s=Px(s),a=Px(a),t.isRawShaderMaterial!==!0&&(b=`#version 300 es
`,x=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+x,p=["#define varying in",t.glslVersion===Fv?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===Fv?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+p);const g=b+x+s,y=b+p+a,E=Mx(i,i.VERTEX_SHADER,g),C=Mx(i,i.FRAGMENT_SHADER,y);i.attachShader(_,E),i.attachShader(_,C),t.index0AttributeName!==void 0?i.bindAttribLocation(_,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(_,0,"position"),i.linkProgram(_);function A(P){if(n.debug.checkShaderErrors){const I=i.getProgramInfoLog(_)||"",D=i.getShaderInfoLog(E)||"",$=i.getShaderInfoLog(C)||"",W=I.trim(),H=D.trim(),Z=$.trim();let F=!0,Y=!0;if(i.getProgramParameter(_,i.LINK_STATUS)===!1)if(F=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,_,E,C);else{const X=Cx(i,E,"vertex"),oe=Cx(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(_,i.VALIDATE_STATUS)+`

Material Name: `+P.name+`
Material Type: `+P.type+`

Program Info Log: `+W+`
`+X+`
`+oe)}else W!==""?console.warn("THREE.WebGLProgram: Program Info Log:",W):(H===""||Z==="")&&(Y=!1);Y&&(P.diagnostics={runnable:F,programLog:W,vertexShader:{log:H,prefix:x},fragmentShader:{log:Z,prefix:p}})}i.deleteShader(E),i.deleteShader(C),T=new ku(i,_),w=ZI(i,_)}let T;this.getUniforms=function(){return T===void 0&&A(this),T};let w;this.getAttributes=function(){return w===void 0&&A(this),w};let M=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return M===!1&&(M=i.getProgramParameter(_,WI)),M},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(_),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=VI++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=E,this.fragmentShader=C,this}let uL=0;class dL{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(r),s=this._getShaderCacheForMaterial(e);return s.has(i)===!1&&(s.add(i),i.usedTimes++),s.has(o)===!1&&(s.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new hL(e),t.set(e,r)),r}}class hL{constructor(e){this.id=uL++,this.code=e,this.usedTimes=0}}function fL(n,e,t,r,i,o,s){const a=new Dg,l=new dL,c=new Set,u=[],d=i.logarithmicDepthBuffer,f=i.vertexTextures;let m=i.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function _(w){return c.add(w),w===0?"uv":`uv${w}`}function x(w,M,P,I,D){const $=I.fog,W=D.geometry,H=w.isMeshStandardMaterial?I.environment:null,Z=(w.isMeshStandardMaterial?t:e).get(w.envMap||H),F=Z&&Z.mapping===zd?Z.image.height:null,Y=v[w.type];w.precision!==null&&(m=i.getMaxPrecision(w.precision),m!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",m,"instead."));const X=W.morphAttributes.position||W.morphAttributes.normal||W.morphAttributes.color,oe=X!==void 0?X.length:0;let pe=0;W.morphAttributes.position!==void 0&&(pe=1),W.morphAttributes.normal!==void 0&&(pe=2),W.morphAttributes.color!==void 0&&(pe=3);let De,z,ve,j;if(Y){const Ze=$r[Y];De=Ze.vertexShader,z=Ze.fragmentShader}else De=w.vertexShader,z=w.fragmentShader,l.update(w),ve=l.getVertexShaderID(w),j=l.getFragmentShaderID(w);const ne=n.getRenderTarget(),Ee=n.state.buffers.depth.getReversed(),me=D.isInstancedMesh===!0,te=D.isBatchedMesh===!0,Pe=!!w.map,je=!!w.matcap,L=!!Z,Fe=!!w.aoMap,Re=!!w.lightMap,Ne=!!w.bumpMap,de=!!w.normalMap,Se=!!w.displacementMap,Ue=!!w.emissiveMap,ze=!!w.metalnessMap,Ke=!!w.roughnessMap,it=w.anisotropy>0,N=w.clearcoat>0,k=w.dispersion>0,G=w.iridescence>0,ue=w.sheen>0,Me=w.transmission>0,ge=it&&!!w.anisotropyMap,$e=N&&!!w.clearcoatMap,ke=N&&!!w.clearcoatNormalMap,We=N&&!!w.clearcoatRoughnessMap,Je=G&&!!w.iridescenceMap,_e=G&&!!w.iridescenceThicknessMap,Le=ue&&!!w.sheenColorMap,qe=ue&&!!w.sheenRoughnessMap,re=!!w.specularMap,ie=!!w.specularColorMap,we=!!w.specularIntensityMap,U=Me&&!!w.transmissionMap,se=Me&&!!w.thicknessMap,he=!!w.gradientMap,Oe=!!w.alphaMap,Te=w.alphaTest>0,ce=!!w.alphaHash,K=!!w.extensions;let be=vo;w.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(be=n.toneMapping);const Be={shaderID:Y,shaderType:w.type,shaderName:w.name,vertexShader:De,fragmentShader:z,defines:w.defines,customVertexShaderID:ve,customFragmentShaderID:j,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:m,batching:te,batchingColor:te&&D._colorsTexture!==null,instancing:me,instancingColor:me&&D.instanceColor!==null,instancingMorph:me&&D.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:ne===null?n.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:us,alphaToCoverage:!!w.alphaToCoverage,map:Pe,matcap:je,envMap:L,envMapMode:L&&Z.mapping,envMapCubeUVHeight:F,aoMap:Fe,lightMap:Re,bumpMap:Ne,normalMap:de,displacementMap:f&&Se,emissiveMap:Ue,normalMapObjectSpace:de&&w.normalMapType===eR,normalMapTangentSpace:de&&w.normalMapType===PS,metalnessMap:ze,roughnessMap:Ke,anisotropy:it,anisotropyMap:ge,clearcoat:N,clearcoatMap:$e,clearcoatNormalMap:ke,clearcoatRoughnessMap:We,dispersion:k,iridescence:G,iridescenceMap:Je,iridescenceThicknessMap:_e,sheen:ue,sheenColorMap:Le,sheenRoughnessMap:qe,specularMap:re,specularColorMap:ie,specularIntensityMap:we,transmission:Me,transmissionMap:U,thicknessMap:se,gradientMap:he,opaque:w.transparent===!1&&w.blending===va&&w.alphaToCoverage===!1,alphaMap:Oe,alphaTest:Te,alphaHash:ce,combine:w.combine,mapUv:Pe&&_(w.map.channel),aoMapUv:Fe&&_(w.aoMap.channel),lightMapUv:Re&&_(w.lightMap.channel),bumpMapUv:Ne&&_(w.bumpMap.channel),normalMapUv:de&&_(w.normalMap.channel),displacementMapUv:Se&&_(w.displacementMap.channel),emissiveMapUv:Ue&&_(w.emissiveMap.channel),metalnessMapUv:ze&&_(w.metalnessMap.channel),roughnessMapUv:Ke&&_(w.roughnessMap.channel),anisotropyMapUv:ge&&_(w.anisotropyMap.channel),clearcoatMapUv:$e&&_(w.clearcoatMap.channel),clearcoatNormalMapUv:ke&&_(w.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:We&&_(w.clearcoatRoughnessMap.channel),iridescenceMapUv:Je&&_(w.iridescenceMap.channel),iridescenceThicknessMapUv:_e&&_(w.iridescenceThicknessMap.channel),sheenColorMapUv:Le&&_(w.sheenColorMap.channel),sheenRoughnessMapUv:qe&&_(w.sheenRoughnessMap.channel),specularMapUv:re&&_(w.specularMap.channel),specularColorMapUv:ie&&_(w.specularColorMap.channel),specularIntensityMapUv:we&&_(w.specularIntensityMap.channel),transmissionMapUv:U&&_(w.transmissionMap.channel),thicknessMapUv:se&&_(w.thicknessMap.channel),alphaMapUv:Oe&&_(w.alphaMap.channel),vertexTangents:!!W.attributes.tangent&&(de||it),vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!W.attributes.color&&W.attributes.color.itemSize===4,pointsUvs:D.isPoints===!0&&!!W.attributes.uv&&(Pe||Oe),fog:!!$,useFog:w.fog===!0,fogExp2:!!$&&$.isFogExp2,flatShading:w.flatShading===!0&&w.wireframe===!1,sizeAttenuation:w.sizeAttenuation===!0,logarithmicDepthBuffer:d,reversedDepthBuffer:Ee,skinning:D.isSkinnedMesh===!0,morphTargets:W.morphAttributes.position!==void 0,morphNormals:W.morphAttributes.normal!==void 0,morphColors:W.morphAttributes.color!==void 0,morphTargetsCount:oe,morphTextureStride:pe,numDirLights:M.directional.length,numPointLights:M.point.length,numSpotLights:M.spot.length,numSpotLightMaps:M.spotLightMap.length,numRectAreaLights:M.rectArea.length,numHemiLights:M.hemi.length,numDirLightShadows:M.directionalShadowMap.length,numPointLightShadows:M.pointShadowMap.length,numSpotLightShadows:M.spotShadowMap.length,numSpotLightShadowsWithMaps:M.numSpotLightShadowsWithMaps,numLightProbes:M.numLightProbes,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:w.dithering,shadowMapEnabled:n.shadowMap.enabled&&P.length>0,shadowMapType:n.shadowMap.type,toneMapping:be,decodeVideoTexture:Pe&&w.map.isVideoTexture===!0&&Pt.getTransfer(w.map.colorSpace)===Lt,decodeVideoTextureEmissive:Ue&&w.emissiveMap.isVideoTexture===!0&&Pt.getTransfer(w.emissiveMap.colorSpace)===Lt,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===xi,flipSided:w.side===Kn,useDepthPacking:w.depthPacking>=0,depthPacking:w.depthPacking||0,index0AttributeName:w.index0AttributeName,extensionClipCullDistance:K&&w.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(K&&w.extensions.multiDraw===!0||te)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:w.customProgramCacheKey()};return Be.vertexUv1s=c.has(1),Be.vertexUv2s=c.has(2),Be.vertexUv3s=c.has(3),c.clear(),Be}function p(w){const M=[];if(w.shaderID?M.push(w.shaderID):(M.push(w.customVertexShaderID),M.push(w.customFragmentShaderID)),w.defines!==void 0)for(const P in w.defines)M.push(P),M.push(w.defines[P]);return w.isRawShaderMaterial===!1&&(b(M,w),g(M,w),M.push(n.outputColorSpace)),M.push(w.customProgramCacheKey),M.join()}function b(w,M){w.push(M.precision),w.push(M.outputColorSpace),w.push(M.envMapMode),w.push(M.envMapCubeUVHeight),w.push(M.mapUv),w.push(M.alphaMapUv),w.push(M.lightMapUv),w.push(M.aoMapUv),w.push(M.bumpMapUv),w.push(M.normalMapUv),w.push(M.displacementMapUv),w.push(M.emissiveMapUv),w.push(M.metalnessMapUv),w.push(M.roughnessMapUv),w.push(M.anisotropyMapUv),w.push(M.clearcoatMapUv),w.push(M.clearcoatNormalMapUv),w.push(M.clearcoatRoughnessMapUv),w.push(M.iridescenceMapUv),w.push(M.iridescenceThicknessMapUv),w.push(M.sheenColorMapUv),w.push(M.sheenRoughnessMapUv),w.push(M.specularMapUv),w.push(M.specularColorMapUv),w.push(M.specularIntensityMapUv),w.push(M.transmissionMapUv),w.push(M.thicknessMapUv),w.push(M.combine),w.push(M.fogExp2),w.push(M.sizeAttenuation),w.push(M.morphTargetsCount),w.push(M.morphAttributeCount),w.push(M.numDirLights),w.push(M.numPointLights),w.push(M.numSpotLights),w.push(M.numSpotLightMaps),w.push(M.numHemiLights),w.push(M.numRectAreaLights),w.push(M.numDirLightShadows),w.push(M.numPointLightShadows),w.push(M.numSpotLightShadows),w.push(M.numSpotLightShadowsWithMaps),w.push(M.numLightProbes),w.push(M.shadowMapType),w.push(M.toneMapping),w.push(M.numClippingPlanes),w.push(M.numClipIntersection),w.push(M.depthPacking)}function g(w,M){a.disableAll(),M.supportsVertexTextures&&a.enable(0),M.instancing&&a.enable(1),M.instancingColor&&a.enable(2),M.instancingMorph&&a.enable(3),M.matcap&&a.enable(4),M.envMap&&a.enable(5),M.normalMapObjectSpace&&a.enable(6),M.normalMapTangentSpace&&a.enable(7),M.clearcoat&&a.enable(8),M.iridescence&&a.enable(9),M.alphaTest&&a.enable(10),M.vertexColors&&a.enable(11),M.vertexAlphas&&a.enable(12),M.vertexUv1s&&a.enable(13),M.vertexUv2s&&a.enable(14),M.vertexUv3s&&a.enable(15),M.vertexTangents&&a.enable(16),M.anisotropy&&a.enable(17),M.alphaHash&&a.enable(18),M.batching&&a.enable(19),M.dispersion&&a.enable(20),M.batchingColor&&a.enable(21),M.gradientMap&&a.enable(22),w.push(a.mask),a.disableAll(),M.fog&&a.enable(0),M.useFog&&a.enable(1),M.flatShading&&a.enable(2),M.logarithmicDepthBuffer&&a.enable(3),M.reversedDepthBuffer&&a.enable(4),M.skinning&&a.enable(5),M.morphTargets&&a.enable(6),M.morphNormals&&a.enable(7),M.morphColors&&a.enable(8),M.premultipliedAlpha&&a.enable(9),M.shadowMapEnabled&&a.enable(10),M.doubleSided&&a.enable(11),M.flipSided&&a.enable(12),M.useDepthPacking&&a.enable(13),M.dithering&&a.enable(14),M.transmission&&a.enable(15),M.sheen&&a.enable(16),M.opaque&&a.enable(17),M.pointsUvs&&a.enable(18),M.decodeVideoTexture&&a.enable(19),M.decodeVideoTextureEmissive&&a.enable(20),M.alphaToCoverage&&a.enable(21),w.push(a.mask)}function y(w){const M=v[w.type];let P;if(M){const I=$r[M];P=DR.clone(I.uniforms)}else P=w.uniforms;return P}function E(w,M){let P;for(let I=0,D=u.length;I<D;I++){const $=u[I];if($.cacheKey===M){P=$,++P.usedTimes;break}}return P===void 0&&(P=new cL(n,M,w,o),u.push(P)),P}function C(w){if(--w.usedTimes===0){const M=u.indexOf(w);u[M]=u[u.length-1],u.pop(),w.destroy()}}function A(w){l.remove(w)}function T(){l.dispose()}return{getParameters:x,getProgramCacheKey:p,getUniforms:y,acquireProgram:E,releaseProgram:C,releaseShaderCache:A,programs:u,dispose:T}}function pL(){let n=new WeakMap;function e(s){return n.has(s)}function t(s){let a=n.get(s);return a===void 0&&(a={},n.set(s,a)),a}function r(s){n.delete(s)}function i(s,a,l){n.get(s)[a]=l}function o(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:o}}function mL(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function Ix(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Lx(){const n=[];let e=0;const t=[],r=[],i=[];function o(){e=0,t.length=0,r.length=0,i.length=0}function s(d,f,m,v,_,x){let p=n[e];return p===void 0?(p={id:d.id,object:d,geometry:f,material:m,groupOrder:v,renderOrder:d.renderOrder,z:_,group:x},n[e]=p):(p.id=d.id,p.object=d,p.geometry=f,p.material=m,p.groupOrder=v,p.renderOrder=d.renderOrder,p.z=_,p.group=x),e++,p}function a(d,f,m,v,_,x){const p=s(d,f,m,v,_,x);m.transmission>0?r.push(p):m.transparent===!0?i.push(p):t.push(p)}function l(d,f,m,v,_,x){const p=s(d,f,m,v,_,x);m.transmission>0?r.unshift(p):m.transparent===!0?i.unshift(p):t.unshift(p)}function c(d,f){t.length>1&&t.sort(d||mL),r.length>1&&r.sort(f||Ix),i.length>1&&i.sort(f||Ix)}function u(){for(let d=e,f=n.length;d<f;d++){const m=n[d];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:r,transparent:i,init:o,push:a,unshift:l,finish:u,sort:c}}function gL(){let n=new WeakMap;function e(r,i){const o=n.get(r);let s;return o===void 0?(s=new Lx,n.set(r,[s])):i>=o.length?(s=new Lx,o.push(s)):s=o[i],s}function t(){n=new WeakMap}return{get:e,dispose:t}}function vL(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ae,color:new pt};break;case"SpotLight":t={position:new ae,direction:new ae,color:new pt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ae,color:new pt,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ae,skyColor:new pt,groundColor:new pt};break;case"RectAreaLight":t={color:new pt,position:new ae,halfWidth:new ae,halfHeight:new ae};break}return n[e.id]=t,t}}}function xL(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new gt,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let yL=0;function _L(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function bL(n){const e=new vL,t=xL(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let c=0;c<9;c++)r.probe.push(new ae);const i=new ae,o=new kt,s=new kt;function a(c){let u=0,d=0,f=0;for(let w=0;w<9;w++)r.probe[w].set(0,0,0);let m=0,v=0,_=0,x=0,p=0,b=0,g=0,y=0,E=0,C=0,A=0;c.sort(_L);for(let w=0,M=c.length;w<M;w++){const P=c[w],I=P.color,D=P.intensity,$=P.distance,W=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)u+=I.r*D,d+=I.g*D,f+=I.b*D;else if(P.isLightProbe){for(let H=0;H<9;H++)r.probe[H].addScaledVector(P.sh.coefficients[H],D);A++}else if(P.isDirectionalLight){const H=e.get(P);if(H.color.copy(P.color).multiplyScalar(P.intensity),P.castShadow){const Z=P.shadow,F=t.get(P);F.shadowIntensity=Z.intensity,F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,r.directionalShadow[m]=F,r.directionalShadowMap[m]=W,r.directionalShadowMatrix[m]=P.shadow.matrix,b++}r.directional[m]=H,m++}else if(P.isSpotLight){const H=e.get(P);H.position.setFromMatrixPosition(P.matrixWorld),H.color.copy(I).multiplyScalar(D),H.distance=$,H.coneCos=Math.cos(P.angle),H.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),H.decay=P.decay,r.spot[_]=H;const Z=P.shadow;if(P.map&&(r.spotLightMap[E]=P.map,E++,Z.updateMatrices(P),P.castShadow&&C++),r.spotLightMatrix[_]=Z.matrix,P.castShadow){const F=t.get(P);F.shadowIntensity=Z.intensity,F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,r.spotShadow[_]=F,r.spotShadowMap[_]=W,y++}_++}else if(P.isRectAreaLight){const H=e.get(P);H.color.copy(I).multiplyScalar(D),H.halfWidth.set(P.width*.5,0,0),H.halfHeight.set(0,P.height*.5,0),r.rectArea[x]=H,x++}else if(P.isPointLight){const H=e.get(P);if(H.color.copy(P.color).multiplyScalar(P.intensity),H.distance=P.distance,H.decay=P.decay,P.castShadow){const Z=P.shadow,F=t.get(P);F.shadowIntensity=Z.intensity,F.shadowBias=Z.bias,F.shadowNormalBias=Z.normalBias,F.shadowRadius=Z.radius,F.shadowMapSize=Z.mapSize,F.shadowCameraNear=Z.camera.near,F.shadowCameraFar=Z.camera.far,r.pointShadow[v]=F,r.pointShadowMap[v]=W,r.pointShadowMatrix[v]=P.shadow.matrix,g++}r.point[v]=H,v++}else if(P.isHemisphereLight){const H=e.get(P);H.skyColor.copy(P.color).multiplyScalar(D),H.groundColor.copy(P.groundColor).multiplyScalar(D),r.hemi[p]=H,p++}}x>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=tt.LTC_FLOAT_1,r.rectAreaLTC2=tt.LTC_FLOAT_2):(r.rectAreaLTC1=tt.LTC_HALF_1,r.rectAreaLTC2=tt.LTC_HALF_2)),r.ambient[0]=u,r.ambient[1]=d,r.ambient[2]=f;const T=r.hash;(T.directionalLength!==m||T.pointLength!==v||T.spotLength!==_||T.rectAreaLength!==x||T.hemiLength!==p||T.numDirectionalShadows!==b||T.numPointShadows!==g||T.numSpotShadows!==y||T.numSpotMaps!==E||T.numLightProbes!==A)&&(r.directional.length=m,r.spot.length=_,r.rectArea.length=x,r.point.length=v,r.hemi.length=p,r.directionalShadow.length=b,r.directionalShadowMap.length=b,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=y,r.spotShadowMap.length=y,r.directionalShadowMatrix.length=b,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=y+E-C,r.spotLightMap.length=E,r.numSpotLightShadowsWithMaps=C,r.numLightProbes=A,T.directionalLength=m,T.pointLength=v,T.spotLength=_,T.rectAreaLength=x,T.hemiLength=p,T.numDirectionalShadows=b,T.numPointShadows=g,T.numSpotShadows=y,T.numSpotMaps=E,T.numLightProbes=A,r.version=yL++)}function l(c,u){let d=0,f=0,m=0,v=0,_=0;const x=u.matrixWorldInverse;for(let p=0,b=c.length;p<b;p++){const g=c[p];if(g.isDirectionalLight){const y=r.directional[d];y.direction.setFromMatrixPosition(g.matrixWorld),i.setFromMatrixPosition(g.target.matrixWorld),y.direction.sub(i),y.direction.transformDirection(x),d++}else if(g.isSpotLight){const y=r.spot[m];y.position.setFromMatrixPosition(g.matrixWorld),y.position.applyMatrix4(x),y.direction.setFromMatrixPosition(g.matrixWorld),i.setFromMatrixPosition(g.target.matrixWorld),y.direction.sub(i),y.direction.transformDirection(x),m++}else if(g.isRectAreaLight){const y=r.rectArea[v];y.position.setFromMatrixPosition(g.matrixWorld),y.position.applyMatrix4(x),s.identity(),o.copy(g.matrixWorld),o.premultiply(x),s.extractRotation(o),y.halfWidth.set(g.width*.5,0,0),y.halfHeight.set(0,g.height*.5,0),y.halfWidth.applyMatrix4(s),y.halfHeight.applyMatrix4(s),v++}else if(g.isPointLight){const y=r.point[f];y.position.setFromMatrixPosition(g.matrixWorld),y.position.applyMatrix4(x),f++}else if(g.isHemisphereLight){const y=r.hemi[_];y.direction.setFromMatrixPosition(g.matrixWorld),y.direction.transformDirection(x),_++}}}return{setup:a,setupView:l,state:r}}function Dx(n){const e=new bL(n),t=[],r=[];function i(u){c.camera=u,t.length=0,r.length=0}function o(u){t.push(u)}function s(u){r.push(u)}function a(){e.setup(t)}function l(u){e.setupView(t,u)}const c={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:c,setupLights:a,setupLightsView:l,pushLight:o,pushShadow:s}}function SL(n){let e=new WeakMap;function t(i,o=0){const s=e.get(i);let a;return s===void 0?(a=new Dx(n),e.set(i,[a])):o>=s.length?(a=new Dx(n),s.push(a)):a=s[o],a}function r(){e=new WeakMap}return{get:t,dispose:r}}const wL=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,EL=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function ML(n,e,t){let r=new Ng;const i=new gt,o=new gt,s=new Jt,a=new VR({depthPacking:Q5}),l=new $R,c={},u=t.maxTextureSize,d={[wo]:Kn,[Kn]:wo,[xi]:xi},f=new Eo({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new gt},radius:{value:4}},vertexShader:wL,fragmentShader:EL}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const v=new Ni;v.setAttribute("position",new Or(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const _=new bn(v,f),x=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=xS;let p=this.type;this.render=function(C,A,T){if(x.enabled===!1||x.autoUpdate===!1&&x.needsUpdate===!1||C.length===0)return;const w=n.getRenderTarget(),M=n.getActiveCubeFace(),P=n.getActiveMipmapLevel(),I=n.state;I.setBlending(go),I.buffers.depth.getReversed()===!0?I.buffers.color.setClear(0,0,0,0):I.buffers.color.setClear(1,1,1,1),I.buffers.depth.setTest(!0),I.setScissorTest(!1);const D=p!==pi&&this.type===pi,$=p===pi&&this.type!==pi;for(let W=0,H=C.length;W<H;W++){const Z=C[W],F=Z.shadow;if(F===void 0){console.warn("THREE.WebGLShadowMap:",Z,"has no shadow.");continue}if(F.autoUpdate===!1&&F.needsUpdate===!1)continue;i.copy(F.mapSize);const Y=F.getFrameExtents();if(i.multiply(Y),o.copy(F.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(o.x=Math.floor(u/Y.x),i.x=o.x*Y.x,F.mapSize.x=o.x),i.y>u&&(o.y=Math.floor(u/Y.y),i.y=o.y*Y.y,F.mapSize.y=o.y)),F.map===null||D===!0||$===!0){const oe=this.type!==pi?{minFilter:lr,magFilter:lr}:{};F.map!==null&&F.map.dispose(),F.map=new ds(i.x,i.y,oe),F.map.texture.name=Z.name+".shadowMap",F.camera.updateProjectionMatrix()}n.setRenderTarget(F.map),n.clear();const X=F.getViewportCount();for(let oe=0;oe<X;oe++){const pe=F.getViewport(oe);s.set(o.x*pe.x,o.y*pe.y,o.x*pe.z,o.y*pe.w),I.viewport(s),F.updateMatrices(Z,oe),r=F.getFrustum(),y(A,T,F.camera,Z,this.type)}F.isPointLightShadow!==!0&&this.type===pi&&b(F,T),F.needsUpdate=!1}p=this.type,x.needsUpdate=!1,n.setRenderTarget(w,M,P)};function b(C,A){const T=e.update(_);f.defines.VSM_SAMPLES!==C.blurSamples&&(f.defines.VSM_SAMPLES=C.blurSamples,m.defines.VSM_SAMPLES=C.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new ds(i.x,i.y)),f.uniforms.shadow_pass.value=C.map.texture,f.uniforms.resolution.value=C.mapSize,f.uniforms.radius.value=C.radius,n.setRenderTarget(C.mapPass),n.clear(),n.renderBufferDirect(A,null,T,f,_,null),m.uniforms.shadow_pass.value=C.mapPass.texture,m.uniforms.resolution.value=C.mapSize,m.uniforms.radius.value=C.radius,n.setRenderTarget(C.map),n.clear(),n.renderBufferDirect(A,null,T,m,_,null)}function g(C,A,T,w){let M=null;const P=T.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(P!==void 0)M=P;else if(M=T.isPointLight===!0?l:a,n.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0||A.alphaToCoverage===!0){const I=M.uuid,D=A.uuid;let $=c[I];$===void 0&&($={},c[I]=$);let W=$[D];W===void 0&&(W=M.clone(),$[D]=W,A.addEventListener("dispose",E)),M=W}if(M.visible=A.visible,M.wireframe=A.wireframe,w===pi?M.side=A.shadowSide!==null?A.shadowSide:A.side:M.side=A.shadowSide!==null?A.shadowSide:d[A.side],M.alphaMap=A.alphaMap,M.alphaTest=A.alphaToCoverage===!0?.5:A.alphaTest,M.map=A.map,M.clipShadows=A.clipShadows,M.clippingPlanes=A.clippingPlanes,M.clipIntersection=A.clipIntersection,M.displacementMap=A.displacementMap,M.displacementScale=A.displacementScale,M.displacementBias=A.displacementBias,M.wireframeLinewidth=A.wireframeLinewidth,M.linewidth=A.linewidth,T.isPointLight===!0&&M.isMeshDistanceMaterial===!0){const I=n.properties.get(M);I.light=T}return M}function y(C,A,T,w,M){if(C.visible===!1)return;if(C.layers.test(A.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&M===pi)&&(!C.frustumCulled||r.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(T.matrixWorldInverse,C.matrixWorld);const D=e.update(C),$=C.material;if(Array.isArray($)){const W=D.groups;for(let H=0,Z=W.length;H<Z;H++){const F=W[H],Y=$[F.materialIndex];if(Y&&Y.visible){const X=g(C,Y,w,M);C.onBeforeShadow(n,C,A,T,D,X,F),n.renderBufferDirect(T,null,D,X,C,F),C.onAfterShadow(n,C,A,T,D,X,F)}}}else if($.visible){const W=g(C,$,w,M);C.onBeforeShadow(n,C,A,T,D,W,null),n.renderBufferDirect(T,null,D,W,C,null),C.onAfterShadow(n,C,A,T,D,W,null)}}const I=C.children;for(let D=0,$=I.length;D<$;D++)y(I[D],A,T,w,M)}function E(C){C.target.removeEventListener("dispose",E);for(const T in c){const w=c[T],M=C.target.uuid;M in w&&(w[M].dispose(),delete w[M])}}}const TL={[Ap]:Pp,[kp]:Dp,[Ip]:Np,[Ca]:Lp,[Pp]:Ap,[Dp]:kp,[Np]:Ip,[Lp]:Ca};function CL(n,e){function t(){let U=!1;const se=new Jt;let he=null;const Oe=new Jt(0,0,0,0);return{setMask:function(Te){he!==Te&&!U&&(n.colorMask(Te,Te,Te,Te),he=Te)},setLocked:function(Te){U=Te},setClear:function(Te,ce,K,be,Be){Be===!0&&(Te*=be,ce*=be,K*=be),se.set(Te,ce,K,be),Oe.equals(se)===!1&&(n.clearColor(Te,ce,K,be),Oe.copy(se))},reset:function(){U=!1,he=null,Oe.set(-1,0,0,0)}}}function r(){let U=!1,se=!1,he=null,Oe=null,Te=null;return{setReversed:function(ce){if(se!==ce){const K=e.get("EXT_clip_control");ce?K.clipControlEXT(K.LOWER_LEFT_EXT,K.ZERO_TO_ONE_EXT):K.clipControlEXT(K.LOWER_LEFT_EXT,K.NEGATIVE_ONE_TO_ONE_EXT),se=ce;const be=Te;Te=null,this.setClear(be)}},getReversed:function(){return se},setTest:function(ce){ce?ne(n.DEPTH_TEST):Ee(n.DEPTH_TEST)},setMask:function(ce){he!==ce&&!U&&(n.depthMask(ce),he=ce)},setFunc:function(ce){if(se&&(ce=TL[ce]),Oe!==ce){switch(ce){case Ap:n.depthFunc(n.NEVER);break;case Pp:n.depthFunc(n.ALWAYS);break;case kp:n.depthFunc(n.LESS);break;case Ca:n.depthFunc(n.LEQUAL);break;case Ip:n.depthFunc(n.EQUAL);break;case Lp:n.depthFunc(n.GEQUAL);break;case Dp:n.depthFunc(n.GREATER);break;case Np:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}Oe=ce}},setLocked:function(ce){U=ce},setClear:function(ce){Te!==ce&&(se&&(ce=1-ce),n.clearDepth(ce),Te=ce)},reset:function(){U=!1,he=null,Oe=null,Te=null,se=!1}}}function i(){let U=!1,se=null,he=null,Oe=null,Te=null,ce=null,K=null,be=null,Be=null;return{setTest:function(Ze){U||(Ze?ne(n.STENCIL_TEST):Ee(n.STENCIL_TEST))},setMask:function(Ze){se!==Ze&&!U&&(n.stencilMask(Ze),se=Ze)},setFunc:function(Ze,lt,ut){(he!==Ze||Oe!==lt||Te!==ut)&&(n.stencilFunc(Ze,lt,ut),he=Ze,Oe=lt,Te=ut)},setOp:function(Ze,lt,ut){(ce!==Ze||K!==lt||be!==ut)&&(n.stencilOp(Ze,lt,ut),ce=Ze,K=lt,be=ut)},setLocked:function(Ze){U=Ze},setClear:function(Ze){Be!==Ze&&(n.clearStencil(Ze),Be=Ze)},reset:function(){U=!1,se=null,he=null,Oe=null,Te=null,ce=null,K=null,be=null,Be=null}}}const o=new t,s=new r,a=new i,l=new WeakMap,c=new WeakMap;let u={},d={},f=new WeakMap,m=[],v=null,_=!1,x=null,p=null,b=null,g=null,y=null,E=null,C=null,A=new pt(0,0,0),T=0,w=!1,M=null,P=null,I=null,D=null,$=null;const W=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let H=!1,Z=0;const F=n.getParameter(n.VERSION);F.indexOf("WebGL")!==-1?(Z=parseFloat(/^WebGL (\d)/.exec(F)[1]),H=Z>=1):F.indexOf("OpenGL ES")!==-1&&(Z=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),H=Z>=2);let Y=null,X={};const oe=n.getParameter(n.SCISSOR_BOX),pe=n.getParameter(n.VIEWPORT),De=new Jt().fromArray(oe),z=new Jt().fromArray(pe);function ve(U,se,he,Oe){const Te=new Uint8Array(4),ce=n.createTexture();n.bindTexture(U,ce),n.texParameteri(U,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(U,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let K=0;K<he;K++)U===n.TEXTURE_3D||U===n.TEXTURE_2D_ARRAY?n.texImage3D(se,0,n.RGBA,1,1,Oe,0,n.RGBA,n.UNSIGNED_BYTE,Te):n.texImage2D(se+K,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,Te);return ce}const j={};j[n.TEXTURE_2D]=ve(n.TEXTURE_2D,n.TEXTURE_2D,1),j[n.TEXTURE_CUBE_MAP]=ve(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),j[n.TEXTURE_2D_ARRAY]=ve(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),j[n.TEXTURE_3D]=ve(n.TEXTURE_3D,n.TEXTURE_3D,1,1),o.setClear(0,0,0,1),s.setClear(1),a.setClear(0),ne(n.DEPTH_TEST),s.setFunc(Ca),Ne(!1),de(Lv),ne(n.CULL_FACE),Fe(go);function ne(U){u[U]!==!0&&(n.enable(U),u[U]=!0)}function Ee(U){u[U]!==!1&&(n.disable(U),u[U]=!1)}function me(U,se){return d[U]!==se?(n.bindFramebuffer(U,se),d[U]=se,U===n.DRAW_FRAMEBUFFER&&(d[n.FRAMEBUFFER]=se),U===n.FRAMEBUFFER&&(d[n.DRAW_FRAMEBUFFER]=se),!0):!1}function te(U,se){let he=m,Oe=!1;if(U){he=f.get(se),he===void 0&&(he=[],f.set(se,he));const Te=U.textures;if(he.length!==Te.length||he[0]!==n.COLOR_ATTACHMENT0){for(let ce=0,K=Te.length;ce<K;ce++)he[ce]=n.COLOR_ATTACHMENT0+ce;he.length=Te.length,Oe=!0}}else he[0]!==n.BACK&&(he[0]=n.BACK,Oe=!0);Oe&&n.drawBuffers(he)}function Pe(U){return v!==U?(n.useProgram(U),v=U,!0):!1}const je={[Xo]:n.FUNC_ADD,[T5]:n.FUNC_SUBTRACT,[C5]:n.FUNC_REVERSE_SUBTRACT};je[R5]=n.MIN,je[A5]=n.MAX;const L={[P5]:n.ZERO,[k5]:n.ONE,[I5]:n.SRC_COLOR,[Cp]:n.SRC_ALPHA,[z5]:n.SRC_ALPHA_SATURATE,[O5]:n.DST_COLOR,[D5]:n.DST_ALPHA,[L5]:n.ONE_MINUS_SRC_COLOR,[Rp]:n.ONE_MINUS_SRC_ALPHA,[U5]:n.ONE_MINUS_DST_COLOR,[N5]:n.ONE_MINUS_DST_ALPHA,[F5]:n.CONSTANT_COLOR,[j5]:n.ONE_MINUS_CONSTANT_COLOR,[B5]:n.CONSTANT_ALPHA,[H5]:n.ONE_MINUS_CONSTANT_ALPHA};function Fe(U,se,he,Oe,Te,ce,K,be,Be,Ze){if(U===go){_===!0&&(Ee(n.BLEND),_=!1);return}if(_===!1&&(ne(n.BLEND),_=!0),U!==M5){if(U!==x||Ze!==w){if((p!==Xo||y!==Xo)&&(n.blendEquation(n.FUNC_ADD),p=Xo,y=Xo),Ze)switch(U){case va:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Dv:n.blendFunc(n.ONE,n.ONE);break;case Nv:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case Ov:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}else switch(U){case va:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Dv:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case Nv:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case Ov:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",U);break}b=null,g=null,E=null,C=null,A.set(0,0,0),T=0,x=U,w=Ze}return}Te=Te||se,ce=ce||he,K=K||Oe,(se!==p||Te!==y)&&(n.blendEquationSeparate(je[se],je[Te]),p=se,y=Te),(he!==b||Oe!==g||ce!==E||K!==C)&&(n.blendFuncSeparate(L[he],L[Oe],L[ce],L[K]),b=he,g=Oe,E=ce,C=K),(be.equals(A)===!1||Be!==T)&&(n.blendColor(be.r,be.g,be.b,Be),A.copy(be),T=Be),x=U,w=!1}function Re(U,se){U.side===xi?Ee(n.CULL_FACE):ne(n.CULL_FACE);let he=U.side===Kn;se&&(he=!he),Ne(he),U.blending===va&&U.transparent===!1?Fe(go):Fe(U.blending,U.blendEquation,U.blendSrc,U.blendDst,U.blendEquationAlpha,U.blendSrcAlpha,U.blendDstAlpha,U.blendColor,U.blendAlpha,U.premultipliedAlpha),s.setFunc(U.depthFunc),s.setTest(U.depthTest),s.setMask(U.depthWrite),o.setMask(U.colorWrite);const Oe=U.stencilWrite;a.setTest(Oe),Oe&&(a.setMask(U.stencilWriteMask),a.setFunc(U.stencilFunc,U.stencilRef,U.stencilFuncMask),a.setOp(U.stencilFail,U.stencilZFail,U.stencilZPass)),Ue(U.polygonOffset,U.polygonOffsetFactor,U.polygonOffsetUnits),U.alphaToCoverage===!0?ne(n.SAMPLE_ALPHA_TO_COVERAGE):Ee(n.SAMPLE_ALPHA_TO_COVERAGE)}function Ne(U){M!==U&&(U?n.frontFace(n.CW):n.frontFace(n.CCW),M=U)}function de(U){U!==w5?(ne(n.CULL_FACE),U!==P&&(U===Lv?n.cullFace(n.BACK):U===E5?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):Ee(n.CULL_FACE),P=U}function Se(U){U!==I&&(H&&n.lineWidth(U),I=U)}function Ue(U,se,he){U?(ne(n.POLYGON_OFFSET_FILL),(D!==se||$!==he)&&(n.polygonOffset(se,he),D=se,$=he)):Ee(n.POLYGON_OFFSET_FILL)}function ze(U){U?ne(n.SCISSOR_TEST):Ee(n.SCISSOR_TEST)}function Ke(U){U===void 0&&(U=n.TEXTURE0+W-1),Y!==U&&(n.activeTexture(U),Y=U)}function it(U,se,he){he===void 0&&(Y===null?he=n.TEXTURE0+W-1:he=Y);let Oe=X[he];Oe===void 0&&(Oe={type:void 0,texture:void 0},X[he]=Oe),(Oe.type!==U||Oe.texture!==se)&&(Y!==he&&(n.activeTexture(he),Y=he),n.bindTexture(U,se||j[U]),Oe.type=U,Oe.texture=se)}function N(){const U=X[Y];U!==void 0&&U.type!==void 0&&(n.bindTexture(U.type,null),U.type=void 0,U.texture=void 0)}function k(){try{n.compressedTexImage2D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function G(){try{n.compressedTexImage3D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ue(){try{n.texSubImage2D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Me(){try{n.texSubImage3D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ge(){try{n.compressedTexSubImage2D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function $e(){try{n.compressedTexSubImage3D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function ke(){try{n.texStorage2D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function We(){try{n.texStorage3D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Je(){try{n.texImage2D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function _e(){try{n.texImage3D(...arguments)}catch(U){console.error("THREE.WebGLState:",U)}}function Le(U){De.equals(U)===!1&&(n.scissor(U.x,U.y,U.z,U.w),De.copy(U))}function qe(U){z.equals(U)===!1&&(n.viewport(U.x,U.y,U.z,U.w),z.copy(U))}function re(U,se){let he=c.get(se);he===void 0&&(he=new WeakMap,c.set(se,he));let Oe=he.get(U);Oe===void 0&&(Oe=n.getUniformBlockIndex(se,U.name),he.set(U,Oe))}function ie(U,se){const Oe=c.get(se).get(U);l.get(se)!==Oe&&(n.uniformBlockBinding(se,Oe,U.__bindingPointIndex),l.set(se,Oe))}function we(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),s.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},Y=null,X={},d={},f=new WeakMap,m=[],v=null,_=!1,x=null,p=null,b=null,g=null,y=null,E=null,C=null,A=new pt(0,0,0),T=0,w=!1,M=null,P=null,I=null,D=null,$=null,De.set(0,0,n.canvas.width,n.canvas.height),z.set(0,0,n.canvas.width,n.canvas.height),o.reset(),s.reset(),a.reset()}return{buffers:{color:o,depth:s,stencil:a},enable:ne,disable:Ee,bindFramebuffer:me,drawBuffers:te,useProgram:Pe,setBlending:Fe,setMaterial:Re,setFlipSided:Ne,setCullFace:de,setLineWidth:Se,setPolygonOffset:Ue,setScissorTest:ze,activeTexture:Ke,bindTexture:it,unbindTexture:N,compressedTexImage2D:k,compressedTexImage3D:G,texImage2D:Je,texImage3D:_e,updateUBOMapping:re,uniformBlockBinding:ie,texStorage2D:ke,texStorage3D:We,texSubImage2D:ue,texSubImage3D:Me,compressedTexSubImage2D:ge,compressedTexSubImage3D:$e,scissor:Le,viewport:qe,reset:we}}function RL(n,e,t,r,i,o,s){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,l=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),c=new gt,u=new WeakMap;let d;const f=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function v(N,k){return m?new OffscreenCanvas(N,k):dd("canvas")}function _(N,k,G){let ue=1;const Me=it(N);if((Me.width>G||Me.height>G)&&(ue=G/Math.max(Me.width,Me.height)),ue<1)if(typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&N instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&N instanceof ImageBitmap||typeof VideoFrame<"u"&&N instanceof VideoFrame){const ge=Math.floor(ue*Me.width),$e=Math.floor(ue*Me.height);d===void 0&&(d=v(ge,$e));const ke=k?v(ge,$e):d;return ke.width=ge,ke.height=$e,ke.getContext("2d").drawImage(N,0,0,ge,$e),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Me.width+"x"+Me.height+") to ("+ge+"x"+$e+")."),ke}else return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Me.width+"x"+Me.height+")."),N;return N}function x(N){return N.generateMipmaps}function p(N){n.generateMipmap(N)}function b(N){return N.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:N.isWebGL3DRenderTarget?n.TEXTURE_3D:N.isWebGLArrayRenderTarget||N.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function g(N,k,G,ue,Me=!1){if(N!==null){if(n[N]!==void 0)return n[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}let ge=k;if(k===n.RED&&(G===n.FLOAT&&(ge=n.R32F),G===n.HALF_FLOAT&&(ge=n.R16F),G===n.UNSIGNED_BYTE&&(ge=n.R8)),k===n.RED_INTEGER&&(G===n.UNSIGNED_BYTE&&(ge=n.R8UI),G===n.UNSIGNED_SHORT&&(ge=n.R16UI),G===n.UNSIGNED_INT&&(ge=n.R32UI),G===n.BYTE&&(ge=n.R8I),G===n.SHORT&&(ge=n.R16I),G===n.INT&&(ge=n.R32I)),k===n.RG&&(G===n.FLOAT&&(ge=n.RG32F),G===n.HALF_FLOAT&&(ge=n.RG16F),G===n.UNSIGNED_BYTE&&(ge=n.RG8)),k===n.RG_INTEGER&&(G===n.UNSIGNED_BYTE&&(ge=n.RG8UI),G===n.UNSIGNED_SHORT&&(ge=n.RG16UI),G===n.UNSIGNED_INT&&(ge=n.RG32UI),G===n.BYTE&&(ge=n.RG8I),G===n.SHORT&&(ge=n.RG16I),G===n.INT&&(ge=n.RG32I)),k===n.RGB_INTEGER&&(G===n.UNSIGNED_BYTE&&(ge=n.RGB8UI),G===n.UNSIGNED_SHORT&&(ge=n.RGB16UI),G===n.UNSIGNED_INT&&(ge=n.RGB32UI),G===n.BYTE&&(ge=n.RGB8I),G===n.SHORT&&(ge=n.RGB16I),G===n.INT&&(ge=n.RGB32I)),k===n.RGBA_INTEGER&&(G===n.UNSIGNED_BYTE&&(ge=n.RGBA8UI),G===n.UNSIGNED_SHORT&&(ge=n.RGBA16UI),G===n.UNSIGNED_INT&&(ge=n.RGBA32UI),G===n.BYTE&&(ge=n.RGBA8I),G===n.SHORT&&(ge=n.RGBA16I),G===n.INT&&(ge=n.RGBA32I)),k===n.RGB&&(G===n.UNSIGNED_INT_5_9_9_9_REV&&(ge=n.RGB9_E5),G===n.UNSIGNED_INT_10F_11F_11F_REV&&(ge=n.R11F_G11F_B10F)),k===n.RGBA){const $e=Me?cd:Pt.getTransfer(ue);G===n.FLOAT&&(ge=n.RGBA32F),G===n.HALF_FLOAT&&(ge=n.RGBA16F),G===n.UNSIGNED_BYTE&&(ge=$e===Lt?n.SRGB8_ALPHA8:n.RGBA8),G===n.UNSIGNED_SHORT_4_4_4_4&&(ge=n.RGBA4),G===n.UNSIGNED_SHORT_5_5_5_1&&(ge=n.RGB5_A1)}return(ge===n.R16F||ge===n.R32F||ge===n.RG16F||ge===n.RG32F||ge===n.RGBA16F||ge===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ge}function y(N,k){let G;return N?k===null||k===cs||k===ql?G=n.DEPTH24_STENCIL8:k===Gn?G=n.DEPTH32F_STENCIL8:k===Yl&&(G=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):k===null||k===cs||k===ql?G=n.DEPTH_COMPONENT24:k===Gn?G=n.DEPTH_COMPONENT32F:k===Yl&&(G=n.DEPTH_COMPONENT16),G}function E(N,k){return x(N)===!0||N.isFramebufferTexture&&N.minFilter!==lr&&N.minFilter!==Dn?Math.log2(Math.max(k.width,k.height))+1:N.mipmaps!==void 0&&N.mipmaps.length>0?N.mipmaps.length:N.isCompressedTexture&&Array.isArray(N.image)?k.mipmaps.length:1}function C(N){const k=N.target;k.removeEventListener("dispose",C),T(k),k.isVideoTexture&&u.delete(k)}function A(N){const k=N.target;k.removeEventListener("dispose",A),M(k)}function T(N){const k=r.get(N);if(k.__webglInit===void 0)return;const G=N.source,ue=f.get(G);if(ue){const Me=ue[k.__cacheKey];Me.usedTimes--,Me.usedTimes===0&&w(N),Object.keys(ue).length===0&&f.delete(G)}r.remove(N)}function w(N){const k=r.get(N);n.deleteTexture(k.__webglTexture);const G=N.source,ue=f.get(G);delete ue[k.__cacheKey],s.memory.textures--}function M(N){const k=r.get(N);if(N.depthTexture&&(N.depthTexture.dispose(),r.remove(N.depthTexture)),N.isWebGLCubeRenderTarget)for(let ue=0;ue<6;ue++){if(Array.isArray(k.__webglFramebuffer[ue]))for(let Me=0;Me<k.__webglFramebuffer[ue].length;Me++)n.deleteFramebuffer(k.__webglFramebuffer[ue][Me]);else n.deleteFramebuffer(k.__webglFramebuffer[ue]);k.__webglDepthbuffer&&n.deleteRenderbuffer(k.__webglDepthbuffer[ue])}else{if(Array.isArray(k.__webglFramebuffer))for(let ue=0;ue<k.__webglFramebuffer.length;ue++)n.deleteFramebuffer(k.__webglFramebuffer[ue]);else n.deleteFramebuffer(k.__webglFramebuffer);if(k.__webglDepthbuffer&&n.deleteRenderbuffer(k.__webglDepthbuffer),k.__webglMultisampledFramebuffer&&n.deleteFramebuffer(k.__webglMultisampledFramebuffer),k.__webglColorRenderbuffer)for(let ue=0;ue<k.__webglColorRenderbuffer.length;ue++)k.__webglColorRenderbuffer[ue]&&n.deleteRenderbuffer(k.__webglColorRenderbuffer[ue]);k.__webglDepthRenderbuffer&&n.deleteRenderbuffer(k.__webglDepthRenderbuffer)}const G=N.textures;for(let ue=0,Me=G.length;ue<Me;ue++){const ge=r.get(G[ue]);ge.__webglTexture&&(n.deleteTexture(ge.__webglTexture),s.memory.textures--),r.remove(G[ue])}r.remove(N)}let P=0;function I(){P=0}function D(){const N=P;return N>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+N+" texture units while this GPU supports only "+i.maxTextures),P+=1,N}function $(N){const k=[];return k.push(N.wrapS),k.push(N.wrapT),k.push(N.wrapR||0),k.push(N.magFilter),k.push(N.minFilter),k.push(N.anisotropy),k.push(N.internalFormat),k.push(N.format),k.push(N.type),k.push(N.generateMipmaps),k.push(N.premultiplyAlpha),k.push(N.flipY),k.push(N.unpackAlignment),k.push(N.colorSpace),k.join()}function W(N,k){const G=r.get(N);if(N.isVideoTexture&&ze(N),N.isRenderTargetTexture===!1&&N.isExternalTexture!==!0&&N.version>0&&G.__version!==N.version){const ue=N.image;if(ue===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(ue.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{j(G,N,k);return}}else N.isExternalTexture&&(G.__webglTexture=N.sourceTexture?N.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,G.__webglTexture,n.TEXTURE0+k)}function H(N,k){const G=r.get(N);if(N.isRenderTargetTexture===!1&&N.version>0&&G.__version!==N.version){j(G,N,k);return}t.bindTexture(n.TEXTURE_2D_ARRAY,G.__webglTexture,n.TEXTURE0+k)}function Z(N,k){const G=r.get(N);if(N.isRenderTargetTexture===!1&&N.version>0&&G.__version!==N.version){j(G,N,k);return}t.bindTexture(n.TEXTURE_3D,G.__webglTexture,n.TEXTURE0+k)}function F(N,k){const G=r.get(N);if(N.version>0&&G.__version!==N.version){ne(G,N,k);return}t.bindTexture(n.TEXTURE_CUBE_MAP,G.__webglTexture,n.TEXTURE0+k)}const Y={[zp]:n.REPEAT,[wi]:n.CLAMP_TO_EDGE,[Fp]:n.MIRRORED_REPEAT},X={[lr]:n.NEAREST,[J5]:n.NEAREST_MIPMAP_NEAREST,[zc]:n.NEAREST_MIPMAP_LINEAR,[Dn]:n.LINEAR,[Ch]:n.LINEAR_MIPMAP_NEAREST,[oo]:n.LINEAR_MIPMAP_LINEAR},oe={[tR]:n.NEVER,[aR]:n.ALWAYS,[nR]:n.LESS,[kS]:n.LEQUAL,[rR]:n.EQUAL,[sR]:n.GEQUAL,[iR]:n.GREATER,[oR]:n.NOTEQUAL};function pe(N,k){if(k.type===Gn&&e.has("OES_texture_float_linear")===!1&&(k.magFilter===Dn||k.magFilter===Ch||k.magFilter===zc||k.magFilter===oo||k.minFilter===Dn||k.minFilter===Ch||k.minFilter===zc||k.minFilter===oo)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(N,n.TEXTURE_WRAP_S,Y[k.wrapS]),n.texParameteri(N,n.TEXTURE_WRAP_T,Y[k.wrapT]),(N===n.TEXTURE_3D||N===n.TEXTURE_2D_ARRAY)&&n.texParameteri(N,n.TEXTURE_WRAP_R,Y[k.wrapR]),n.texParameteri(N,n.TEXTURE_MAG_FILTER,X[k.magFilter]),n.texParameteri(N,n.TEXTURE_MIN_FILTER,X[k.minFilter]),k.compareFunction&&(n.texParameteri(N,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(N,n.TEXTURE_COMPARE_FUNC,oe[k.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(k.magFilter===lr||k.minFilter!==zc&&k.minFilter!==oo||k.type===Gn&&e.has("OES_texture_float_linear")===!1)return;if(k.anisotropy>1||r.get(k).__currentAnisotropy){const G=e.get("EXT_texture_filter_anisotropic");n.texParameterf(N,G.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(k.anisotropy,i.getMaxAnisotropy())),r.get(k).__currentAnisotropy=k.anisotropy}}}function De(N,k){let G=!1;N.__webglInit===void 0&&(N.__webglInit=!0,k.addEventListener("dispose",C));const ue=k.source;let Me=f.get(ue);Me===void 0&&(Me={},f.set(ue,Me));const ge=$(k);if(ge!==N.__cacheKey){Me[ge]===void 0&&(Me[ge]={texture:n.createTexture(),usedTimes:0},s.memory.textures++,G=!0),Me[ge].usedTimes++;const $e=Me[N.__cacheKey];$e!==void 0&&(Me[N.__cacheKey].usedTimes--,$e.usedTimes===0&&w(k)),N.__cacheKey=ge,N.__webglTexture=Me[ge].texture}return G}function z(N,k,G){return Math.floor(Math.floor(N/G)/k)}function ve(N,k,G,ue){const ge=N.updateRanges;if(ge.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,k.width,k.height,G,ue,k.data);else{ge.sort((_e,Le)=>_e.start-Le.start);let $e=0;for(let _e=1;_e<ge.length;_e++){const Le=ge[$e],qe=ge[_e],re=Le.start+Le.count,ie=z(qe.start,k.width,4),we=z(Le.start,k.width,4);qe.start<=re+1&&ie===we&&z(qe.start+qe.count-1,k.width,4)===ie?Le.count=Math.max(Le.count,qe.start+qe.count-Le.start):(++$e,ge[$e]=qe)}ge.length=$e+1;const ke=n.getParameter(n.UNPACK_ROW_LENGTH),We=n.getParameter(n.UNPACK_SKIP_PIXELS),Je=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,k.width);for(let _e=0,Le=ge.length;_e<Le;_e++){const qe=ge[_e],re=Math.floor(qe.start/4),ie=Math.ceil(qe.count/4),we=re%k.width,U=Math.floor(re/k.width),se=ie,he=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,we),n.pixelStorei(n.UNPACK_SKIP_ROWS,U),t.texSubImage2D(n.TEXTURE_2D,0,we,U,se,he,G,ue,k.data)}N.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,ke),n.pixelStorei(n.UNPACK_SKIP_PIXELS,We),n.pixelStorei(n.UNPACK_SKIP_ROWS,Je)}}function j(N,k,G){let ue=n.TEXTURE_2D;(k.isDataArrayTexture||k.isCompressedArrayTexture)&&(ue=n.TEXTURE_2D_ARRAY),k.isData3DTexture&&(ue=n.TEXTURE_3D);const Me=De(N,k),ge=k.source;t.bindTexture(ue,N.__webglTexture,n.TEXTURE0+G);const $e=r.get(ge);if(ge.version!==$e.__version||Me===!0){t.activeTexture(n.TEXTURE0+G);const ke=Pt.getPrimaries(Pt.workingColorSpace),We=k.colorSpace===no?null:Pt.getPrimaries(k.colorSpace),Je=k.colorSpace===no||ke===We?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,k.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,k.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Je);let _e=_(k.image,!1,i.maxTextureSize);_e=Ke(k,_e);const Le=o.convert(k.format,k.colorSpace),qe=o.convert(k.type);let re=g(k.internalFormat,Le,qe,k.colorSpace,k.isVideoTexture);pe(ue,k);let ie;const we=k.mipmaps,U=k.isVideoTexture!==!0,se=$e.__version===void 0||Me===!0,he=ge.dataReady,Oe=E(k,_e);if(k.isDepthTexture)re=y(k.format===Jl,k.type),se&&(U?t.texStorage2D(n.TEXTURE_2D,1,re,_e.width,_e.height):t.texImage2D(n.TEXTURE_2D,0,re,_e.width,_e.height,0,Le,qe,null));else if(k.isDataTexture)if(we.length>0){U&&se&&t.texStorage2D(n.TEXTURE_2D,Oe,re,we[0].width,we[0].height);for(let Te=0,ce=we.length;Te<ce;Te++)ie=we[Te],U?he&&t.texSubImage2D(n.TEXTURE_2D,Te,0,0,ie.width,ie.height,Le,qe,ie.data):t.texImage2D(n.TEXTURE_2D,Te,re,ie.width,ie.height,0,Le,qe,ie.data);k.generateMipmaps=!1}else U?(se&&t.texStorage2D(n.TEXTURE_2D,Oe,re,_e.width,_e.height),he&&ve(k,_e,Le,qe)):t.texImage2D(n.TEXTURE_2D,0,re,_e.width,_e.height,0,Le,qe,_e.data);else if(k.isCompressedTexture)if(k.isCompressedArrayTexture){U&&se&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Oe,re,we[0].width,we[0].height,_e.depth);for(let Te=0,ce=we.length;Te<ce;Te++)if(ie=we[Te],k.format!==Lr)if(Le!==null)if(U){if(he)if(k.layerUpdates.size>0){const K=dx(ie.width,ie.height,k.format,k.type);for(const be of k.layerUpdates){const Be=ie.data.subarray(be*K/ie.data.BYTES_PER_ELEMENT,(be+1)*K/ie.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Te,0,0,be,ie.width,ie.height,1,Le,Be)}k.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Te,0,0,0,ie.width,ie.height,_e.depth,Le,ie.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Te,re,ie.width,ie.height,_e.depth,0,ie.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else U?he&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Te,0,0,0,ie.width,ie.height,_e.depth,Le,qe,ie.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Te,re,ie.width,ie.height,_e.depth,0,Le,qe,ie.data)}else{U&&se&&t.texStorage2D(n.TEXTURE_2D,Oe,re,we[0].width,we[0].height);for(let Te=0,ce=we.length;Te<ce;Te++)ie=we[Te],k.format!==Lr?Le!==null?U?he&&t.compressedTexSubImage2D(n.TEXTURE_2D,Te,0,0,ie.width,ie.height,Le,ie.data):t.compressedTexImage2D(n.TEXTURE_2D,Te,re,ie.width,ie.height,0,ie.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):U?he&&t.texSubImage2D(n.TEXTURE_2D,Te,0,0,ie.width,ie.height,Le,qe,ie.data):t.texImage2D(n.TEXTURE_2D,Te,re,ie.width,ie.height,0,Le,qe,ie.data)}else if(k.isDataArrayTexture)if(U){if(se&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Oe,re,_e.width,_e.height,_e.depth),he)if(k.layerUpdates.size>0){const Te=dx(_e.width,_e.height,k.format,k.type);for(const ce of k.layerUpdates){const K=_e.data.subarray(ce*Te/_e.data.BYTES_PER_ELEMENT,(ce+1)*Te/_e.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,ce,_e.width,_e.height,1,Le,qe,K)}k.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,_e.width,_e.height,_e.depth,Le,qe,_e.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,re,_e.width,_e.height,_e.depth,0,Le,qe,_e.data);else if(k.isData3DTexture)U?(se&&t.texStorage3D(n.TEXTURE_3D,Oe,re,_e.width,_e.height,_e.depth),he&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,_e.width,_e.height,_e.depth,Le,qe,_e.data)):t.texImage3D(n.TEXTURE_3D,0,re,_e.width,_e.height,_e.depth,0,Le,qe,_e.data);else if(k.isFramebufferTexture){if(se)if(U)t.texStorage2D(n.TEXTURE_2D,Oe,re,_e.width,_e.height);else{let Te=_e.width,ce=_e.height;for(let K=0;K<Oe;K++)t.texImage2D(n.TEXTURE_2D,K,re,Te,ce,0,Le,qe,null),Te>>=1,ce>>=1}}else if(we.length>0){if(U&&se){const Te=it(we[0]);t.texStorage2D(n.TEXTURE_2D,Oe,re,Te.width,Te.height)}for(let Te=0,ce=we.length;Te<ce;Te++)ie=we[Te],U?he&&t.texSubImage2D(n.TEXTURE_2D,Te,0,0,Le,qe,ie):t.texImage2D(n.TEXTURE_2D,Te,re,Le,qe,ie);k.generateMipmaps=!1}else if(U){if(se){const Te=it(_e);t.texStorage2D(n.TEXTURE_2D,Oe,re,Te.width,Te.height)}he&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Le,qe,_e)}else t.texImage2D(n.TEXTURE_2D,0,re,Le,qe,_e);x(k)&&p(ue),$e.__version=ge.version,k.onUpdate&&k.onUpdate(k)}N.__version=k.version}function ne(N,k,G){if(k.image.length!==6)return;const ue=De(N,k),Me=k.source;t.bindTexture(n.TEXTURE_CUBE_MAP,N.__webglTexture,n.TEXTURE0+G);const ge=r.get(Me);if(Me.version!==ge.__version||ue===!0){t.activeTexture(n.TEXTURE0+G);const $e=Pt.getPrimaries(Pt.workingColorSpace),ke=k.colorSpace===no?null:Pt.getPrimaries(k.colorSpace),We=k.colorSpace===no||$e===ke?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,k.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,k.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,k.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,We);const Je=k.isCompressedTexture||k.image[0].isCompressedTexture,_e=k.image[0]&&k.image[0].isDataTexture,Le=[];for(let ce=0;ce<6;ce++)!Je&&!_e?Le[ce]=_(k.image[ce],!0,i.maxCubemapSize):Le[ce]=_e?k.image[ce].image:k.image[ce],Le[ce]=Ke(k,Le[ce]);const qe=Le[0],re=o.convert(k.format,k.colorSpace),ie=o.convert(k.type),we=g(k.internalFormat,re,ie,k.colorSpace),U=k.isVideoTexture!==!0,se=ge.__version===void 0||ue===!0,he=Me.dataReady;let Oe=E(k,qe);pe(n.TEXTURE_CUBE_MAP,k);let Te;if(Je){U&&se&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Oe,we,qe.width,qe.height);for(let ce=0;ce<6;ce++){Te=Le[ce].mipmaps;for(let K=0;K<Te.length;K++){const be=Te[K];k.format!==Lr?re!==null?U?he&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K,0,0,be.width,be.height,re,be.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K,we,be.width,be.height,0,be.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):U?he&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K,0,0,be.width,be.height,re,ie,be.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K,we,be.width,be.height,0,re,ie,be.data)}}}else{if(Te=k.mipmaps,U&&se){Te.length>0&&Oe++;const ce=it(Le[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Oe,we,ce.width,ce.height)}for(let ce=0;ce<6;ce++)if(_e){U?he&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,0,0,Le[ce].width,Le[ce].height,re,ie,Le[ce].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,we,Le[ce].width,Le[ce].height,0,re,ie,Le[ce].data);for(let K=0;K<Te.length;K++){const Be=Te[K].image[ce].image;U?he&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K+1,0,0,Be.width,Be.height,re,ie,Be.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K+1,we,Be.width,Be.height,0,re,ie,Be.data)}}else{U?he&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,0,0,re,ie,Le[ce]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,0,we,re,ie,Le[ce]);for(let K=0;K<Te.length;K++){const be=Te[K];U?he&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K+1,0,0,re,ie,be.image[ce]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+ce,K+1,we,re,ie,be.image[ce])}}}x(k)&&p(n.TEXTURE_CUBE_MAP),ge.__version=Me.version,k.onUpdate&&k.onUpdate(k)}N.__version=k.version}function Ee(N,k,G,ue,Me,ge){const $e=o.convert(G.format,G.colorSpace),ke=o.convert(G.type),We=g(G.internalFormat,$e,ke,G.colorSpace),Je=r.get(k),_e=r.get(G);if(_e.__renderTarget=k,!Je.__hasExternalTextures){const Le=Math.max(1,k.width>>ge),qe=Math.max(1,k.height>>ge);Me===n.TEXTURE_3D||Me===n.TEXTURE_2D_ARRAY?t.texImage3D(Me,ge,We,Le,qe,k.depth,0,$e,ke,null):t.texImage2D(Me,ge,We,Le,qe,0,$e,ke,null)}t.bindFramebuffer(n.FRAMEBUFFER,N),Ue(k)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,ue,Me,_e.__webglTexture,0,Se(k)):(Me===n.TEXTURE_2D||Me>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Me<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,ue,Me,_e.__webglTexture,ge),t.bindFramebuffer(n.FRAMEBUFFER,null)}function me(N,k,G){if(n.bindRenderbuffer(n.RENDERBUFFER,N),k.depthBuffer){const ue=k.depthTexture,Me=ue&&ue.isDepthTexture?ue.type:null,ge=y(k.stencilBuffer,Me),$e=k.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ke=Se(k);Ue(k)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ke,ge,k.width,k.height):G?n.renderbufferStorageMultisample(n.RENDERBUFFER,ke,ge,k.width,k.height):n.renderbufferStorage(n.RENDERBUFFER,ge,k.width,k.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,$e,n.RENDERBUFFER,N)}else{const ue=k.textures;for(let Me=0;Me<ue.length;Me++){const ge=ue[Me],$e=o.convert(ge.format,ge.colorSpace),ke=o.convert(ge.type),We=g(ge.internalFormat,$e,ke,ge.colorSpace),Je=Se(k);G&&Ue(k)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Je,We,k.width,k.height):Ue(k)?a.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Je,We,k.width,k.height):n.renderbufferStorage(n.RENDERBUFFER,We,k.width,k.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function te(N,k){if(k&&k.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,N),!(k.depthTexture&&k.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const ue=r.get(k.depthTexture);ue.__renderTarget=k,(!ue.__webglTexture||k.depthTexture.image.width!==k.width||k.depthTexture.image.height!==k.height)&&(k.depthTexture.image.width=k.width,k.depthTexture.image.height=k.height,k.depthTexture.needsUpdate=!0),W(k.depthTexture,0);const Me=ue.__webglTexture,ge=Se(k);if(k.depthTexture.format===Kl)Ue(k)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Me,0,ge):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Me,0);else if(k.depthTexture.format===Jl)Ue(k)?a.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Me,0,ge):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Me,0);else throw new Error("Unknown depthTexture format")}function Pe(N){const k=r.get(N),G=N.isWebGLCubeRenderTarget===!0;if(k.__boundDepthTexture!==N.depthTexture){const ue=N.depthTexture;if(k.__depthDisposeCallback&&k.__depthDisposeCallback(),ue){const Me=()=>{delete k.__boundDepthTexture,delete k.__depthDisposeCallback,ue.removeEventListener("dispose",Me)};ue.addEventListener("dispose",Me),k.__depthDisposeCallback=Me}k.__boundDepthTexture=ue}if(N.depthTexture&&!k.__autoAllocateDepthBuffer){if(G)throw new Error("target.depthTexture not supported in Cube render targets");const ue=N.texture.mipmaps;ue&&ue.length>0?te(k.__webglFramebuffer[0],N):te(k.__webglFramebuffer,N)}else if(G){k.__webglDepthbuffer=[];for(let ue=0;ue<6;ue++)if(t.bindFramebuffer(n.FRAMEBUFFER,k.__webglFramebuffer[ue]),k.__webglDepthbuffer[ue]===void 0)k.__webglDepthbuffer[ue]=n.createRenderbuffer(),me(k.__webglDepthbuffer[ue],N,!1);else{const Me=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ge=k.__webglDepthbuffer[ue];n.bindRenderbuffer(n.RENDERBUFFER,ge),n.framebufferRenderbuffer(n.FRAMEBUFFER,Me,n.RENDERBUFFER,ge)}}else{const ue=N.texture.mipmaps;if(ue&&ue.length>0?t.bindFramebuffer(n.FRAMEBUFFER,k.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,k.__webglFramebuffer),k.__webglDepthbuffer===void 0)k.__webglDepthbuffer=n.createRenderbuffer(),me(k.__webglDepthbuffer,N,!1);else{const Me=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ge=k.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,ge),n.framebufferRenderbuffer(n.FRAMEBUFFER,Me,n.RENDERBUFFER,ge)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function je(N,k,G){const ue=r.get(N);k!==void 0&&Ee(ue.__webglFramebuffer,N,N.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),G!==void 0&&Pe(N)}function L(N){const k=N.texture,G=r.get(N),ue=r.get(k);N.addEventListener("dispose",A);const Me=N.textures,ge=N.isWebGLCubeRenderTarget===!0,$e=Me.length>1;if($e||(ue.__webglTexture===void 0&&(ue.__webglTexture=n.createTexture()),ue.__version=k.version,s.memory.textures++),ge){G.__webglFramebuffer=[];for(let ke=0;ke<6;ke++)if(k.mipmaps&&k.mipmaps.length>0){G.__webglFramebuffer[ke]=[];for(let We=0;We<k.mipmaps.length;We++)G.__webglFramebuffer[ke][We]=n.createFramebuffer()}else G.__webglFramebuffer[ke]=n.createFramebuffer()}else{if(k.mipmaps&&k.mipmaps.length>0){G.__webglFramebuffer=[];for(let ke=0;ke<k.mipmaps.length;ke++)G.__webglFramebuffer[ke]=n.createFramebuffer()}else G.__webglFramebuffer=n.createFramebuffer();if($e)for(let ke=0,We=Me.length;ke<We;ke++){const Je=r.get(Me[ke]);Je.__webglTexture===void 0&&(Je.__webglTexture=n.createTexture(),s.memory.textures++)}if(N.samples>0&&Ue(N)===!1){G.__webglMultisampledFramebuffer=n.createFramebuffer(),G.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,G.__webglMultisampledFramebuffer);for(let ke=0;ke<Me.length;ke++){const We=Me[ke];G.__webglColorRenderbuffer[ke]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,G.__webglColorRenderbuffer[ke]);const Je=o.convert(We.format,We.colorSpace),_e=o.convert(We.type),Le=g(We.internalFormat,Je,_e,We.colorSpace,N.isXRRenderTarget===!0),qe=Se(N);n.renderbufferStorageMultisample(n.RENDERBUFFER,qe,Le,N.width,N.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+ke,n.RENDERBUFFER,G.__webglColorRenderbuffer[ke])}n.bindRenderbuffer(n.RENDERBUFFER,null),N.depthBuffer&&(G.__webglDepthRenderbuffer=n.createRenderbuffer(),me(G.__webglDepthRenderbuffer,N,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ge){t.bindTexture(n.TEXTURE_CUBE_MAP,ue.__webglTexture),pe(n.TEXTURE_CUBE_MAP,k);for(let ke=0;ke<6;ke++)if(k.mipmaps&&k.mipmaps.length>0)for(let We=0;We<k.mipmaps.length;We++)Ee(G.__webglFramebuffer[ke][We],N,k,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,We);else Ee(G.__webglFramebuffer[ke],N,k,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0);x(k)&&p(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if($e){for(let ke=0,We=Me.length;ke<We;ke++){const Je=Me[ke],_e=r.get(Je);let Le=n.TEXTURE_2D;(N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(Le=N.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Le,_e.__webglTexture),pe(Le,Je),Ee(G.__webglFramebuffer,N,Je,n.COLOR_ATTACHMENT0+ke,Le,0),x(Je)&&p(Le)}t.unbindTexture()}else{let ke=n.TEXTURE_2D;if((N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(ke=N.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(ke,ue.__webglTexture),pe(ke,k),k.mipmaps&&k.mipmaps.length>0)for(let We=0;We<k.mipmaps.length;We++)Ee(G.__webglFramebuffer[We],N,k,n.COLOR_ATTACHMENT0,ke,We);else Ee(G.__webglFramebuffer,N,k,n.COLOR_ATTACHMENT0,ke,0);x(k)&&p(ke),t.unbindTexture()}N.depthBuffer&&Pe(N)}function Fe(N){const k=N.textures;for(let G=0,ue=k.length;G<ue;G++){const Me=k[G];if(x(Me)){const ge=b(N),$e=r.get(Me).__webglTexture;t.bindTexture(ge,$e),p(ge),t.unbindTexture()}}}const Re=[],Ne=[];function de(N){if(N.samples>0){if(Ue(N)===!1){const k=N.textures,G=N.width,ue=N.height;let Me=n.COLOR_BUFFER_BIT;const ge=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,$e=r.get(N),ke=k.length>1;if(ke)for(let Je=0;Je<k.length;Je++)t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,$e.__webglMultisampledFramebuffer);const We=N.texture.mipmaps;We&&We.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglFramebuffer);for(let Je=0;Je<k.length;Je++){if(N.resolveDepthBuffer&&(N.depthBuffer&&(Me|=n.DEPTH_BUFFER_BIT),N.stencilBuffer&&N.resolveStencilBuffer&&(Me|=n.STENCIL_BUFFER_BIT)),ke){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,$e.__webglColorRenderbuffer[Je]);const _e=r.get(k[Je]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,_e,0)}n.blitFramebuffer(0,0,G,ue,0,0,G,ue,Me,n.NEAREST),l===!0&&(Re.length=0,Ne.length=0,Re.push(n.COLOR_ATTACHMENT0+Je),N.depthBuffer&&N.resolveDepthBuffer===!1&&(Re.push(ge),Ne.push(ge),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Ne)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Re))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),ke)for(let Je=0;Je<k.length;Je++){t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.RENDERBUFFER,$e.__webglColorRenderbuffer[Je]);const _e=r.get(k[Je]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,$e.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.TEXTURE_2D,_e,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,$e.__webglMultisampledFramebuffer)}else if(N.depthBuffer&&N.resolveDepthBuffer===!1&&l){const k=N.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[k])}}}function Se(N){return Math.min(i.maxSamples,N.samples)}function Ue(N){const k=r.get(N);return N.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&k.__useRenderToTexture!==!1}function ze(N){const k=s.render.frame;u.get(N)!==k&&(u.set(N,k),N.update())}function Ke(N,k){const G=N.colorSpace,ue=N.format,Me=N.type;return N.isCompressedTexture===!0||N.isVideoTexture===!0||G!==us&&G!==no&&(Pt.getTransfer(G)===Lt?(ue!==Lr||Me!==Kr)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",G)),k}function it(N){return typeof HTMLImageElement<"u"&&N instanceof HTMLImageElement?(c.width=N.naturalWidth||N.width,c.height=N.naturalHeight||N.height):typeof VideoFrame<"u"&&N instanceof VideoFrame?(c.width=N.displayWidth,c.height=N.displayHeight):(c.width=N.width,c.height=N.height),c}this.allocateTextureUnit=D,this.resetTextureUnits=I,this.setTexture2D=W,this.setTexture2DArray=H,this.setTexture3D=Z,this.setTextureCube=F,this.rebindTextures=je,this.setupRenderTarget=L,this.updateRenderTargetMipmap=Fe,this.updateMultisampleRenderTarget=de,this.setupDepthRenderbuffer=Pe,this.setupFrameBufferTexture=Ee,this.useMultisampledRTT=Ue}function AL(n,e){function t(r,i=no){let o;const s=Pt.getTransfer(i);if(r===Kr)return n.UNSIGNED_BYTE;if(r===Tg)return n.UNSIGNED_SHORT_4_4_4_4;if(r===Cg)return n.UNSIGNED_SHORT_5_5_5_1;if(r===MS)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===TS)return n.UNSIGNED_INT_10F_11F_11F_REV;if(r===wS)return n.BYTE;if(r===ES)return n.SHORT;if(r===Yl)return n.UNSIGNED_SHORT;if(r===Mg)return n.INT;if(r===cs)return n.UNSIGNED_INT;if(r===Gn)return n.FLOAT;if(r===Ei)return n.HALF_FLOAT;if(r===CS)return n.ALPHA;if(r===RS)return n.RGB;if(r===Lr)return n.RGBA;if(r===Kl)return n.DEPTH_COMPONENT;if(r===Jl)return n.DEPTH_STENCIL;if(r===Rg)return n.RED;if(r===Ag)return n.RED_INTEGER;if(r===AS)return n.RG;if(r===Pg)return n.RG_INTEGER;if(r===kg)return n.RGBA_INTEGER;if(r===Tu||r===Cu||r===Ru||r===Au)if(s===Lt)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(r===Tu)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Cu)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Ru)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Au)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===Tu)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Cu)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Ru)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Au)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===jp||r===Bp||r===Hp||r===Wp)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===jp)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===Bp)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===Hp)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===Wp)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===Vp||r===$p||r===Gp)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(r===Vp||r===$p)return s===Lt?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(r===Gp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===Xp||r===Yp||r===qp||r===Kp||r===Jp||r===Zp||r===Qp||r===em||r===tm||r===nm||r===rm||r===im||r===om||r===sm)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(r===Xp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===Yp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===qp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===Kp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===Jp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===Zp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===Qp)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===em)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===tm)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===nm)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===rm)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===im)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===om)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===sm)return s===Lt?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===am||r===lm||r===cm)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(r===am)return s===Lt?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===lm)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===cm)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===um||r===dm||r===hm||r===fm)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(r===um)return o.COMPRESSED_RED_RGTC1_EXT;if(r===dm)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===hm)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===fm)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===ql?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}const PL=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,kL=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class IL{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const r=new VS(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new Eo({vertexShader:PL,fragmentShader:kL,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new bn(new Fd(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class LL extends gs{constructor(e,t){super();const r=this;let i=null,o=1,s=null,a="local-floor",l=1,c=null,u=null,d=null,f=null,m=null,v=null;const _=typeof XRWebGLBinding<"u",x=new IL,p={},b=t.getContextAttributes();let g=null,y=null;const E=[],C=[],A=new gt;let T=null;const w=new or;w.viewport=new Jt;const M=new or;M.viewport=new Jt;const P=[w,M],I=new QR;let D=null,$=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(j){let ne=E[j];return ne===void 0&&(ne=new qh,E[j]=ne),ne.getTargetRaySpace()},this.getControllerGrip=function(j){let ne=E[j];return ne===void 0&&(ne=new qh,E[j]=ne),ne.getGripSpace()},this.getHand=function(j){let ne=E[j];return ne===void 0&&(ne=new qh,E[j]=ne),ne.getHandSpace()};function W(j){const ne=C.indexOf(j.inputSource);if(ne===-1)return;const Ee=E[ne];Ee!==void 0&&(Ee.update(j.inputSource,j.frame,c||s),Ee.dispatchEvent({type:j.type,data:j.inputSource}))}function H(){i.removeEventListener("select",W),i.removeEventListener("selectstart",W),i.removeEventListener("selectend",W),i.removeEventListener("squeeze",W),i.removeEventListener("squeezestart",W),i.removeEventListener("squeezeend",W),i.removeEventListener("end",H),i.removeEventListener("inputsourceschange",Z);for(let j=0;j<E.length;j++){const ne=C[j];ne!==null&&(C[j]=null,E[j].disconnect(ne))}D=null,$=null,x.reset();for(const j in p)delete p[j];e.setRenderTarget(g),m=null,f=null,d=null,i=null,y=null,ve.stop(),r.isPresenting=!1,e.setPixelRatio(T),e.setSize(A.width,A.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(j){o=j,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(j){a=j,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c||s},this.setReferenceSpace=function(j){c=j},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return d===null&&_&&(d=new XRWebGLBinding(i,t)),d},this.getFrame=function(){return v},this.getSession=function(){return i},this.setSession=async function(j){if(i=j,i!==null){if(g=e.getRenderTarget(),i.addEventListener("select",W),i.addEventListener("selectstart",W),i.addEventListener("selectend",W),i.addEventListener("squeeze",W),i.addEventListener("squeezestart",W),i.addEventListener("squeezeend",W),i.addEventListener("end",H),i.addEventListener("inputsourceschange",Z),b.xrCompatible!==!0&&await t.makeXRCompatible(),T=e.getPixelRatio(),e.getSize(A),_&&"createProjectionLayer"in XRWebGLBinding.prototype){let Ee=null,me=null,te=null;b.depth&&(te=b.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,Ee=b.stencil?Jl:Kl,me=b.stencil?ql:cs);const Pe={colorFormat:t.RGBA8,depthFormat:te,scaleFactor:o};d=this.getBinding(),f=d.createProjectionLayer(Pe),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),y=new ds(f.textureWidth,f.textureHeight,{format:Lr,type:Kr,depthTexture:new WS(f.textureWidth,f.textureHeight,me,void 0,void 0,void 0,void 0,void 0,void 0,Ee),stencilBuffer:b.stencil,colorSpace:e.outputColorSpace,samples:b.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const Ee={antialias:b.antialias,alpha:!0,depth:b.depth,stencil:b.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(i,t,Ee),i.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),y=new ds(m.framebufferWidth,m.framebufferHeight,{format:Lr,type:Kr,colorSpace:e.outputColorSpace,stencilBuffer:b.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}y.isXRRenderTarget=!0,this.setFoveation(l),c=null,s=await i.requestReferenceSpace(a),ve.setContext(i),ve.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return x.getDepthTexture()};function Z(j){for(let ne=0;ne<j.removed.length;ne++){const Ee=j.removed[ne],me=C.indexOf(Ee);me>=0&&(C[me]=null,E[me].disconnect(Ee))}for(let ne=0;ne<j.added.length;ne++){const Ee=j.added[ne];let me=C.indexOf(Ee);if(me===-1){for(let Pe=0;Pe<E.length;Pe++)if(Pe>=C.length){C.push(Ee),me=Pe;break}else if(C[Pe]===null){C[Pe]=Ee,me=Pe;break}if(me===-1)break}const te=E[me];te&&te.connect(Ee)}}const F=new ae,Y=new ae;function X(j,ne,Ee){F.setFromMatrixPosition(ne.matrixWorld),Y.setFromMatrixPosition(Ee.matrixWorld);const me=F.distanceTo(Y),te=ne.projectionMatrix.elements,Pe=Ee.projectionMatrix.elements,je=te[14]/(te[10]-1),L=te[14]/(te[10]+1),Fe=(te[9]+1)/te[5],Re=(te[9]-1)/te[5],Ne=(te[8]-1)/te[0],de=(Pe[8]+1)/Pe[0],Se=je*Ne,Ue=je*de,ze=me/(-Ne+de),Ke=ze*-Ne;if(ne.matrixWorld.decompose(j.position,j.quaternion,j.scale),j.translateX(Ke),j.translateZ(ze),j.matrixWorld.compose(j.position,j.quaternion,j.scale),j.matrixWorldInverse.copy(j.matrixWorld).invert(),te[10]===-1)j.projectionMatrix.copy(ne.projectionMatrix),j.projectionMatrixInverse.copy(ne.projectionMatrixInverse);else{const it=je+ze,N=L+ze,k=Se-Ke,G=Ue+(me-Ke),ue=Fe*L/N*it,Me=Re*L/N*it;j.projectionMatrix.makePerspective(k,G,ue,Me,it,N),j.projectionMatrixInverse.copy(j.projectionMatrix).invert()}}function oe(j,ne){ne===null?j.matrixWorld.copy(j.matrix):j.matrixWorld.multiplyMatrices(ne.matrixWorld,j.matrix),j.matrixWorldInverse.copy(j.matrixWorld).invert()}this.updateCamera=function(j){if(i===null)return;let ne=j.near,Ee=j.far;x.texture!==null&&(x.depthNear>0&&(ne=x.depthNear),x.depthFar>0&&(Ee=x.depthFar)),I.near=M.near=w.near=ne,I.far=M.far=w.far=Ee,(D!==I.near||$!==I.far)&&(i.updateRenderState({depthNear:I.near,depthFar:I.far}),D=I.near,$=I.far),I.layers.mask=j.layers.mask|6,w.layers.mask=I.layers.mask&3,M.layers.mask=I.layers.mask&5;const me=j.parent,te=I.cameras;oe(I,me);for(let Pe=0;Pe<te.length;Pe++)oe(te[Pe],me);te.length===2?X(I,w,M):I.projectionMatrix.copy(w.projectionMatrix),pe(j,I,me)};function pe(j,ne,Ee){Ee===null?j.matrix.copy(ne.matrixWorld):(j.matrix.copy(Ee.matrixWorld),j.matrix.invert(),j.matrix.multiply(ne.matrixWorld)),j.matrix.decompose(j.position,j.quaternion,j.scale),j.updateMatrixWorld(!0),j.projectionMatrix.copy(ne.projectionMatrix),j.projectionMatrixInverse.copy(ne.projectionMatrixInverse),j.isPerspectiveCamera&&(j.fov=pm*2*Math.atan(1/j.projectionMatrix.elements[5]),j.zoom=1)}this.getCamera=function(){return I},this.getFoveation=function(){if(!(f===null&&m===null))return l},this.setFoveation=function(j){l=j,f!==null&&(f.fixedFoveation=j),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=j)},this.hasDepthSensing=function(){return x.texture!==null},this.getDepthSensingMesh=function(){return x.getMesh(I)},this.getCameraTexture=function(j){return p[j]};let De=null;function z(j,ne){if(u=ne.getViewerPose(c||s),v=ne,u!==null){const Ee=u.views;m!==null&&(e.setRenderTargetFramebuffer(y,m.framebuffer),e.setRenderTarget(y));let me=!1;Ee.length!==I.cameras.length&&(I.cameras.length=0,me=!0);for(let L=0;L<Ee.length;L++){const Fe=Ee[L];let Re=null;if(m!==null)Re=m.getViewport(Fe);else{const de=d.getViewSubImage(f,Fe);Re=de.viewport,L===0&&(e.setRenderTargetTextures(y,de.colorTexture,de.depthStencilTexture),e.setRenderTarget(y))}let Ne=P[L];Ne===void 0&&(Ne=new or,Ne.layers.enable(L),Ne.viewport=new Jt,P[L]=Ne),Ne.matrix.fromArray(Fe.transform.matrix),Ne.matrix.decompose(Ne.position,Ne.quaternion,Ne.scale),Ne.projectionMatrix.fromArray(Fe.projectionMatrix),Ne.projectionMatrixInverse.copy(Ne.projectionMatrix).invert(),Ne.viewport.set(Re.x,Re.y,Re.width,Re.height),L===0&&(I.matrix.copy(Ne.matrix),I.matrix.decompose(I.position,I.quaternion,I.scale)),me===!0&&I.cameras.push(Ne)}const te=i.enabledFeatures;if(te&&te.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&_){d=r.getBinding();const L=d.getDepthInformation(Ee[0]);L&&L.isValid&&L.texture&&x.init(L,i.renderState)}if(te&&te.includes("camera-access")&&_){e.state.unbindTexture(),d=r.getBinding();for(let L=0;L<Ee.length;L++){const Fe=Ee[L].camera;if(Fe){let Re=p[Fe];Re||(Re=new VS,p[Fe]=Re);const Ne=d.getCameraImage(Fe);Re.sourceTexture=Ne}}}}for(let Ee=0;Ee<E.length;Ee++){const me=C[Ee],te=E[Ee];me!==null&&te!==void 0&&te.update(me,ne,c||s)}De&&De(j,ne),ne.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ne}),v=null}const ve=new qS;ve.setAnimationLoop(z),this.setAnimationLoop=function(j){De=j},this.dispose=function(){}}}const zo=new Zr,DL=new kt;function NL(n,e){function t(x,p){x.matrixAutoUpdate===!0&&x.updateMatrix(),p.value.copy(x.matrix)}function r(x,p){p.color.getRGB(x.fogColor.value,zS(n)),p.isFog?(x.fogNear.value=p.near,x.fogFar.value=p.far):p.isFogExp2&&(x.fogDensity.value=p.density)}function i(x,p,b,g,y){p.isMeshBasicMaterial||p.isMeshLambertMaterial?o(x,p):p.isMeshToonMaterial?(o(x,p),d(x,p)):p.isMeshPhongMaterial?(o(x,p),u(x,p)):p.isMeshStandardMaterial?(o(x,p),f(x,p),p.isMeshPhysicalMaterial&&m(x,p,y)):p.isMeshMatcapMaterial?(o(x,p),v(x,p)):p.isMeshDepthMaterial?o(x,p):p.isMeshDistanceMaterial?(o(x,p),_(x,p)):p.isMeshNormalMaterial?o(x,p):p.isLineBasicMaterial?(s(x,p),p.isLineDashedMaterial&&a(x,p)):p.isPointsMaterial?l(x,p,b,g):p.isSpriteMaterial?c(x,p):p.isShadowMaterial?(x.color.value.copy(p.color),x.opacity.value=p.opacity):p.isShaderMaterial&&(p.uniformsNeedUpdate=!1)}function o(x,p){x.opacity.value=p.opacity,p.color&&x.diffuse.value.copy(p.color),p.emissive&&x.emissive.value.copy(p.emissive).multiplyScalar(p.emissiveIntensity),p.map&&(x.map.value=p.map,t(p.map,x.mapTransform)),p.alphaMap&&(x.alphaMap.value=p.alphaMap,t(p.alphaMap,x.alphaMapTransform)),p.bumpMap&&(x.bumpMap.value=p.bumpMap,t(p.bumpMap,x.bumpMapTransform),x.bumpScale.value=p.bumpScale,p.side===Kn&&(x.bumpScale.value*=-1)),p.normalMap&&(x.normalMap.value=p.normalMap,t(p.normalMap,x.normalMapTransform),x.normalScale.value.copy(p.normalScale),p.side===Kn&&x.normalScale.value.negate()),p.displacementMap&&(x.displacementMap.value=p.displacementMap,t(p.displacementMap,x.displacementMapTransform),x.displacementScale.value=p.displacementScale,x.displacementBias.value=p.displacementBias),p.emissiveMap&&(x.emissiveMap.value=p.emissiveMap,t(p.emissiveMap,x.emissiveMapTransform)),p.specularMap&&(x.specularMap.value=p.specularMap,t(p.specularMap,x.specularMapTransform)),p.alphaTest>0&&(x.alphaTest.value=p.alphaTest);const b=e.get(p),g=b.envMap,y=b.envMapRotation;g&&(x.envMap.value=g,zo.copy(y),zo.x*=-1,zo.y*=-1,zo.z*=-1,g.isCubeTexture&&g.isRenderTargetTexture===!1&&(zo.y*=-1,zo.z*=-1),x.envMapRotation.value.setFromMatrix4(DL.makeRotationFromEuler(zo)),x.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,x.reflectivity.value=p.reflectivity,x.ior.value=p.ior,x.refractionRatio.value=p.refractionRatio),p.lightMap&&(x.lightMap.value=p.lightMap,x.lightMapIntensity.value=p.lightMapIntensity,t(p.lightMap,x.lightMapTransform)),p.aoMap&&(x.aoMap.value=p.aoMap,x.aoMapIntensity.value=p.aoMapIntensity,t(p.aoMap,x.aoMapTransform))}function s(x,p){x.diffuse.value.copy(p.color),x.opacity.value=p.opacity,p.map&&(x.map.value=p.map,t(p.map,x.mapTransform))}function a(x,p){x.dashSize.value=p.dashSize,x.totalSize.value=p.dashSize+p.gapSize,x.scale.value=p.scale}function l(x,p,b,g){x.diffuse.value.copy(p.color),x.opacity.value=p.opacity,x.size.value=p.size*b,x.scale.value=g*.5,p.map&&(x.map.value=p.map,t(p.map,x.uvTransform)),p.alphaMap&&(x.alphaMap.value=p.alphaMap,t(p.alphaMap,x.alphaMapTransform)),p.alphaTest>0&&(x.alphaTest.value=p.alphaTest)}function c(x,p){x.diffuse.value.copy(p.color),x.opacity.value=p.opacity,x.rotation.value=p.rotation,p.map&&(x.map.value=p.map,t(p.map,x.mapTransform)),p.alphaMap&&(x.alphaMap.value=p.alphaMap,t(p.alphaMap,x.alphaMapTransform)),p.alphaTest>0&&(x.alphaTest.value=p.alphaTest)}function u(x,p){x.specular.value.copy(p.specular),x.shininess.value=Math.max(p.shininess,1e-4)}function d(x,p){p.gradientMap&&(x.gradientMap.value=p.gradientMap)}function f(x,p){x.metalness.value=p.metalness,p.metalnessMap&&(x.metalnessMap.value=p.metalnessMap,t(p.metalnessMap,x.metalnessMapTransform)),x.roughness.value=p.roughness,p.roughnessMap&&(x.roughnessMap.value=p.roughnessMap,t(p.roughnessMap,x.roughnessMapTransform)),p.envMap&&(x.envMapIntensity.value=p.envMapIntensity)}function m(x,p,b){x.ior.value=p.ior,p.sheen>0&&(x.sheenColor.value.copy(p.sheenColor).multiplyScalar(p.sheen),x.sheenRoughness.value=p.sheenRoughness,p.sheenColorMap&&(x.sheenColorMap.value=p.sheenColorMap,t(p.sheenColorMap,x.sheenColorMapTransform)),p.sheenRoughnessMap&&(x.sheenRoughnessMap.value=p.sheenRoughnessMap,t(p.sheenRoughnessMap,x.sheenRoughnessMapTransform))),p.clearcoat>0&&(x.clearcoat.value=p.clearcoat,x.clearcoatRoughness.value=p.clearcoatRoughness,p.clearcoatMap&&(x.clearcoatMap.value=p.clearcoatMap,t(p.clearcoatMap,x.clearcoatMapTransform)),p.clearcoatRoughnessMap&&(x.clearcoatRoughnessMap.value=p.clearcoatRoughnessMap,t(p.clearcoatRoughnessMap,x.clearcoatRoughnessMapTransform)),p.clearcoatNormalMap&&(x.clearcoatNormalMap.value=p.clearcoatNormalMap,t(p.clearcoatNormalMap,x.clearcoatNormalMapTransform),x.clearcoatNormalScale.value.copy(p.clearcoatNormalScale),p.side===Kn&&x.clearcoatNormalScale.value.negate())),p.dispersion>0&&(x.dispersion.value=p.dispersion),p.iridescence>0&&(x.iridescence.value=p.iridescence,x.iridescenceIOR.value=p.iridescenceIOR,x.iridescenceThicknessMinimum.value=p.iridescenceThicknessRange[0],x.iridescenceThicknessMaximum.value=p.iridescenceThicknessRange[1],p.iridescenceMap&&(x.iridescenceMap.value=p.iridescenceMap,t(p.iridescenceMap,x.iridescenceMapTransform)),p.iridescenceThicknessMap&&(x.iridescenceThicknessMap.value=p.iridescenceThicknessMap,t(p.iridescenceThicknessMap,x.iridescenceThicknessMapTransform))),p.transmission>0&&(x.transmission.value=p.transmission,x.transmissionSamplerMap.value=b.texture,x.transmissionSamplerSize.value.set(b.width,b.height),p.transmissionMap&&(x.transmissionMap.value=p.transmissionMap,t(p.transmissionMap,x.transmissionMapTransform)),x.thickness.value=p.thickness,p.thicknessMap&&(x.thicknessMap.value=p.thicknessMap,t(p.thicknessMap,x.thicknessMapTransform)),x.attenuationDistance.value=p.attenuationDistance,x.attenuationColor.value.copy(p.attenuationColor)),p.anisotropy>0&&(x.anisotropyVector.value.set(p.anisotropy*Math.cos(p.anisotropyRotation),p.anisotropy*Math.sin(p.anisotropyRotation)),p.anisotropyMap&&(x.anisotropyMap.value=p.anisotropyMap,t(p.anisotropyMap,x.anisotropyMapTransform))),x.specularIntensity.value=p.specularIntensity,x.specularColor.value.copy(p.specularColor),p.specularColorMap&&(x.specularColorMap.value=p.specularColorMap,t(p.specularColorMap,x.specularColorMapTransform)),p.specularIntensityMap&&(x.specularIntensityMap.value=p.specularIntensityMap,t(p.specularIntensityMap,x.specularIntensityMapTransform))}function v(x,p){p.matcap&&(x.matcap.value=p.matcap)}function _(x,p){const b=e.get(p).light;x.referencePosition.value.setFromMatrixPosition(b.matrixWorld),x.nearDistance.value=b.shadow.camera.near,x.farDistance.value=b.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function OL(n,e,t,r){let i={},o={},s=[];const a=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function l(b,g){const y=g.program;r.uniformBlockBinding(b,y)}function c(b,g){let y=i[b.id];y===void 0&&(v(b),y=u(b),i[b.id]=y,b.addEventListener("dispose",x));const E=g.program;r.updateUBOMapping(b,E);const C=e.render.frame;o[b.id]!==C&&(f(b),o[b.id]=C)}function u(b){const g=d();b.__bindingPointIndex=g;const y=n.createBuffer(),E=b.__size,C=b.usage;return n.bindBuffer(n.UNIFORM_BUFFER,y),n.bufferData(n.UNIFORM_BUFFER,E,C),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,g,y),y}function d(){for(let b=0;b<a;b++)if(s.indexOf(b)===-1)return s.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(b){const g=i[b.id],y=b.uniforms,E=b.__cache;n.bindBuffer(n.UNIFORM_BUFFER,g);for(let C=0,A=y.length;C<A;C++){const T=Array.isArray(y[C])?y[C]:[y[C]];for(let w=0,M=T.length;w<M;w++){const P=T[w];if(m(P,C,w,E)===!0){const I=P.__offset,D=Array.isArray(P.value)?P.value:[P.value];let $=0;for(let W=0;W<D.length;W++){const H=D[W],Z=_(H);typeof H=="number"||typeof H=="boolean"?(P.__data[0]=H,n.bufferSubData(n.UNIFORM_BUFFER,I+$,P.__data)):H.isMatrix3?(P.__data[0]=H.elements[0],P.__data[1]=H.elements[1],P.__data[2]=H.elements[2],P.__data[3]=0,P.__data[4]=H.elements[3],P.__data[5]=H.elements[4],P.__data[6]=H.elements[5],P.__data[7]=0,P.__data[8]=H.elements[6],P.__data[9]=H.elements[7],P.__data[10]=H.elements[8],P.__data[11]=0):(H.toArray(P.__data,$),$+=Z.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,I,P.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(b,g,y,E){const C=b.value,A=g+"_"+y;if(E[A]===void 0)return typeof C=="number"||typeof C=="boolean"?E[A]=C:E[A]=C.clone(),!0;{const T=E[A];if(typeof C=="number"||typeof C=="boolean"){if(T!==C)return E[A]=C,!0}else if(T.equals(C)===!1)return T.copy(C),!0}return!1}function v(b){const g=b.uniforms;let y=0;const E=16;for(let A=0,T=g.length;A<T;A++){const w=Array.isArray(g[A])?g[A]:[g[A]];for(let M=0,P=w.length;M<P;M++){const I=w[M],D=Array.isArray(I.value)?I.value:[I.value];for(let $=0,W=D.length;$<W;$++){const H=D[$],Z=_(H),F=y%E,Y=F%Z.boundary,X=F+Y;y+=Y,X!==0&&E-X<Z.storage&&(y+=E-X),I.__data=new Float32Array(Z.storage/Float32Array.BYTES_PER_ELEMENT),I.__offset=y,y+=Z.storage}}}const C=y%E;return C>0&&(y+=E-C),b.__size=y,b.__cache={},this}function _(b){const g={boundary:0,storage:0};return typeof b=="number"||typeof b=="boolean"?(g.boundary=4,g.storage=4):b.isVector2?(g.boundary=8,g.storage=8):b.isVector3||b.isColor?(g.boundary=16,g.storage=12):b.isVector4?(g.boundary=16,g.storage=16):b.isMatrix3?(g.boundary=48,g.storage=48):b.isMatrix4?(g.boundary=64,g.storage=64):b.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",b),g}function x(b){const g=b.target;g.removeEventListener("dispose",x);const y=s.indexOf(g.__bindingPointIndex);s.splice(y,1),n.deleteBuffer(i[g.id]),delete i[g.id],delete o[g.id]}function p(){for(const b in i)n.deleteBuffer(i[b]);s=[],i={},o={}}return{bind:l,update:c,dispose:p}}class ew{constructor(e={}){const{canvas:t=dR(),context:r=null,depth:i=!0,stencil:o=!1,alpha:s=!1,antialias:a=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:c=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1,reversedDepthBuffer:f=!1}=e;this.isWebGLRenderer=!0;let m;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");m=r.getContextAttributes().alpha}else m=s;const v=new Uint32Array(4),_=new Int32Array(4);let x=null,p=null;const b=[],g=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=vo,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const y=this;let E=!1;this._outputColorSpace=ir;let C=0,A=0,T=null,w=-1,M=null;const P=new Jt,I=new Jt;let D=null;const $=new pt(0);let W=0,H=t.width,Z=t.height,F=1,Y=null,X=null;const oe=new Jt(0,0,H,Z),pe=new Jt(0,0,H,Z);let De=!1;const z=new Ng;let ve=!1,j=!1;const ne=new kt,Ee=new ae,me=new Jt,te={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Pe=!1;function je(){return T===null?F:1}let L=r;function Fe(R,B){return t.getContext(R,B)}try{const R={alpha:!0,depth:i,stencil:o,antialias:a,premultipliedAlpha:l,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Eg}`),t.addEventListener("webglcontextlost",he,!1),t.addEventListener("webglcontextrestored",Oe,!1),t.addEventListener("webglcontextcreationerror",Te,!1),L===null){const B="webgl2";if(L=Fe(B,R),L===null)throw Fe(B)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(R){throw console.error("THREE.WebGLRenderer: "+R.message),R}let Re,Ne,de,Se,Ue,ze,Ke,it,N,k,G,ue,Me,ge,$e,ke,We,Je,_e,Le,qe,re,ie,we;function U(){Re=new Xk(L),Re.init(),re=new AL(L,Re),Ne=new jk(L,Re,e,re),de=new CL(L,Re),Ne.reversedDepthBuffer&&f&&de.buffers.depth.setReversed(!0),Se=new Kk(L),Ue=new pL,ze=new RL(L,Re,de,Ue,Ne,re,Se),Ke=new Hk(y),it=new Gk(y),N=new nA(L),ie=new zk(L,N),k=new Yk(L,N,Se,ie),G=new Zk(L,k,N,Se),_e=new Jk(L,Ne,ze),ke=new Bk(Ue),ue=new fL(y,Ke,it,Re,Ne,ie,ke),Me=new NL(y,Ue),ge=new gL,$e=new SL(Re),Je=new Uk(y,Ke,it,de,G,m,l),We=new ML(y,G,Ne),we=new OL(L,Se,Ne,de),Le=new Fk(L,Re,Se),qe=new qk(L,Re,Se),Se.programs=ue.programs,y.capabilities=Ne,y.extensions=Re,y.properties=Ue,y.renderLists=ge,y.shadowMap=We,y.state=de,y.info=Se}U();const se=new LL(y,L);this.xr=se,this.getContext=function(){return L},this.getContextAttributes=function(){return L.getContextAttributes()},this.forceContextLoss=function(){const R=Re.get("WEBGL_lose_context");R&&R.loseContext()},this.forceContextRestore=function(){const R=Re.get("WEBGL_lose_context");R&&R.restoreContext()},this.getPixelRatio=function(){return F},this.setPixelRatio=function(R){R!==void 0&&(F=R,this.setSize(H,Z,!1))},this.getSize=function(R){return R.set(H,Z)},this.setSize=function(R,B,J=!0){if(se.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}H=R,Z=B,t.width=Math.floor(R*F),t.height=Math.floor(B*F),J===!0&&(t.style.width=R+"px",t.style.height=B+"px"),this.setViewport(0,0,R,B)},this.getDrawingBufferSize=function(R){return R.set(H*F,Z*F).floor()},this.setDrawingBufferSize=function(R,B,J){H=R,Z=B,F=J,t.width=Math.floor(R*J),t.height=Math.floor(B*J),this.setViewport(0,0,R,B)},this.getCurrentViewport=function(R){return R.copy(P)},this.getViewport=function(R){return R.copy(oe)},this.setViewport=function(R,B,J,Q){R.isVector4?oe.set(R.x,R.y,R.z,R.w):oe.set(R,B,J,Q),de.viewport(P.copy(oe).multiplyScalar(F).round())},this.getScissor=function(R){return R.copy(pe)},this.setScissor=function(R,B,J,Q){R.isVector4?pe.set(R.x,R.y,R.z,R.w):pe.set(R,B,J,Q),de.scissor(I.copy(pe).multiplyScalar(F).round())},this.getScissorTest=function(){return De},this.setScissorTest=function(R){de.setScissorTest(De=R)},this.setOpaqueSort=function(R){Y=R},this.setTransparentSort=function(R){X=R},this.getClearColor=function(R){return R.copy(Je.getClearColor())},this.setClearColor=function(){Je.setClearColor(...arguments)},this.getClearAlpha=function(){return Je.getClearAlpha()},this.setClearAlpha=function(){Je.setClearAlpha(...arguments)},this.clear=function(R=!0,B=!0,J=!0){let Q=0;if(R){let V=!1;if(T!==null){const O=T.texture.format;V=O===kg||O===Pg||O===Ag}if(V){const O=T.texture.type,q=O===Kr||O===cs||O===Yl||O===ql||O===Tg||O===Cg,le=Je.getClearColor(),xe=Je.getClearAlpha(),fe=le.r,ee=le.g,Ce=le.b;q?(v[0]=fe,v[1]=ee,v[2]=Ce,v[3]=xe,L.clearBufferuiv(L.COLOR,0,v)):(_[0]=fe,_[1]=ee,_[2]=Ce,_[3]=xe,L.clearBufferiv(L.COLOR,0,_))}else Q|=L.COLOR_BUFFER_BIT}B&&(Q|=L.DEPTH_BUFFER_BIT),J&&(Q|=L.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),L.clear(Q)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",he,!1),t.removeEventListener("webglcontextrestored",Oe,!1),t.removeEventListener("webglcontextcreationerror",Te,!1),Je.dispose(),ge.dispose(),$e.dispose(),Ue.dispose(),Ke.dispose(),it.dispose(),G.dispose(),ie.dispose(),we.dispose(),ue.dispose(),se.dispose(),se.removeEventListener("sessionstart",ut),se.removeEventListener("sessionend",wt),mt.stop()};function he(R){R.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),E=!0}function Oe(){console.log("THREE.WebGLRenderer: Context Restored."),E=!1;const R=Se.autoReset,B=We.enabled,J=We.autoUpdate,Q=We.needsUpdate,V=We.type;U(),Se.autoReset=R,We.enabled=B,We.autoUpdate=J,We.needsUpdate=Q,We.type=V}function Te(R){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",R.statusMessage)}function ce(R){const B=R.target;B.removeEventListener("dispose",ce),K(B)}function K(R){be(R),Ue.remove(R)}function be(R){const B=Ue.get(R).programs;B!==void 0&&(B.forEach(function(J){ue.releaseProgram(J)}),R.isShaderMaterial&&ue.releaseShaderCache(R))}this.renderBufferDirect=function(R,B,J,Q,V,O){B===null&&(B=te);const q=V.isMesh&&V.matrixWorld.determinant()<0,le=Fr(R,B,J,Q,V);de.setMaterial(Q,q);let xe=J.index,fe=1;if(Q.wireframe===!0){if(xe=k.getWireframeAttribute(J),xe===void 0)return;fe=2}const ee=J.drawRange,Ce=J.attributes.position;let He=ee.start*fe,Ye=(ee.start+ee.count)*fe;O!==null&&(He=Math.max(He,O.start*fe),Ye=Math.min(Ye,(O.start+O.count)*fe)),xe!==null?(He=Math.max(He,0),Ye=Math.min(Ye,xe.count)):Ce!=null&&(He=Math.max(He,0),Ye=Math.min(Ye,Ce.count));const Qe=Ye-He;if(Qe<0||Qe===1/0)return;ie.setup(V,Q,le,J,xe);let rt,Ae=Le;if(xe!==null&&(rt=N.get(xe),Ae=qe,Ae.setIndex(rt)),V.isMesh)Q.wireframe===!0?(de.setLineWidth(Q.wireframeLinewidth*je()),Ae.setMode(L.LINES)):Ae.setMode(L.TRIANGLES);else if(V.isLine){let ye=Q.linewidth;ye===void 0&&(ye=1),de.setLineWidth(ye*je()),V.isLineSegments?Ae.setMode(L.LINES):V.isLineLoop?Ae.setMode(L.LINE_LOOP):Ae.setMode(L.LINE_STRIP)}else V.isPoints?Ae.setMode(L.POINTS):V.isSprite&&Ae.setMode(L.TRIANGLES);if(V.isBatchedMesh)if(V._multiDrawInstances!==null)Zl("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Ae.renderMultiDrawInstances(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount,V._multiDrawInstances);else if(Re.get("WEBGL_multi_draw"))Ae.renderMultiDraw(V._multiDrawStarts,V._multiDrawCounts,V._multiDrawCount);else{const ye=V._multiDrawStarts,Ie=V._multiDrawCounts,Ge=V._multiDrawCount,et=xe?N.get(xe).bytesPerElement:1,Ve=Ue.get(Q).currentProgram.getUniforms();for(let st=0;st<Ge;st++)Ve.setValue(L,"_gl_DrawID",st),Ae.render(ye[st]/et,Ie[st])}else if(V.isInstancedMesh)Ae.renderInstances(He,Qe,V.count);else if(J.isInstancedBufferGeometry){const ye=J._maxInstanceCount!==void 0?J._maxInstanceCount:1/0,Ie=Math.min(J.instanceCount,ye);Ae.renderInstances(He,Qe,Ie)}else Ae.render(He,Qe)};function Be(R,B,J){R.transparent===!0&&R.side===xi&&R.forceSinglePass===!1?(R.side=Kn,R.needsUpdate=!0,yn(R,B,J),R.side=wo,R.needsUpdate=!0,yn(R,B,J),R.side=xi):yn(R,B,J)}this.compile=function(R,B,J=null){J===null&&(J=R),p=$e.get(J),p.init(B),g.push(p),J.traverseVisible(function(V){V.isLight&&V.layers.test(B.layers)&&(p.pushLight(V),V.castShadow&&p.pushShadow(V))}),R!==J&&R.traverseVisible(function(V){V.isLight&&V.layers.test(B.layers)&&(p.pushLight(V),V.castShadow&&p.pushShadow(V))}),p.setupLights();const Q=new Set;return R.traverse(function(V){if(!(V.isMesh||V.isPoints||V.isLine||V.isSprite))return;const O=V.material;if(O)if(Array.isArray(O))for(let q=0;q<O.length;q++){const le=O[q];Be(le,J,V),Q.add(le)}else Be(O,J,V),Q.add(O)}),p=g.pop(),Q},this.compileAsync=function(R,B,J=null){const Q=this.compile(R,B,J);return new Promise(V=>{function O(){if(Q.forEach(function(q){Ue.get(q).currentProgram.isReady()&&Q.delete(q)}),Q.size===0){V(R);return}setTimeout(O,10)}Re.get("KHR_parallel_shader_compile")!==null?O():setTimeout(O,10)})};let Ze=null;function lt(R){Ze&&Ze(R)}function ut(){mt.stop()}function wt(){mt.start()}const mt=new qS;mt.setAnimationLoop(lt),typeof self<"u"&&mt.setContext(self),this.setAnimationLoop=function(R){Ze=R,se.setAnimationLoop(R),R===null?mt.stop():mt.start()},se.addEventListener("sessionstart",ut),se.addEventListener("sessionend",wt),this.render=function(R,B){if(B!==void 0&&B.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(E===!0)return;if(R.matrixWorldAutoUpdate===!0&&R.updateMatrixWorld(),B.parent===null&&B.matrixWorldAutoUpdate===!0&&B.updateMatrixWorld(),se.enabled===!0&&se.isPresenting===!0&&(se.cameraAutoUpdate===!0&&se.updateCamera(B),B=se.getCamera()),R.isScene===!0&&R.onBeforeRender(y,R,B,T),p=$e.get(R,g.length),p.init(B),g.push(p),ne.multiplyMatrices(B.projectionMatrix,B.matrixWorldInverse),z.setFromProjectionMatrix(ne,Xr,B.reversedDepth),j=this.localClippingEnabled,ve=ke.init(this.clippingPlanes,j),x=ge.get(R,b.length),x.init(),b.push(x),se.enabled===!0&&se.isPresenting===!0){const O=y.xr.getDepthSensingMesh();O!==null&&vt(O,B,-1/0,y.sortObjects)}vt(R,B,0,y.sortObjects),x.finish(),y.sortObjects===!0&&x.sort(Y,X),Pe=se.enabled===!1||se.isPresenting===!1||se.hasDepthSensing()===!1,Pe&&Je.addToRenderList(x,R),this.info.render.frame++,ve===!0&&ke.beginShadows();const J=p.state.shadowsArray;We.render(J,R,B),ve===!0&&ke.endShadows(),this.info.autoReset===!0&&this.info.reset();const Q=x.opaque,V=x.transmissive;if(p.setupLights(),B.isArrayCamera){const O=B.cameras;if(V.length>0)for(let q=0,le=O.length;q<le;q++){const xe=O[q];Yt(Q,V,R,xe)}Pe&&Je.render(R);for(let q=0,le=O.length;q<le;q++){const xe=O[q];St(x,R,xe,xe.viewport)}}else V.length>0&&Yt(Q,V,R,B),Pe&&Je.render(R),St(x,R,B);T!==null&&A===0&&(ze.updateMultisampleRenderTarget(T),ze.updateRenderTargetMipmap(T)),R.isScene===!0&&R.onAfterRender(y,R,B),ie.resetDefaultState(),w=-1,M=null,g.pop(),g.length>0?(p=g[g.length-1],ve===!0&&ke.setGlobalState(y.clippingPlanes,p.state.camera)):p=null,b.pop(),b.length>0?x=b[b.length-1]:x=null};function vt(R,B,J,Q){if(R.visible===!1)return;if(R.layers.test(B.layers)){if(R.isGroup)J=R.renderOrder;else if(R.isLOD)R.autoUpdate===!0&&R.update(B);else if(R.isLight)p.pushLight(R),R.castShadow&&p.pushShadow(R);else if(R.isSprite){if(!R.frustumCulled||z.intersectsSprite(R)){Q&&me.setFromMatrixPosition(R.matrixWorld).applyMatrix4(ne);const q=G.update(R),le=R.material;le.visible&&x.push(R,q,le,J,me.z,null)}}else if((R.isMesh||R.isLine||R.isPoints)&&(!R.frustumCulled||z.intersectsObject(R))){const q=G.update(R),le=R.material;if(Q&&(R.boundingSphere!==void 0?(R.boundingSphere===null&&R.computeBoundingSphere(),me.copy(R.boundingSphere.center)):(q.boundingSphere===null&&q.computeBoundingSphere(),me.copy(q.boundingSphere.center)),me.applyMatrix4(R.matrixWorld).applyMatrix4(ne)),Array.isArray(le)){const xe=q.groups;for(let fe=0,ee=xe.length;fe<ee;fe++){const Ce=xe[fe],He=le[Ce.materialIndex];He&&He.visible&&x.push(R,q,He,J,me.z,Ce)}}else le.visible&&x.push(R,q,le,J,me.z,null)}}const O=R.children;for(let q=0,le=O.length;q<le;q++)vt(O[q],B,J,Q)}function St(R,B,J,Q){const V=R.opaque,O=R.transmissive,q=R.transparent;p.setupLightsView(J),ve===!0&&ke.setGlobalState(y.clippingPlanes,J),Q&&de.viewport(P.copy(Q)),V.length>0&&Nt(V,B,J),O.length>0&&Nt(O,B,J),q.length>0&&Nt(q,B,J),de.buffers.depth.setTest(!0),de.buffers.depth.setMask(!0),de.buffers.color.setMask(!0),de.setPolygonOffset(!1)}function Yt(R,B,J,Q){if((J.isScene===!0?J.overrideMaterial:null)!==null)return;p.state.transmissionRenderTarget[Q.id]===void 0&&(p.state.transmissionRenderTarget[Q.id]=new ds(1,1,{generateMipmaps:!0,type:Re.has("EXT_color_buffer_half_float")||Re.has("EXT_color_buffer_float")?Ei:Kr,minFilter:oo,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:Pt.workingColorSpace}));const O=p.state.transmissionRenderTarget[Q.id],q=Q.viewport||P;O.setSize(q.z*y.transmissionResolutionScale,q.w*y.transmissionResolutionScale);const le=y.getRenderTarget(),xe=y.getActiveCubeFace(),fe=y.getActiveMipmapLevel();y.setRenderTarget(O),y.getClearColor($),W=y.getClearAlpha(),W<1&&y.setClearColor(16777215,.5),y.clear(),Pe&&Je.render(J);const ee=y.toneMapping;y.toneMapping=vo;const Ce=Q.viewport;if(Q.viewport!==void 0&&(Q.viewport=void 0),p.setupLightsView(Q),ve===!0&&ke.setGlobalState(y.clippingPlanes,Q),Nt(R,J,Q),ze.updateMultisampleRenderTarget(O),ze.updateRenderTargetMipmap(O),Re.has("WEBGL_multisampled_render_to_texture")===!1){let He=!1;for(let Ye=0,Qe=B.length;Ye<Qe;Ye++){const rt=B[Ye],Ae=rt.object,ye=rt.geometry,Ie=rt.material,Ge=rt.group;if(Ie.side===xi&&Ae.layers.test(Q.layers)){const et=Ie.side;Ie.side=Kn,Ie.needsUpdate=!0,Zt(Ae,J,Q,ye,Ie,Ge),Ie.side=et,Ie.needsUpdate=!0,He=!0}}He===!0&&(ze.updateMultisampleRenderTarget(O),ze.updateRenderTargetMipmap(O))}y.setRenderTarget(le,xe,fe),y.setClearColor($,W),Ce!==void 0&&(Q.viewport=Ce),y.toneMapping=ee}function Nt(R,B,J){const Q=B.isScene===!0?B.overrideMaterial:null;for(let V=0,O=R.length;V<O;V++){const q=R[V],le=q.object,xe=q.geometry,fe=q.group;let ee=q.material;ee.allowOverride===!0&&Q!==null&&(ee=Q),le.layers.test(J.layers)&&Zt(le,B,J,xe,ee,fe)}}function Zt(R,B,J,Q,V,O){R.onBeforeRender(y,B,J,Q,V,O),R.modelViewMatrix.multiplyMatrices(J.matrixWorldInverse,R.matrixWorld),R.normalMatrix.getNormalMatrix(R.modelViewMatrix),V.onBeforeRender(y,B,J,Q,R,O),V.transparent===!0&&V.side===xi&&V.forceSinglePass===!1?(V.side=Kn,V.needsUpdate=!0,y.renderBufferDirect(J,B,Q,V,R,O),V.side=wo,V.needsUpdate=!0,y.renderBufferDirect(J,B,Q,V,R,O),V.side=xi):y.renderBufferDirect(J,B,Q,V,R,O),R.onAfterRender(y,B,J,Q,V,O)}function yn(R,B,J){B.isScene!==!0&&(B=te);const Q=Ue.get(R),V=p.state.lights,O=p.state.shadowsArray,q=V.state.version,le=ue.getParameters(R,V.state,O,B,J),xe=ue.getProgramCacheKey(le);let fe=Q.programs;Q.environment=R.isMeshStandardMaterial?B.environment:null,Q.fog=B.fog,Q.envMap=(R.isMeshStandardMaterial?it:Ke).get(R.envMap||Q.environment),Q.envMapRotation=Q.environment!==null&&R.envMap===null?B.environmentRotation:R.envMapRotation,fe===void 0&&(R.addEventListener("dispose",ce),fe=new Map,Q.programs=fe);let ee=fe.get(xe);if(ee!==void 0){if(Q.currentProgram===ee&&Q.lightsStateVersion===q)return ni(R,le),ee}else le.uniforms=ue.getUniforms(R),R.onBeforeCompile(le,y),ee=ue.acquireProgram(le,xe),fe.set(xe,ee),Q.uniforms=le.uniforms;const Ce=Q.uniforms;return(!R.isShaderMaterial&&!R.isRawShaderMaterial||R.clipping===!0)&&(Ce.clippingPlanes=ke.uniform),ni(R,le),Q.needsLights=Oi(R),Q.lightsStateVersion=q,Q.needsLights&&(Ce.ambientLightColor.value=V.state.ambient,Ce.lightProbe.value=V.state.probe,Ce.directionalLights.value=V.state.directional,Ce.directionalLightShadows.value=V.state.directionalShadow,Ce.spotLights.value=V.state.spot,Ce.spotLightShadows.value=V.state.spotShadow,Ce.rectAreaLights.value=V.state.rectArea,Ce.ltc_1.value=V.state.rectAreaLTC1,Ce.ltc_2.value=V.state.rectAreaLTC2,Ce.pointLights.value=V.state.point,Ce.pointLightShadows.value=V.state.pointShadow,Ce.hemisphereLights.value=V.state.hemi,Ce.directionalShadowMap.value=V.state.directionalShadowMap,Ce.directionalShadowMatrix.value=V.state.directionalShadowMatrix,Ce.spotShadowMap.value=V.state.spotShadowMap,Ce.spotLightMatrix.value=V.state.spotLightMatrix,Ce.spotLightMap.value=V.state.spotLightMap,Ce.pointShadowMap.value=V.state.pointShadowMap,Ce.pointShadowMatrix.value=V.state.pointShadowMatrix),Q.currentProgram=ee,Q.uniformsList=null,ee}function ti(R){if(R.uniformsList===null){const B=R.currentProgram.getUniforms();R.uniformsList=ku.seqWithValue(B.seq,R.uniforms)}return R.uniformsList}function ni(R,B){const J=Ue.get(R);J.outputColorSpace=B.outputColorSpace,J.batching=B.batching,J.batchingColor=B.batchingColor,J.instancing=B.instancing,J.instancingColor=B.instancingColor,J.instancingMorph=B.instancingMorph,J.skinning=B.skinning,J.morphTargets=B.morphTargets,J.morphNormals=B.morphNormals,J.morphColors=B.morphColors,J.morphTargetsCount=B.morphTargetsCount,J.numClippingPlanes=B.numClippingPlanes,J.numIntersection=B.numClipIntersection,J.vertexAlphas=B.vertexAlphas,J.vertexTangents=B.vertexTangents,J.toneMapping=B.toneMapping}function Fr(R,B,J,Q,V){B.isScene!==!0&&(B=te),ze.resetTextureUnits();const O=B.fog,q=Q.isMeshStandardMaterial?B.environment:null,le=T===null?y.outputColorSpace:T.isXRRenderTarget===!0?T.texture.colorSpace:us,xe=(Q.isMeshStandardMaterial?it:Ke).get(Q.envMap||q),fe=Q.vertexColors===!0&&!!J.attributes.color&&J.attributes.color.itemSize===4,ee=!!J.attributes.tangent&&(!!Q.normalMap||Q.anisotropy>0),Ce=!!J.morphAttributes.position,He=!!J.morphAttributes.normal,Ye=!!J.morphAttributes.color;let Qe=vo;Q.toneMapped&&(T===null||T.isXRRenderTarget===!0)&&(Qe=y.toneMapping);const rt=J.morphAttributes.position||J.morphAttributes.normal||J.morphAttributes.color,Ae=rt!==void 0?rt.length:0,ye=Ue.get(Q),Ie=p.state.lights;if(ve===!0&&(j===!0||R!==M)){const Ct=R===M&&Q.id===w;ke.setState(Q,R,Ct)}let Ge=!1;Q.version===ye.__version?(ye.needsLights&&ye.lightsStateVersion!==Ie.state.version||ye.outputColorSpace!==le||V.isBatchedMesh&&ye.batching===!1||!V.isBatchedMesh&&ye.batching===!0||V.isBatchedMesh&&ye.batchingColor===!0&&V.colorTexture===null||V.isBatchedMesh&&ye.batchingColor===!1&&V.colorTexture!==null||V.isInstancedMesh&&ye.instancing===!1||!V.isInstancedMesh&&ye.instancing===!0||V.isSkinnedMesh&&ye.skinning===!1||!V.isSkinnedMesh&&ye.skinning===!0||V.isInstancedMesh&&ye.instancingColor===!0&&V.instanceColor===null||V.isInstancedMesh&&ye.instancingColor===!1&&V.instanceColor!==null||V.isInstancedMesh&&ye.instancingMorph===!0&&V.morphTexture===null||V.isInstancedMesh&&ye.instancingMorph===!1&&V.morphTexture!==null||ye.envMap!==xe||Q.fog===!0&&ye.fog!==O||ye.numClippingPlanes!==void 0&&(ye.numClippingPlanes!==ke.numPlanes||ye.numIntersection!==ke.numIntersection)||ye.vertexAlphas!==fe||ye.vertexTangents!==ee||ye.morphTargets!==Ce||ye.morphNormals!==He||ye.morphColors!==Ye||ye.toneMapping!==Qe||ye.morphTargetsCount!==Ae)&&(Ge=!0):(Ge=!0,ye.__version=Q.version);let et=ye.currentProgram;Ge===!0&&(et=yn(Q,B,V));let Ve=!1,st=!1,ot=!1;const nt=et.getUniforms(),ct=ye.uniforms;if(de.useProgram(et.program)&&(Ve=!0,st=!0,ot=!0),Q.id!==w&&(w=Q.id,st=!0),Ve||M!==R){de.buffers.depth.getReversed()&&R.reversedDepth!==!0&&(R._reversedDepth=!0,R.updateProjectionMatrix()),nt.setValue(L,"projectionMatrix",R.projectionMatrix),nt.setValue(L,"viewMatrix",R.matrixWorldInverse);const Ot=nt.map.cameraPosition;Ot!==void 0&&Ot.setValue(L,Ee.setFromMatrixPosition(R.matrixWorld)),Ne.logarithmicDepthBuffer&&nt.setValue(L,"logDepthBufFC",2/(Math.log(R.far+1)/Math.LN2)),(Q.isMeshPhongMaterial||Q.isMeshToonMaterial||Q.isMeshLambertMaterial||Q.isMeshBasicMaterial||Q.isMeshStandardMaterial||Q.isShaderMaterial)&&nt.setValue(L,"isOrthographic",R.isOrthographicCamera===!0),M!==R&&(M=R,st=!0,ot=!0)}if(V.isSkinnedMesh){nt.setOptional(L,V,"bindMatrix"),nt.setOptional(L,V,"bindMatrixInverse");const Ct=V.skeleton;Ct&&(Ct.boneTexture===null&&Ct.computeBoneTexture(),nt.setValue(L,"boneTexture",Ct.boneTexture,ze))}V.isBatchedMesh&&(nt.setOptional(L,V,"batchingTexture"),nt.setValue(L,"batchingTexture",V._matricesTexture,ze),nt.setOptional(L,V,"batchingIdTexture"),nt.setValue(L,"batchingIdTexture",V._indirectTexture,ze),nt.setOptional(L,V,"batchingColorTexture"),V._colorsTexture!==null&&nt.setValue(L,"batchingColorTexture",V._colorsTexture,ze));const ft=J.morphAttributes;if((ft.position!==void 0||ft.normal!==void 0||ft.color!==void 0)&&_e.update(V,J,et),(st||ye.receiveShadow!==V.receiveShadow)&&(ye.receiveShadow=V.receiveShadow,nt.setValue(L,"receiveShadow",V.receiveShadow)),Q.isMeshGouraudMaterial&&Q.envMap!==null&&(ct.envMap.value=xe,ct.flipEnvMap.value=xe.isCubeTexture&&xe.isRenderTargetTexture===!1?-1:1),Q.isMeshStandardMaterial&&Q.envMap===null&&B.environment!==null&&(ct.envMapIntensity.value=B.environmentIntensity),st&&(nt.setValue(L,"toneMappingExposure",y.toneMappingExposure),ye.needsLights&&ri(ct,ot),O&&Q.fog===!0&&Me.refreshFogUniforms(ct,O),Me.refreshMaterialUniforms(ct,Q,F,Z,p.state.transmissionRenderTarget[R.id]),ku.upload(L,ti(ye),ct,ze)),Q.isShaderMaterial&&Q.uniformsNeedUpdate===!0&&(ku.upload(L,ti(ye),ct,ze),Q.uniformsNeedUpdate=!1),Q.isSpriteMaterial&&nt.setValue(L,"center",V.center),nt.setValue(L,"modelViewMatrix",V.modelViewMatrix),nt.setValue(L,"normalMatrix",V.normalMatrix),nt.setValue(L,"modelMatrix",V.matrixWorld),Q.isShaderMaterial||Q.isRawShaderMaterial){const Ct=Q.uniformsGroups;for(let Ot=0,Bt=Ct.length;Ot<Bt;Ot++){const Tt=Ct[Ot];we.update(Tt,et),we.bind(Tt,et)}}return et}function ri(R,B){R.ambientLightColor.needsUpdate=B,R.lightProbe.needsUpdate=B,R.directionalLights.needsUpdate=B,R.directionalLightShadows.needsUpdate=B,R.pointLights.needsUpdate=B,R.pointLightShadows.needsUpdate=B,R.spotLights.needsUpdate=B,R.spotLightShadows.needsUpdate=B,R.rectAreaLights.needsUpdate=B,R.hemisphereLights.needsUpdate=B}function Oi(R){return R.isMeshLambertMaterial||R.isMeshToonMaterial||R.isMeshPhongMaterial||R.isMeshStandardMaterial||R.isShadowMaterial||R.isShaderMaterial&&R.lights===!0}this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return A},this.getRenderTarget=function(){return T},this.setRenderTargetTextures=function(R,B,J){const Q=Ue.get(R);Q.__autoAllocateDepthBuffer=R.resolveDepthBuffer===!1,Q.__autoAllocateDepthBuffer===!1&&(Q.__useRenderToTexture=!1),Ue.get(R.texture).__webglTexture=B,Ue.get(R.depthTexture).__webglTexture=Q.__autoAllocateDepthBuffer?void 0:J,Q.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(R,B){const J=Ue.get(R);J.__webglFramebuffer=B,J.__useDefaultFramebuffer=B===void 0};const ii=L.createFramebuffer();this.setRenderTarget=function(R,B=0,J=0){T=R,C=B,A=J;let Q=!0,V=null,O=!1,q=!1;if(R){const xe=Ue.get(R);if(xe.__useDefaultFramebuffer!==void 0)de.bindFramebuffer(L.FRAMEBUFFER,null),Q=!1;else if(xe.__webglFramebuffer===void 0)ze.setupRenderTarget(R);else if(xe.__hasExternalTextures)ze.rebindTextures(R,Ue.get(R.texture).__webglTexture,Ue.get(R.depthTexture).__webglTexture);else if(R.depthBuffer){const Ce=R.depthTexture;if(xe.__boundDepthTexture!==Ce){if(Ce!==null&&Ue.has(Ce)&&(R.width!==Ce.image.width||R.height!==Ce.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ze.setupDepthRenderbuffer(R)}}const fe=R.texture;(fe.isData3DTexture||fe.isDataArrayTexture||fe.isCompressedArrayTexture)&&(q=!0);const ee=Ue.get(R).__webglFramebuffer;R.isWebGLCubeRenderTarget?(Array.isArray(ee[B])?V=ee[B][J]:V=ee[B],O=!0):R.samples>0&&ze.useMultisampledRTT(R)===!1?V=Ue.get(R).__webglMultisampledFramebuffer:Array.isArray(ee)?V=ee[J]:V=ee,P.copy(R.viewport),I.copy(R.scissor),D=R.scissorTest}else P.copy(oe).multiplyScalar(F).floor(),I.copy(pe).multiplyScalar(F).floor(),D=De;if(J!==0&&(V=ii),de.bindFramebuffer(L.FRAMEBUFFER,V)&&Q&&de.drawBuffers(R,V),de.viewport(P),de.scissor(I),de.setScissorTest(D),O){const xe=Ue.get(R.texture);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+B,xe.__webglTexture,J)}else if(q){const xe=B;for(let fe=0;fe<R.textures.length;fe++){const ee=Ue.get(R.textures[fe]);L.framebufferTextureLayer(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0+fe,ee.__webglTexture,J,xe)}}else if(R!==null&&J!==0){const xe=Ue.get(R.texture);L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,xe.__webglTexture,J)}w=-1},this.readRenderTargetPixels=function(R,B,J,Q,V,O,q,le=0){if(!(R&&R.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let xe=Ue.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&q!==void 0&&(xe=xe[q]),xe){de.bindFramebuffer(L.FRAMEBUFFER,xe);try{const fe=R.textures[le],ee=fe.format,Ce=fe.type;if(!Ne.textureFormatReadable(ee)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ne.textureTypeReadable(Ce)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}B>=0&&B<=R.width-Q&&J>=0&&J<=R.height-V&&(R.textures.length>1&&L.readBuffer(L.COLOR_ATTACHMENT0+le),L.readPixels(B,J,Q,V,re.convert(ee),re.convert(Ce),O))}finally{const fe=T!==null?Ue.get(T).__webglFramebuffer:null;de.bindFramebuffer(L.FRAMEBUFFER,fe)}}},this.readRenderTargetPixelsAsync=async function(R,B,J,Q,V,O,q,le=0){if(!(R&&R.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let xe=Ue.get(R).__webglFramebuffer;if(R.isWebGLCubeRenderTarget&&q!==void 0&&(xe=xe[q]),xe)if(B>=0&&B<=R.width-Q&&J>=0&&J<=R.height-V){de.bindFramebuffer(L.FRAMEBUFFER,xe);const fe=R.textures[le],ee=fe.format,Ce=fe.type;if(!Ne.textureFormatReadable(ee))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ne.textureTypeReadable(Ce))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const He=L.createBuffer();L.bindBuffer(L.PIXEL_PACK_BUFFER,He),L.bufferData(L.PIXEL_PACK_BUFFER,O.byteLength,L.STREAM_READ),R.textures.length>1&&L.readBuffer(L.COLOR_ATTACHMENT0+le),L.readPixels(B,J,Q,V,re.convert(ee),re.convert(Ce),0);const Ye=T!==null?Ue.get(T).__webglFramebuffer:null;de.bindFramebuffer(L.FRAMEBUFFER,Ye);const Qe=L.fenceSync(L.SYNC_GPU_COMMANDS_COMPLETE,0);return L.flush(),await hR(L,Qe,4),L.bindBuffer(L.PIXEL_PACK_BUFFER,He),L.getBufferSubData(L.PIXEL_PACK_BUFFER,0,O),L.deleteBuffer(He),L.deleteSync(Qe),O}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(R,B=null,J=0){const Q=Math.pow(2,-J),V=Math.floor(R.image.width*Q),O=Math.floor(R.image.height*Q),q=B!==null?B.x:0,le=B!==null?B.y:0;ze.setTexture2D(R,0),L.copyTexSubImage2D(L.TEXTURE_2D,J,0,0,q,le,V,O),de.unbindTexture()};const oi=L.createFramebuffer(),si=L.createFramebuffer();this.copyTextureToTexture=function(R,B,J=null,Q=null,V=0,O=null){O===null&&(V!==0?(Zl("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),O=V,V=0):O=0);let q,le,xe,fe,ee,Ce,He,Ye,Qe;const rt=R.isCompressedTexture?R.mipmaps[O]:R.image;if(J!==null)q=J.max.x-J.min.x,le=J.max.y-J.min.y,xe=J.isBox3?J.max.z-J.min.z:1,fe=J.min.x,ee=J.min.y,Ce=J.isBox3?J.min.z:0;else{const ft=Math.pow(2,-V);q=Math.floor(rt.width*ft),le=Math.floor(rt.height*ft),R.isDataArrayTexture?xe=rt.depth:R.isData3DTexture?xe=Math.floor(rt.depth*ft):xe=1,fe=0,ee=0,Ce=0}Q!==null?(He=Q.x,Ye=Q.y,Qe=Q.z):(He=0,Ye=0,Qe=0);const Ae=re.convert(B.format),ye=re.convert(B.type);let Ie;B.isData3DTexture?(ze.setTexture3D(B,0),Ie=L.TEXTURE_3D):B.isDataArrayTexture||B.isCompressedArrayTexture?(ze.setTexture2DArray(B,0),Ie=L.TEXTURE_2D_ARRAY):(ze.setTexture2D(B,0),Ie=L.TEXTURE_2D),L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,B.flipY),L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,B.premultiplyAlpha),L.pixelStorei(L.UNPACK_ALIGNMENT,B.unpackAlignment);const Ge=L.getParameter(L.UNPACK_ROW_LENGTH),et=L.getParameter(L.UNPACK_IMAGE_HEIGHT),Ve=L.getParameter(L.UNPACK_SKIP_PIXELS),st=L.getParameter(L.UNPACK_SKIP_ROWS),ot=L.getParameter(L.UNPACK_SKIP_IMAGES);L.pixelStorei(L.UNPACK_ROW_LENGTH,rt.width),L.pixelStorei(L.UNPACK_IMAGE_HEIGHT,rt.height),L.pixelStorei(L.UNPACK_SKIP_PIXELS,fe),L.pixelStorei(L.UNPACK_SKIP_ROWS,ee),L.pixelStorei(L.UNPACK_SKIP_IMAGES,Ce);const nt=R.isDataArrayTexture||R.isData3DTexture,ct=B.isDataArrayTexture||B.isData3DTexture;if(R.isDepthTexture){const ft=Ue.get(R),Ct=Ue.get(B),Ot=Ue.get(ft.__renderTarget),Bt=Ue.get(Ct.__renderTarget);de.bindFramebuffer(L.READ_FRAMEBUFFER,Ot.__webglFramebuffer),de.bindFramebuffer(L.DRAW_FRAMEBUFFER,Bt.__webglFramebuffer);for(let Tt=0;Tt<xe;Tt++)nt&&(L.framebufferTextureLayer(L.READ_FRAMEBUFFER,L.COLOR_ATTACHMENT0,Ue.get(R).__webglTexture,V,Ce+Tt),L.framebufferTextureLayer(L.DRAW_FRAMEBUFFER,L.COLOR_ATTACHMENT0,Ue.get(B).__webglTexture,O,Qe+Tt)),L.blitFramebuffer(fe,ee,q,le,He,Ye,q,le,L.DEPTH_BUFFER_BIT,L.NEAREST);de.bindFramebuffer(L.READ_FRAMEBUFFER,null),de.bindFramebuffer(L.DRAW_FRAMEBUFFER,null)}else if(V!==0||R.isRenderTargetTexture||Ue.has(R)){const ft=Ue.get(R),Ct=Ue.get(B);de.bindFramebuffer(L.READ_FRAMEBUFFER,oi),de.bindFramebuffer(L.DRAW_FRAMEBUFFER,si);for(let Ot=0;Ot<xe;Ot++)nt?L.framebufferTextureLayer(L.READ_FRAMEBUFFER,L.COLOR_ATTACHMENT0,ft.__webglTexture,V,Ce+Ot):L.framebufferTexture2D(L.READ_FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,ft.__webglTexture,V),ct?L.framebufferTextureLayer(L.DRAW_FRAMEBUFFER,L.COLOR_ATTACHMENT0,Ct.__webglTexture,O,Qe+Ot):L.framebufferTexture2D(L.DRAW_FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,Ct.__webglTexture,O),V!==0?L.blitFramebuffer(fe,ee,q,le,He,Ye,q,le,L.COLOR_BUFFER_BIT,L.NEAREST):ct?L.copyTexSubImage3D(Ie,O,He,Ye,Qe+Ot,fe,ee,q,le):L.copyTexSubImage2D(Ie,O,He,Ye,fe,ee,q,le);de.bindFramebuffer(L.READ_FRAMEBUFFER,null),de.bindFramebuffer(L.DRAW_FRAMEBUFFER,null)}else ct?R.isDataTexture||R.isData3DTexture?L.texSubImage3D(Ie,O,He,Ye,Qe,q,le,xe,Ae,ye,rt.data):B.isCompressedArrayTexture?L.compressedTexSubImage3D(Ie,O,He,Ye,Qe,q,le,xe,Ae,rt.data):L.texSubImage3D(Ie,O,He,Ye,Qe,q,le,xe,Ae,ye,rt):R.isDataTexture?L.texSubImage2D(L.TEXTURE_2D,O,He,Ye,q,le,Ae,ye,rt.data):R.isCompressedTexture?L.compressedTexSubImage2D(L.TEXTURE_2D,O,He,Ye,rt.width,rt.height,Ae,rt.data):L.texSubImage2D(L.TEXTURE_2D,O,He,Ye,q,le,Ae,ye,rt);L.pixelStorei(L.UNPACK_ROW_LENGTH,Ge),L.pixelStorei(L.UNPACK_IMAGE_HEIGHT,et),L.pixelStorei(L.UNPACK_SKIP_PIXELS,Ve),L.pixelStorei(L.UNPACK_SKIP_ROWS,st),L.pixelStorei(L.UNPACK_SKIP_IMAGES,ot),O===0&&B.generateMipmaps&&L.generateMipmap(Ie),de.unbindTexture()},this.initRenderTarget=function(R){Ue.get(R).__webglFramebuffer===void 0&&ze.setupRenderTarget(R)},this.initTexture=function(R){R.isCubeTexture?ze.setTextureCube(R,0):R.isData3DTexture?ze.setTexture3D(R,0):R.isDataArrayTexture||R.isCompressedArrayTexture?ze.setTexture2DArray(R,0):ze.setTexture2D(R,0),de.unbindTexture()},this.resetState=function(){C=0,A=0,T=null,de.reset(),ie.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Xr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=Pt._getDrawingBufferColorSpace(e),t.unpackColorSpace=Pt._getUnpackColorSpace()}}const Nx={type:"change"},jg={type:"start"},tw={type:"end"},au=new Lg,Ox=new Zi,UL=Math.cos(70*uR.DEG2RAD),sn=new ae,Bn=2*Math.PI,Dt={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},of=1e-6;class nw extends eA{constructor(e,t=null){super(e,t),this.state=Dt.NONE,this.target=new ae,this.cursor=new ae,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ga.ROTATE,MIDDLE:ga.DOLLY,RIGHT:ga.PAN},this.touches={ONE:ra.ROTATE,TWO:ra.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new ae,this._lastQuaternion=new Jr,this._lastTargetPosition=new ae,this._quat=new Jr().setFromUnitVectors(e.up,new ae(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new ux,this._sphericalDelta=new ux,this._scale=1,this._panOffset=new ae,this._rotateStart=new gt,this._rotateEnd=new gt,this._rotateDelta=new gt,this._panStart=new gt,this._panEnd=new gt,this._panDelta=new gt,this._dollyStart=new gt,this._dollyEnd=new gt,this._dollyDelta=new gt,this._dollyDirection=new ae,this._mouse=new gt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=FL.bind(this),this._onPointerDown=zL.bind(this),this._onPointerUp=jL.bind(this),this._onContextMenu=XL.bind(this),this._onMouseWheel=WL.bind(this),this._onKeyDown=VL.bind(this),this._onTouchStart=$L.bind(this),this._onTouchMove=GL.bind(this),this._onMouseDown=BL.bind(this),this._onMouseMove=HL.bind(this),this._interceptControlDown=YL.bind(this),this._interceptControlUp=qL.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(e){super.connect(e),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(Nx),this.update(),this.state=Dt.NONE}update(e=null){const t=this.object.position;sn.copy(t).sub(this.target),sn.applyQuaternion(this._quat),this._spherical.setFromVector3(sn),this.autoRotate&&this.state===Dt.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let r=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(r)&&isFinite(i)&&(r<-Math.PI?r+=Bn:r>Math.PI&&(r-=Bn),i<-Math.PI?i+=Bn:i>Math.PI&&(i-=Bn),r<=i?this._spherical.theta=Math.max(r,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(r+i)/2?Math.max(r,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const s=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=s!=this._spherical.radius}if(sn.setFromSpherical(this._spherical),sn.applyQuaternion(this._quatInverse),t.copy(this.target).add(sn),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let s=null;if(this.object.isPerspectiveCamera){const a=sn.length();s=this._clampDistance(a*this._scale);const l=a-s;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),o=!!l}else if(this.object.isOrthographicCamera){const a=new ae(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=l!==this.object.zoom;const c=new ae(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),s=sn.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;s!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(s).add(this.object.position):(au.origin.copy(this.object.position),au.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(au.direction))<UL?this.object.lookAt(this.target):(Ox.setFromNormalAndCoplanarPoint(this.object.up,this.target),au.intersectPlane(Ox,this.target))))}else if(this.object.isOrthographicCamera){const s=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),s!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>of||8*(1-this._lastQuaternion.dot(this.object.quaternion))>of||this._lastTargetPosition.distanceToSquared(this.target)>of?(this.dispatchEvent(Nx),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?Bn/60*this.autoRotateSpeed*e:Bn/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){sn.setFromMatrixColumn(t,0),sn.multiplyScalar(-e),this._panOffset.add(sn)}_panUp(e,t){this.screenSpacePanning===!0?sn.setFromMatrixColumn(t,1):(sn.setFromMatrixColumn(t,0),sn.crossVectors(this.object.up,sn)),sn.multiplyScalar(e),this._panOffset.add(sn)}_pan(e,t){const r=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;sn.copy(i).sub(this.target);let o=sn.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/r.clientHeight,this.object.matrix),this._panUp(2*t*o/r.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/r.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/r.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const r=this.domElement.getBoundingClientRect(),i=e-r.left,o=t-r.top,s=r.width,a=r.height;this._mouse.x=i/s*2-1,this._mouse.y=-(o/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Bn*this._rotateDelta.x/t.clientHeight),this._rotateUp(Bn*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(Bn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-Bn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(Bn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-Bn*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(r,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(r,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,o=Math.sqrt(r*r+i*i);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const r=this._getSecondPointerPosition(e),i=.5*(e.pageX+r.x),o=.5*(e.pageY+r.y);this._rotateEnd.set(i,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(Bn*this._rotateDelta.x/t.clientHeight),this._rotateUp(Bn*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(r,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),r=e.pageX-t.x,i=e.pageY-t.y,o=Math.sqrt(r*r+i*i);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const s=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(s,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new gt,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,r={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:r.deltaY*=16;break;case 2:r.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(r.deltaY*=10),r}}function zL(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function FL(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function jL(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(tw),this.state=Dt.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function BL(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ga.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=Dt.DOLLY;break;case ga.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Dt.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Dt.ROTATE}break;case ga.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=Dt.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=Dt.PAN}break;default:this.state=Dt.NONE}this.state!==Dt.NONE&&this.dispatchEvent(jg)}function HL(n){switch(this.state){case Dt.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case Dt.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case Dt.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function WL(n){this.enabled===!1||this.enableZoom===!1||this.state!==Dt.NONE||(n.preventDefault(),this.dispatchEvent(jg),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(tw))}function VL(n){this.enabled!==!1&&this._handleKeyDown(n)}function $L(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case ra.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=Dt.TOUCH_ROTATE;break;case ra.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=Dt.TOUCH_PAN;break;default:this.state=Dt.NONE}break;case 2:switch(this.touches.TWO){case ra.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=Dt.TOUCH_DOLLY_PAN;break;case ra.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=Dt.TOUCH_DOLLY_ROTATE;break;default:this.state=Dt.NONE}break;default:this.state=Dt.NONE}this.state!==Dt.NONE&&this.dispatchEvent(jg)}function GL(n){switch(this._trackPointer(n),this.state){case Dt.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case Dt.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case Dt.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case Dt.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=Dt.NONE}}function XL(n){this.enabled!==!1&&n.preventDefault()}function YL(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function qL(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Ht={material:{color:"#ffffff",metalness:1,roughness:0,opacity:1},lights:{brightness:0,directional:[1,.8,.6,.4,.2],hdr:{enabled:!0,envId:"studio",intensity:1},shadows:{enabled:!0,intensity:1},backgroundColor:"#f0f0f0"},camera:{projection:"perspective",fovDeg:50,orthoZoom:1},effect:{id:"none",durationSec:3,output:{screen:!0,export:!1},export:{aspect:"landscape",resolution:"1080p",quality:"medium"}},emptyCells:{linkToEnvironment:!1,customMaterial:{color:"#4a4a4a",metalness:.02,roughness:0,opacity:.48}},sphereColorTheme:"default"};let KL=class extends KR{constructor(e){super(e),this.type=Ei}parse(e){const s=function(T,w){switch(T){case 1:throw new Error("THREE.HDRLoader: Read Error: "+(w||""));case 2:throw new Error("THREE.HDRLoader: Write Error: "+(w||""));case 3:throw new Error("THREE.HDRLoader: Bad File Format: "+(w||""));default:case 4:throw new Error("THREE.HDRLoader: Memory Error: "+(w||""))}},u=`
`,d=function(T,w,M){w=w||1024;let I=T.pos,D=-1,$=0,W="",H=String.fromCharCode.apply(null,new Uint16Array(T.subarray(I,I+128)));for(;0>(D=H.indexOf(u))&&$<w&&I<T.byteLength;)W+=H,$+=H.length,I+=128,H+=String.fromCharCode.apply(null,new Uint16Array(T.subarray(I,I+128)));return-1<D?(T.pos+=$+D+1,W+H.slice(0,D)):!1},f=function(T){const w=/^#\?(\S+)/,M=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,P=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,I=/^\s*FORMAT=(\S+)\s*$/,D=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,$={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let W,H;for((T.pos>=T.byteLength||!(W=d(T)))&&s(1,"no header found"),(H=W.match(w))||s(3,"bad initial token"),$.valid|=1,$.programtype=H[1],$.string+=W+`
`;W=d(T),W!==!1;){if($.string+=W+`
`,W.charAt(0)==="#"){$.comments+=W+`
`;continue}if((H=W.match(M))&&($.gamma=parseFloat(H[1])),(H=W.match(P))&&($.exposure=parseFloat(H[1])),(H=W.match(I))&&($.valid|=2,$.format=H[1]),(H=W.match(D))&&($.valid|=4,$.height=parseInt(H[1],10),$.width=parseInt(H[2],10)),$.valid&2&&$.valid&4)break}return $.valid&2||s(3,"missing format specifier"),$.valid&4||s(3,"missing image size specifier"),$},m=function(T,w,M){const P=w;if(P<8||P>32767||T[0]!==2||T[1]!==2||T[2]&128)return new Uint8Array(T);P!==(T[2]<<8|T[3])&&s(3,"wrong scanline width");const I=new Uint8Array(4*w*M);I.length||s(4,"unable to allocate buffer space");let D=0,$=0;const W=4*P,H=new Uint8Array(4),Z=new Uint8Array(W);let F=M;for(;F>0&&$<T.byteLength;){$+4>T.byteLength&&s(1),H[0]=T[$++],H[1]=T[$++],H[2]=T[$++],H[3]=T[$++],(H[0]!=2||H[1]!=2||(H[2]<<8|H[3])!=P)&&s(3,"bad rgbe scanline format");let Y=0,X;for(;Y<W&&$<T.byteLength;){X=T[$++];const pe=X>128;if(pe&&(X-=128),(X===0||Y+X>W)&&s(3,"bad scanline data"),pe){const De=T[$++];for(let z=0;z<X;z++)Z[Y++]=De}else Z.set(T.subarray($,$+X),Y),Y+=X,$+=X}const oe=P;for(let pe=0;pe<oe;pe++){let De=0;I[D]=Z[pe+De],De+=P,I[D+1]=Z[pe+De],De+=P,I[D+2]=Z[pe+De],De+=P,I[D+3]=Z[pe+De],D+=4}F--}return I},v=function(T,w,M,P){const I=T[w+3],D=Math.pow(2,I-128)/255;M[P+0]=T[w+0]*D,M[P+1]=T[w+1]*D,M[P+2]=T[w+2]*D,M[P+3]=1},_=function(T,w,M,P){const I=T[w+3],D=Math.pow(2,I-128)/255;M[P+0]=Xc.toHalfFloat(Math.min(T[w+0]*D,65504)),M[P+1]=Xc.toHalfFloat(Math.min(T[w+1]*D,65504)),M[P+2]=Xc.toHalfFloat(Math.min(T[w+2]*D,65504)),M[P+3]=Xc.toHalfFloat(1)},x=new Uint8Array(e);x.pos=0;const p=f(x),b=p.width,g=p.height,y=m(x.subarray(x.pos),b,g);let E,C,A;switch(this.type){case Gn:A=y.length/4;const T=new Float32Array(A*4);for(let M=0;M<A;M++)v(y,M*4,T,M*4);E=T,C=Gn;break;case Ei:A=y.length/4;const w=new Uint16Array(A*4);for(let M=0;M<A;M++)_(y,M*4,w,M*4);E=w,C=Ei;break;default:throw new Error("THREE.HDRLoader: Unsupported type: "+this.type)}return{width:b,height:g,data:E,header:p.string,gamma:p.gamma,exposure:p.exposure,type:C}}setDataType(e){return this.type=e,this}load(e,t,r,i){function o(s,a){switch(s.type){case Gn:case Ei:s.colorSpace=us,s.minFilter=Dn,s.magFilter=Dn,s.generateMipmaps=!1,s.flipY=!0;break}t&&t(s,a)}return super.load(e,o,r,i)}};class JL extends KL{constructor(e){console.warn("RGBELoader has been deprecated. Please use HDRLoader instead."),super(e)}}const Rn=class Rn{constructor(){dt(this,"loader");dt(this,"pmremGenerator");dt(this,"environments",new Map);this.loader=new JL,this.loader.setCrossOrigin("anonymous"),this.loader.setDataType(Gn),console.log(" HDRLoader: Initialized with CORS and FloatType data type")}static getInstance(){return Rn.instance||(Rn.instance=new Rn),Rn.instance}static resetInstance(){Rn.instance&&(Rn.instance.dispose(),Rn.instance=null),console.log(" HDRLoader: Instance reset")}initializePMREMGenerator(e){this.pmremGenerator||(this.pmremGenerator=new vm(e),this.pmremGenerator.compileEquirectangularShader(),console.log(" HDRLoader: PMREM Generator initialized"))}getAvailableEnvironments(){return Rn.AVAILABLE_HDRIS}async loadEnvironment(e){if(!this.pmremGenerator)return console.error(" HDRLoader: PMREM Generator not initialized"),null;const t=this.environments.get(e);if(t!=null&&t.envMap)return console.log(` HDRLoader: Using cached environment '${e}'`),t.envMap;const r=Rn.AVAILABLE_HDRIS.find(i=>i.id===e);if(!r)return console.error(` HDRLoader: Environment '${e}' not found`),null;try{console.log(` HDRLoader: Loading '${r.name}' from ${r.url}`),console.log(` HDRLoader: Testing direct fetch of ${r.url}`);try{const a=await fetch(r.url);if(console.log(" HDRLoader: Fetch response:",{ok:a.ok,status:a.status,statusText:a.statusText,contentType:a.headers.get("content-type"),contentLength:a.headers.get("content-length")}),!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`)}catch(a){throw console.error(" HDRLoader: Direct fetch failed:",a),a}const i=await new Promise((a,l)=>{this.loader.load(r.url,c=>{var u,d;console.log(` HDRLoader: Successfully loaded '${r.name}'`),console.log(" HDRLoader: Texture details:",{width:(u=c.image)==null?void 0:u.width,height:(d=c.image)==null?void 0:d.height,format:c.format,type:c.type,isDataTexture:c.isDataTexture}),a(c)},c=>{if(c.total>0){const u=Math.round(c.loaded/c.total*100);console.log(` HDRLoader: Loading '${r.name}' - ${u}%`)}},c=>{console.error(` HDRLoader: Failed to load '${r.name}':`,c),console.error(` HDRLoader: URL was: ${r.url}`),console.error(" HDRLoader: This might be a CORS issue or the file might not be a valid HDR"),l(c)})});if(!this.pmremGenerator)return console.error(" HDRLoader: PMREM Generator became undefined during load"),i.dispose(),null;const o=this.pmremGenerator.fromEquirectangular(i).texture,s={...r,envMap:o};return this.environments.set(e,s),i.dispose(),console.log(` HDRLoader: Environment '${r.name}' ready for use`),o}catch(i){return console.error(` HDRLoader: Error loading environment '${e}':`,i),console.warn(" HDRLoader: HDR loading failed - returning null"),null}}dispose(){this.environments.forEach(e=>{e.texture&&e.texture.dispose(),e.envMap&&e.envMap.dispose()}),this.environments.clear(),this.pmremGenerator&&(this.pmremGenerator.dispose(),this.pmremGenerator=void 0),console.log(" HDRLoader: Disposed all resources")}};dt(Rn,"instance"),dt(Rn,"LOCAL_BASE_URL","/assets/hdri"),dt(Rn,"AVAILABLE_HDRIS",[{id:"studio",name:"Studio",url:`${Rn.LOCAL_BASE_URL}/Studio.hdr`},{id:"outdoor",name:"Outdoor",url:`${Rn.LOCAL_BASE_URL}/Outdoor.hdr`}]);let ka=Rn;function ZL(n,e){if(!n.current||!(n.current.material instanceof Ug))return;const t=e*.4;n.current.material.opacity=Math.max(.05,t),n.current.material.needsUpdate=!0,console.log(` Shadow intensity updated: ${e}  opacity ${t.toFixed(2)}`)}function QL(n,e,t){const r=[];return n.current?n.current.material instanceof Ug||r.push("Shadow plane does not use ShadowMaterial"):r.push("Shadow plane not found"),e.current?!e.current.castShadow&&t.enabled&&r.push("Key light not casting shadows when shadows enabled"):r.push("Key light not found"),r.length>0?(console.warn(" Shadow system validation failed:",r),!1):(console.log(" Shadow system validation passed"),!0)}function e3({cells:n,view:e,mode:t,editEnabled:r,onCellsChange:i,onSave:o,containerOpacity:s=1,containerColor:a="#ffffff",containerRoughness:l=.19,settings:c=Ht,onSceneReady:u,interactionsDisabled:d=!1}){var Z,F,Y,X,oe,pe,De,z,ve;const f=S.useRef(null),m=S.useRef(null),v=S.useRef(),_=S.useRef(),x=S.useRef(),p=S.useRef(new YS),b=S.useRef(new gt),g=S.useRef(null),y=S.useRef(void 0),E=S.useRef([]),C=S.useRef(),A=S.useRef([]),T=S.useRef(),w=S.useRef(),M=S.useRef(),[P,I]=S.useState(null),[D,$]=S.useState(null),W=S.useRef(n);S.useEffect(()=>{W.current=n},[n]),S.useEffect(()=>{o&&(window.saveCurrentShape=o)},[n,o]),S.useEffect(()=>(window.setOrbitTarget=j=>{x.current?(x.current.target.copy(j),x.current.update(),console.log(" OrbitControls target updated to:",j)):console.warn(" Cannot update OrbitControls target - controls not initialized")},()=>{delete window.setOrbitTarget}),[]),S.useEffect(()=>{window.resetCameraFlag=()=>{window.hasInitializedCamera&&(window.hasInitializedCamera=!1,console.log(" ShapeEditorCanvas: Camera initialization flag reset"))}},[]),S.useEffect(()=>{x.current&&(x.current.enabled=!d,console.log(d?" Canvas interactions disabled (modal open)":" Canvas interactions enabled"))},[d]),S.useEffect(()=>{if(!f.current)return;console.log(" ShapeEditorCanvas: Initializing Three.js");const j=new BS;j.background=new pt(1973790);const ne=new or(50,window.innerWidth/window.innerHeight,.1,2e3),me="ontouchstart"in window?7:4;ne.position.set(me,me,me);const te=new ew({antialias:!0,preserveDrawingBuffer:!0});te.setSize(window.innerWidth,window.innerHeight),te.setPixelRatio(window.devicePixelRatio),te.shadowMap.enabled=!0,te.shadowMap.type=yS,te.toneMapping=bS,te.toneMappingExposure=1,te.outputColorSpace=ir;const Pe=new nw(ne,te.domElement);Pe.enableDamping=!0,Pe.dampingFactor=.05;const je=new XS(4210752,.3);j.add(je),C.current=je;const L=[new _i(16777215,1),new _i(16777215,.8),new _i(16777215,.6),new _i(16777215,.4),new _i(16777215,.2)];L[0].position.set(20,0,0),L[1].position.set(-20,0,0),L[2].position.set(30,40,30),L[3].position.set(0,-20,0),L[4].position.set(0,0,20),L.forEach(Ue=>j.add(Ue)),A.current=L,T.current=L[2];const Fe=T.current;Fe.castShadow=!0,Fe.intensity=2,Fe.shadow.mapSize.set(2048,2048),Fe.shadow.bias=-5e-4,Fe.shadow.normalBias=.05,ka.resetInstance();const Re=ka.getInstance();Re.initializePMREMGenerator(te),M.current=Re,w.current=void 0,f.current.appendChild(te.domElement),m.current=j,v.current=ne,_.current=te,x.current=Pe,u&&u(te.domElement);let Ne;const de=()=>{Ne=requestAnimationFrame(de),Pe.update(),te.render(j,ne)};de();const Se=()=>{!ne||!te||(ne.aspect=window.innerWidth/window.innerHeight,ne.updateProjectionMatrix(),te.setSize(window.innerWidth,window.innerHeight))};return window.addEventListener("resize",Se),console.log(" ShapeEditorCanvas: Three.js initialized"),()=>{cancelAnimationFrame(Ne),window.removeEventListener("resize",Se),Pe.dispose(),te.dispose(),f.current&&te.domElement&&f.current.removeChild(te.domElement)}},[]),S.useEffect(()=>{const j=m.current,ne=v.current,Ee=x.current;if(!j||!ne||!Ee||!n.length||!e)return;g.current&&(j.remove(g.current),g.current.geometry.dispose(),Array.isArray(g.current.material)?g.current.material.forEach(Re=>Re.dispose()):g.current.material.dispose());const me=Ux(e.M_world),te=zx(e),Pe=new xo(te,32,32),je=new In({color:c.material.color,metalness:c.material.metalness,roughness:c.material.roughness,opacity:s,transparent:s<1}),L=new hd(Pe,je,n.length);L.castShadow=!0,L.receiveShadow=!1;const Fe=new xn;n.forEach((Re,Ne)=>{const de=new ae(Re.i,Re.j,Re.k).applyMatrix4(me);Fe.position.copy(de),Fe.updateMatrix(),L.setMatrixAt(Ne,Fe.matrix)}),L.instanceMatrix.needsUpdate=!0,L.instanceColor&&(L.instanceColor.needsUpdate=!0),j.add(L),g.current=L,window.hasInitializedCamera||(H(L),window.hasInitializedCamera=!0)},[n,e,s,l,c.material]),S.useEffect(()=>{var ne,Ee;const j=m.current;if(j){if(y.current){for(const me of y.current)j.remove(me),me.geometry.dispose(),Array.isArray(me.material)?me.material.forEach(te=>te.dispose()):me.material.dispose();y.current=void 0}if(r&&t==="add"&&n.length&&e){const me=Ux(e.M_world),te=zx(e),Pe=new Set(n.map(Se=>`${Se.i},${Se.j},${Se.k}`)),je=new Set;for(const Se of n){const Ue=[{i:Se.i+1,j:Se.j,k:Se.k},{i:Se.i-1,j:Se.j,k:Se.k},{i:Se.i,j:Se.j+1,k:Se.k},{i:Se.i,j:Se.j-1,k:Se.k},{i:Se.i,j:Se.j,k:Se.k+1},{i:Se.i,j:Se.j,k:Se.k-1},{i:Se.i+1,j:Se.j+1,k:Se.k},{i:Se.i+1,j:Se.j-1,k:Se.k},{i:Se.i-1,j:Se.j+1,k:Se.k},{i:Se.i-1,j:Se.j-1,k:Se.k},{i:Se.i+1,j:Se.j,k:Se.k+1},{i:Se.i+1,j:Se.j,k:Se.k-1},{i:Se.i-1,j:Se.j,k:Se.k+1},{i:Se.i-1,j:Se.j,k:Se.k-1},{i:Se.i,j:Se.j+1,k:Se.k+1},{i:Se.i,j:Se.j+1,k:Se.k-1},{i:Se.i,j:Se.j-1,k:Se.k+1},{i:Se.i,j:Se.j-1,k:Se.k-1}];for(const ze of Ue){const Ke=`${ze.i},${ze.j},${ze.k}`;Pe.has(Ke)||je.add(Ke)}}const L=[],Fe=[],Re=[];for(const Se of n){const ze=new ae(Se.i,Se.j,Se.k).applyMatrix4(me);Re.push(ze)}const de=te*2*1.1;for(const Se of je){const[Ue,ze,Ke]=Se.split(",").map(Number),N=new ae(Ue,ze,Ke).applyMatrix4(me);let k=!1;for(const G of Re)if(N.distanceTo(G)<=de){k=!0;break}k&&(L.push(N),Fe.push({i:Ue,j:ze,k:Ke}))}if(E.current=Fe,L.length>0){const Se=new xo(te,32,24),Ue=[];for(let ze=0;ze<L.length;ze++){const Ke=(ne=c.emptyCells)!=null&&ne.linkToEnvironment?c.material:((Ee=c.emptyCells)==null?void 0:Ee.customMaterial)||c.material,it=new In({color:Ke.color,metalness:Ke.metalness,roughness:Ke.roughness,transparent:!0,opacity:0}),N=new bn(Se,it);N.position.copy(L[ze]),j.add(N),Ue.push(N)}y.current=Ue}}}},[r,t,n,e,l,c.emptyCells,c.material]),S.useEffect(()=>{const j=_.current,ne=v.current,Ee=p.current,me=b.current;if(!j||!ne||!Ee||!me||!r||t!=="remove")return;let te=0,Pe=null;const je=300,L=500;let Fe=null,Re=!1;const Ne=5;let de=null,Se=null;const Ue=()=>{if(!Se){de=null;return}const G=Se;Se=null;const ue=j.domElement.getBoundingClientRect();me.x=(G.clientX-ue.left)/ue.width*2-1,me.y=-((G.clientY-ue.top)/ue.height)*2+1,Ee.setFromCamera(me,ne);const Me=g.current;if(!Me)return;const ge=Ee.intersectObject(Me);if(ge.length>0){const $e=ge[0].instanceId;$e!==void 0&&$e!==P&&I($e)}else P!==null&&I(null);de=null},ze=G=>{if(Fe&&G.buttons!==0){const ue=G.clientX-Fe.x,Me=G.clientY-Fe.y;Math.sqrt(ue*ue+Me*Me)>Ne&&(Re=!0,Pe!==null&&(clearTimeout(Pe),Pe=null))}G.buttons===0&&(Se=G,de===null&&(de=requestAnimationFrame(Ue)))},Ke=()=>{if(t==="remove"&&P!==null&&P<W.current.length){const G=W.current.filter((ue,Me)=>Me!==P);i(G),I(null)}},it=G=>{Fe={x:G.clientX,y:G.clientY},Re=!1,!(t!=="remove"||P===null)&&(Pe=window.setTimeout(()=>{Ke(),Pe=null},L))},N=()=>{Pe!==null&&(clearTimeout(Pe),Pe=null),Fe=null},k=()=>{if(Re){Re=!1;return}if(t!=="remove"||P===null)return;const G=Date.now();G-te<je?(Ke(),te=0):te=G};return j.domElement.addEventListener("mousemove",ze),j.domElement.addEventListener("mousedown",it),j.domElement.addEventListener("mouseup",N),j.domElement.addEventListener("click",k),()=>{Pe!==null&&clearTimeout(Pe),de!==null&&cancelAnimationFrame(de),j.domElement.removeEventListener("mousemove",ze),j.domElement.removeEventListener("mousedown",it),j.domElement.removeEventListener("mouseup",N),j.domElement.removeEventListener("click",k)}},[r,t,P,i]),S.useEffect(()=>{const j=_.current,ne=v.current,Ee=p.current,me=b.current;if(!j||!ne||!Ee||!me||!r||t!=="add")return;let te=0,Pe=null;const je=300,L=500;let Fe=null,Re=!1;const Ne=5;let de=null,Se=null;const Ue=()=>{if(!Se){de=null;return}const G=Se;Se=null;const ue=j.domElement.getBoundingClientRect();me.x=(G.clientX-ue.left)/ue.width*2-1,me.y=-((G.clientY-ue.top)/ue.height)*2+1,Ee.setFromCamera(me,ne);const Me=y.current;if(!Me)return;const ge=Ee.intersectObjects(Me);if(ge.length>0){const $e=ge[0].object,ke=Me.indexOf($e);ke!==-1&&ke!==D&&$(ke)}else D!==null&&$(null);de=null},ze=G=>{if(Fe&&G.buttons!==0){const ue=G.clientX-Fe.x,Me=G.clientY-Fe.y;Math.sqrt(ue*ue+Me*Me)>Ne&&(Re=!0,Pe!==null&&(clearTimeout(Pe),Pe=null))}G.buttons===0&&(Se=G,de===null&&(de=requestAnimationFrame(Ue)))},Ke=()=>{if(t!=="add")return;const G=E.current;if(!(!G||D===null)&&D<G.length){const ue=G[D];i([...W.current,ue]),$(null)}},it=G=>{Fe={x:G.clientX,y:G.clientY},Re=!1,!(t!=="add"||D===null)&&(Pe=window.setTimeout(()=>{Ke(),Pe=null},L))},N=()=>{Pe!==null&&(clearTimeout(Pe),Pe=null),Fe=null},k=()=>{if(Re){Re=!1;return}if(t!=="add"||D===null)return;const G=Date.now();G-te<je?(Ke(),te=0):te=G};return j.domElement.addEventListener("mousemove",ze),j.domElement.addEventListener("mousedown",it),j.domElement.addEventListener("mouseup",N),j.domElement.addEventListener("click",k),()=>{Pe!==null&&clearTimeout(Pe),de!==null&&cancelAnimationFrame(de),j.domElement.removeEventListener("mousemove",ze),j.domElement.removeEventListener("mousedown",it),j.domElement.removeEventListener("mouseup",N),j.domElement.removeEventListener("click",k)}},[r,t,D,i]),S.useEffect(()=>{var Ee,me,te;const j=y.current;if(!j)return;const ne=(Ee=c.emptyCells)!=null&&Ee.linkToEnvironment?c.material:((me=c.emptyCells)==null?void 0:me.customMaterial)||c.material;console.log(" Updating empty cell materials:",{linkToEnvironment:(te=c.emptyCells)==null?void 0:te.linkToEnvironment,color:ne.color,metalness:ne.metalness,roughness:ne.roughness,opacity:ne.opacity,neighborCount:j.length}),j.forEach((Pe,je)=>{const L=Pe.material,Fe=L.color.getHexString();L.color.set(ne.color),L.metalness=ne.metalness,L.roughness=ne.roughness,L.needsUpdate=!0,je===0&&console.log("  Material update sample:",{oldColor:"#"+Fe,newColor:ne.color,opacity:L.opacity,visible:Pe.visible})}),_.current&&m.current&&v.current&&_.current.render(m.current,v.current)},[(Z=c.emptyCells)==null?void 0:Z.linkToEnvironment,(Y=(F=c.emptyCells)==null?void 0:F.customMaterial)==null?void 0:Y.color,(oe=(X=c.emptyCells)==null?void 0:X.customMaterial)==null?void 0:oe.metalness,(De=(pe=c.emptyCells)==null?void 0:pe.customMaterial)==null?void 0:De.roughness,(ve=(z=c.emptyCells)==null?void 0:z.customMaterial)==null?void 0:ve.opacity,c.material.color,c.material.metalness,c.material.roughness,c.material.opacity]),S.useEffect(()=>{const j=y.current;if(!j)return;const ne=new pt(65280);console.log(" Updating hover for neighbor:",D),j.forEach((Ee,me)=>{const te=Ee.material;me===D?(te.color.copy(ne),te.metalness=c.material.metalness,te.roughness=c.material.roughness,te.opacity=1,te.transparent=!1):(te.opacity=0,te.transparent=!0),te.needsUpdate=!0}),_.current&&m.current&&v.current&&_.current.render(m.current,v.current)},[D,c.material.metalness,c.material.roughness]),S.useEffect(()=>{const j=g.current;if(!j)return;const ne=new pt(16711680),Ee=new pt(c.material.color);for(let me=0;me<n.length;me++)me===P?j.setColorAt(me,ne):j.setColorAt(me,Ee);j.instanceColor&&(j.instanceColor.needsUpdate=!0)},[P,n.length,c.material.color]);const H=j=>{if(!v.current||!x.current)return;const ne=new Po().setFromObject(j),Ee=ne.getCenter(new ae),me=ne.getSize(new ae),te=Math.max(me.x,me.y,me.z),je="ontouchstart"in window?1.9:1.1,L=te*je;v.current.position.set(Ee.x+L*.7,Ee.y+L*.7,Ee.z+L*.7),x.current.target.copy(Ee),x.current.update()};return S.useEffect(()=>{var Ee;const j=m.current;if(!((Ee=g.current)!=null&&Ee.material)||!j)return;const ne=g.current.material;ne.color.set(c.material.color),ne.metalness=c.material.metalness,ne.roughness=c.material.roughness,ne.envMapIntensity=c.lights.hdr.enabled?c.lights.hdr.intensity:1,ne.envMap&&(ne.envMap=null),ne.needsUpdate=!0},[c.material,c.lights.hdr]),S.useEffect(()=>{var me;const j=m.current,ne=M.current;if(!j||!C.current)return;j.background=new pt(c.lights.backgroundColor),C.current.intensity=.3*c.lights.brightness,A.current.forEach((te,Pe)=>{if(Pe<c.lights.directional.length){const je=c.lights.directional[Pe]*c.lights.brightness;te.intensity=te===T.current?Math.max(je,.3):je}});const Ee=T.current;if(Ee&&(Ee.castShadow=c.lights.shadows.enabled),ZL(w,c.lights.shadows.intensity),w.current&&w.current.material instanceof Ug){const te=c.lights.shadows.intensity*.4;w.current.material.opacity=Math.max(.05,te),w.current.material.needsUpdate=!0,w.current.visible=c.lights.shadows.enabled}if(QL(w,T,c.lights.shadows),c.lights.hdr.enabled&&A.current.forEach(te=>{te.intensity=Math.max(te.intensity,.25*c.lights.brightness)}),c.lights.hdr.enabled&&c.lights.hdr.envId&&ne)ne.loadEnvironment(c.lights.hdr.envId).then(te=>{var Pe;if(te&&(j.environment=te,((Pe=g.current)==null?void 0:Pe.material)instanceof In)){const je=g.current.material;je.envMap=te,je.envMapIntensity=c.lights.hdr.intensity,je.needsUpdate=!0}}).catch(te=>console.error("HDR load error",te));else if(j.environment=null,((me=g.current)==null?void 0:me.material)instanceof In){const te=g.current.material;te.envMap=null,te.needsUpdate=!0}},[c.lights,c.material.metalness,c.material.roughness]),h.jsx("div",{ref:f,style:{width:"100%",height:"100%",position:"absolute",left:0,overflow:"hidden"}})}function Ux(n){const e=new kt;return e.set(n[0][0],n[0][1],n[0][2],n[0][3],n[1][0],n[1][1],n[1][2],n[1][3],n[2][0],n[2][1],n[2][2],n[2][3],n[3][0],n[3][1],n[3][2],n[3][3]),e}function zx(n){const e=n.M_world,t=l=>{const c=new kt;return c.set(l[0][0],l[0][1],l[0][2],l[0][3],l[1][0],l[1][1],l[1][2],l[1][3],l[2][0],l[2][1],l[2][2],l[2][3],l[3][0],l[3][1],l[3][2],l[3][3]),c},r=(l,c,u)=>new ae(l,c,u).applyMatrix4(t(e)),i=r(0,0,0),o=r(1,0,0);return i.distanceTo(o)/2}function vs(n,e,t,r){console.log(` ViewTransforms: Processing ${n.length} cells`);const i=n.map(e);if(i.length===0)throw new Error("Empty cell set");const o=i.map(t3),s=r(o,1e-6);let a=a3();if(s.faces&&s.faces.length>0){let A=s.faces[0];for(const I of s.faces)I.area>A.area&&(A=I);console.log(` ViewTransforms: Largest face normal: (${A.normal.x.toFixed(3)}, ${A.normal.y.toFixed(3)}, ${A.normal.z.toFixed(3)})`);const T=n3(A.normal),w={x:-T.x,y:-T.y,z:-T.z},P=o3(w,{x:0,y:1,z:0});a=s3(P)}const l=l3(a,t),c=sf(l,{x:0,y:0,z:0}),u=sf(l,{x:1,y:0,z:0}),d=.5*Math.sqrt((u.x-c.x)*(u.x-c.x)+(u.y-c.y)*(u.y-c.y)+(u.z-c.z)*(u.z-c.z)),f=n.map(A=>{const T={x:A.i,y:A.j,z:A.k};return sf(l,T)});let m=1/0,v=-1/0,_=1/0,x=-1/0,p=1/0,b=-1/0;for(const A of f)A.x<m&&(m=A.x),A.x>v&&(v=A.x),A.y<_&&(_=A.y),A.y>x&&(x=A.y),A.z<p&&(p=A.z),A.z>b&&(b=A.z);const g=(m+v)*.5,y=(p+b)*.5,E=_-d;console.log(` ViewTransforms: Sphere radius: ${d.toFixed(3)}`),console.log(` ViewTransforms: Bounds - X: [${m.toFixed(3)}, ${v.toFixed(3)}], Y: [${_.toFixed(3)}, ${x.toFixed(3)}], Z: [${p.toFixed(3)}, ${b.toFixed(3)}]`),console.log(` ViewTransforms: Centering at X: ${g.toFixed(3)}, Z: ${y.toFixed(3)}, placing on XZ plane (Y offset: ${(-E).toFixed(3)})`);const C=[[l[0][0],l[0][1],l[0][2],l[0][3]-g],[l[1][0],l[1][1],l[1][2],l[1][3]-E],[l[2][0],l[2][1],l[2][2],l[2][3]-y],[l[3][0],l[3][1],l[3][2],l[3][3]]];return console.log(" ViewTransforms: Shape centered at origin and resting on XZ plane"),{M_world:C}}function t3(n){return{x:Math.round(n.x*1e3)/1e3,y:Math.round(n.y*1e3)/1e3,z:Math.round(n.z*1e3)/1e3}}function n3(n){const e=Math.sqrt(n.x*n.x+n.y*n.y+n.z*n.z);return e<1e-9?{x:1,y:0,z:0}:{x:n.x/e,y:n.y/e,z:n.z/e}}function r3(n,e){return{x:n.y*e.z-n.z*e.y,y:n.z*e.x-n.x*e.z,z:n.x*e.y-n.y*e.x}}function i3(n,e){return n.x*e.x+n.y*e.y+n.z*e.z}function o3(n,e){const t=r3(n,e),r=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z),i=i3(n,e);if(r<1e-9)return i>0?[[1,0,0],[0,1,0],[0,0,1]]:[[-1,0,0],[0,-1,0],[0,0,1]];const o=[[0,-t.z,t.y],[t.z,0,-t.x],[-t.y,t.x,0]],s=[[1,0,0],[0,1,0],[0,0,1]],a=(1-i)/(r*r),l=[[0,0,0],[0,0,0],[0,0,0]];for(let c=0;c<3;c++)for(let u=0;u<3;u++){l[c][u]=s[c][u]+o[c][u];for(let d=0;d<3;d++)l[c][u]+=a*o[c][d]*o[d][u]}return l}function s3(n){return[[n[0][0],n[0][1],n[0][2],0],[n[1][0],n[1][1],n[1][2],0],[n[2][0],n[2][1],n[2][2],0],[0,0,0,1]]}function a3(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}function l3(n,e){const t=Array(4).fill(0).map(()=>Array(4).fill(0));for(let r=0;r<4;r++)for(let i=0;i<4;i++)for(let o=0;o<4;o++)t[r][i]+=n[r][o]*e[o][i];return t}function sf(n,e){return{x:n[0][0]*e.x+n[0][1]*e.y+n[0][2]*e.z+n[0][3],y:n[1][0]*e.x+n[1][1]*e.y+n[1][2]*e.z+n[1][3],z:n[2][0]*e.x+n[2][1]*e.y+n[2][2]*e.z+n[2][3]}}var Bg=c3;function c3(n,e){var t=e[0],r=e[1],i=e[2],o=t*t+r*r+i*i;return o>0&&(o=1/Math.sqrt(o),n[0]=e[0]*o,n[1]=e[1]*o,n[2]=e[2]*o),n}const u3=on(Bg);var Hg=d3;function d3(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}const af=on(Hg);var Bd=h3;function h3(n,e,t){var r=e[0],i=e[1],o=e[2],s=t[0],a=t[1],l=t[2];return n[0]=i*l-o*a,n[1]=o*s-r*l,n[2]=r*a-i*s,n}const f3=on(Bd);var p3=Bg,Fx=Hg,m3=Bd,jx=[0,0,0],g3=v3;function v3(n,e,t,r){return Fx(n,e,t),Fx(jx,t,r),m3(n,n,jx),p3(n,n)}const lu=on(g3);var x3=y3;function y3(n){var e=n[0],t=n[1],r=n[2];return e*e+t*t+r*r}var Bx=Hg,_3=Bd,Hx=x3,lf=[],Wx=[],b3=[],S3=function(n,e,t){Bx(lf,t,e),Bx(Wx,n,e);var r=Hx(_3(b3,Wx,lf)),i=Hx(lf);if(i===0)throw Error("a and b are the same point");return r/i},w3=S3,E3=function(n,e,t){return Math.sqrt(w3(n,e,t))};const M3=on(E3);var rw={exports:{}},iw=T3,Vx=+(Math.pow(2,27)+1);function T3(n,e,t){var r=n*e,i=Vx*n,o=i-n,s=i-o,a=n-s,l=Vx*e,c=l-e,u=l-c,d=e-u,f=r-s*u,m=f-a*u,v=m-s*d,_=a*d-v;return t?(t[0]=_,t[1]=r,t):[_,r]}var C3=A3;function R3(n,e){var t=n+e,r=t-n,i=t-r,o=e-r,s=n-i,a=s+o;return a?[a,t]:[t]}function A3(n,e){var t=n.length|0,r=e.length|0;if(t===1&&r===1)return R3(n[0],e[0]);var i=t+r,o=new Array(i),s=0,a=0,l=0,c=Math.abs,u=n[a],d=c(u),f=e[l],m=c(f),v,_;d<m?(_=u,a+=1,a<t&&(u=n[a],d=c(u))):(_=f,l+=1,l<r&&(f=e[l],m=c(f))),a<t&&d<m||l>=r?(v=u,a+=1,a<t&&(u=n[a],d=c(u))):(v=f,l+=1,l<r&&(f=e[l],m=c(f)));for(var x=v+_,p=x-v,b=_-p,g=b,y=x,E,C,A,T,w;a<t&&l<r;)d<m?(v=u,a+=1,a<t&&(u=n[a],d=c(u))):(v=f,l+=1,l<r&&(f=e[l],m=c(f))),_=g,x=v+_,p=x-v,b=_-p,b&&(o[s++]=b),E=y+x,C=E-y,A=E-C,T=x-C,w=y-A,g=w+T,y=E;for(;a<t;)v=u,_=g,x=v+_,p=x-v,b=_-p,b&&(o[s++]=b),E=y+x,C=E-y,A=E-C,T=x-C,w=y-A,g=w+T,y=E,a+=1,a<t&&(u=n[a]);for(;l<r;)v=f,_=g,x=v+_,p=x-v,b=_-p,b&&(o[s++]=b),E=y+x,C=E-y,A=E-C,T=x-C,w=y-A,g=w+T,y=E,l+=1,l<r&&(f=e[l]);return g&&(o[s++]=g),y&&(o[s++]=y),s||(o[s++]=0),o.length=s,o}var P3=k3;function k3(n,e,t){var r=n+e,i=r-n,o=r-i,s=e-i,a=n-o;return t?(t[0]=a+s,t[1]=r,t):[a+s,r]}var cf=iw,I3=P3,L3=D3;function D3(n,e){var t=n.length;if(t===1){var r=cf(n[0],e);return r[0]?r:[r[1]]}var i=new Array(2*t),o=[.1,.1],s=[.1,.1],a=0;cf(n[0],e,o),o[0]&&(i[a++]=o[0]);for(var l=1;l<t;++l){cf(n[l],e,s);var c=o[1];I3(c,s[0],o),o[0]&&(i[a++]=o[0]);var u=s[1],d=o[1],f=u+d,m=f-u,v=d-m;o[1]=f,v&&(i[a++]=v)}return o[1]&&(i[a++]=o[1]),a===0&&(i[a++]=0),i.length=a,i}var N3=U3;function O3(n,e){var t=n+e,r=t-n,i=t-r,o=e-r,s=n-i,a=s+o;return a?[a,t]:[t]}function U3(n,e){var t=n.length|0,r=e.length|0;if(t===1&&r===1)return O3(n[0],-e[0]);var i=t+r,o=new Array(i),s=0,a=0,l=0,c=Math.abs,u=n[a],d=c(u),f=-e[l],m=c(f),v,_;d<m?(_=u,a+=1,a<t&&(u=n[a],d=c(u))):(_=f,l+=1,l<r&&(f=-e[l],m=c(f))),a<t&&d<m||l>=r?(v=u,a+=1,a<t&&(u=n[a],d=c(u))):(v=f,l+=1,l<r&&(f=-e[l],m=c(f)));for(var x=v+_,p=x-v,b=_-p,g=b,y=x,E,C,A,T,w;a<t&&l<r;)d<m?(v=u,a+=1,a<t&&(u=n[a],d=c(u))):(v=f,l+=1,l<r&&(f=-e[l],m=c(f))),_=g,x=v+_,p=x-v,b=_-p,b&&(o[s++]=b),E=y+x,C=E-y,A=E-C,T=x-C,w=y-A,g=w+T,y=E;for(;a<t;)v=u,_=g,x=v+_,p=x-v,b=_-p,b&&(o[s++]=b),E=y+x,C=E-y,A=E-C,T=x-C,w=y-A,g=w+T,y=E,a+=1,a<t&&(u=n[a]);for(;l<r;)v=f,_=g,x=v+_,p=x-v,b=_-p,b&&(o[s++]=b),E=y+x,C=E-y,A=E-C,T=x-C,w=y-A,g=w+T,y=E,l+=1,l<r&&(f=-e[l]);return g&&(o[s++]=g),y&&(o[s++]=y),s||(o[s++]=0),o.length=s,o}(function(n){var e=iw,t=C3,r=L3,i=N3,o=5,s=11102230246251565e-32,a=(3+16*s)*s,l=(7+56*s)*s;function c(g,y,E,C){return function(T,w,M){var P=g(g(y(w[1],M[0]),y(-M[1],w[0])),g(y(T[1],w[0]),y(-w[1],T[0]))),I=g(y(T[1],M[0]),y(-M[1],T[0])),D=C(P,I);return D[D.length-1]}}function u(g,y,E,C){return function(T,w,M,P){var I=g(g(E(g(y(M[1],P[0]),y(-P[1],M[0])),w[2]),g(E(g(y(w[1],P[0]),y(-P[1],w[0])),-M[2]),E(g(y(w[1],M[0]),y(-M[1],w[0])),P[2]))),g(E(g(y(w[1],P[0]),y(-P[1],w[0])),T[2]),g(E(g(y(T[1],P[0]),y(-P[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),P[2])))),D=g(g(E(g(y(M[1],P[0]),y(-P[1],M[0])),T[2]),g(E(g(y(T[1],P[0]),y(-P[1],T[0])),-M[2]),E(g(y(T[1],M[0]),y(-M[1],T[0])),P[2]))),g(E(g(y(w[1],M[0]),y(-M[1],w[0])),T[2]),g(E(g(y(T[1],M[0]),y(-M[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),M[2])))),$=C(I,D);return $[$.length-1]}}function d(g,y,E,C){return function(T,w,M,P,I){var D=g(g(g(E(g(E(g(y(P[1],I[0]),y(-I[1],P[0])),M[2]),g(E(g(y(M[1],I[0]),y(-I[1],M[0])),-P[2]),E(g(y(M[1],P[0]),y(-P[1],M[0])),I[2]))),w[3]),g(E(g(E(g(y(P[1],I[0]),y(-I[1],P[0])),w[2]),g(E(g(y(w[1],I[0]),y(-I[1],w[0])),-P[2]),E(g(y(w[1],P[0]),y(-P[1],w[0])),I[2]))),-M[3]),E(g(E(g(y(M[1],I[0]),y(-I[1],M[0])),w[2]),g(E(g(y(w[1],I[0]),y(-I[1],w[0])),-M[2]),E(g(y(w[1],M[0]),y(-M[1],w[0])),I[2]))),P[3]))),g(E(g(E(g(y(M[1],P[0]),y(-P[1],M[0])),w[2]),g(E(g(y(w[1],P[0]),y(-P[1],w[0])),-M[2]),E(g(y(w[1],M[0]),y(-M[1],w[0])),P[2]))),-I[3]),g(E(g(E(g(y(P[1],I[0]),y(-I[1],P[0])),w[2]),g(E(g(y(w[1],I[0]),y(-I[1],w[0])),-P[2]),E(g(y(w[1],P[0]),y(-P[1],w[0])),I[2]))),T[3]),E(g(E(g(y(P[1],I[0]),y(-I[1],P[0])),T[2]),g(E(g(y(T[1],I[0]),y(-I[1],T[0])),-P[2]),E(g(y(T[1],P[0]),y(-P[1],T[0])),I[2]))),-w[3])))),g(g(E(g(E(g(y(w[1],I[0]),y(-I[1],w[0])),T[2]),g(E(g(y(T[1],I[0]),y(-I[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),I[2]))),P[3]),g(E(g(E(g(y(w[1],P[0]),y(-P[1],w[0])),T[2]),g(E(g(y(T[1],P[0]),y(-P[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),P[2]))),-I[3]),E(g(E(g(y(M[1],P[0]),y(-P[1],M[0])),w[2]),g(E(g(y(w[1],P[0]),y(-P[1],w[0])),-M[2]),E(g(y(w[1],M[0]),y(-M[1],w[0])),P[2]))),T[3]))),g(E(g(E(g(y(M[1],P[0]),y(-P[1],M[0])),T[2]),g(E(g(y(T[1],P[0]),y(-P[1],T[0])),-M[2]),E(g(y(T[1],M[0]),y(-M[1],T[0])),P[2]))),-w[3]),g(E(g(E(g(y(w[1],P[0]),y(-P[1],w[0])),T[2]),g(E(g(y(T[1],P[0]),y(-P[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),P[2]))),M[3]),E(g(E(g(y(w[1],M[0]),y(-M[1],w[0])),T[2]),g(E(g(y(T[1],M[0]),y(-M[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),M[2]))),-P[3]))))),$=g(g(g(E(g(E(g(y(P[1],I[0]),y(-I[1],P[0])),M[2]),g(E(g(y(M[1],I[0]),y(-I[1],M[0])),-P[2]),E(g(y(M[1],P[0]),y(-P[1],M[0])),I[2]))),T[3]),E(g(E(g(y(P[1],I[0]),y(-I[1],P[0])),T[2]),g(E(g(y(T[1],I[0]),y(-I[1],T[0])),-P[2]),E(g(y(T[1],P[0]),y(-P[1],T[0])),I[2]))),-M[3])),g(E(g(E(g(y(M[1],I[0]),y(-I[1],M[0])),T[2]),g(E(g(y(T[1],I[0]),y(-I[1],T[0])),-M[2]),E(g(y(T[1],M[0]),y(-M[1],T[0])),I[2]))),P[3]),E(g(E(g(y(M[1],P[0]),y(-P[1],M[0])),T[2]),g(E(g(y(T[1],P[0]),y(-P[1],T[0])),-M[2]),E(g(y(T[1],M[0]),y(-M[1],T[0])),P[2]))),-I[3]))),g(g(E(g(E(g(y(M[1],I[0]),y(-I[1],M[0])),w[2]),g(E(g(y(w[1],I[0]),y(-I[1],w[0])),-M[2]),E(g(y(w[1],M[0]),y(-M[1],w[0])),I[2]))),T[3]),E(g(E(g(y(M[1],I[0]),y(-I[1],M[0])),T[2]),g(E(g(y(T[1],I[0]),y(-I[1],T[0])),-M[2]),E(g(y(T[1],M[0]),y(-M[1],T[0])),I[2]))),-w[3])),g(E(g(E(g(y(w[1],I[0]),y(-I[1],w[0])),T[2]),g(E(g(y(T[1],I[0]),y(-I[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),I[2]))),M[3]),E(g(E(g(y(w[1],M[0]),y(-M[1],w[0])),T[2]),g(E(g(y(T[1],M[0]),y(-M[1],T[0])),-w[2]),E(g(y(T[1],w[0]),y(-w[1],T[0])),M[2]))),-I[3])))),W=C(D,$);return W[W.length-1]}}function f(g){var y=g===3?c:g===4?u:d;return y(t,e,r,i)}var m=f(3),v=f(4),_=[function(){return 0},function(){return 0},function(y,E){return E[0]-y[0]},function(y,E,C){var A=(y[1]-C[1])*(E[0]-C[0]),T=(y[0]-C[0])*(E[1]-C[1]),w=A-T,M;if(A>0){if(T<=0)return w;M=A+T}else if(A<0){if(T>=0)return w;M=-(A+T)}else return w;var P=a*M;return w>=P||w<=-P?w:m(y,E,C)},function(y,E,C,A){var T=y[0]-A[0],w=E[0]-A[0],M=C[0]-A[0],P=y[1]-A[1],I=E[1]-A[1],D=C[1]-A[1],$=y[2]-A[2],W=E[2]-A[2],H=C[2]-A[2],Z=w*D,F=M*I,Y=M*P,X=T*D,oe=T*I,pe=w*P,De=$*(Z-F)+W*(Y-X)+H*(oe-pe),z=(Math.abs(Z)+Math.abs(F))*Math.abs($)+(Math.abs(Y)+Math.abs(X))*Math.abs(W)+(Math.abs(oe)+Math.abs(pe))*Math.abs(H),ve=l*z;return De>ve||-De>ve?De:v(y,E,C,A)}];function x(g){var y=_[g.length];return y||(y=_[g.length]=f(g.length)),y.apply(void 0,g)}function p(g,y,E,C,A,T,w){return function(P,I,D,$,W){switch(arguments.length){case 0:case 1:return 0;case 2:return C(P,I);case 3:return A(P,I,D);case 4:return T(P,I,D,$);case 5:return w(P,I,D,$,W)}for(var H=new Array(arguments.length),Z=0;Z<arguments.length;++Z)H[Z]=arguments[Z];return g(H)}}function b(){for(;_.length<=o;)_.push(f(_.length));n.exports=p.apply(void 0,[x].concat(_));for(var g=0;g<=o;++g)n.exports[g]=_[g]}b()})(rw);var z3=rw.exports,F3=j3,$x=z3[3];function j3(n){var e=n.length;if(e<3){for(var c=new Array(e),t=0;t<e;++t)c[t]=t;return e===2&&n[0][0]===n[1][0]&&n[0][1]===n[1][1]?[0]:c}for(var r=new Array(e),t=0;t<e;++t)r[t]=t;r.sort(function(m,v){var _=n[m][0]-n[v][0];return _||n[m][1]-n[v][1]});for(var i=[r[0],r[1]],o=[r[0],r[1]],t=2;t<e;++t){for(var s=r[t],a=n[s],l=i.length;l>1&&$x(n[i[l-2]],n[i[l-1]],a)<=0;)l-=1,i.pop();for(i.push(s),l=o.length;l>1&&$x(n[o[l-2]],n[o[l-1]],a)>=0;)l-=1,o.pop();o.push(s)}for(var c=new Array(o.length+i.length-2),u=0,t=0,d=i.length;t<d;++t)c[u++]=i[t];for(var f=o.length-2;f>0;--f)c[u++]=o[f];return c}const B3=on(F3);var ow=H3;function H3(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}const Vr=on(ow);var W3=V3;function V3(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n}const Iu=on(W3);var $3=G3;function G3(n,e,t,r){var i=new Float32Array(4);return i[0]=n,i[1]=e,i[2]=t,i[3]=r,i}const X3=on($3);var Y3=q3;function q3(n,e,t){var r=e[0],i=e[1],o=e[2],s=e[3];return n[0]=t[0]*r+t[4]*i+t[8]*o+t[12]*s,n[1]=t[1]*r+t[5]*i+t[9]*o+t[13]*s,n[2]=t[2]*r+t[6]*i+t[10]*o+t[14]*s,n[3]=t[3]*r+t[7]*i+t[11]*o+t[15]*s,n}const K3=on(Y3);var J3=Z3;function Z3(n,e,t){var r=e[0],i=e[1],o=e[2],s=e[3],a=r+r,l=i+i,c=o+o,u=r*a,d=r*l,f=r*c,m=i*l,v=i*c,_=o*c,x=s*a,p=s*l,b=s*c;return n[0]=1-(m+_),n[1]=d+b,n[2]=f-p,n[3]=0,n[4]=d-b,n[5]=1-(u+_),n[6]=v+x,n[7]=0,n[8]=f+p,n[9]=v-x,n[10]=1-(u+m),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n}const Q3=on(J3);var sw=eD;function eD(n){var e=n[0],t=n[1],r=n[2];return Math.sqrt(e*e+t*t+r*r)}const tD=on(sw);var nD=rD;function rD(n,e){var t=e[0],r=e[1],i=e[2],o=e[3],s=t*t+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),n[0]=t*s,n[1]=r*s,n[2]=i*s,n[3]=o*s),n}var iD=nD,oD=sD;function sD(n,e,t){t=t*.5;var r=Math.sin(t);return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=Math.cos(t),n}var aD=ow,uf=Bd,lD=sw,cD=Bg,uD=iD,dD=oD,hD=mD,Br=[0,0,0],fD=[1,0,0],pD=[0,1,0];function mD(n,e,t){var r=aD(e,t);return r<-.999999?(uf(Br,fD,e),lD(Br)<1e-6&&uf(Br,pD,e),cD(Br,Br),dD(n,Br,Math.PI),n):r>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(uf(Br,e,t),n[0]=Br[0],n[1]=Br[1],n[2]=Br[2],n[3]=1+r,uD(n,n))}const gD=on(hD);var ym={exports:{}},df,Gx;function vD(){if(Gx)return df;Gx=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,o=r*365.25;df=function(u,d){d=d||{};var f=typeof u;if(f==="string"&&u.length>0)return s(u);if(f==="number"&&isFinite(u))return d.long?l(u):a(u);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(u))};function s(u){if(u=String(u),!(u.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(u);if(d){var f=parseFloat(d[1]),m=(d[2]||"ms").toLowerCase();switch(m){case"years":case"year":case"yrs":case"yr":case"y":return f*o;case"weeks":case"week":case"w":return f*i;case"days":case"day":case"d":return f*r;case"hours":case"hour":case"hrs":case"hr":case"h":return f*t;case"minutes":case"minute":case"mins":case"min":case"m":return f*e;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function a(u){var d=Math.abs(u);return d>=r?Math.round(u/r)+"d":d>=t?Math.round(u/t)+"h":d>=e?Math.round(u/e)+"m":d>=n?Math.round(u/n)+"s":u+"ms"}function l(u){var d=Math.abs(u);return d>=r?c(u,d,r,"day"):d>=t?c(u,d,t,"hour"):d>=e?c(u,d,e,"minute"):d>=n?c(u,d,n,"second"):u+" ms"}function c(u,d,f,m){var v=d>=f*1.5;return Math.round(u/f)+" "+m+(v?"s":"")}return df}function xD(n){t.debug=t,t.default=t,t.coerce=l,t.disable=s,t.enable=i,t.enabled=a,t.humanize=vD(),t.destroy=c,Object.keys(n).forEach(u=>{t[u]=n[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let d=0;for(let f=0;f<u.length;f++)d=(d<<5)-d+u.charCodeAt(f),d|=0;return t.colors[Math.abs(d)%t.colors.length]}t.selectColor=e;function t(u){let d,f=null,m,v;function _(...x){if(!_.enabled)return;const p=_,b=Number(new Date),g=b-(d||b);p.diff=g,p.prev=d,p.curr=b,d=b,x[0]=t.coerce(x[0]),typeof x[0]!="string"&&x.unshift("%O");let y=0;x[0]=x[0].replace(/%([a-zA-Z%])/g,(C,A)=>{if(C==="%%")return"%";y++;const T=t.formatters[A];if(typeof T=="function"){const w=x[y];C=T.call(p,w),x.splice(y,1),y--}return C}),t.formatArgs.call(p,x),(p.log||t.log).apply(p,x)}return _.namespace=u,_.useColors=t.useColors(),_.color=t.selectColor(u),_.extend=r,_.destroy=t.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(m!==t.namespaces&&(m=t.namespaces,v=t.enabled(u)),v),set:x=>{f=x}}),typeof t.init=="function"&&t.init(_),_}function r(u,d){const f=t(this.namespace+(typeof d>"u"?":":d)+u);return f.log=this.log,f}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];const d=(typeof u=="string"?u:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const f of d)f[0]==="-"?t.skips.push(f.slice(1)):t.names.push(f)}function o(u,d){let f=0,m=0,v=-1,_=0;for(;f<u.length;)if(m<d.length&&(d[m]===u[f]||d[m]==="*"))d[m]==="*"?(v=m,_=f,m++):(f++,m++);else if(v!==-1)m=v+1,_++,f=_;else return!1;for(;m<d.length&&d[m]==="*";)m++;return m===d.length}function s(){const u=[...t.names,...t.skips.map(d=>"-"+d)].join(",");return t.enable(""),u}function a(u){for(const d of t.skips)if(o(u,d))return!1;for(const d of t.names)if(o(u,d))return!0;return!1}function l(u){return u instanceof Error?u.stack||u.message:u}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var yD=xD;(function(n,e){var t={};e.formatArgs=i,e.save=o,e.load=s,e.useColors=r,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function r(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function i(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let d=0,f=0;c[0].replace(/%[a-zA-Z%]/g,m=>{m!=="%%"&&(d++,m==="%c"&&(f=d))}),c.splice(f,0,u)}e.log=console.debug||console.log||(()=>{});function o(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function s(){let c;try{c=e.storage.getItem("debug")||e.storage.getItem("DEBUG")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=t.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=yD(e);const{formatters:l}=n.exports;l.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(ym,ym.exports);var _D=ym.exports;const Wg=on(_D);class Xx{constructor(){dt(this,"head");dt(this,"tail");this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}first(){return this.head}isEmpty(){return!this.head}}class bD{constructor(e,t){dt(this,"point");dt(this,"index");dt(this,"next");dt(this,"prev");dt(this,"face");this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null}}var SD=wD;function wD(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}const Yx=on(SD);var ED=MD;function MD(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}const TD=on(ED);var CD=RD;function RD(n,e,t,r){return n[0]=e[0]+t[0]*r,n[1]=e[1]+t[1]*r,n[2]=e[2]+t[2]*r,n}const AD=on(CD);var PD=kD;function kD(n,e){var t=e[0]-n[0],r=e[1]-n[1],i=e[2]-n[2];return Math.sqrt(t*t+r*r+i*i)}const ID=on(PD);var LD=DD;function DD(n,e){var t=e[0]-n[0],r=e[1]-n[1],i=e[2]-n[2];return t*t+r*r+i*i}const ND=on(LD),qx=Wg("quickhull3d:halfedge");class sl{constructor(e,t){dt(this,"vertex");dt(this,"face");dt(this,"next");dt(this,"prev");dt(this,"opposite");this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?ID(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?ND(this.tail().point,this.head().point):-1}setOpposite(e){const t=this;qx.enabled&&qx(`opposite ${t.tail().index} <--> ${t.head().index} between ${t.face.collectIndices()}, ${e.face.collectIndices()}`),this.opposite=e,e.opposite=this}}const cu=Wg("quickhull3d:face");var Hn;(function(n){n[n.Visible=0]="Visible",n[n.NonConvex=1]="NonConvex",n[n.Deleted=2]="Deleted"})(Hn||(Hn={}));class nr{constructor(){dt(this,"normal");dt(this,"centroid");dt(this,"offset");dt(this,"outside");dt(this,"mark");dt(this,"edge");dt(this,"nVertices");dt(this,"area");this.normal=[0,0,0],this.centroid=[0,0,0],this.offset=0,this.outside=null,this.mark=Hn.Visible,this.edge=null,this.nVertices=0}getEdge(e){let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}computeNormal(){const e=this.edge,t=e.next;let r=t.next;const i=af([],t.head().point,e.head().point),o=[],s=[];for(this.nVertices=2,this.normal=[0,0,0];r!==e;)TD(s,i),af(i,r.head().point,e.head().point),Yx(this.normal,this.normal,f3(o,s,i)),r=r.next,this.nVertices+=1;this.area=tD(this.normal),this.normal=Iu(this.normal,this.normal,1/this.area)}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let t,r=0,i=this.edge;do{const u=i.lengthSquared();u>r&&(t=i,r=u),i=i.next}while(i!==this.edge);const o=t.tail().point,s=t.head().point,a=af([],s,o),l=Math.sqrt(r);Iu(a,a,1/l);const c=Vr(this.normal,a);AD(this.normal,this.normal,a,-c),u3(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do Yx(this.centroid,this.centroid,e.head().point),e=e.next;while(e!==this.edge);Iu(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(e){typeof e<"u"?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=Vr(this.normal,this.centroid)}distanceToPlane(e){return Vr(this.normal,e)-this.offset}connectHalfEdges(e,t){let r;if(e.opposite.face===t.opposite.face){const i=t.opposite.face;let o;e===this.edge&&(this.edge=t),i.nVertices===3?(o=t.opposite.prev.opposite,i.mark=Hn.Deleted,r=i):(o=t.opposite.next,i.edge===o.prev&&(i.edge=o),o.prev=o.prev.prev,o.prev.next=o),t.prev=e.prev,t.prev.next=t,t.setOpposite(o),i.computeNormalAndCentroid()}else e.next=t,t.prev=e;return r}mergeAdjacentFaces(e,t){const r=e.opposite,i=r.face;t.push(i),i.mark=Hn.Deleted;let o=e.prev,s=e.next,a=r.prev,l=r.next;for(;o.opposite.face===i;)o=o.prev,l=l.next;for(;s.opposite.face===i;)s=s.next,a=a.prev;let c;for(c=l;c!==a.next;c=c.next)c.face=this;this.edge=s;let u;return u=this.connectHalfEdges(a,s),u&&t.push(u),u=this.connectHalfEdges(o,l),u&&t.push(u),this.computeNormalAndCentroid(),t}collectIndices(){const e=[];let t=this.edge;do e.push(t.head().index),t=t.next;while(t!==this.edge);return e}static fromVertices(e,t=0){const r=new nr,i=new sl(e[0],r);let o=i;for(let s=1;s<e.length;s+=1){const a=new sl(e[s],r);a.prev=o,o.next=a,o=a}return o.next=i,i.prev=o,r.edge=i,r.computeNormalAndCentroid(t),cu.enabled&&cu("face created %j",r.collectIndices()),r}static createTriangle(e,t,r,i=0){const o=new nr,s=new sl(e,o),a=new sl(t,o),l=new sl(r,o);return s.next=l.prev=a,a.next=s.prev=l,l.next=a.prev=s,o.edge=s,o.computeNormalAndCentroid(i),cu.enabled&&cu("face created %j",o.collectIndices()),o}}const er=Wg("quickhull3d:quickhull");var Tl;(function(n){n[n.NonConvexWrtLargerFace=0]="NonConvexWrtLargerFace",n[n.NonConvex=1]="NonConvex"})(Tl||(Tl={}));class OD{constructor(e){dt(this,"tolerance");dt(this,"faces");dt(this,"newFaces");dt(this,"claimed");dt(this,"unclaimed");dt(this,"vertices");dt(this,"discardedFaces");dt(this,"vertexPointIndices");if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.faces=[],this.newFaces=[],this.claimed=new Xx,this.unclaimed=new Xx,this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new bD(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}deleteFaceVertices(e,t){const r=this.removeAllVerticesFromFace(e);if(r)if(!t)this.unclaimed.addAll(r);else{let i;for(let o=r;o;o=i)i=o.next,t.distanceToPlane(o.point)>this.tolerance?this.addVertexToFace(o,t):this.unclaimed.add(o)}}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let r=t;r;r=t){t=r.next;let i=this.tolerance,o;for(let s=0;s<e.length;s+=1){const a=e[s];if(a.mark===Hn.Visible){const l=a.distanceToPlane(r.point);if(l>i&&(i=l,o=a),i>1e3*this.tolerance)break}}o&&this.addVertexToFace(r,o)}}allPointsBelongToPlane(e,t,r){const i=lu([0,0,0],e.point,t.point,r.point),o=Vr(i,e.point);for(const s of this.vertices){const a=Vr(s.point,i);if(Math.abs(a-o)>this.tolerance)return!1}return!0}convexHull2d(e,t,r){const i=lu([0,0,0],e.point,t.point,r.point),s=gD([],i,[0,1,0]),a=Iu([],i,-Vr(e.point,i)),l=Q3([],s,a),c=[];for(const m of this.vertices){const v=X3(m.point[0],m.point[1],m.point[2],0),_=K3([],v,l);er.enabled&&_[1]>this.tolerance&&er(`ERROR: point ${_} has an unexpected y value, it should be less than ${this.tolerance}`),c.push([_[0],_[2]])}const u=B3(c),d=[];for(const m of u)d.push(this.vertices[m]);const f=nr.fromVertices(d);this.faces=[f]}computeTetrahedronExtremes(){const e=this,t=[],r=[],i=[],o=[];for(let v=0;v<3;v+=1)i[v]=o[v]=this.vertices[0];for(let v=0;v<3;v+=1)t[v]=r[v]=this.vertices[0].point[v];for(let v=1;v<this.vertices.length;v+=1){const _=this.vertices[v],x=_.point;for(let p=0;p<3;p+=1)x[p]<t[p]&&(t[p]=x[p],i[p]=_);for(let p=0;p<3;p+=1)x[p]>r[p]&&(r[p]=x[p],o[p]=_)}this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t[0]),Math.abs(r[0]))+Math.max(Math.abs(t[1]),Math.abs(r[1]))+Math.max(Math.abs(t[2]),Math.abs(r[2]))),er.enabled&&er("tolerance %d",e.tolerance);let s=0,a=0;for(let v=0;v<3;v+=1){const _=o[v].point[v]-i[v].point[v];_>s&&(s=_,a=v)}const l=i[a],c=o[a];let u,d;s=0;for(let v=0;v<this.vertices.length;v+=1){const _=this.vertices[v];if(_!==l&&_!==c){const x=M3(_.point,l.point,c.point);x>s&&(s=x,u=_)}}const f=lu([0,0,0],l.point,c.point,u.point),m=Vr(l.point,f);s=-1;for(let v=0;v<this.vertices.length;v+=1){const _=this.vertices[v];if(_!==l&&_!==c&&_!==u){const x=Math.abs(Vr(f,_.point)-m);x>s&&(s=x,d=_)}}return[l,c,u,d]}createInitialSimplex(e,t,r,i){const o=lu([0,0,0],e.point,t.point,r.point),s=Vr(e.point,o),a=[];if(Vr(i.point,o)-s<0){a.push(nr.createTriangle(e,t,r),nr.createTriangle(i,t,e),nr.createTriangle(i,r,t),nr.createTriangle(i,e,r));for(let c=0;c<3;c+=1){const u=(c+1)%3;a[c+1].getEdge(2).setOpposite(a[0].getEdge(u)),a[c+1].getEdge(1).setOpposite(a[u+1].getEdge(0))}}else{a.push(nr.createTriangle(e,r,t),nr.createTriangle(i,e,t),nr.createTriangle(i,t,r),nr.createTriangle(i,r,e));for(let c=0;c<3;c+=1){const u=(c+1)%3;a[c+1].getEdge(2).setOpposite(a[0].getEdge((3-c)%3)),a[c+1].getEdge(0).setOpposite(a[u+1].getEdge(1))}}for(let c=0;c<4;c+=1)this.faces.push(a[c]);const l=this.vertices;for(let c=0;c<l.length;c+=1){const u=l[c];if(u!==e&&u!==t&&u!==r&&u!==i){let d=this.tolerance,f;for(let m=0;m<4;m+=1){const v=a[m].distanceToPlane(u.point);v>d&&(d=v,f=a[m])}f&&this.addVertexToFace(u,f)}}}reindexFaceAndVertices(){const e=[];for(let t=0;t<this.faces.length;t+=1){const r=this.faces[t];r.mark===Hn.Visible&&e.push(r)}this.faces=e}collectFaces(e){const t=[];for(let r=0;r<this.faces.length;r+=1){if(this.faces[r].mark!==Hn.Visible)throw Error("attempt to include a destroyed face in the hull");const i=this.faces[r].collectIndices();if(e)t.push(i);else for(let o=0;o<i.length-2;o+=1)t.push([i[0],i[o+1],i[o+2]])}return t}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,r=0;const i=this.claimed.first().face;for(t=i.outside;t&&t.face===i;t=t.next){const o=i.distanceToPlane(t.point);o>r&&(r=o,e=t)}return e}}computeHorizon(e,t,r,i){this.deleteFaceVertices(r),r.mark=Hn.Deleted;let o;t?o=t.next:o=t=r.getEdge(0);do{const s=o.opposite,a=s.face;a.mark===Hn.Visible&&(a.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,s,a,i):i.push(o)),o=o.next}while(o!==t)}addAdjoiningFace(e,t){const r=nr.createTriangle(e,t.tail(),t.head());return this.faces.push(r),r.getEdge(-1).setOpposite(t.opposite),r.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let r,i;for(let o=0;o<t.length;o+=1){const s=t[o],a=this.addAdjoiningFace(e,s);r?a.next.setOpposite(i):r=a,this.newFaces.push(a.face),i=a}r.next.setOpposite(i)}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid)}doAdjacentMerge(e,t){let r=e.edge,i=!0,o=0;do{if(o>=e.nVertices)throw Error("merge recursion limit exceeded");const s=r.opposite.face;let a=!1;if(t===Tl.NonConvex?(this.oppositeFaceDistance(r)>-this.tolerance||this.oppositeFaceDistance(r.opposite)>-this.tolerance)&&(a=!0):e.area>s.area?this.oppositeFaceDistance(r)>-this.tolerance?a=!0:this.oppositeFaceDistance(r.opposite)>-this.tolerance&&(i=!1):this.oppositeFaceDistance(r.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(r)>-this.tolerance&&(i=!1),a){er("face merge");const l=e.mergeAdjacentFaces(r,[]);for(let c=0;c<l.length;c+=1)this.deleteFaceVertices(l[c],e);return!0}r=r.next,o+=1}while(r!==e.edge);return i||(e.mark=Hn.NonConvex),!1}addVertexToHull(e){const t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),er.enabled&&er("horizon %j",t.map(function(r){return r.head().index})),this.addNewFaces(e,t),er("first merge");for(let r=0;r<this.newFaces.length;r+=1){const i=this.newFaces[r];if(i.mark===Hn.Visible)for(;this.doAdjacentMerge(i,Tl.NonConvexWrtLargerFace););}er("second merge");for(let r=0;r<this.newFaces.length;r+=1){const i=this.newFaces[r];if(i.mark===Hn.NonConvex)for(i.mark=Hn.Visible;this.doAdjacentMerge(i,Tl.NonConvexWrtLargerFace););}er("reassigning points to newFaces"),this.resolveUnclaimedPoints(this.newFaces)}build(){let e=0,t;const[r,i,o,s]=this.computeTetrahedronExtremes();if(this.allPointsBelongToPlane(r,i,o))return this.convexHull2d(r,i,o),this;for(this.createInitialSimplex(r,i,o,s);t=this.nextVertexToAdd();)e+=1,er(`== iteration ${e} ==`),er("next vertex to add = %d %j",t.index,t.point),this.addVertexToHull(t),er(`== end iteration ${e}`);return this.reindexFaceAndVertices(),this}}function hf(n,e={}){const t=new OD(n);return t.build(),t.collectFaces(e.skipTriangulation)}function xs(n,e=1e-6){if(n.length<4)return{faces:[{area:1,normal:{x:0,y:1,z:0},vertices:n}]};let t;try{const o=n.map(s=>[s.x,s.y,s.z]);t=hf(o)}catch{try{const s=n.flatMap(a=>[a.x,a.y,a.z]);t=hf(s)}catch{try{const a=n.map(l=>({x:l.x,y:l.y,z:l.z}));t=hf(a)}catch{return console.warn(" QuickHull failed, using fallback bounding box"),BD(n)}}}const r=t.map(o=>{const s=o.map(c=>n[c]),{area:a,normal:l}=UD(s,n);return{area:a,normal:l,vertices:s}});return{faces:zD(r,e)}}function UD(n,e){if(n.length<3)return{area:0,normal:{x:0,y:1,z:0}};const t=n[0],r=n[1],i=n[2],o={x:r.x-t.x,y:r.y-t.y,z:r.z-t.z},s={x:i.x-t.x,y:i.y-t.y,z:i.z-t.z};let a={x:o.y*s.z-o.z*s.y,y:o.z*s.x-o.x*s.z,z:o.x*s.y-o.y*s.x};const l=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);if(l>0&&(a.x/=l,a.y/=l,a.z/=l),e&&e.length>0){const u={x:0,y:0,z:0};for(const m of e)u.x+=m.x,u.y+=m.y,u.z+=m.z;u.x/=e.length,u.y/=e.length,u.z/=e.length;const d={x:t.x-u.x,y:t.y-u.y,z:t.z-u.z};a.x*d.x+a.y*d.y+a.z*d.z<0&&(a={x:-a.x,y:-a.y,z:-a.z})}return{area:l*.5,normal:a}}function zD(n,e){const t=[],r=new Set;for(let i=0;i<n.length;i++){if(r.has(i))continue;const o=n[i],s=[o];r.add(i);for(let a=i+1;a<n.length;a++){if(r.has(a))continue;const l=n[a];FD(o.normal,l.normal,e)&&(s.push(l),r.add(a))}if(s.length===1)t.push(o);else{const a=jD(s);t.push(a)}}return t}function FD(n,e,t){const r=Math.abs(n.x*e.x+n.y*e.y+n.z*e.z);return Math.abs(r-1)<t}function jD(n){const e=[];let t=0;for(const i of n)e.push(...i.vertices),t+=i.area;const r=n.reduce((i,o)=>o.area>i.area?o:i);return{area:t,normal:r.normal,vertices:e}}function BD(n){console.log(` Creating bounding box hull fallback for ${n.length} points`);const e={x:1/0,y:1/0,z:1/0},t={x:-1/0,y:-1/0,z:-1/0};for(const i of n)i.x<e.x&&(e.x=i.x),i.y<e.y&&(e.y=i.y),i.z<e.z&&(e.z=i.z),i.x>t.x&&(t.x=i.x),i.y>t.y&&(t.y=i.y),i.z>t.z&&(t.z=i.z);const r=[{area:(t.x-e.x)*(t.z-e.z),normal:{x:0,y:1,z:0},vertices:[]},{area:(t.x-e.x)*(t.z-e.z),normal:{x:0,y:-1,z:0},vertices:[]},{area:(t.y-e.y)*(t.z-e.z),normal:{x:1,y:0,z:0},vertices:[]},{area:(t.y-e.y)*(t.z-e.z),normal:{x:-1,y:0,z:0},vertices:[]},{area:(t.x-e.x)*(t.y-e.y),normal:{x:0,y:0,z:1},vertices:[]},{area:(t.x-e.x)*(t.y-e.y),normal:{x:0,y:0,z:-1},vertices:[]}];return console.log(` Bounding box hull: 6 faces, largest area: ${Math.max(...r.map(i=>i.area)).toFixed(3)}`),{faces:r}}const pn={camera:{fovDeg:35,orthoZoom:1,projection:"perspective"},effect:{id:"none",export:{aspect:"landscape",quality:"medium",resolution:"1080p"},output:{export:!1,screen:!0},durationSec:3},lights:{hdr:{envId:"studio",enabled:!0,intensity:1.5},shadows:{enabled:!0,intensity:1},brightness:2.7,directional:[1,.8,.6,.4,.2],backgroundColor:"#000000"},material:{color:"#ffffff",opacity:1,metalness:1,roughness:0},emptyCells:{customMaterial:{color:"#4a4a4a",opacity:.48,metalness:.02,roughness:0},linkToEnvironment:!1}},fd={"metallic-light":{...pn,lights:{...pn.lights,hdr:{envId:"studio",enabled:!0,intensity:1.5},shadows:{enabled:!0,intensity:1},backgroundColor:"#ffffff"},material:{...pn.material,metalness:1,roughness:0},emptyCells:{customMaterial:{color:"#4a4a4a",opacity:.48,metalness:.02,roughness:0},linkToEnvironment:!1}},"metallic-dark":{...pn,lights:{...pn.lights,hdr:{envId:"studio",enabled:!0,intensity:1.5},shadows:{enabled:!0,intensity:1},backgroundColor:"#000000"},material:{...pn.material,metalness:1,roughness:0},emptyCells:{customMaterial:{color:"#4a4a4a",opacity:.48,metalness:.02,roughness:0},linkToEnvironment:!1}},"shiny-light":{...pn,lights:{...pn.lights,hdr:{envId:"studio",enabled:!0,intensity:1},shadows:{enabled:!1,intensity:1},backgroundColor:"#ffffff"},material:{...pn.material,metalness:0,roughness:0},emptyCells:{customMaterial:{color:"#4a4a4a",opacity:.59,metalness:.78,roughness:.4},linkToEnvironment:!1},sphereColorTheme:"default"},"shiny-dark":{...pn,lights:{...pn.lights,hdr:{envId:"studio",enabled:!0,intensity:1},shadows:{enabled:!1,intensity:1},backgroundColor:"#000000"},material:{...pn.material,metalness:0,roughness:0},emptyCells:{customMaterial:{color:"#4a4a4a",opacity:.59,metalness:.78,roughness:.4},linkToEnvironment:!1},sphereColorTheme:"default"},"matte-light":{...pn,lights:{...pn.lights,hdr:{envId:"studio",enabled:!0,intensity:.4},shadows:{enabled:!1,intensity:1},backgroundColor:"#ffffff"},material:{...pn.material,metalness:0,roughness:.48},emptyCells:{customMaterial:{color:"#978c8c",opacity:.68,metalness:0,roughness:.57},linkToEnvironment:!1},sphereColorTheme:"default"},"matte-dark":{...pn,lights:{...pn.lights,hdr:{envId:"studio",enabled:!0,intensity:.4},shadows:{enabled:!1,intensity:1},backgroundColor:"#000000"},material:{...pn.material,metalness:0,roughness:.48},emptyCells:{customMaterial:{color:"#a8a4a4",opacity:.7,metalness:0,roughness:.44},linkToEnvironment:!1},sphereColorTheme:"default"}},HD={"metallic-light":"Metallic Light","metallic-dark":"Metallic Dark","shiny-light":"Shiny Light","shiny-dark":"Shiny Dark","matte-light":"Matte Light","matte-dark":"Matte Dark"},WD=["metallic-light","metallic-dark","shiny-light","shiny-dark","matte-light","matte-dark"],Hd=({isOpen:n,currentPreset:e,onClose:t,onSelectPreset:r})=>{if(!n)return null;const i=o=>{const s=fd[o];r(s,o),t()};return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .preset-modal {
          width: min(360px, 86vw);
          height: auto;
          max-height: calc(100vh - 160px);
          overflow: hidden;
          padding: 12px;
        }
        .preset-modal-grid {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          gap: 8px;
        }
        .preset-modal-tile {
          height: 92px;
          padding: 10px 8px;
          font-size: 0.9rem;
          position: relative;
          overflow: hidden;
          line-height: 1.1;
        }
        .preset-modal-icon {
          font-size: 1.25rem;
          line-height: 1;
        }
        .preset-modal-sub {
          font-size: 0.78rem;
          line-height: 1.05;
        }
        .preset-modal-check {
          position: absolute;
          top: 8px;
          right: 10px;
          font-size: 0.75rem;
          font-weight: 700;
          color: #93c5fd;
          text-shadow: 0 1px 6px rgba(0,0,0,0.45);
          pointer-events: none;
        }
        .preset-modal-tip {
          display: none;
        }
        @media (max-width: 520px) {
          .preset-modal {
            padding: 12px;
            border-radius: 14px;
          }
          .preset-modal-grid {
            grid-template-columns: 1fr;
          }
          .preset-modal-tile {
            height: 80px;
            padding: 10px 10px;
          }
        }
        @media (min-height: 820px) {
          .preset-modal-tip {
            display: block;
          }
        }
      `}),h.jsx("div",{onClick:t,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.55)",backdropFilter:"blur(4px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center"},children:h.jsxs("div",{onClick:o=>o.stopPropagation(),className:"preset-modal",style:{background:"linear-gradient(135deg, rgba(255,255,255,0.92) 0%, rgba(236,233,255,0.90) 45%, rgba(219,234,254,0.88) 100%)",borderRadius:"16px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"1px solid rgba(255, 255, 255, 0.35)"},children:[h.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.6rem",borderBottom:"1px solid rgba(15, 23, 42, 0.12)"},children:[h.jsx("h2",{style:{margin:0,fontSize:"1.1rem",fontWeight:600,color:"#0f172a",background:"linear-gradient(135deg, #60a5fa, #a78bfa)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Choose Environment"}),h.jsx("button",{onClick:t,style:{background:"none",border:"none",color:"#334155",fontSize:"1.5rem",cursor:"pointer",padding:"0.25rem 0.5rem",borderRadius:"4px",transition:"color 0.2s"},onMouseEnter:o=>o.currentTarget.style.color="#fff",onMouseLeave:o=>o.currentTarget.style.color="#334155",children:""})]}),h.jsx("div",{className:"preset-modal-grid",children:WD.map(o=>{const s=e===o,a=HD[o],[l,c]=a.split(" "),u=c==="Dark";return h.jsxs("button",{onClick:()=>i(o),className:"preset-modal-tile",style:{background:s?"linear-gradient(135deg, #3b82f6, #8b5cf6)":u?"linear-gradient(135deg, #1e293b, #0f172a)":"linear-gradient(135deg, #f1f5f9, #e2e8f0)",border:s?"2px solid #60a5fa":"2px solid rgba(255, 255, 255, 0.1)",borderRadius:"12px",color:u||s?"#fff":"#1e293b",cursor:"pointer",transition:"all 0.2s",display:"flex",flexDirection:"column",alignItems:"center",gap:"0.35rem",fontWeight:600,boxShadow:s?"0 8px 16px rgba(59, 130, 246, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.2)"},onMouseEnter:d=>{s||(d.currentTarget.style.transform="translateY(-2px)",d.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)")},onMouseLeave:d=>{d.currentTarget.style.transform="translateY(0)",d.currentTarget.style.boxShadow=s?"0 8px 16px rgba(59, 130, 246, 0.3)":"0 2px 8px rgba(0, 0, 0, 0.2)"},children:[s&&h.jsx("div",{className:"preset-modal-check",children:""}),h.jsxs("div",{className:"preset-modal-icon",children:[l==="Metallic"&&"",l==="Shiny"&&"",l==="Matte"&&""]}),h.jsx("div",{children:l}),h.jsx("div",{className:"preset-modal-sub",style:{opacity:.8,fontWeight:400},children:c})]},o)})}),h.jsxs("div",{className:"preset-modal-tip",style:{marginTop:"0.75rem",padding:"0.6rem",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:"8px",fontSize:"0.78rem",color:"#cbd5e1",lineHeight:"1.45"},children:[h.jsx("strong",{style:{color:"#60a5fa"},children:"Tip:"})," Choose a preset to instantly set the perfect lighting and material style for your creation."]})]})})]})},Kx={low:{name:"Low",resolution:{width:1280,height:720},bitrate:2e6,fps:24,description:"720p, small file"},medium:{name:"Medium",resolution:{width:1920,height:1080},bitrate:5e6,fps:30,description:"1080p, balanced"},high:{name:"High",resolution:{width:2560,height:1440},bitrate:12e6,fps:60,description:"1440p, large file"}},VD=({isOpen:n,onClose:e,onRecordingReady:t,actions:r,cells:i,creationTimeMs:o})=>{const[s,a]=S.useState("medium"),[l,c]=S.useState("landscape"),[u,d]=S.useState(5),[f,m]=S.useState(""),v=b=>`~${(Kx[b].bitrate*u/8/1024/1024).toFixed(1)} MB`,_=()=>{console.log(` Recording prepared: ${r.length} actions over ${u}s`),console.log(`Settings: ${s}, ${l}`),e(),t&&t(u)},x=()=>{e()};if(!n)return null;const p=h.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:5e3},children:h.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",padding:"2rem",maxWidth:"600px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"},children:[h.jsx("h2",{style:{margin:"0 0 1rem 0",fontSize:"1.5rem",fontWeight:600},children:" Create Movie"}),h.jsxs("div",{style:{padding:"1rem",background:"#f0f9ff",borderRadius:"8px",marginBottom:"1.5rem",borderLeft:"4px solid #2196F3"},children:[h.jsx("div",{style:{fontSize:"0.875rem",marginBottom:"0.5rem"},children:h.jsx("strong",{children:"Your Creation:"})}),h.jsxs("div",{style:{fontSize:"0.8rem",color:"#666"},children:[" ",i.length," spheres",h.jsx("br",{})," ",r.length," actions tracked",h.jsx("br",{})," ",(o/1e3).toFixed(1),"s creation time"]})]}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",fontWeight:500,marginBottom:"0.75rem"},children:"Aspect Ratio"}),h.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[h.jsxs("button",{onClick:()=>c("landscape"),style:{flex:1,padding:"0.75rem",border:`2px solid ${l==="landscape"?"#007bff":"#e9ecef"}`,borderRadius:"6px",backgroundColor:l==="landscape"?"#f8f9ff":"#fff",cursor:"pointer",fontWeight:l==="landscape"?600:400,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[h.jsx("div",{style:{fontSize:"1.2rem"},children:""}),h.jsx("div",{children:"Landscape"}),h.jsx("div",{style:{fontSize:"0.75rem",color:"#666"},children:"16:9"})]}),h.jsxs("button",{onClick:()=>c("square"),style:{flex:1,padding:"0.75rem",border:`2px solid ${l==="square"?"#007bff":"#e9ecef"}`,borderRadius:"6px",backgroundColor:l==="square"?"#f8f9ff":"#fff",cursor:"pointer",fontWeight:l==="square"?600:400,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[h.jsx("div",{style:{fontSize:"1.2rem"},children:""}),h.jsx("div",{children:"Square"}),h.jsx("div",{style:{fontSize:"0.75rem",color:"#666"},children:"1:1"})]}),h.jsxs("button",{onClick:()=>c("portrait"),style:{flex:1,padding:"0.75rem",border:`2px solid ${l==="portrait"?"#007bff":"#e9ecef"}`,borderRadius:"6px",backgroundColor:l==="portrait"?"#f8f9ff":"#fff",cursor:"pointer",fontWeight:l==="portrait"?600:400,display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem"},children:[h.jsx("div",{style:{fontSize:"1.2rem"},children:""}),h.jsx("div",{children:"Portrait"}),h.jsx("div",{style:{fontSize:"0.75rem",color:"#666"},children:"9:16"})]})]})]}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",fontWeight:500,marginBottom:"0.75rem"},children:"Movie Duration (seconds)"}),h.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[h.jsx("input",{type:"range",min:"5",max:"30",step:"1",value:u,onChange:b=>d(Number(b.target.value)),style:{flex:1}}),h.jsxs("div",{style:{minWidth:"60px",padding:"0.5rem 1rem",border:"2px solid #007bff",borderRadius:"6px",backgroundColor:"#f8f9ff",textAlign:"center",fontWeight:600,color:"#007bff"},children:[u,"s"]})]}),h.jsxs("div",{style:{fontSize:"0.75rem",color:"#666",marginTop:"0.5rem"},children:["Actions will be spread evenly over ",u," seconds"]})]}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",fontWeight:500,marginBottom:"0.75rem"},children:"Recording Quality"}),h.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Object.entries(Kx).map(([b,g])=>h.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"0.75rem",border:`2px solid ${s===b?"#007bff":"#e9ecef"}`,borderRadius:"6px",cursor:"pointer",backgroundColor:s===b?"#f8f9ff":"#fff"},children:[h.jsx("input",{type:"radio",name:"quality",value:b,checked:s===b,onChange:y=>a(y.target.value),style:{marginRight:"0.75rem"}}),h.jsxs("div",{style:{flex:1},children:[h.jsxs("div",{style:{fontWeight:500,fontSize:"0.9rem",marginBottom:"0.25rem"},children:[g.name," - ",g.description]}),h.jsxs("div",{style:{fontSize:"0.75rem",color:"#666",display:"flex",gap:"1rem"},children:[h.jsxs("span",{children:[g.resolution.width,"",g.resolution.height]}),h.jsxs("span",{children:[g.fps,"fps"]}),h.jsx("span",{children:v(b)})]})]})]},b))})]}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",fontWeight:500,marginBottom:"0.5rem"},children:"Filename (optional)"}),h.jsx("input",{type:"text",value:f,onChange:b=>m(b.target.value),placeholder:"my_puzzle_creation",style:{width:"100%",padding:"0.5rem",border:"1px solid #ccc",borderRadius:"4px",fontSize:"0.875rem",boxSizing:"border-box"}})]}),h.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[h.jsx("button",{onClick:x,style:{padding:"0.75rem 1.5rem",border:"1px solid #ccc",borderRadius:"6px",backgroundColor:"#fff",cursor:"pointer"},children:"Cancel"}),h.jsx("button",{onClick:_,style:{padding:"0.75rem 1.5rem",border:"none",borderRadius:"6px",backgroundColor:"#28a745",color:"#fff",cursor:"pointer",fontWeight:500},children:" Ready to Record"})]}),h.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(0.95); }
          }
        `})]})});return pg.createPortal(p,document.body)},$D=({onSave:n,onCancel:e,isSaving:t,puzzleStats:r,initialData:i})=>{const[o,s]=S.useState((i==null?void 0:i.name)||""),[a,l]=S.useState(""),[c,u]=S.useState((i==null?void 0:i.description)||""),[d,f]=S.useState((i==null?void 0:i.challengeMessage)||""),[m,v]=S.useState("public"),_=p=>{if(p.preventDefault(),!o.trim()){alert("Please enter a puzzle name");return}if(!a.trim()){alert("Please enter your name");return}n({name:o.trim(),creatorName:a.trim(),description:c.trim()||void 0,challengeMessage:d.trim()||void 0,visibility:m})},x=p=>{const b=Math.floor(p/1e3),g=Math.floor(b/60);return g>0?`${g}m ${b%60}s`:`${b}s`};return h.jsx("div",{onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px",cursor:"pointer"},children:h.jsxs("div",{onClick:p=>p.stopPropagation(),style:{backgroundColor:"#1a1a1a",borderRadius:"20px",padding:"40px",maxWidth:"600px",width:"100%",border:"2px solid #4CAF50",boxShadow:"0 16px 48px rgba(76, 175, 80, 0.3)",maxHeight:"90vh",overflowY:"auto",cursor:"default"},children:[h.jsxs("div",{style:{position:"relative",textAlign:"center",marginBottom:"30px"},children:[h.jsx("button",{onClick:p=>{p.stopPropagation(),e()},onTouchEnd:p=>{p.stopPropagation(),e()},disabled:t,style:{position:"absolute",top:"-20px",right:"-20px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:t?"not-allowed":"pointer",fontSize:"20px",color:"#fff",fontWeight:700,transition:"all 0.2s",opacity:t?.5:1,touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onMouseEnter:p=>!t&&(p.currentTarget.style.background="rgba(255,255,255,0.2)"),onMouseLeave:p=>!t&&(p.currentTarget.style.background="rgba(255,255,255,0.1)"),title:"Close",children:""}),h.jsx("div",{style:{fontSize:"4rem",marginBottom:"10px"},children:""}),h.jsx("h2",{style:{margin:0,fontSize:"2rem",background:"linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",fontWeight:700},children:"Save Your Puzzle"})]}),h.jsxs("div",{style:{display:"flex",gap:"20px",justifyContent:"center",marginBottom:"30px",flexWrap:"wrap"},children:[h.jsxs("div",{style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",padding:"15px 25px",borderRadius:"15px",textAlign:"center",boxShadow:"0 4px 15px rgba(102, 126, 234, 0.3)"},children:[h.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"5px"},children:""}),h.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#fff"},children:r.sphereCount}),h.jsx("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.8)",marginTop:"2px"},children:"Spheres"})]}),h.jsxs("div",{style:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",padding:"15px 25px",borderRadius:"15px",textAlign:"center",boxShadow:"0 4px 15px rgba(240, 147, 251, 0.3)"},children:[h.jsx("div",{style:{fontSize:"1.5rem",marginBottom:"5px"},children:""}),h.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#fff"},children:x(r.creationTimeMs)}),h.jsx("div",{style:{fontSize:"0.8rem",color:"rgba(255,255,255,0.8)",marginTop:"2px"},children:"Creation Time"})]})]}),h.jsxs("form",{onSubmit:_,style:{marginTop:"20px"},children:[h.jsxs("div",{style:{marginBottom:"20px"},children:[h.jsx("label",{htmlFor:"puzzle-name",style:{display:"block",marginBottom:"8px",fontSize:"0.95rem",fontWeight:600,color:"#fff"},children:" Puzzle Name *"}),h.jsx("input",{id:"puzzle-name",type:"text",value:o,onChange:p=>s(p.target.value),placeholder:"My Awesome Puzzle",maxLength:100,disabled:t,required:!0,style:{width:"100%",padding:"12px 16px",fontSize:"1rem",borderRadius:"10px",border:"2px solid #333",backgroundColor:"#2a2a2a",color:"#fff",outline:"none",transition:"all 0.2s",boxSizing:"border-box"},onFocus:p=>p.target.style.borderColor="#4CAF50",onBlur:p=>p.target.style.borderColor="#333"})]}),h.jsxs("div",{style:{marginBottom:"20px"},children:[h.jsx("label",{htmlFor:"creator-name",style:{display:"block",marginBottom:"8px",fontSize:"0.95rem",fontWeight:600,color:"#fff"},children:" Your Name *"}),h.jsx("input",{id:"creator-name",type:"text",value:a,onChange:p=>l(p.target.value),placeholder:"Anonymous Creator",maxLength:50,disabled:t,required:!0,style:{width:"100%",padding:"12px 16px",fontSize:"1rem",borderRadius:"10px",border:"2px solid #333",backgroundColor:"#2a2a2a",color:"#fff",outline:"none",transition:"all 0.2s",boxSizing:"border-box"},onFocus:p=>p.target.style.borderColor="#4CAF50",onBlur:p=>p.target.style.borderColor="#333"})]}),h.jsxs("div",{style:{marginBottom:"20px"},children:[h.jsx("label",{htmlFor:"description",style:{display:"block",marginBottom:"8px",fontSize:"0.95rem",fontWeight:600,color:"#fff"},children:" Description (optional)"}),h.jsx("textarea",{id:"description",value:c,onChange:p=>u(p.target.value),placeholder:"Tell others about your puzzle...",maxLength:500,rows:3,disabled:t,style:{width:"100%",padding:"12px 16px",fontSize:"1rem",borderRadius:"10px",border:"2px solid #333",backgroundColor:"#2a2a2a",color:"#fff",outline:"none",transition:"all 0.2s",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box"},onFocus:p=>p.target.style.borderColor="#4CAF50",onBlur:p=>p.target.style.borderColor="#333"})]}),h.jsxs("div",{style:{marginBottom:"20px"},children:[h.jsx("label",{htmlFor:"challenge",style:{display:"block",marginBottom:"8px",fontSize:"0.95rem",fontWeight:600,color:"#fff"},children:" Challenge Message (optional)"}),h.jsx("textarea",{id:"challenge",value:d,onChange:p=>f(p.target.value),placeholder:"Can you solve this? Try to beat my time!",maxLength:200,rows:2,disabled:t,style:{width:"100%",padding:"12px 16px",fontSize:"1rem",borderRadius:"10px",border:"2px solid #333",backgroundColor:"#2a2a2a",color:"#fff",outline:"none",transition:"all 0.2s",fontFamily:"inherit",resize:"vertical",boxSizing:"border-box"},onFocus:p=>p.target.style.borderColor="#4CAF50",onBlur:p=>p.target.style.borderColor="#333"}),h.jsx("small",{style:{fontSize:"0.75rem",color:"rgba(255,255,255,0.5)",marginTop:"0.25rem",display:"block"},children:"Challenge others to solve your puzzle"})]}),h.jsxs("div",{style:{marginBottom:"30px"},children:[h.jsx("label",{style:{display:"block",marginBottom:"12px",fontSize:"0.95rem",fontWeight:600,color:"#fff"},children:" Visibility"}),h.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[h.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"15px",borderRadius:"10px",border:`2px solid ${m==="public"?"#4CAF50":"#333"}`,backgroundColor:m==="public"?"rgba(76, 175, 80, 0.1)":"#2a2a2a",cursor:"pointer",transition:"all 0.2s"},children:[h.jsx("input",{type:"radio",name:"visibility",value:"public",checked:m==="public",onChange:p=>v(p.target.value),disabled:t,style:{marginRight:"12px",cursor:"pointer"}}),h.jsx("span",{style:{color:"#fff",fontSize:"1rem"},children:" Public (appears in gallery)"})]}),h.jsxs("label",{style:{display:"flex",alignItems:"center",padding:"15px",borderRadius:"10px",border:`2px solid ${m==="private"?"#4CAF50":"#333"}`,backgroundColor:m==="private"?"rgba(76, 175, 80, 0.1)":"#2a2a2a",cursor:"pointer",transition:"all 0.2s"},children:[h.jsx("input",{type:"radio",name:"visibility",value:"private",checked:m==="private",onChange:p=>v(p.target.value),disabled:t,style:{marginRight:"12px",cursor:"pointer"}}),h.jsx("span",{style:{color:"#fff",fontSize:"1rem"},children:" Private (only you have the link)"})]})]})]}),h.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"flex-end",marginTop:"30px"},children:[h.jsx("button",{type:"button",onClick:e,disabled:t,style:{padding:"14px 30px",fontSize:"1rem",fontWeight:600,borderRadius:"12px",border:"2px solid #555",background:"#2a2a2a",color:"#fff",cursor:t?"not-allowed":"pointer",transition:"all 0.2s",opacity:t?.5:1},onMouseEnter:p=>!t&&(p.currentTarget.style.borderColor="#777"),onMouseLeave:p=>!t&&(p.currentTarget.style.borderColor="#555"),children:"Cancel"}),h.jsxs("button",{type:"submit",disabled:t,style:{padding:"14px 30px",fontSize:"1rem",fontWeight:600,borderRadius:"12px",border:"none",background:t?"#666":"linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",color:"#fff",cursor:t?"not-allowed":"pointer",boxShadow:t?"none":"0 4px 15px rgba(76, 175, 80, 0.4)",transition:"all 0.2s",display:"flex",alignItems:"center",gap:"8px"},onMouseEnter:p=>!t&&(p.currentTarget.style.transform="translateY(-2px)"),onMouseLeave:p=>!t&&(p.currentTarget.style.transform="translateY(0)"),children:[h.jsx("span",{children:t?"":""}),h.jsx("span",{children:t?"Saving...":"Save Puzzle"})]})]})]})]})})},GD=({isOpen:n,onClose:e,puzzleUrl:t,puzzleName:r="My Puzzle"})=>{if(!n)return null;const i=()=>{navigator.clipboard.writeText(t),alert("Link copied to clipboard!")},o=()=>{const c=encodeURIComponent(`Check out my puzzle: ${r}`),u=encodeURIComponent(t);window.open(`https://twitter.com/intent/tweet?text=${c}&url=${u}`,"_blank")},s=()=>{const c=encodeURIComponent(t);window.open(`https://www.facebook.com/sharer/sharer.php?u=${c}`,"_blank")},a=()=>{const c=encodeURIComponent(r),u=encodeURIComponent(t);window.open(`https://reddit.com/submit?title=${c}&url=${u}`,"_blank")},l=h.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:5e3},children:h.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",padding:"2rem",maxWidth:"500px",width:"90%",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)"},children:[h.jsx("h2",{style:{margin:"0 0 1rem 0",fontSize:"1.5rem",fontWeight:600},children:" Share Your Puzzle"}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",fontWeight:500,marginBottom:"0.5rem"},children:"Puzzle Link"}),h.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[h.jsx("input",{type:"text",value:t,readOnly:!0,style:{flex:1,padding:"0.75rem",border:"2px solid #e0e0e0",borderRadius:"6px",fontSize:"0.875rem",backgroundColor:"#f5f5f5"}}),h.jsx("button",{onClick:i,style:{padding:"0.75rem 1.5rem",border:"none",borderRadius:"6px",backgroundColor:"#007bff",color:"#fff",cursor:"pointer",fontWeight:500,whiteSpace:"nowrap"},children:" Copy"})]})]}),h.jsxs("div",{style:{marginBottom:"1.5rem"},children:[h.jsx("label",{style:{display:"block",fontWeight:500,marginBottom:"0.75rem"},children:"Share to Social Media"}),h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem"},children:[h.jsx("button",{onClick:o,style:{padding:"0.75rem",border:"1px solid #1DA1F2",borderRadius:"6px",backgroundColor:"#fff",color:"#1DA1F2",cursor:"pointer",fontWeight:500},children:" Twitter"}),h.jsx("button",{onClick:s,style:{padding:"0.75rem",border:"1px solid #4267B2",borderRadius:"6px",backgroundColor:"#fff",color:"#4267B2",cursor:"pointer",fontWeight:500},children:" Facebook"}),h.jsx("button",{onClick:a,style:{padding:"0.75rem",border:"1px solid #FF4500",borderRadius:"6px",backgroundColor:"#fff",color:"#FF4500",cursor:"pointer",fontWeight:500},children:" Reddit"})]})]}),h.jsx("button",{onClick:e,style:{width:"100%",padding:"0.75rem",border:"none",borderRadius:"6px",backgroundColor:"#6c757d",color:"#fff",cursor:"pointer",fontWeight:500},children:"Done"})]})});return pg.createPortal(l,document.body)},XD=({isOpen:n,onClose:e,puzzleName:t,puzzleId:r,sphereCount:i,onViewInGallery:o,onSolvePuzzle:s,onCreateAnother:a})=>{if(!n)return null;const l=`${window.location.origin}/manual/${r}?shared=true`,c=()=>{navigator.clipboard.writeText(l),alert("Link copied to clipboard!")};return h.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px"},children:h.jsxs("div",{style:{backgroundColor:"#1a1a1a",borderRadius:"16px",padding:"32px",maxWidth:"500px",width:"100%",border:"2px solid #4CAF50",boxShadow:"0 8px 32px rgba(76, 175, 80, 0.3)",position:"relative"},children:[h.jsx("button",{onClick:u=>{u.stopPropagation(),e()},onTouchEnd:u=>{u.stopPropagation(),e()},style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"20px",color:"#fff",fontWeight:700,transition:"all 0.2s",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onMouseEnter:u=>u.currentTarget.style.background="rgba(255,255,255,0.2)",onMouseLeave:u=>u.currentTarget.style.background="rgba(255,255,255,0.1)",title:"Close",children:""}),h.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:"#4CAF50",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 24px",fontSize:"32px"},children:""}),h.jsx("h2",{style:{color:"#fff",textAlign:"center",marginBottom:"8px",fontSize:"24px",fontWeight:"600"},children:"Puzzle Saved Successfully!"}),h.jsxs("div",{style:{backgroundColor:"#252525",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:[h.jsx("div",{style:{color:"#aaa",fontSize:"14px",marginBottom:"8px"},children:"Puzzle Name"}),h.jsx("div",{style:{color:"#fff",fontSize:"18px",fontWeight:"500",marginBottom:"16px"},children:t}),h.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[h.jsxs("div",{children:[h.jsx("div",{style:{color:"#aaa",fontSize:"12px"},children:"Spheres"}),h.jsx("div",{style:{color:"#4CAF50",fontSize:"20px",fontWeight:"600"},children:i})]}),h.jsxs("div",{children:[h.jsx("div",{style:{color:"#aaa",fontSize:"12px"},children:"Status"}),h.jsx("div",{style:{color:"#4CAF50",fontSize:"16px",fontWeight:"500"},children:"Public"})]})]})]}),h.jsxs("div",{style:{backgroundColor:"#252525",borderRadius:"8px",padding:"12px",marginBottom:"24px",display:"flex",alignItems:"center",gap:"8px"},children:[h.jsx("input",{type:"text",value:l,readOnly:!0,style:{flex:1,background:"#1a1a1a",border:"1px solid #333",borderRadius:"4px",padding:"8px 12px",color:"#aaa",fontSize:"14px",fontFamily:"monospace"}}),h.jsx("button",{onClick:c,style:{background:"#4CAF50",border:"none",borderRadius:"4px",padding:"8px 16px",color:"#fff",fontSize:"14px",fontWeight:"500",cursor:"pointer",whiteSpace:"nowrap"},children:"Copy"})]}),h.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[h.jsx("button",{onClick:s,style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",borderRadius:"8px",padding:"14px 24px",color:"#fff",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"transform 0.2s"},onMouseOver:u=>u.currentTarget.style.transform="scale(1.02)",onMouseOut:u=>u.currentTarget.style.transform="scale(1)",children:" Try to Solve It"}),h.jsx("button",{onClick:o,style:{background:"#333",border:"1px solid #555",borderRadius:"8px",padding:"14px 24px",color:"#fff",fontSize:"16px",fontWeight:"500",cursor:"pointer",transition:"transform 0.2s"},onMouseOver:u=>u.currentTarget.style.transform="scale(1.02)",onMouseOut:u=>u.currentTarget.style.transform="scale(1)",children:" View in Gallery"}),h.jsx("button",{onClick:a,style:{background:"transparent",border:"1px solid #4CAF50",borderRadius:"8px",padding:"14px 24px",color:"#4CAF50",fontSize:"16px",fontWeight:"500",cursor:"pointer",transition:"all 0.2s"},onMouseOver:u=>{u.currentTarget.style.transform="scale(1.02)",u.currentTarget.style.backgroundColor="rgba(76, 175, 80, 0.1)"},onMouseOut:u=>{u.currentTarget.style.transform="scale(1)",u.currentTarget.style.backgroundColor="transparent"},children:" Create Another Puzzle"})]})]})})},ff="create.environmentSettings";function YD(){var Ne;const n=Jn(),t=(Ne=Di().state)==null?void 0:Ne.loadPuzzle,[r,i]=S.useState((t==null?void 0:t.cells)||[{i:0,j:0,k:0}]),[o,s]=S.useState("add"),[a,l]=S.useState(t?{id:t.id,name:t.name}:null),[c,u]=S.useState("edit"),[d,f]=S.useState(null),m=S.useRef(null),[v,_]=S.useState(!1);S.useRef(null);const[x,p]=S.useState(()=>{try{const de=localStorage.getItem(ff);if(de){const Se=JSON.parse(de);return console.log(" Loaded saved environment settings from localStorage"),{...Ht,...Se,emptyCells:Se.emptyCells||Ht.emptyCells}}}catch(de){console.error(" Failed to load saved settings:",de)}return fd["metallic-light"]}),[b,g]=S.useState(null),[y,E]=S.useState(!1),[C,A]=S.useState(!1),[T,w]=S.useState(!1),[M,P]=S.useState(!1),[I,D]=S.useState(!1),[$,W]=S.useState("metallic-light"),[H,Z]=S.useState(!1),[F,Y]=S.useState(null),[X,oe]=S.useState(!1),[pe,De]=S.useState(!1),[z,ve]=S.useState(!1),[j,ne]=S.useState(!1),[Ee,me]=S.useState(""),te=S.useRef(r),Pe=S.useRef(null),je=S.useRef(Date.now());S.useRef(null),S.useEffect(()=>{te.current=r},[r]),S.useEffect(()=>{try{localStorage.setItem(ff,JSON.stringify(x)),console.log(" Environment settings saved to localStorage")}catch(de){console.error(" Failed to save settings:",de)}},[x]),S.useEffect(()=>{const de=[[.5,.5,0,0],[.5,0,.5,0],[0,.5,.5,0],[0,0,0,1]];try{const Se=vs([{i:0,j:0,k:0}],ms,de,xs);f(Se),console.log(" Initial view transforms computed")}catch(Se){console.error(" Failed to compute initial view transforms:",Se),f({M_world:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]})}},[]);const L=de=>{if(de.length===0){console.log(" Cannot delete the last sphere - at least one sphere is required");return}window.setEditingFlag&&window.setEditingFlag(!0),i(de)},Fe=async()=>{if(console.log(" Preparing to save puzzle"),m.current){E(!0);try{await new Promise(Ue=>requestAnimationFrame(()=>requestAnimationFrame(Ue))),console.log(" Capturing thumbnail from current view...");const{captureCanvasScreenshot:de}=await So(async()=>{const{captureCanvasScreenshot:Ue}=await Promise.resolve().then(()=>oy);return{captureCanvasScreenshot:Ue}},void 0),Se=await de(m.current);console.log(" Thumbnail captured, size:",(Se.size/1024).toFixed(2),"KB"),g(Se)}catch(de){console.error(" Failed to capture thumbnail:",de)}finally{E(!1)}}A(!0)},Re=async de=>{oe(!0);try{console.log(" Saving puzzle to Supabase..."),console.log("  Skipping shape_id generation (using puzzles.geometry directly)");let Se=null;if(b)try{console.log(" Uploading pre-captured thumbnail...");const N=`temp_${Date.now()}`,{uploadThumbnail:k}=await So(async()=>{const{uploadThumbnail:G}=await Promise.resolve().then(()=>oy);return{uploadThumbnail:G}},void 0);Se=await k(b,N),console.log(" Thumbnail uploaded:",Se)}catch(N){console.error(" Failed to upload thumbnail, continuing without it:",N)}else console.warn(" No thumbnail blob available");const Ue={shape_id:null,name:de.name,creator_name:de.creatorName,description:de.description||null,challenge_message:de.challengeMessage||null,visibility:de.visibility,geometry:r,preset_config:x,sphere_count:r.length,creation_time_ms:Date.now()-je.current,thumbnail_url:Se};let ze,Ke;if(a){console.log(" Updating existing puzzle:",a.id);const N=await bt.from("puzzles").update({thumbnail_url:Se,name:Ue.name,description:Ue.description,challenge_message:Ue.challenge_message}).eq("id",a.id).select().single();ze=N.data,Ke=N.error,l(null)}else{console.log(" Creating new puzzle");const N=await bt.from("puzzles").insert([Ue]).select().single();ze=N.data,Ke=N.error}if(Ke)throw console.error("Supabase error:",Ke),new Error(`Failed to save puzzle: ${Ke.message}`);if(!ze)throw new Error("No data returned from Supabase");console.log(" Puzzle saved!",ze);const it=`${window.location.origin}/manual/${ze.id}`;me(it),console.log(" Puzzle URL:",it),Y({id:ze.id,name:de.name,sphereCount:r.length}),A(!1),Z(!0)}catch(Se){console.error(" Failed to save puzzle:",Se);const Ue=Se instanceof Error?Se.message:"Unknown error occurred";alert(`Failed to save puzzle: ${Ue}

Please check your internet connection and try again.`)}finally{oe(!1)}};return h.jsxs("div",{className:"content-studio-page",style:{height:"100vh",width:"100vw",display:"flex",flexDirection:"column",overflow:"hidden",position:"fixed",top:0,left:0,right:0,bottom:0,background:"linear-gradient(to bottom, #0a0a0a 0%, #000000 100%)"},children:[h.jsx("div",{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",zIndex:1e3},children:h.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:"16px",fontWeight:600,color:"#fff",padding:"8px 16px",borderRadius:"20px",background:"linear-gradient(135deg, #3b82f6, #2563eb)",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",border:"1px solid rgba(255, 255, 255, 0.15)",transition:"all 0.2s ease",cursor:"default"},children:[r.length," ",r.length===1?"Sphere":"Spheres"]})}),h.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",display:"flex",gap:"8px",zIndex:1e3},children:[h.jsx("button",{className:"pill",onClick:()=>D(!0),title:"Environment",style:{background:"linear-gradient(135deg, #6366f1, #4f46e5)",color:"#fff",fontWeight:700,border:"none",fontSize:"16px",width:"40px",height:"40px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease",cursor:"pointer"},children:""}),h.jsx("button",{className:"pill",onClick:()=>n("/"),title:"Home",style:{background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",fontWeight:700,border:"none",fontSize:"16px",width:"40px",height:"40px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease",cursor:"pointer"},children:""})]}),c==="edit"&&h.jsxs("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"12px",alignItems:"center",zIndex:1e3},ref:Pe,children:[h.jsx("button",{className:"pill",onClick:()=>s(o==="add"?"remove":"add"),title:o==="add"?"Switch to Remove Mode":"Switch to Add Mode",style:{background:o==="add"?"linear-gradient(135deg, #10b981, #059669)":"linear-gradient(135deg, #ef4444, #dc2626)",color:"#fff",fontWeight:700,border:"none",fontSize:o==="add"?"20px":"24px",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",transition:"all 0.2s ease",cursor:"pointer"},children:o==="add"?"+":""}),r.length%4===0&&h.jsx("button",{className:"pill",onClick:Fe,title:"Save puzzle",style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)",color:"#fff",fontWeight:700,border:"none",fontSize:"18px",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",transition:"all 0.2s ease",cursor:"pointer"},children:""})]}),!1,h.jsx("div",{className:"canvas-wrap",style:{flex:1,position:"relative",overflow:"hidden"},children:d&&h.jsx(h.Fragment,{children:h.jsx(e3,{cells:r,view:d,mode:o,editEnabled:c==="edit",onCellsChange:L,settings:x,onSceneReady:de=>{m.current=de,console.log(" Canvas ready for thumbnail capture")},interactionsDisabled:C||T||M||I||H||y})})}),h.jsx("style",{children:`
        @keyframes recordPulse {
          0%, 100% { opacity: 1; }
          50% { opacity: 0.8; }
        }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
          to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
      `}),y&&h.jsxs("div",{style:{position:"fixed",top:"100px",left:"50%",transform:"translateX(-50%)",background:"rgba(76, 175, 80, 0.95)",color:"#fff",padding:"16px 32px",borderRadius:"12px",fontSize:"1.1rem",fontWeight:600,zIndex:9999,boxShadow:"0 8px 24px rgba(0, 0, 0, 0.3)",display:"flex",alignItems:"center",gap:"12px",animation:"fadeIn 0.3s ease"},children:[h.jsx("span",{style:{fontSize:"1.5rem"},children:""}),h.jsx("span",{children:"Capturing thumbnail from current view..."})]}),C&&h.jsx($D,{onSave:Re,onCancel:()=>A(!1),isSaving:X,puzzleStats:{sphereCount:r.length,creationTimeMs:Date.now()-je.current},initialData:a?{name:a.name,description:t==null?void 0:t.description,challengeMessage:t==null?void 0:t.challengeMessage}:void 0}),h.jsx(VD,{isOpen:T,onClose:()=>w(!1),onRecordingReady:de=>{ve(!0),console.log(` Recording ready! Duration: ${de}s. Press Play to start.`)},actions:[],cells:r,creationTimeMs:Date.now()-je.current}),h.jsx(GD,{isOpen:M,onClose:()=>P(!1),puzzleUrl:Ee,puzzleName:"My Awesome Puzzle"}),F&&h.jsx(XD,{isOpen:H,onClose:()=>Z(!1),puzzleName:F.name,puzzleId:F.id,sphereCount:F.sphereCount,onViewInGallery:()=>{n("/gallery")},onSolvePuzzle:()=>{n(`/manual/${F.id}`)},onCreateAnother:()=>{Z(!1),Y(null),i([{i:0,j:0,k:0}]),me(""),je.current=Date.now(),u("edit")}}),h.jsx(Hd,{isOpen:I,currentPreset:$,onClose:()=>D(!1),onSelectPreset:(de,Se)=>{p(de),W(Se),localStorage.setItem(ff,JSON.stringify(de)),console.log(" Applied preset:",Se)}})]})}const Jx=[16382715,15987958,15067115,15197668,16119284,16448249,15855855],Zx=[16711680,65280,33023,16776960,16744448,8388863,16711808,65535,8453888,16728192,4227327,16760832,12583167,65408,16744512,8405247,4259712,16728064,16639,8453952,16711744,4194559,49407,12648192,16711872];function qD(n,e){let t=0;for(let i=0;i<n.length;i++)t=t*31+n.charCodeAt(i)>>>0;if(e==="whiteMarbleCluster"){const i=t%Jx.length;return Jx[i]}const r=t%Zx.length;return Zx[r]}function fl(n){return new kt().set(n[0][0],n[0][1],n[0][2],n[0][3],n[1][0],n[1][1],n[1][2],n[1][3],n[2][0],n[2][1],n[2][2],n[2][3],n[3][0],n[3][1],n[3][2],n[3][3])}function Fo(n){const e=(s,a,l)=>new ae(s,a,l).applyMatrix4(fl(n.M_world)),t=e(0,0,0),r=e(1,0,0);return t.distanceTo(r)/2}function aw(n){const{spherePositions:e,radius:t,material:r,bondRadiusFactor:i=.35,thresholdFactor:o=1.1,radialSegments:s=48}=n,a=new ia,l=t*2*o,c=new Og(i*t,i*t,1,s);for(let u=0;u<e.length;u++)for(let d=u+1;d<e.length;d++){const f=e[u],m=e[d],v=f.distanceTo(m);if(v>=l)continue;const _=new bn(c,r),x=new ae().addVectors(f,m).multiplyScalar(.5);_.position.copy(x);const p=new ae().subVectors(m,f).normalize(),b=new Jr().setFromUnitVectors(new ae(0,1,0),p);_.setRotationFromQuaternion(b),_.scale.y=v,a.add(_)}return{bondGroup:a,cylinderGeo:c}}function KD(n){var f,m;const{cells:e,M:t,radius:r,material:i,scale:o=1}=n,s=((f=n.segments)==null?void 0:f.w)??32,a=((m=n.segments)==null?void 0:m.h)??32,l=new xo(r*o,s,a),c=new hd(l,i,e.length),u=[],d=new xn;for(let v=0;v<e.length;v++){const _=e[v],x=new ae(_.i,_.j,_.k).applyMatrix4(t);u.push(x),d.position.copy(x),d.updateMatrix(),c.setMatrixAt(v,d.matrix)}return c.instanceMatrix.needsUpdate=!0,{mesh:c,geom:l,spherePositions:u}}function JD(n,e){var r,i,o;if(!e)return;n.remove(e),e.geometry&&((i=(r=e.geometry).dispose)==null||i.call(r));const t=e.material;Array.isArray(t)?t.forEach(s=>{var a;return(a=s==null?void 0:s.dispose)==null?void 0:a.call(s)}):(o=t==null?void 0:t.dispose)==null||o.call(t)}function ZD(n,e){e&&(n.remove(e),e.traverse(t=>{if(t instanceof bn){t.geometry.dispose();const r=t.material;Array.isArray(r)?r.forEach(i=>i.dispose()):r.dispose()}}))}function pf(n){const{scene:e,viewMWorld:t,cells:r,showBonds:i,material:o,radius:s,meshRef:a,bondsRef:l,segments:c={w:32,h:32},scale:u=1,bondRadiusFactor:d=.35,thresholdFactor:f=1.1,radialSegments:m=48,castShadow:v=!0,receiveShadow:_=!0}=n;if(JD(e,a.current),a.current=void 0,ZD(e,l.current),l.current=void 0,!r||r.length===0)return;const x=new kt().set(t[0][0],t[0][1],t[0][2],t[0][3],t[1][0],t[1][1],t[1][2],t[1][3],t[2][0],t[2][1],t[2][2],t[2][3],t[3][0],t[3][1],t[3][2],t[3][3]),{mesh:p,spherePositions:b}=KD({cells:r,M:x,radius:s,material:o,segments:c,scale:u});if(p.castShadow=v,p.receiveShadow=_,e.add(p),a.current=p,i){const{bondGroup:g}=aw({spherePositions:b,radius:s,material:o,bondRadiusFactor:d,thresholdFactor:f,radialSegments:m});g.children.forEach(y=>{y.castShadow=!0,y.receiveShadow=!0}),e.add(g),l.current=g}}const Ba=({cells:n,showBonds:e=!0,view:t,editMode:r,mode:i,settings:o,layout:s="fullscreen",onCellsChange:a,onSave:l,visibility:c,onHoverCell:u,onClickCell:d,anchor:f,previewOffsets:m,placedPieces:v=[],selectedPieceUid:_=null,onSelectPiece:x,containerOpacity:p=1,containerColor:b="#ffffff",containerRoughness:g=.3,puzzleMode:y="unlimited",onCycleOrientation:E,onPlacePiece:C,onDeleteSelectedPiece:A,drawingCells:T=[],computerDrawingCells:w=[],onDrawCell:M,hintCells:P=null,hidePlacedPieces:I=!1,temporarilyVisiblePieces:D=new Set,explosionFactor:$=0,turntableRotation:W=0,alwaysShowContainer:H=!1,onInteraction:Z,onSceneReady:F})=>{var lt,ut,wt,mt,vt,St,Yt,Nt,Zt,yn,ti,ni,Fr,ri,Oi,ii,oi,si;const Y=S.useRef(null),X=S.useRef(),oe=S.useRef(),pe=S.useRef(),De=S.useRef(),z=S.useRef(),ve=S.useRef(!1),j=S.useRef(),ne=S.useRef(),Ee=S.useRef(!1),me=S.useRef(!1),te=S.useRef(),Pe=S.useRef([]),je=S.useRef(new Map),L=S.useRef(new Map),Fe=S.useRef(null),Re=S.useRef([]),Ne=S.useRef(null),de=S.useRef([]),Se=S.useRef(null),Ue=S.useRef(),ze=S.useRef(),[Ke,it]=S.useState(null),[N,k]=S.useState(!1),G=S.useRef(null),[ue,Me]=S.useState(null);S.useEffect(()=>{console.log(" SceneCanvas mounted - new gesture detector version")},[]);const[ge,$e]=S.useState(null),ke=S.useRef(null),We=S.useRef(n);S.useEffect(()=>{We.current=n},[n]);const Je=S.useRef(null),_e=S.useRef(!1),Le=S.useRef(0),qe=S.useRef(!1),re=S.useRef(!1);S.useRef(!1);const ie=Math.max(.1,((lt=o==null?void 0:o.lights)==null?void 0:lt.brightness)??2.7),we=((ut=o==null?void 0:o.material)==null?void 0:ut.metalness)??.4,U=((wt=o==null?void 0:o.material)==null?void 0:wt.roughness)??.1,se=((mt=o==null?void 0:o.material)==null?void 0:mt.opacity)??1,he=(vt=o==null?void 0:o.emptyCells)!=null&&vt.linkToEnvironment?o.material.metalness:((Yt=(St=o==null?void 0:o.emptyCells)==null?void 0:St.customMaterial)==null?void 0:Yt.metalness)??0;S.useEffect(()=>{console.log(" SceneCanvas material settings:",{brightness:ie,metalness:we,roughness:U,hasSettings:!!o})},[ie,we,U,o]),S.useEffect(()=>{var q,le,xe,fe,ee,Ce,He,Ye,Qe,rt,Ae;const R=oe.current,B=Se.current,J=X.current;if(!Ne.current||de.current.length===0||!R||!J||!B){console.log(" Waiting for initialization before updating lights");return}if(console.log(" Updating lights with brightness:",ie,"directional:",(q=o==null?void 0:o.lights)==null?void 0:q.directional),Ne.current.intensity=(le=o==null?void 0:o.lights)!=null&&le.directional?.3*ie:.6*ie,(xe=o==null?void 0:o.lights)!=null&&xe.directional&&Array.isArray(o.lights.directional))de.current.forEach((ye,Ie)=>{ye.intensity=o.lights.directional[Ie]??0}),console.log(" Applied directional light settings from movie:",o.lights.directional);else{const ye=[.8,.4,.3,.3];de.current.forEach((Ie,Ge)=>{Ie.intensity=ye[Ge]*ie})}(fe=o==null?void 0:o.lights)!=null&&fe.backgroundColor&&(R.background=new pt(o.lights.backgroundColor));const Q=(Ce=(ee=o==null?void 0:o.lights)==null?void 0:ee.hdr)==null?void 0:Ce.enabled,V=(Ye=(He=o==null?void 0:o.lights)==null?void 0:He.hdr)==null?void 0:Ye.envId,O=((rt=(Qe=o==null?void 0:o.lights)==null?void 0:Qe.hdr)==null?void 0:rt.intensity)??1;console.log(" HDR check (real-time):",{enabled:Q,envId:V,intensity:O,hasHdrLoader:!!B,hasPMREM:B?!!B.pmremGenerator:!1}),Q&&V&&B?B.pmremGenerator?(console.log(" Loading HDR environment:",V),B.loadEnvironment(V).then(ye=>{var Ie;ye&&(R.environment=ye,je.current.forEach(Ge=>{Ge.material instanceof In&&(Ge.material.envMap=ye,Ge.material.envMapIntensity=O,Ge.material.needsUpdate=!0)}),((Ie=z.current)==null?void 0:Ie.material)instanceof In&&(z.current.material.envMap=ye,z.current.material.envMapIntensity=O,z.current.material.needsUpdate=!0),console.log(" HDR environment applied"))}).catch(ye=>console.error(" HDR load error:",ye))):console.warn(" PMREM generator not initialized yet, will retry on next render"):(R.environment=null,je.current.forEach(ye=>{ye.material instanceof In&&(ye.material.envMap=null,ye.material.needsUpdate=!0)}),((Ae=z.current)==null?void 0:Ae.material)instanceof In&&(z.current.material.envMap=null,z.current.material.needsUpdate=!0),console.log(" HDR disabled - environment and material envMaps cleared"))},[ie,(Nt=o==null?void 0:o.lights)==null?void 0:Nt.backgroundColor,(Zt=o==null?void 0:o.lights)==null?void 0:Zt.directional,(ti=(yn=o==null?void 0:o.lights)==null?void 0:yn.hdr)==null?void 0:ti.enabled,(Fr=(ni=o==null?void 0:o.lights)==null?void 0:ni.hdr)==null?void 0:Fr.envId,(Oi=(ri=o==null?void 0:o.lights)==null?void 0:ri.hdr)==null?void 0:Oi.intensity,N]),S.useEffect(()=>{je.current.size!==0&&(console.log(" Updating materials on existing pieces:",{metalness:we,roughness:U,opacity:se,numPieces:je.current.size}),je.current.forEach(R=>{R.material instanceof In&&(R.material.metalness=we,R.material.roughness=U,R.material.opacity=se,R.material.transparent=se<1,R.material.needsUpdate=!0)}))},[we,U,se]),S.useEffect(()=>{var O,q,le;const R=pe.current;De.current;const B=X.current;if(!R||!B)return;const J=((O=o==null?void 0:o.camera)==null?void 0:O.projection)==="orthographic",Q=((q=o==null?void 0:o.camera)==null?void 0:q.fovDeg)??50,V=((le=o==null?void 0:o.camera)==null?void 0:le.orthoZoom)??1;console.log(" Camera settings check:",{projection:J?"orthographic":"perspective",isPerspective:R.type==="PerspectiveCamera",fov:Q,zoom:V}),!J&&R.type==="PerspectiveCamera"&&R.fov!==Q&&(R.fov=Q,R.updateProjectionMatrix(),console.log(" Perspective FOV updated to:",Q))},[(ii=o==null?void 0:o.camera)==null?void 0:ii.projection,(oi=o==null?void 0:o.camera)==null?void 0:oi.fovDeg,(si=o==null?void 0:o.camera)==null?void 0:si.orthoZoom]);const Oe=async()=>{if(!n.length){alert("No cells to save!");return}const R=JSON.stringify(n.map(O=>[O.i,O.j,O.k])),B="sha256:"+btoa(R).substring(0,32),J={version:"1.0",lattice:"fcc",cells:n.map(O=>[O.i,O.j,O.k]),cid:B,designer:{name:"Shape Editor User",date:new Date().toISOString().split("T")[0]}},Q=JSON.stringify(J,null,2),V=`${n.length} cell.fcc.json`;try{if("showSaveFilePicker"in window){const q=await(await window.showSaveFilePicker({suggestedName:V,types:[{description:"FCC JSON files",accept:{"application/json":[".json"]}}]})).createWritable();await q.write(Q),await q.close(),console.log(` Saved shape with ${n.length} cells as ${V}`)}else{const O=new Blob([Q],{type:"application/json"}),q=URL.createObjectURL(O),le=document.createElement("a");le.href=q,le.download=V,document.body.appendChild(le),le.click(),document.body.removeChild(le),URL.revokeObjectURL(q),console.log(` Downloaded shape with ${n.length} cells as ${V}`)}}catch(O){O.name!=="AbortError"&&(console.error("Save failed:",O),alert("Failed to save file. Please try again."))}};S.useEffect(()=>{l&&(window.saveCurrentShape=Oe)},[n,l]),S.useEffect(()=>{window.setOrbitTarget=R=>{De.current&&(De.current.target.copy(R),De.current.update())},window.setEditingFlag=R=>{Ee.current=R},window.resetCameraFlag=()=>{me.current=!1,console.log(" SceneCanvas: Camera initialization flag reset for new file")},window.markCameraInitialized=()=>{me.current=!0,console.log(" SceneCanvas: Camera marked as initialized")},window.sceneRef={scene:oe.current,camera:pe.current,controls:De.current,renderer:X.current},window.setCameraPosition=R=>{pe.current&&(pe.current.position.set(R.x,R.y,R.z),pe.current.updateProjectionMatrix(),De.current&&De.current.update(),console.log(" SceneCanvas: Camera position set to",R))},window.getOrbitControls=()=>De.current},[]),S.useEffect(()=>{if(!Y.current)return;console.log(" SceneCanvas MOUNTING - Initializing Three.js");const R=new BS;R.background=new pt(0);const B=new ia;R.add(B),Fe.current=B;const J=Y.current,Q=J.clientWidth,V=J.clientHeight,O=new or(50,Q/V,.1,1e3);O.position.set(0,0,10);const q=new ew({antialias:!0,preserveDrawingBuffer:!0});q.setSize(Q,V),q.shadowMap.enabled=!1,J.appendChild(q.domElement);const le=new XS(4210752,.6);R.add(le),Ne.current=le;const xe=new _i(16777215,.8);xe.position.set(10,10,5),xe.castShadow=!1,R.add(xe);const fe=new _i(16777215,.4);fe.position.set(-10,-10,-5),R.add(fe);const ee=new _i(16777215,.3);ee.position.set(5,-10,10),R.add(ee);const Ce=new _i(16777215,.3);Ce.position.set(-5,10,-10),R.add(Ce),de.current=[xe,fe,ee,Ce];const He=[.6,.8,.4,.3,.3];[le,xe,fe,ee,Ce].forEach((et,Ve)=>{et.intensity=He[Ve]*ie}),j.current=new YS,ne.current=new gt,Se.current||ka.resetInstance();const Qe=ka.getInstance();Qe.initializePMREMGenerator(q),Se.current=Qe,k(!0);const rt=new nw(O,q.domElement);if(rt.enableDamping=!0,rt.dampingFactor=.05,rt.enabled=!0,rt.enablePan=!0,rt.enableZoom=!0,rt.enableRotate=!0,De.current=rt,oe.current=R,pe.current=O,X.current=q,Me(q.domElement),F){const et=new ae(0,0,0);F({scene:R,camera:O,renderer:q,controls:rt,spheresGroup:B,centroidWorld:et})}let Ae=0;const ye=()=>{Ae=requestAnimationFrame(ye),De.current&&De.current.update(),q.render(R,O)};ye();const Ie=()=>{if(!Y.current)return;const et=Y.current.clientWidth,Ve=Y.current.clientHeight;et>0&&Ve>0&&(O.aspect=et/Ve,O.updateProjectionMatrix(),q.setSize(et,Ve))};window.addEventListener("resize",Ie);const Ge=()=>{setTimeout(Ie,100)};return window.addEventListener("orientationchange",Ge),setTimeout(Ie,50),()=>{window.removeEventListener("resize",Ie),window.removeEventListener("orientationchange",Ge),cancelAnimationFrame(Ae);const et=q.domElement;et&&Y.current&&et.parentNode&&Y.current.removeChild(et),q.dispose(),rt.dispose(),Se.current=null,k(!1)}},[]),S.useEffect(()=>{const R=oe.current,B=pe.current,J=X.current;if(!R||!B||!J||!n.length||!t)return;const Q=new Set;for(const Ve of v)for(const st of Ve.cells)Q.add(`${st.i},${st.j},${st.k}`);for(const Ve of T)Q.add(`${Ve.i},${Ve.j},${Ve.k}`);if(m)for(const Ve of m)Q.add(`${Ve.i},${Ve.j},${Ve.k}`);const V=H?n:n.filter(Ve=>{const st=`${Ve.i},${Ve.j},${Ve.k}`;return!Q.has(st)});z.current&&(R.remove(z.current),z.current.geometry.dispose(),z.current.material.dispose(),z.current=void 0);const O=fl(t.M_world),q=Fo(t);let le=1/0,xe=-1/0,fe=1/0,ee=-1/0,Ce=1/0,He=-1/0;const Ye=[];for(let Ve=0;Ve<V.length;Ve++){const ot=new ae(V[Ve].i,V[Ve].j,V[Ve].k).applyMatrix4(O);Ye.push(ot),le=Math.min(le,ot.x),xe=Math.max(xe,ot.x),fe=Math.min(fe,ot.y),ee=Math.max(ee,ot.y),Ce=Math.min(Ce,ot.z),He=Math.max(He,ot.z)}const Qe=new ae((le+xe)/2,(fe+ee)/2,(Ce+He)/2),rt=Math.max(xe-le,ee-fe,He-Ce);if(!me.current&&!Ee.current){const Ve=B.fov*(Math.PI/180),st=rt/2/Math.tan(Ve/2)*1;B.position.set(Qe.x+st*.7,Qe.y+st*.8,Qe.z+st*.7),B.lookAt(Qe),B.updateProjectionMatrix(),De.current.target.copy(Qe),De.current.update(),me.current=!0}else Ee.current&&(Ee.current=!1);const Ae=new xo(q,32,24),ye=new In({color:16777215,metalness:he,roughness:g,transparent:p<1,opacity:p}),Ie=new hd(Ae,ye,V.length);Ie.instanceMatrix.setUsage(lR);const Ge=new Float32Array(V.length*3),et=new pt(b);for(let Ve=0;Ve<V.length;Ve++)Ge[Ve*3]=et.r,Ge[Ve*3+1]=et.g,Ge[Ve*3+2]=et.b;Ie.instanceColor=new mm(Ge,3);for(let Ve=0;Ve<V.length;Ve++){const st=Ye[Ve],ot=new kt;ot.compose(st,new Jr,new ae(1,1,1)),Ie.setMatrixAt(Ve,ot)}Ie.instanceMatrix.needsUpdate=!0,$===0?(R.add(Ie),z.current=Ie,Re.current=V):z.current&&(R.remove(z.current),z.current=void 0)},[n,t,v,T,m,p,b,g,he,$]),S.useEffect(()=>{n.length===0&&(ve.current=!1,me.current=!1)},[n.length]),S.useEffect(()=>{const R=oe.current;if(!R||!t)return;const B=Fo(t),J=new In({color:16768256,metalness:.3,roughness:.4,transparent:!0,opacity:.9});pf({scene:R,viewMWorld:t.M_world,cells:T,showBonds:e,material:J,radius:B,meshRef:ze,bondsRef:Ue,segments:{w:32,h:32}})},[T,t,e]);const Te=S.useRef(),ce=S.useRef();S.useEffect(()=>{const R=oe.current;if(!R||!t)return;const B=Fo(t),J=new In({color:12632256,metalness:.6,roughness:.3,transparent:!0,opacity:.9});pf({scene:R,viewMWorld:t.M_world,cells:w,showBonds:e,material:J,radius:B,meshRef:Te,bondsRef:ce,segments:{w:32,h:32}})},[w,t,e]);const K=S.useRef(),be=S.useRef();S.useEffect(()=>{const R=oe.current;if(!R||!t)return;const B=Fo(t),J=new In({color:"#ffd700",emissive:"#ffd700",emissiveIntensity:.6,metalness:.8,roughness:.2,transparent:!0,opacity:.95});console.log("HINT CELLS (IJK):",P),pf({scene:R,viewMWorld:t.M_world,cells:P,showBonds:e,material:J,radius:B,meshRef:K,bondsRef:be,segments:{w:32,h:32},scale:1.1,bondRadiusFactor:.35*1.1})},[P,t,e]),S.useEffect(()=>{const R=oe.current;if(!R||!t||!x)return;for(const[O,q]of je.current.entries())q.visible=!I||D.has(O);for(const[O,q]of L.current.entries())q.visible=!I||D.has(O);if(I&&D.size===0)return;const B=fl(t.M_world),J=Fo(t),Q=new Set(v.map(O=>O.uid));for(const[O,q]of je.current.entries())if(!Q.has(O)){const le=Fe.current;le?le.remove(q):R.remove(q),q.geometry.dispose(),q.material.dispose(),je.current.delete(O)}for(const[O,q]of L.current.entries())if(!Q.has(O)){const le=Fe.current;le?le.remove(q):R.remove(q),q.traverse(xe=>{xe instanceof bn&&(xe.geometry.dispose(),xe.material.dispose())}),L.current.delete(O)}const V=.35;for(const O of v){const q=O.uid===_;if(je.current.has(O.uid)){const Ye=je.current.get(O.uid);if(Ye.material.emissive.getHex()!==(q?16777215:0)||Ye.userData.puzzleMode!==y){Fe.current?Fe.current.remove(Ye):R.remove(Ye),Ye.geometry.dispose(),Ye.material.dispose(),je.current.delete(O.uid);const ye=L.current.get(O.uid);ye&&(Fe.current?Fe.current.remove(ye):R.remove(ye),ye.traverse(Ie=>{Ie instanceof bn&&(Ie.geometry.dispose(),Ie.material.dispose())}),L.current.delete(O.uid))}else continue}const le=new xo(J,64,64),xe=y==="oneOfEach"?O.pieceId:O.uid,fe=qD(xe,o==null?void 0:o.sphereColorTheme),ee=new In({color:fe,metalness:we,roughness:U,transparent:se<1,opacity:se,envMapIntensity:1.5,emissive:q?16777215:0,emissiveIntensity:q?.3:0}),Ce=new hd(le,ee,O.cells.length),He=[];for(let Ye=0;Ye<O.cells.length;Ye++){const Qe=O.cells[Ye],Ae=new ae(Qe.i,Qe.j,Qe.k).applyMatrix4(B);He.push(Ae);const ye=new kt;ye.compose(Ae,new Jr,new ae(1,1,1)),Ce.setMatrixAt(Ye,ye)}if(Ce.instanceMatrix.needsUpdate=!0,Ce.userData.puzzleMode=y,Fe.current?Fe.current.add(Ce):R.add(Ce),je.current.set(O.uid,Ce),e){const{bondGroup:Ye}=aw({spherePositions:He,radius:J,material:ee,bondRadiusFactor:V,thresholdFactor:1.1,radialSegments:48});Ye.children.forEach(Qe=>{Qe.castShadow=!0,Qe.receiveShadow=!0}),Fe.current?Fe.current.add(Ye):R.add(Ye),L.current.set(O.uid,Ye)}}},[x,v,t,_,y,I,D,e]);const Be=S.useRef(null),Ze=S.useRef(0);return S.useEffect(()=>{if(!t||v.length===0){Be.current=null,Ze.current=0;return}const R=Math.max(0,Math.min(1,$)),B=t.M_world;if(!Be.current||v.length>Ze.current*1.5){let q=0,le=0,xe=0,fe=0;for(const ee of v)for(const Ce of ee.cells){const He=B[0][0]*Ce.i+B[0][1]*Ce.j+B[0][2]*Ce.k+B[0][3],Ye=B[1][0]*Ce.i+B[1][1]*Ce.j+B[1][2]*Ce.k+B[1][3],Qe=B[2][0]*Ce.i+B[2][1]*Ce.j+B[2][2]*Ce.k+B[2][3];q+=He,le+=Ye,xe+=Qe,fe++}if(fe===0)return;q/=fe,le/=fe,xe/=fe,Be.current={x:q,y:le,z:xe},Ze.current=v.length}if(!Be.current)return;const{x:Q,y:V,z:O}=Be.current;for(const q of v){const le=je.current.get(q.uid),xe=L.current.get(q.uid);if(!le)continue;let fe=0,ee=0,Ce=0;for(const Ae of q.cells){const ye=B[0][0]*Ae.i+B[0][1]*Ae.j+B[0][2]*Ae.k+B[0][3],Ie=B[1][0]*Ae.i+B[1][1]*Ae.j+B[1][2]*Ae.k+B[1][3],Ge=B[2][0]*Ae.i+B[2][1]*Ae.j+B[2][2]*Ae.k+B[2][3];fe+=ye,ee+=Ie,Ce+=Ge}fe/=q.cells.length,ee/=q.cells.length,Ce/=q.cells.length;const He=fe-Q,Ye=ee-V,Qe=Ce-O;le.userData.originalPosition===void 0&&(le.userData.originalPosition=le.position.clone());const rt=le.userData.originalPosition;if(le.position.set(rt.x+He*R*1.5,rt.y+Ye*R*1.5,rt.z+Qe*R*1.5),xe){xe.userData.originalPosition===void 0&&(xe.userData.originalPosition=xe.position.clone());const Ae=xe.userData.originalPosition;xe.position.set(Ae.x+He*R*1.5,Ae.y+Ye*R*1.5,Ae.z+Qe*R*1.5)}}},[$,v,t]),S.useEffect(()=>{const R=Fe.current;R&&(R.rotation.y=W)},[W]),S.useEffect(()=>{},[r,i]),S.useEffect(()=>{const R=oe.current;if(R){if(te.current){const B=te.current;Array.isArray(B)?B.forEach(J=>{R.remove(J),J.geometry.dispose(),J.material.dispose()}):(R.remove(te.current),te.current.geometry.dispose(),te.current.material.dispose()),te.current=void 0}if(r&&i==="add"&&n.length&&t){const B=fl(t.M_world),J=Fo(t),Q=new Set(n.map(ee=>`${ee.i},${ee.j},${ee.k}`)),V=new Set;for(const ee of n){const Ce=[{i:ee.i+1,j:ee.j,k:ee.k},{i:ee.i-1,j:ee.j,k:ee.k},{i:ee.i,j:ee.j+1,k:ee.k},{i:ee.i,j:ee.j-1,k:ee.k},{i:ee.i,j:ee.j,k:ee.k+1},{i:ee.i,j:ee.j,k:ee.k-1},{i:ee.i+1,j:ee.j+1,k:ee.k},{i:ee.i+1,j:ee.j-1,k:ee.k},{i:ee.i-1,j:ee.j+1,k:ee.k},{i:ee.i-1,j:ee.j-1,k:ee.k},{i:ee.i+1,j:ee.j,k:ee.k+1},{i:ee.i+1,j:ee.j,k:ee.k-1},{i:ee.i-1,j:ee.j,k:ee.k+1},{i:ee.i-1,j:ee.j,k:ee.k-1},{i:ee.i,j:ee.j+1,k:ee.k+1},{i:ee.i,j:ee.j+1,k:ee.k-1},{i:ee.i,j:ee.j-1,k:ee.k+1},{i:ee.i,j:ee.j-1,k:ee.k-1}];for(const He of Ce){const Ye=`${He.i},${He.j},${He.k}`;Q.has(Ye)||V.add(Ye)}}const O=[],q=[],le=[];for(const ee of n){const He=new ae(ee.i,ee.j,ee.k).applyMatrix4(B);le.push(He)}const fe=J*2*1.1;for(const ee of V){const[Ce,He,Ye]=ee.split(",").map(Number),rt=new ae(Ce,He,Ye).applyMatrix4(B);let Ae=!1;for(const ye of le)if(rt.distanceTo(ye)<=fe){Ae=!0;break}Ae&&(O.push(rt),q.push({i:Ce,j:He,k:Ye}))}if(Pe.current=q,O.length>0){const ee=new xo(J,32,24),Ce=[];for(let He=0;He<O.length;He++){const Ye=new In({color:65280,metalness:0,roughness:g,transparent:!0,opacity:0}),Qe=new bn(ee,Ye);Qe.position.copy(O[He]),R.add(Qe),Ce.push(Qe)}te.current=Ce}}}},[r,i,n,t]),S.useEffect(()=>{const R=X.current,B=pe.current,J=j.current,Q=ne.current;if(!R||!B||!J||!Q||!r||i!=="remove")return;let V=null,O=null,q=0,le=0,xe=!1;const fe=10,ee=(Ie,Ge)=>{const et=z.current;if(!et)return;const Ve=R.domElement.getBoundingClientRect();Q.x=(Ie-Ve.left)/Ve.width*2-1,Q.y=-((Ge-Ve.top)/Ve.height)*2+1,J.setFromCamera(Q,B);const st=J.intersectObject(et);if(st.length>0){const ot=st[0].instanceId;ot!==void 0&&ot!==Ke&&(Ke!==null&&et.setColorAt(Ke,new pt(b)),et.setColorAt(ot,new pt(16711680)),et.instanceColor.needsUpdate=!0,G.current=ot,it(ot))}else Ke!==null&&(et.setColorAt(Ke,new pt(b)),et.instanceColor.needsUpdate=!0,G.current=null,it(null))},Ce=Ie=>{const Ge=We.current;Ge[Ie],Ee.current=!0;const et=Ge.filter((Ve,st)=>st!==Ie);a(et),G.current=null,it(null)},He=Ie=>{ee(Ie.clientX,Ie.clientY)},Ye=Ie=>{if(i!=="remove"||!r||xe)return;const Ge=G.current;Ge!==null&&(Ie.preventDefault(),Ie.stopPropagation(),Ce(Ge))},Qe=Ie=>{if(xe=!0,Ie.touches.length!==1)return;const Ge=z.current;if(!Ge)return;const et=Ie.touches[0];q=et.clientX,le=et.clientY;const Ve=R.domElement.getBoundingClientRect();Q.x=(et.clientX-Ve.left)/Ve.width*2-1,Q.y=-((et.clientY-Ve.top)/Ve.height)*2+1,J.setFromCamera(Q,B);const st=J.intersectObject(Ge);if(st.length>0){const ot=st[0].instanceId;if(ot===void 0)return;O=ot,G.current===ot&&(V=window.setTimeout(()=>{Ce(ot),V=null},600))}},rt=Ie=>{if(V===null)return;const Ge=Ie.touches[0];if(Ge){const et=Math.abs(Ge.clientX-q),Ve=Math.abs(Ge.clientY-le);(et>fe||Ve>fe)&&(clearTimeout(V),V=null)}},Ae=Ie=>{if(re.current){Ie.stopImmediatePropagation(),Ie.preventDefault();return}if(V!==null&&(clearTimeout(V),V=null),O===null)return;const Ge=Ie.changedTouches[0];if(Ge){const st=Math.abs(Ge.clientX-q),ot=Math.abs(Ge.clientY-le);if(st>fe||ot>fe)return}const et=z.current;if(!et)return;const Ve=G.current;Ve===null?(et.setColorAt(O,new pt(16711680)),et.instanceColor.needsUpdate=!0,G.current=O,it(O)):Ve===O?(Ie.preventDefault(),Ce(Ve)):(et.setColorAt(Ve,new pt(b)),et.setColorAt(O,new pt(16711680)),et.instanceColor.needsUpdate=!0,G.current=O,it(O)),O=null},ye=()=>{V!==null&&(clearTimeout(V),V=null),O=null};return R.domElement.addEventListener("mousemove",He),R.domElement.addEventListener("click",Ye),R.domElement.addEventListener("touchstart",Qe),R.domElement.addEventListener("touchmove",rt,{passive:!0}),R.domElement.addEventListener("touchend",Ae),R.domElement.addEventListener("touchcancel",ye),()=>{V!==null&&clearTimeout(V),R.domElement.removeEventListener("mousemove",He),R.domElement.removeEventListener("click",Ye),R.domElement.removeEventListener("touchstart",Qe),R.domElement.removeEventListener("touchmove",rt),R.domElement.removeEventListener("touchend",Ae),R.domElement.removeEventListener("touchcancel",ye),Ke!==null&&z.current&&(z.current.setColorAt(Ke,new pt(b)),z.current.instanceColor&&(z.current.instanceColor.needsUpdate=!0),it(null))}},[r,i,b]),S.useEffect(()=>{const R=X.current,B=pe.current,J=j.current,Q=ne.current;if(!R||!B||!J||!Q||!r||i!=="add")return;const V=fe=>{const ee=te.current;if(!ee||!Array.isArray(ee)||qe.current)return;const Ce=R.domElement.getBoundingClientRect();Q.x=(fe.clientX-Ce.left)/Ce.width*2-1,Q.y=-((fe.clientY-Ce.top)/Ce.height)*2+1,J.setFromCamera(Q,B);const He=J.intersectObjects(ee);if(He.length>0){fe.preventDefault(),fe.stopPropagation();const Ye=He[0],Qe=ee.indexOf(Ye.object);Qe!==-1&&Qe!==ke.current&&(ke.current!==null&&ee[ke.current]&&(ee[ke.current].material.opacity=0),ee[Qe].material.opacity=1,ke.current=Qe,$e(Qe))}else ke.current!==null&&ee[ke.current]&&(ee[ke.current].material.opacity=0,ke.current=null,$e(null))},O=()=>{if(ke.current!==null){const fe=Pe.current[ke.current],ee=`${fe.i},${fe.j},${fe.k}`,Ce=We.current;if(Ce.some(Qe=>`${Qe.i},${Qe.j},${Qe.k}`===ee)){ke.current=null,$e(null);return}console.log(`Adding cell at IJK: i=${fe.i}, j=${fe.j}, k=${fe.k}`),Ee.current=!0;const Ye=[...Ce,fe];a(Ye),ke.current=null,$e(null)}},q=fe=>{ke.current!==null&&(fe.preventDefault(),fe.stopPropagation(),qe.current=!0,_e.current=!1,Je.current=window.setTimeout(()=>{_e.current=!0,O()},500))},le=fe=>{qe.current=!1,ke.current!==null&&(fe.preventDefault(),fe.stopPropagation(),Je.current&&(clearTimeout(Je.current),Je.current=null),_e.current)},xe=fe=>{if(!(i!=="add"||!r)&&ke.current!==null&&!_e.current){fe.preventDefault(),fe.stopPropagation();const ee=Date.now();ee-Le.current<300?O():Le.current=ee}};return R.domElement.addEventListener("mousemove",V,{capture:!0}),R.domElement.addEventListener("mousedown",q,{capture:!0}),R.domElement.addEventListener("mouseup",le,{capture:!0}),R.domElement.addEventListener("click",xe,{capture:!0}),()=>{R.domElement.removeEventListener("mousemove",V,{capture:!0}),R.domElement.removeEventListener("mousedown",q,{capture:!0}),R.domElement.removeEventListener("mouseup",le,{capture:!0}),R.domElement.removeEventListener("click",xe,{capture:!0}),Je.current&&(clearTimeout(Je.current),Je.current=null);const fe=te.current;ke.current!==null&&fe&&Array.isArray(fe)&&fe[ke.current]&&(fe[ke.current].material.opacity=0,ke.current=null,$e(null))}},[r,i]),S.useEffect(()=>{const R=X.current,B=pe.current,J=j.current,Q=ne.current,V=z.current;if(!R||!B||!J||!Q||r||!d&&!x||Z)return;const O=q=>{const le=R.domElement.getBoundingClientRect();Q.x=(q.clientX-le.left)/le.width*2-1,Q.y=-((q.clientY-le.top)/le.height)*2+1,J.setFromCamera(Q,B);let xe=!1;if(!I){for(const[fe,ee]of je.current.entries())if(J.intersectObject(ee).length>0){x&&x(fe),xe=!0;break}}if(!xe&&V&&d&&!M){const fe=J.intersectObject(V);if(fe.length>0){x&&_&&x(null);const ee=fe[0].instanceId;if(ee!==void 0&&ee<Re.current.length){const Ce=Re.current[ee];d(Ce)}}}};return R.domElement.addEventListener("click",O),()=>{R.domElement.removeEventListener("click",O)}},[r,d,x,n,v,_,I,M]),S.useEffect(()=>{const R=X.current,B=pe.current,J=j.current,Q=ne.current;if(!R||!B||!J||!Q||Z||!E&&!C&&!M||r)return;const V={current:0},O={current:null},q={current:{x:0,y:0}},le={current:!1},xe={current:null},fe={current:!1},ee={current:!1},Ce={current:0},He={current:0},Ye=300,Qe=320,rt=600,Ae=15,ye=Ve=>{if(Date.now()-Ce.current<500||Ve.target.closest("button, input, select")||Ve.target!==R.domElement)return;const nt=R.domElement.getBoundingClientRect();if(Q.x=(Ve.clientX-nt.left)/nt.width*2-1,Q.y=-((Ve.clientY-nt.top)/nt.height)*2+1,J.setFromCamera(Q,B),M){const ct=z.current;if(ct){const ft=J.intersectObject(ct);if(ft.length>0){const Ot=ft[0].instanceId;if(Ot!==void 0&&Ot<Re.current.length){const Bt=Re.current[Ot],Tt=Date.now(),qt=Tt-V.current;if(O.current&&(clearTimeout(O.current),O.current=null),qt>0&&qt<Ye){M(Bt),V.current=0;return}V.current=Tt,d&&(O.current=window.setTimeout(()=>{V.current===Tt&&d(Bt),O.current=null},Qe))}}}}},Ie=Ve=>{if(Ve.target.closest("button, input, select")||Ve.target!==R.domElement||Ve.touches.length!==1)return;const ot=Ve.touches[0];q.current={x:ot.clientX,y:ot.clientY},le.current=!1,re.current=!1;const nt=R.domElement.getBoundingClientRect();Q.x=(ot.clientX-nt.left)/nt.width*2-1,Q.y=-((ot.clientY-nt.top)/nt.height)*2+1,J.setFromCamera(Q,B),ee.current=!1;let ct=!1;for(const[ft,Ct]of je.current.entries())if(J.intersectObject(Ct).length>0){ct=!0,ft===_&&A&&(fe.current=!1,xe.current=window.setTimeout(()=>{le.current||(fe.current=!0,A(),re.current=!0,console.log(" Long press on selected piece - deleting"))},rt));break}if(!ct&&M){const ft=z.current;if(ft){const Ct=J.intersectObject(ft);if(Ct.length>0){const Bt=Ct[0].instanceId;if(Bt!==void 0&&Bt<n.length){const Tt=new Set;for(const Rt of v)for(const hn of Rt.cells)Tt.add(`${hn.i},${hn.j},${hn.k}`);for(const Rt of T)Tt.add(`${Rt.i},${Rt.j},${Rt.k}`);const qt=n.filter(Rt=>{const hn=`${Rt.i},${Rt.j},${Rt.k}`;return!Tt.has(hn)});if(Bt<qt.length){const Rt=qt[Bt];fe.current=!1,xe.current=window.setTimeout(()=>{le.current||(fe.current=!0,M(Rt),console.log(" Long press on empty cell - drawing"))},rt)}}}}}},Ge=Ve=>{if(Ve.touches.length!==1)return;const st=Ve.touches[0],ot=Math.abs(st.clientX-q.current.x),nt=Math.abs(st.clientY-q.current.y);(ot>Ae||nt>Ae)&&(le.current=!0,xe.current&&(clearTimeout(xe.current),xe.current=null))},et=Ve=>{if(Ce.current=Date.now(),re.current){console.log(" touchend skipped - gesture already completed"),Ve.stopImmediatePropagation(),Ve.preventDefault(),re.current=!1,le.current=!1,fe.current=!1;return}if(xe.current&&(clearTimeout(xe.current),xe.current=null),!Ve.target.closest("button, input, select")){if(fe.current||le.current){fe.current&&(Ve.preventDefault(),console.log(" Long press completed - skipping tap detection")),fe.current=!1,ee.current=!1;return}if(E&&ee.current){Ve.preventDefault();const ot=V.current;setTimeout(()=>{V.current===ot&&(E(),console.log(" Single tap on ghost - cycling orientation"))},Qe)}else if(!ee.current&&Ve.target===R.domElement){const ot=R.domElement.getBoundingClientRect(),nt=Ve.changedTouches[0];Q.x=(nt.clientX-ot.left)/ot.width*2-1,Q.y=-((nt.clientY-ot.top)/ot.height)*2+1,J.setFromCamera(Q,B);let ct=!1;if(x&&!I){const ft=Date.now()-He.current;if(ft<300)console.log(" Ignoring piece selection - too soon after placement",{timeSinceLastPlacement:ft});else for(const[Ct,Ot]of je.current.entries())if(J.intersectObject(Ot).length>0){x(Ct),console.log(" Single tap on placed piece - selecting:",Ct),ct=!0;break}}if(!ct&&d){const ft=z.current;if(ft){const Ct=J.intersectObject(ft);if(Ct.length>0){const Bt=Ct[0].instanceId;if(Bt!==void 0&&Bt<n.length){const Tt=new Set;for(const Rt of v)for(const hn of Rt.cells)Tt.add(`${hn.i},${hn.j},${hn.k}`);for(const Rt of T)Tt.add(`${Rt.i},${Rt.j},${Rt.k}`);const qt=n.filter(Rt=>{const hn=`${Rt.i},${Rt.j},${Rt.k}`;return!Tt.has(hn)});if(Bt<qt.length){const Rt=qt[Bt];d(Rt),console.log(" Single tap on empty cell - setting anchor")}}}}}}ee.current=!1,le.current=!1,fe.current=!1,re.current=!1}};return R.domElement.addEventListener("click",ye,{capture:!0}),R.domElement.addEventListener("touchstart",Ie,{passive:!1,capture:!0}),R.domElement.addEventListener("touchmove",Ge,{passive:!0,capture:!0}),R.domElement.addEventListener("touchend",et,{passive:!0,capture:!0}),()=>{R.domElement.removeEventListener("click",ye,!0),R.domElement.removeEventListener("touchstart",Ie,!0),R.domElement.removeEventListener("touchmove",Ge,!0),R.domElement.removeEventListener("touchend",et,!0),xe.current&&clearTimeout(xe.current),O.current&&clearTimeout(O.current)}},[r,E,C,M,d,A,_,n,v,T,Z]),S.useEffect(()=>{const R=X.current,B=pe.current,J=j.current,Q=ne.current;if(!R||!B||!J||!Q||!Z||r)return;const V={current:null},O={current:null},q={current:null},le={current:!1},xe={current:!1},fe={current:!1},ee={current:!1},Ce={current:!1},He={current:null},Ye=100,Qe=350,rt=500,Ae=()=>{V.current&&(clearTimeout(V.current),V.current=null),O.current&&(clearTimeout(O.current),O.current=null)},ye=(et,Ve,st)=>{if(!t)return null;const ot=new Set;for(const Tt of v)for(const qt of Tt.cells)ot.add(`${qt.i},${qt.j},${qt.k}`);let nt=null,ct=1/0;const ft=fl(t.M_world);Fo(t);const Ct=.03,Bt=st-.01;for(const Tt of Re.current){const qt=`${Tt.i},${Tt.j},${Tt.k}`;if(ot.has(qt))continue;const Rt=new ae(Tt.i,Tt.j,Tt.k).applyMatrix4(ft),fr=new ae().subVectors(Rt,et).dot(Ve);if(fr<0||fr>=Bt)continue;const Ui=new ae().copy(et).addScaledVector(Ve,fr);Rt.distanceTo(Ui)<Ct&&fr<ct&&(ct=fr,nt=Tt)}return nt},Ie=(et,Ve)=>{const st=R.domElement.getBoundingClientRect();Q.x=(et-st.left)/st.width*2-1,Q.y=-((Ve-st.top)/st.height)*2+1,J.setFromCamera(Q,B);const ot=J.ray.origin.clone(),nt=J.ray.direction.clone();let ct=null;if(!I&&je.current.size>0){const Bt=Array.from(je.current.values()),Tt=J.intersectObjects(Bt,!0);if(Tt.length>0){const qt=Tt[0];let Rt=null;for(const[hn,fr]of je.current.entries())if(qt.object===fr){Rt=hn;break}if(!Rt)for(const[hn,fr]of je.current.entries()){let Ui=qt.object.parent;for(;Ui;){if(Ui===fr){Rt=hn;break}Ui=Ui.parent}if(Rt)break}if(Rt){const hn=qt.point.clone(),fr=ot.distanceTo(hn),Ui=ye(ot,nt,fr);ct={uid:Rt,distance:fr,emptyCellUnderCursor:Ui}}}}let ft=null;const Ct=z.current;if(Ct){const Bt=J.intersectObject(Ct);if(Bt.length>0){const Tt=Bt[0],qt=Tt.instanceId;qt!==void 0&&qt<Re.current.length&&(ft={cell:Re.current[qt],distance:Tt.distance})}}const Ot=.001;return ct&&ft?ct.distance+Ot<ft.distance?(console.log(" [RAYCAST] Piece in front (piece:",ct.distance.toFixed(3),"cell:",ft.distance.toFixed(3)+")"),{target:"piece",data:{uid:ct.uid,hitPieceDistance:ct.distance,emptyCellUnderCursor:ct.emptyCellUnderCursor}}):(console.log(" [RAYCAST] Cell in front (piece:",ct.distance.toFixed(3),"cell:",ft.distance.toFixed(3)+")"),{target:"cell",data:ft.cell}):ct?(console.log(" [RAYCAST] Only piece hit:",ct.uid),{target:"piece",data:{uid:ct.uid,hitPieceDistance:ct.distance,emptyCellUnderCursor:ct.emptyCellUnderCursor}}):ft?(console.log(" [RAYCAST] Only cell hit:",ft.cell),{target:"cell",data:ft.cell}):{target:"background"}};if("ontouchstart"in window){const et=ot=>{if(ot.target!==R.domElement||ot.touches.length!==1)return;const nt=ot.touches[0];fe.current=!0,ee.current=!1,He.current={x:nt.clientX,y:nt.clientY},nt.clientX,nt.clientY,le.current=!1,xe.current=!1,O.current=setTimeout(()=>{if(!le.current&&!ee.current){xe.current=!0;const ct=Ie(nt.clientX,nt.clientY);ct.target&&Z(ct.target,"long",ct.data)}},rt)},Ve=ot=>{if(ot.touches.length!==1||!fe.current||!He.current)return;const nt=ot.touches[0],ct=nt.clientX-He.current.x,ft=nt.clientY-He.current.y;ct*ct+ft*ft>Ye&&(ee.current=!0,le.current=!0,O.current&&(clearTimeout(O.current),O.current=null),console.log(" Drag detected, will suppress tap"))},st=ot=>{if(re.current){console.log(" Interaction handler touchend skipped - gesture completed"),ot.stopImmediatePropagation(),ot.preventDefault();return}if(fe.current&&ee.current){console.log(" touchEnd: Drag session ended, clearing ALL timers and skipping interactions"),Ae(),fe.current=!1,ee.current=!1,He.current=null;return}if(fe.current=!1,ee.current=!1,ot.target!==R.domElement)return;if(O.current&&(clearTimeout(O.current),O.current=null),le.current){console.log(" touchEnd: Was a drag, skipping");return}if(xe.current){console.log(" touchEnd: Long press already handled, skipping tap detection");return}const nt=ot.changedTouches[0],ct=Ie(nt.clientX,nt.clientY);nt.clientX,nt.clientY,V.current&&q.current?(clearTimeout(V.current),V.current=null,ct.target&&Z(ct.target,"double",ct.data),q.current=null):(q.current=ct,V.current=setTimeout(()=>{q.current&&q.current.target&&Z(q.current.target,"single",q.current.data),q.current=null,V.current=null},Qe))};return R.domElement.addEventListener("touchstart",et,{passive:!1}),R.domElement.addEventListener("touchmove",Ve,{passive:!0}),R.domElement.addEventListener("touchend",st,{passive:!0}),()=>{Ae(),R.domElement.removeEventListener("touchstart",et),R.domElement.removeEventListener("touchmove",Ve),R.domElement.removeEventListener("touchend",st)}}else{const et=nt=>{nt.target===R.domElement&&(fe.current=!0,ee.current=!1,He.current={x:nt.clientX,y:nt.clientY})},Ve=nt=>{if(!fe.current||!He.current)return;const ct=nt.clientX-He.current.x,ft=nt.clientY-He.current.y;ct*ct+ft*ft>Ye&&(ee.current=!0,Ce.current=!0,console.log(" Drag detected, will suppress click"))},st=()=>{if(fe.current&&ee.current){console.log(" mouseUp: Drag session ended, clearing ALL timers"),Ae(),fe.current=!1,ee.current=!1,He.current=null;return}fe.current=!1,ee.current=!1,He.current=null},ot=nt=>{if(nt.target!==R.domElement)return;if(Ce.current){console.log(" Suppressing DOM click caused by drag/OrbitControls damping"),nt.stopPropagation(),nt.preventDefault(),Ce.current=!1;return}const ct=Ie(nt.clientX,nt.clientY);nt.clientX,nt.clientY,console.log(" Click detected:",ct.target,"pending:",!!V.current),V.current&&q.current?(console.log("  DOUBLE CLICK detected on",ct.target),clearTimeout(V.current),V.current=null,ct.target&&Z(ct.target,"double",ct.data),q.current=null):(console.log(" First click, waiting for potential double-click..."),q.current=ct,V.current=setTimeout(()=>{var ft;console.log(" Single click confirmed on",(ft=q.current)==null?void 0:ft.target),q.current&&q.current.target&&Z(q.current.target,"single",q.current.data),q.current=null,V.current=null},Qe))};return R.domElement.addEventListener("mousedown",et),R.domElement.addEventListener("mousemove",Ve),R.domElement.addEventListener("mouseup",st),R.domElement.addEventListener("click",ot),()=>{Ae(),R.domElement.removeEventListener("mousedown",et),R.domElement.removeEventListener("mousemove",Ve),R.domElement.removeEventListener("mouseup",st),R.domElement.removeEventListener("click",ot)}}},[r,Z,n,v,T,I]),h.jsx("div",{ref:Y,className:s==="embedded"?"scene-root scene-embedded":"scene-root scene-fullscreen",style:{width:"100%",height:"100%",position:s==="embedded"?"relative":"absolute",left:s==="embedded"?void 0:0,overflow:"hidden"}})},Vg=n=>{const[e,t]=S.useState(null),[r,i]=S.useState(!0),[o,s]=S.useState(null);return S.useEffect(()=>{if(!n){s("No puzzle ID provided"),i(!1);return}(async()=>{try{console.log(" Loading puzzle:",n);const{data:l,error:c}=await bt.from("puzzles").select(`
            id,
            shape_id,
            name,
            creator_name,
            description,
            challenge_message,
            visibility,
            geometry,
            sphere_count,
            actions,
            preset_config,
            creation_time_ms,
            created_at,
            contracts_shapes (
              cells,
              size
            )
          `).eq("id",n).single();if(c)throw console.error("Supabase error:",c),console.error("Error code:",c.code),console.error("Error details:",c.details),console.error("Puzzle ID:",n),new Error(`Failed to load puzzle: ${c.message}`);if(!l)throw new Error("Puzzle not found");const u=l.contracts_shapes;let d,f;if(u&&u.cells&&u.cells.length>0){const v=u.cells[0];if(Array.isArray(v))console.log(" Loading geometry from contracts_shapes (valid format)"),d=u.cells.map(_=>({i:_[0],j:_[1],k:_[2]})),f=u.size;else if(console.warn(" Invalid cell format in contracts_shapes, falling back to puzzles.geometry"),l.geometry)d=l.geometry,f=l.sphere_count||d.length;else throw new Error("Puzzle has invalid shape data and no fallback geometry")}else if(l.geometry)console.log(" Loading geometry from puzzles.geometry"),d=l.geometry,f=l.sphere_count||d.length;else throw new Error("Puzzle has no geometry data");const m={id:l.id,shape_id:l.shape_id,name:l.name,creator_name:l.creator_name,description:l.description,challenge_message:l.challenge_message,visibility:l.visibility,geometry:d,actions:l.actions,preset_config:l.preset_config,sphere_count:f,creation_time_ms:l.creation_time_ms,created_at:l.created_at};console.log(" Puzzle loaded:",m.name,`(${m.sphere_count} spheres${m.shape_id?`, shape: ${m.shape_id.substring(0,20)}...`:""})`),t(m),s(null)}catch(l){const c=l instanceof Error?l.message:"Unknown error occurred";console.error(" Failed to load puzzle:",c),s(c),t(null)}finally{i(!1)}})()},[n]),{puzzle:e,loading:r,error:o}},QD=()=>{const[n,e]=S.useState([]),[t,r]=S.useState(!1),i=S.useRef(null),o=S.useCallback(()=>{r(!0),i.current=Date.now();const u={type:"START_SOLVE",timestamp:Date.now(),data:{}};e([u]),console.log(" Solve action tracking started")},[]),s=S.useCallback(()=>{r(!1);const u={type:"COMPLETE_SOLVE",timestamp:Date.now(),data:{}};e(d=>[...d,u]),console.log(" Solve action tracking stopped")},[]),a=S.useCallback((u,d)=>{if(!t&&u!=="START_SOLVE")return;const f={type:u,timestamp:Date.now(),data:d};e(m=>[...m,f]),console.log(` Action tracked: ${u}`,{pieceId:d.pieceId,timestamp:f.timestamp})},[t]),l=S.useCallback(()=>{e([]),r(!1),i.current=null,console.log(" Solve action history cleared")},[]),c=S.useCallback(()=>{const u=n.filter(b=>b.type==="PLACE_PIECE").length,d=n.filter(b=>b.type==="REMOVE_PIECE").length,f=n.filter(b=>b.type==="UNDO").length,m=n.find(b=>b.type==="START_SOLVE"),v=n.find(b=>b.type==="COMPLETE_SOLVE"),_=m&&v?v.timestamp-m.timestamp:i.current?Date.now()-i.current:0,x=n.filter(b=>["PLACE_PIECE","REMOVE_PIECE","UNDO","REDO"].includes(b.type)),p=x.length>1?_/(x.length-1):0;return{totalActions:n.length,placements:u,removals:d,undos:f,totalTimeMs:_,averageActionTimeMs:p}},[n]);return{actions:n,trackAction:a,startTracking:o,stopTracking:s,isTracking:t,clearHistory:l,getSolveStats:c}},lw=()=>{const[n,e]=S.useState(()=>new Map),[t,r]=S.useState({}),[i,o]=S.useState([]),[s,a]=S.useState([]),l=S.useRef(0),c=S.useCallback(x=>{l.current+=1;const p=l.current;if(console.log(` PLACE #${p}`,{reason:x.reason||"unknown",uid:x.uid,pieceId:x.pieceId,orientationId:x.orientationId,cellCount:x.cells.length,timestamp:x.placedAt}),n.has(x.uid)){console.error(` UID COLLISION #${p}`,{uid:x.uid,pieceId:x.pieceId,existingPiece:n.get(x.uid)});return}const b=E=>`${E.i},${E.j},${E.k}`,g=new Set;for(const E of n.values())for(const C of E.cells)g.add(b(C));const y=x.cells.filter(E=>g.has(b(E)));if(y.length>0){console.error(` OVERLAP DETECTED #${p} - aborting commit`,{reason:x.reason||"unknown",pieceId:x.pieceId,uid:x.uid,overlapCount:y.length,overlappingCells:y,currentPlacedCount:n.size});return}console.log(` PLACE #${p} passed all checks, committing...`),e(E=>{const C=new Map(E);return C.set(x.uid,x),C}),o(E=>[...E,{type:"place",piece:x}]),a(()=>[]),r(E=>({...E,[x.pieceId]:(E[x.pieceId]||0)+1})),console.log(` PLACE #${p} committed successfully`,{reason:x.reason||"unknown",totalPlaced:n.size+1,pieceId:x.pieceId})},[n]),u=S.useCallback(x=>{const p=n.get(x);return p?(e(b=>{const g=new Map(b);return g.delete(x),g}),o(b=>[...b,{type:"delete",piece:p}]),a(()=>[]),r(b=>({...b,[p.pieceId]:Math.max(0,(b[p.pieceId]||0)-1)})),p):null},[n]),d=S.useCallback(()=>{o(x=>{if(x.length===0)return x;const p=x.slice(),b=p[p.length-1];if(b.type==="place"){const g=b.piece;e(y=>{const E=new Map(y);return E.delete(g.uid),E}),r(y=>({...y,[g.pieceId]:Math.max(0,(y[g.pieceId]||0)-1)}))}else{const g=b.piece;e(y=>{const E=new Map(y);return E.set(g.uid,g),E}),r(y=>({...y,[g.pieceId]:(y[g.pieceId]||0)+1}))}return a(g=>[...g,b]),p.slice(0,-1)})},[]),f=S.useCallback(()=>{a(x=>{if(x.length===0)return x;const p=x.slice(),b=p[p.length-1];if(b.type==="place"){const g=b.piece;e(y=>{const E=new Map(y);return E.set(g.uid,g),E}),r(y=>({...y,[g.pieceId]:(y[g.pieceId]||0)+1}))}else{const g=b.piece;e(y=>{const E=new Map(y);return E.delete(g.uid),E}),r(y=>({...y,[g.pieceId]:Math.max(0,(y[g.pieceId]||0)-1)}))}return o(g=>[...g,b]),p.slice(0,-1)})},[]),m=S.useCallback(()=>{e(new Map),o([]),a([]),r({})},[]),v=i.length>0,_=s.length>0;return{placed:n,placedCountByPieceId:t,canUndo:v,canRedo:_,placePiece:c,deletePieceByUid:u,undo:d,redo:f,resetPlacedState:m}};class $g{constructor(){dt(this,"cache")}async load(){if(this.cache)return;const e=await fetch("/data/Pieces/pieces.json");if(!e.ok)throw new Error("Failed to load gold orientations");this.cache=await e.json(),this.cache&&console.log(" GoldOrientationService: loaded",Object.keys(this.cache).length,"pieces")}getPieces(){return this.cache?Object.keys(this.cache):[]}getOrientations(e){var r;return(((r=this.cache)==null?void 0:r[e])??[]).map((i,o)=>({orientationId:`${e}-${String(o).padStart(2,"0")}`,ijkOffsets:i}))}}const eN=Object.freeze(Object.defineProperty({__proto__:null,GoldOrientationService:$g},Symbol.toStringTag,{value:"Module"})),mc=()=>{const[n,e]=S.useState({service:null,loading:!0,error:null}),t=S.useRef(!1);return S.useEffect(()=>{if(t.current)return;let r=!1;const i=new $g;return(async()=>{try{if(await i.load(),r)return;t.current=!0,e({service:i,loading:!1,error:null}),console.log(" Orientation service loaded")}catch(s){if(r)return;console.error(" Failed to load orientations:",s),e({service:null,loading:!1,error:s instanceof Error?s:new Error("Failed to load orientations")})}})(),()=>{r=!0}},[]),n};function Cl(n){return`${n.i},${n.j},${n.k}`}const tN=(n,e)=>{const t=Math.abs(n.i-e.i),r=Math.abs(n.j-e.j),i=Math.abs(n.k-e.k),o=[t,r,i].filter(a=>a===1).length,s=[t,r,i].filter(a=>a===2).length;return o===1&&s===0||o===2&&s===0||o===1&&s===1},Qx=n=>{if(n.length===0)return[];const e=Math.min(...n.map(i=>i.i)),t=Math.min(...n.map(i=>i.j)),r=Math.min(...n.map(i=>i.k));return n.map(i=>({i:i.i-e,j:i.j-t,k:i.k-r}))},nN=(n,e)=>{if(n.length!==e.length)return!1;const t=new Set(n.map(Cl)),r=new Set(e.map(Cl));if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i))return!1;return!0},cw=({placed:n,onPieceDrawn:e})=>{const[t,r]=S.useState([]),i=S.useCallback(()=>{r([])},[]),o=S.useCallback(s=>{const a=Cl(s);for(const[,c]of n)if(c.cells.some(u=>Cl(u)===a))return;if(t.some(c=>Cl(c)===a)||t.length>0&&!t.some(u=>tN(u,s)))return;const l=[...t,s];r(l),l.length===4&&(r([]),e(l))},[t,n,e]);return{drawingCells:t,drawCell:o,clearDrawing:i}};function rN(n,e){for(let t=0;t<n.length;t++){let r=n[t];for(;r;){const i=r&-r,o=iN(i);e(t*64+o),r^=i}}}function iN(n){let e=0,t=n;for(;(t&1n)===0n;)t>>=1n,e++;return e}function oN(n,e){for(let t=0;t<n.length;t++)if((n[t]&~e[t])!==0n)return!1;return!0}class sN{constructor(e,t,r){dt(this,"L");dt(this,"R");dt(this,"U");dt(this,"D");dt(this,"C");dt(this,"rowId");dt(this,"colSize");dt(this,"nCols");dt(this,"nPrimary");dt(this,"root",0);dt(this,"nodeCount");dt(this,"colHeadBase",1);this.nCols=e,this.nPrimary=t,this.L=new Int32Array(r),this.R=new Int32Array(r),this.U=new Int32Array(r),this.D=new Int32Array(r),this.C=new Int32Array(r),this.rowId=new Int32Array(r),this.colSize=new Int32Array(this.colHeadBase+e+1),this.L[this.root]=this.root,this.R[this.root]=this.root,this.U[this.root]=this.root,this.D[this.root]=this.root;for(let i=1;i<=e;i++)this.C[i]=i,this.colSize[i]=0,this.U[i]=i,this.D[i]=i,this.L[i]=i-1,this.R[i]=i===e?this.root:i+1;this.L[1]=this.root,this.R[this.root]=e>=1?1:this.root,this.L[this.root]=e>=1?e:this.root,this.nodeCount=e+1}addRow(e,t){let r=-1,i=-1;for(let o=0;o<t.length;o++){const s=t[o],a=this.colHeadBase+s,l=this.nodeCount++;this.C[l]=a,this.rowId[l]=e;const c=this.U[a];if(this.U[l]=c,this.D[l]=a,this.D[c]=l,this.U[a]=l,this.colSize[a]++,r<0)r=l,i=l,this.L[l]=l,this.R[l]=l;else{const u=this.R[i];this.R[i]=l,this.L[l]=i,this.R[l]=u,this.L[u]=l,i=l}}}cover(e){this.R[this.L[e]]=this.R[e],this.L[this.R[e]]=this.L[e];for(let t=this.D[e];t!==e;t=this.D[t])for(let r=this.R[t];r!==t;r=this.R[r]){const i=this.C[r];this.D[this.U[r]]=this.D[r],this.U[this.D[r]]=this.U[r],this.colSize[i]--}}uncover(e){for(let t=this.U[e];t!==e;t=this.U[t])for(let r=this.L[t];r!==t;r=this.L[r]){const i=this.C[r];this.colSize[i]++,this.D[this.U[r]]=r,this.U[this.D[r]]=r}this.R[this.L[e]]=e,this.L[this.R[e]]=e}choosePrimaryColumnMinSize(){let e=-1,t=2147483647;for(let r=this.R[this.root];r!==this.root;r=this.R[r]){if(r-this.colHeadBase>=this.nPrimary)continue;const o=this.colSize[r];if(o<t&&(t=o,e=r,t<=1))break}return e}solve(e){const t=performance.now();let r=0,i=!1,o="complete";const s=[];let a;const l=u=>{if(performance.now()>=e.deadlineMs)return o="timeout",!1;let d=!1;for(let m=this.R[this.root];m!==this.root;m=this.R[m])if(m-this.colHeadBase<this.nPrimary){d=!0;break}if(!d)return r++,e.wantWitness&&!a&&(a=s.slice()),r>=e.limit?(i=!0,o="limit",!1):!0;const f=this.choosePrimaryColumnMinSize();if(f<0||this.colSize[f]===0)return!0;this.cover(f);for(let m=this.D[f];m!==f;m=this.D[m]){s.push(this.rowId[m]);for(let _=this.R[m];_!==m;_=this.R[_])this.cover(this.C[_]);const v=l();for(let _=this.L[m];_!==m;_=this.L[_])this.uncover(this.C[_]);if(s.pop(),!v&&(o==="limit"||o==="timeout"))return this.uncover(f),!1}return this.uncover(f),!0};l();const c=performance.now()-t;return{count:r,capped:i,reason:o,witness:a,elapsedMs:c}}}function Gg(n){const e=performance.now(),t=n.limit??1e3,r=n.timeoutMs??0,i=r>0?performance.now()+r:Number.POSITIVE_INFINITY,o=!!n.wantWitness,s=[];rN(n.open,w=>s.push(w));const a=s.length;if(a===0)return{feasible:!0,count:1,capped:!1,witness:o?[]:void 0,elapsedMs:performance.now()-e,reason:"complete"};const l=[];for(const w of Object.keys(n.remaining)){const M=Math.max(0,n.remaining[w]??0);for(let P=0;P<M;P++)l.push({pid:w,inst:P})}const c=l.length,u=a+c,d=new Map;for(let w=0;w<s.length;w++)d.set(s[w],w);const f=new Map;{let w=a;for(const M of Object.keys(n.remaining)){const P=Math.max(0,n.remaining[M]??0);P>0&&f.set(M,w),w+=P}}const m=[],v=new Set;for(const w of s){const M=n.bb.candsByTarget[w]??[];for(const P of M){if(!oN(P.mask,n.open)||(n.remaining[P.pid]??0)<=0)continue;const D=`${P.pid}:${P.ori}:${P.t.i},${P.t.j},${P.t.k}:${aN(P.mask)}`;v.has(D)||(v.add(D),m.push({pid:P.pid,ori:P.ori,t:P.t,mask:P.mask,cellsIdx:P.cellsIdx}))}}if(m.length===0)return{feasible:!1,count:0,capped:!1,elapsedMs:performance.now()-e,reason:"complete"};let _=1+u;for(const w of m){const M=Math.max(0,n.remaining[w.pid]??0);_+=5*M}const x=new sN(u,a,_),p=[];for(let w=0;w<m.length;w++){const M=m[w],P=Math.max(0,n.remaining[M.pid]??0),I=f.get(M.pid);if(I===void 0)continue;const D=[];for(const $ of M.cellsIdx){const W=d.get($);if(W===void 0){D.length=0;break}D.push(W)}if(D.length===4)for(let $=0;$<P;$++){const W=p.length;p.push(M);const H=D.concat([I+$]);x.addRow(W,H)}}const{count:b,capped:g,reason:y,witness:E,elapsedMs:C}=x.solve({limit:t,deadlineMs:i,wantWitness:o}),A=b>0,T=A&&o&&E?E.map(w=>p[w]):void 0;return{feasible:A,count:b,capped:g,witness:T,elapsedMs:C,reason:y}}function aN(n){let e="";for(let t=0;t<n.length;t++)e+=n[t].toString(16)+"|";return e}function Xg(n,e){const t=new Map;n.cells.forEach((a,l)=>t.set(iy(a),l));const r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1],[1,-1,0],[-1,1,0],[1,0,-1],[-1,0,1],[0,1,-1],[0,-1,1]],i=n.cells.map(a=>{const l=[];for(const c of r){const u=[a[0]+c[0],a[1]+c[1],a[2]+c[2]],d=t.get(iy(u));d!==void 0&&l.push(d)}return l}),o=n.cells.length,s=(1n<<BigInt(o))-1n;return{id:n.id,cells:n.cells,bitIndex:t,neighbors:i,pieces:e,N:o,occMaskAll:s}}function Yg(n){const e=n.N,t=Math.ceil(e/64),r=Ha(t);for(let m=0;m<e;m++)qo(r,m);const i=Array.from({length:e},()=>es(t));for(let m=0;m<e;m++){const v=i[m];for(const _ of n.neighbors[m])qo(v,_)}const o=es(t),s=es(t);for(let m=0;m<e;m++){const v=n.cells[m];(v[0]+v[1]+v[2])%2===0?qo(o,m):qo(s,m)}let a=0x123456789abcdefn;function l(){return a^=a<<13n,a^=a>>17n,a^=a<<43n,a}const c=[];for(let m=0;m<e;m++)c.push(l());const u=new Map;for(const m of n.pieces.keys()){const _=[];for(let x=0;x<=10;x++)_.push(l());u.set(m,_)}const d=Array.from({length:e},()=>[]);function f(m){const v=es(t),_=[];for(const x of m){const p=n.bitIndex.get(`${x[0]},${x[1]},${x[2]}`);if(p===void 0)return null;qo(v,p),_.push(p)}return{mask:v,idx:_}}for(const[m,v]of n.pieces.entries())for(const _ of v)for(const x of _.cells)for(let p=0;p<e;p++){const b=n.cells[p],g=b[0]-x[0],y=b[1]-x[1],E=b[2]-x[2],C=_.cells.map(w=>[w[0]+g,w[1]+y,w[2]+E]),A=f(C);if(!A)continue;const T=[g,y,E];d[p].push({pid:m,ori:_.id,t:T,mask:A.mask,cellsIdx:A.idx})}for(let m=0;m<e;m++){const v=[],_=new Set;for(const x of d[m]){const p=uw(x.mask),b=`${x.pid}:${x.ori}:${p}`;_.has(b)||(_.add(b),v.push(x))}d[m]=v}return{blockCount:t,occAllMask:r,candsByTarget:d,neighborBits:i,color0Blocks:o,color1Blocks:s,zCell:c,zInv:u}}function es(n){return new BigUint64Array(n)}function Ha(n){return new BigUint64Array(n)}function qo(n,e){const t=e/64|0,r=BigInt(e%64);n[t]|=1n<<r}function ey(n,e){for(let t=0;t<n.length;t++)if((n[t]&e[t])!==0n)return!1;return!0}function lN(n,e){for(let t=0;t<n.length;t++)n[t]|=e[t]}function cN(n,e){for(let t=0;t<n.length;t++)n[t]^=e[t]}function uw(n){let e="";for(let t=0;t<n.length;t++)e+=n[t].toString(16)+"|";return e}function ty(n,e){for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function mf(n,e){const t=Ha(n.length);for(let r=0;r<n.length;r++)t[r]=n[r]|e[r];return t}function ny(n,e){const t=Ha(n.length);for(let r=0;r<n.length;r++)t[r]=n[r]&e[r];return t}function pd(n,e){const t=Ha(n.length);for(let r=0;r<n.length;r++)t[r]=n[r]&~e[r];return t}function Bs(n){let e=0;for(let t=0;t<n.length;t++){let r=n[t];for(;r;)r&=r-1n,e++}return e}function uN(n,e){const t=e/64|0,r=BigInt(e%64);return(n[t]&1n<<r)!==0n}function ry(n,e){const t=e/64|0,r=BigInt(e%64);return(n[t]&1n<<r)===0n}function sa(n,e){for(let t=0;t<n.length;t++){let r=n[t];for(;r;){const i=r&-r,o=Number(dN(i)),s=t*64+o;e(s),r^=i}}}function dN(n){let e=0n,t=n;for(;(t&1n)===0n;)t>>=1n,e++;return e}class hN{constructor(e){dt(this,"slots");dt(this,"ways",2);dt(this,"keys");dt(this,"flags");this.slots=Math.floor(e/(this.ways*9)),this.keys=new BigUint64Array(this.slots*this.ways),this.flags=new Uint8Array(this.slots*this.ways)}lookup(e){const r=Number(e%BigInt(this.slots))*this.ways;for(let i=0;i<this.ways;i++){const o=r+i;if(this.keys[o]===e)return this.flags[o]}return 0}store(e,t){const i=Number(e%BigInt(this.slots))*this.ways;for(let o=0;o<this.ways;o++){const s=i+o;if(this.flags[s]===0||this.keys[s]===e){this.keys[s]=e,this.flags[s]=t;return}}this.keys[i]=e,this.flags[i]=t}}function fN(n,e,t,r){var _e,Le,qe;const i=mN(e),o=performance.now(),s=pN(i.seed??12345);function a(re,ie=0){for(let we=re.length-1;we>ie;we--){const U=ie+Math.floor(s()*(we-ie+1));[re[we],re[U]]=[re[U],re[we]]}}const c=[...(((_e=i.pieces)==null?void 0:_e.allow)??[...n.pieces.keys()]).sort()];(i.shuffleStrategy==="initial"||i.shuffleStrategy==="periodicRestart"||i.shuffleStrategy==="periodicRestartTime"||i.shuffleStrategy==="adaptive")&&a(c);const u={};for(const re of c)u[re]=Math.max(0,Math.floor(((qe=(Le=i.pieces)==null?void 0:Le.inventory)==null?void 0:qe[re])??1));if(i.shuffleStrategy==="initial"){const re=c.every((ie,we)=>we===0||ie>=c[we-1]);console.log(" SEED:",i.seed,"| ORDER:",c.slice(0,8).join(","),"|",re?" FAILED":" OK")}const d=Yg(n),f=new Map;c.forEach((re,ie)=>f.set(re,ie));for(let re=0;re<n.N;re++)d.candsByTarget[re].sort((ie,we)=>{const U=f.get(ie.pid)??999,se=f.get(we.pid)??999;return U-se});console.log(" Candidates sorted by piece order");let m=es(d.blockCount),v=0,_=0,x=0;const p=[];let b=0,g=0,y=0,E=0,C=0,A=o;const T=new Map,w=new Set,M=new Set;let P=0,I=!1;const D=i.tt.enable?new hN(i.tt.bytes??64*1024*1024):null;let $=0;D&&console.log(`  Engine2: TT enabled (${((i.tt.bytes??64*1024*1024)/(1024*1024)).toFixed(0)} MB, 2-way)`);let W=0n;for(let re=0;re<n.N;re++)d.zCell&&d.zCell[re]!==void 0&&(W^=d.zCell[re]);let H=0n;for(const re in u){const ie=d.zInv.get(re);if(ie){const we=u[re]??0;H^=ie[Math.min(we,ie.length-1)]}}function Z(){return W^H}function F(re){d.zCell&&sa(re,ie=>{d.zCell[ie]!==void 0&&(W^=d.zCell[ie])})}function Y(re,ie,we){const U=d.zInv.get(re);U&&(H^=U[Math.min(ie,U.length-1)],H^=U[Math.min(we,U.length-1)])}function X(re){const ie=new Map;for(const[U,se]of n.pieces.entries()){const he=new Map;for(const Oe of se)he.set(Oe.id,Oe.cells);ie.set(U,he)}const we=[];for(const U of re){const se=ie.get(U.pieceId);if(!se)throw new Error(`Unknown pieceId in solution: ${U.pieceId}`);const he=se.get(U.ori);if(!he)throw new Error(`Unknown orientation for ${U.pieceId}: ${U.ori}`);const Oe=he.map(ce=>[ce[0]+U.t[0],ce[1]+U.t[1],ce[2]+U.t[2]]),Te=[];for(const ce of Oe){const K=n.bitIndex.get(`${ce[0]},${ce[1]},${ce[2]}`);if(K===void 0)throw new Error(`Solution cell outside container for ${U.pieceId}`);Te.push(K)}Te.sort((ce,K)=>ce-K),we.push(`${U.pieceId}:${Te.join(",")}`)}return we.sort(),we.join("|")}let oe=!1,pe=!1,De=!1,z=o,ve=!1;const j=i.view??{worldFromIJK:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],sphereRadiusWorld:1},ne=Math.floor(n.N/4),Ee=Object.values(u).reduce((re,ie)=>re+(ie??0),0),me=Math.min(ne,Ee);let te={inventory:0,overlap:0,neighborTouch:0,colorResidue:0,multipleOf4:0,connectivity:0,ttPrune:0,total:0},Pe=performance.now();function je(){ve||(ve=!0,setTimeout(()=>{ve=!1,Fe()},0))}function L(re){var we,U;console.log(` [RESTART] Triggering ${re}-based restart #${E+1} at ${v} nodes`),m=es(d.blockCount),p.length=0,b++;for(const se of c)u[se]=Math.max(0,Math.floor(((U=(we=i.pieces)==null?void 0:we.inventory)==null?void 0:U[se])??1));a(c),E++;const ie=new Map;c.forEach((se,he)=>ie.set(se,he));for(let se=0;se<n.N;se++)d.candsByTarget[se].sort((he,Oe)=>{const Te=ie.get(he.pid)??999,ce=ie.get(Oe.pid)??999;return Te-ce});console.log(" Candidates resorted by new piece order"),W=0n;for(let se=0;se<n.N;se++)d.zCell&&d.zCell[se]!==void 0&&(W^=d.zCell[se]);H=0n;for(const se in u){const he=d.zInv.get(se);if(he){const Oe=u[se]??0;H^=he[Math.min(Oe,he.length-1)]}}C=v,A=performance.now(),We("search")}const Fe=()=>{if(!pe){if(oe){je();return}try{for(let ie=0;ie<200;ie++){if(i.timeoutMs&&performance.now()-o>=i.timeoutMs){Je("timeout");return}if(i.shuffleStrategy==="periodicRestart"&&v-C>=i.restartInterval&&E<i.maxRestarts){L("nodes");continue}if(i.shuffleStrategy==="periodicRestartTime"&&(performance.now()-A)/1e3>=i.restartIntervalSeconds&&E<i.maxRestarts){L("time");continue}if(p.length===0&&!Ke()){console.log(" [NO MOVES] Cannot push initial frame - no valid moves available"),console.log("    This means the first piece cannot be placed anywhere (all positions pruned or invalid)"),Je("complete");return}if(i.tailSwitch.enable){const he=pd(d.occAllMask,m),Oe=Bs(he),Te=i.tailSwitch.dlxThreshold??100;if(Oe>0&&Oe<=Te){const ce=Z();if(M.has(ce)){const lt=p[p.length-1];if(k(lt),p.pop(),p.length===0){Je("complete");return}const ut=p[p.length-1];k(ut),ge(ut);const wt=performance.now();wt-z>=i.statusIntervalMs&&(We("search"),z=wt);continue}if(D&&D.lookup(ce)===1){const lt=p[p.length-1];if(k(lt),p.pop(),p.length===0){Je("complete");return}const ut=p[p.length-1];k(ut),ge(ut);const wt=performance.now();wt-z>=i.statusIntervalMs&&(We("search"),z=wt);continue}const K=i.tailSwitch.dlxTimeoutMs??3e4;M.add(ce),I=!0;let be=!1;const Be=[],Ze=Gg({open:he,remaining:u,bb:d,timeoutMs:K,limit:1,wantWitness:!0});if(Ze.feasible&&Ze.witness&&Ze.witness.length>0){be=!0;const lt=p.filter(St=>St.placed).map(St=>({pieceId:St.placed.pid,ori:St.placed.ori,t:St.placed.t})),ut=Ze.witness.map(St=>({pieceId:St.pid,ori:St.ori,t:St.t})),wt=[...lt,...ut],mt=X(wt);!w.has(mt)&&(w.add(mt),Be.push(wt),x++,console.log(` Solution #${x} (DLX):`,wt.map(St=>St.pieceId).join(",")),D&&(D.store(Z(),2),$++),ke(wt),i.maxSolutions>0&&x>=i.maxSolutions&&(be=!0),i.pauseOnSolution&&(De=!0,oe=!0,We("search")))}if(be){if(i.maxSolutions>0&&x>=i.maxSolutions){Je("limit");return}if(oe)return;if(p.length){const lt=p[p.length-1];for(lt.placed&&k(lt),ge(lt);p.length>0&&!$e(p[p.length-1]);){const ut=p.pop();ut.placed&&k(ut)}if(p.length===0){Je("complete");return}We("search")}continue}else{D&&(D.store(Z(),1),$++);const lt=p[p.length-1];if(k(lt),p.pop(),p.length===0){Je("complete");return}const ut=p[p.length-1];k(ut),ge(ut);const wt=performance.now();wt-z>=i.statusIntervalMs&&(We("search"),z=wt);continue}}}const we=p[p.length-1],U=it(we);if(U){N(we,U),v++;const he=p.length,Oe=p.filter(ce=>ce.placed).length;if(he>g&&(g=he),Oe>y&&(y=Oe),he>P&&(P=he,M.clear()),ty(m,d.occAllMask)){const ce=p.filter(Be=>Be.placed).map(Be=>({pieceId:Be.placed.pid,ori:Be.placed.ori,t:Be.placed.t})),K=X(ce),be=!w.has(K);if(be){if(w.add(K),x++,console.log(` Solution #${x}:`,ce.map(Be=>Be.pieceId).join(",")),D&&(D.store(Z(),2),$++),ke(ce),i.maxSolutions>0&&x>=i.maxSolutions){Je("limit");return}if(i.pauseOnSolution&&be){oe=!0,We("search");return}}for(k(we),ge(we);p.length>0&&!$e(p[p.length-1]);){const Be=p.pop();Be.placed&&k(Be)}if(p.length===0){Je("complete");return}We("search");continue}Ke()||(k(we),ge(we));continue}if(D&&(D.store(Z(),1),$++),k(we),p.pop(),p.length===0){Je("complete");return}if(i.shuffleStrategy==="adaptive"){const he=p.length;if(he<i.shuffleTriggerDepth){const Oe=he,Te=T.get(Oe)??0;if(Te<i.maxSuffixShuffles){const K=p.filter(be=>be.placed).map(be=>be.placed.pid).length;K<c.length-1&&(console.log(` [ADAPTIVE] Shuffling suffix at depth ${he} (shuffle #${Te+1})`),a(c,K),console.log(`    Kept first ${K} pieces, shuffled remaining ${c.length-K}`),T.set(Oe,Te+1),We("search"))}}}const se=p[p.length-1];k(se),ge(se)}const re=performance.now();re-z>=i.statusIntervalMs&&(We("search"),z=re)}catch(re){throw re}je()}};function Re(){oe=!0,We("search")}function Ne(){if(!pe){if(oe=!1,De&&(De=!1,p.length)){const re=p[p.length-1];for(re.placed&&k(re),ge(re);p.length>0&&!$e(p[p.length-1]);){const ie=p.pop();ie.placed&&k(ie)}}We("search"),je()}}function de(){var re;pe=!0,(re=t==null?void 0:t.onDone)==null||re.call(t,{solutions:x,nodes:v,elapsedMs:performance.now()-o,reason:"canceled"})}function Se(){const re=p.map(we=>({targetIdx:we.targetIdx,iPiece:we.iPiece,iOri:we.iOri,iAnchor:we.iAnchor,placed:we.placed?{pieceId:we.placed.pid,ori:we.placed.ori,t:we.placed.t,maskHex:uw(we.placed.mask)}:void 0}));let ie="";for(let we=0;we<m.length;we++)we>0&&(ie+="|"),ie+=m[we].toString(16);return{schema:2,N:n.N,occHex:ie,pieceOrder:[...c],remaining:{...u},frames:re,nodes:v,solutions:x,elapsedMs:performance.now()-o,settings:i,containerId:n.id}}return We("search"),je(),{pause:Re,resume:Ne,cancel:de,snapshot:Se};function Ue(re){const ie=Bs(re);if(ie&3)return!1;const we=Bs(ny(re,d.color0Blocks)),U=ie-we;return!(we&1||U&1)}function ze(re,ie){for(const we of re.cellsIdx){const U=d.neighborBits[we];for(let se=0;se<U.length;se++)if((U[se]&ie[se])!==0n)return!0}return!1}function Ke(){const re=i.moveOrdering==="mostConstrainedCell"?ue(m,u):G(m,n.N);return re<0?!1:(p.push({targetIdx:re,iPiece:0,iOri:0,iAnchor:0,placed:void 0}),!0)}function it(re){const ie=d.candsByTarget[re.targetIdx],we=p.length;i.randomizeTies&&re.iAnchor===0&&ie.length>1&&(re.iAnchor=Math.min(ie.length-1,re.iAnchor+Math.floor(s()*(ie.length-re.iAnchor))));let U=0,se={inventory:0,overlap:0,neighborTouch:0,colorResidue:0,multipleOf4:0,connectivity:0,ttPrune:0};for(;re.iAnchor<ie.length;re.iAnchor++){U++;const he=ie[re.iAnchor];if((u[he.pid]??0)<=0){te.inventory++,se.inventory++;continue}if(!ey(m,he.mask)){te.overlap++,se.overlap++;continue}const Oe=Bs(m);if(i.pruning.neighborTouch&&Oe>0&&!ze(he,m)){_++,te.neighborTouch++,se.neighborTouch++;continue}if(i.pruning.colorResidue){const ce=pd(d.occAllMask,mf(m,he.mask));if(!Ue(ce)){_++,te.colorResidue++,se.colorResidue++;continue}}if(i.pruning.multipleOf4&&(n.N-Bs(mf(m,he.mask)))%4!==0){_++,te.multipleOf4++,se.multipleOf4++;continue}if(i.pruning.connectivity&&!Me(m,he.mask)){_++,te.connectivity++,se.connectivity++;continue}if(D){let ce=Z();for(const lt of he.cellsIdx)ce^=d.zCell[lt];const K=d.zInv.get(he.pid),be=u[he.pid]??0,Be=be-1;if(ce^=K[Math.min(be,K.length-1)],ce^=K[Math.min(Be,K.length-1)],D.lookup(ce)===1){_++,te.ttPrune++,se.ttPrune++;continue}}const Te=performance.now();if(Te-Pe>=1e4){const ce=Object.values(te).reduce((K,be)=>K+be,0);console.log(` [PRUNING STATS] Depth ${we}, Total pruned: ${ce.toLocaleString()}`),console.log(`    Inventory: ${te.inventory.toLocaleString()}`),console.log(`    Overlap: ${te.overlap.toLocaleString()}`),console.log(`    NeighborTouch: ${te.neighborTouch.toLocaleString()}`),console.log(`    ColorResidue: ${te.colorResidue.toLocaleString()}`),console.log(`    MultipleOf4: ${te.multipleOf4.toLocaleString()}`),console.log(`    Connectivity: ${te.connectivity.toLocaleString()}`),console.log(`    TT Prune: ${te.ttPrune.toLocaleString()}`),Pe=Te}return{pid:he.pid,ori:he.ori,t:he.t,mask:he.mask,cellsIdx:he.cellsIdx}}return U>0&&we<=5&&(console.log(` [NO MOVES] Depth ${we}, checked ${U} candidates, all pruned`),console.log(`    Inventory rejects: ${se.inventory}`),console.log(`    Overlap rejects: ${se.overlap}`),console.log(`    NeighborTouch rejects: ${se.neighborTouch}`),console.log(`    ColorResidue rejects: ${se.colorResidue}`),console.log(`    MultipleOf4 rejects: ${se.multipleOf4}`),console.log(`    Connectivity rejects: ${se.connectivity}`),console.log(`    TT rejects: ${se.ttPrune}`)),null}function N(re,ie){lN(m,ie.mask),F(ie.mask),Y(ie.pid,u[ie.pid],u[ie.pid]-1),u[ie.pid]--,re.placed={pid:ie.pid,ori:ie.ori,t:ie.t,mask:ie.mask,cellsIdx:ie.cellsIdx}}function k(re){if(!re.placed)return;const{pid:ie,mask:we}=re.placed;cN(m,we),F(we),Y(ie,u[ie],u[ie]+1),u[ie]++,re.placed=void 0}function G(re,ie){for(let we=0;we<ie;we++)if(ry(re,we))return we;return-1}function ue(re,ie){let we=-1,U=Number.POSITIVE_INFINITY;const se=n.N;for(let he=0;he<se;he++){if(!ry(re,he))continue;let Oe=0;const Te=d.candsByTarget[he];for(const ce of Te)if(!((ie[ce.pid]??0)<=0)&&ey(re,ce.mask)&&(Oe++,Oe>=U))break;if(Oe<U&&(U=Oe,we=he,U===0))return he}return we}function Me(re,ie){const we=mf(re,ie),U=Ha(d.blockCount);for(let Te=0;Te<d.blockCount;Te++)U[Te]=~we[Te]&d.occAllMask[Te];let se=-1;e:for(let Te=0;Te<d.blockCount;Te++){let ce=U[Te];if(ce===0n)continue;let K=0n;for(;(ce&1n)===0n;)ce>>=1n,K++;se=Te*64+Number(K);break e}if(se<0)return!0;const he=es(d.blockCount),Oe=[se];for(qo(he,se);Oe.length;){const Te=Oe.pop(),ce=d.neighborBits[Te],K=ny(ce,U);sa(K,be=>{uN(he,be)||(qo(he,be),Oe.push(be))})}return ty(he,U)}function ge(re){re.iAnchor++}function $e(re){const ie=d.candsByTarget[re.targetIdx];for(let we=re.iAnchor;we<ie.length;we++){const U=ie[we];if((u[U.pid]??0)>0)return!0}return!1}function ke(re){var we,U,se;const ie={engine:"dfs",phase:"search",nodes:v,depth:p.length,elapsedMs:performance.now()-o,pruned:_,placed:re.length,open_cells:0,stack:re,containerId:n.id,worldFromIJK:j.worldFromIJK,sphereRadiusWorld:j.sphereRadiusWorld,clear:!0,scene_version:++b};(we=i.pieces)!=null&&we.inventory&&(ie.inventory_remaining={...u}),(U=t==null?void 0:t.onStatus)==null||U.call(t,ie),(se=t==null?void 0:t.onSolution)==null||se.call(t,re),i.saveSolutions&&(t!=null&&t.onSaveSolutionFile)&&t.onSaveSolutionFile({index:x,placements:re,containerId:n.id,nodes:v,elapsedMs:performance.now()-o})}function We(re){var he,Oe;const ie=p.filter(Te=>Te.placed).map(Te=>({pieceId:Te.placed.pid,ori:Te.placed.ori,t:Te.placed.t})),we=performance.now()-o,U=we>0?Math.round(v/we*1e3):0,se={engine:"dfs",phase:re,nodes:v,depth:p.length,elapsedMs:we,pruned:_,placed:ie.length,open_cells:n.N-Bs(m),stack:ie,containerId:n.id,worldFromIJK:j.worldFromIJK,sphereRadiusWorld:j.sphereRadiusWorld,clear:!1,scene_version:b,bestDepth:g,bestPlaced:y,totalPiecesTarget:me,nodesPerSec:U,tailTriggered:I,restartCount:E,shuffleStrategy:i.shuffleStrategy,restartInterval:i.restartInterval,restartIntervalSeconds:i.restartIntervalSeconds};(he=i.pieces)!=null&&he.inventory&&(se.inventory_remaining={...u}),(Oe=t==null?void 0:t.onStatus)==null||Oe.call(t,se),z=performance.now()}function Je(re){var we;const ie=performance.now()-o;console.log(` DONE: ${v} nodes | ${x} solutions | ${(ie/1e3).toFixed(1)}s`),We("done"),(we=t==null?void 0:t.onDone)==null||we.call(t,{solutions:x,nodes:v,elapsedMs:performance.now()-o,reason:re})}}function iy(n){return`${n[0]},${n[1]},${n[2]}`}function pN(n){let e=n|0||1;return()=>(e^=e<<13,e^=e>>>17,e^=e<<5,(e>>>0)/4294967296)}function mN(n){var e,t,r,i,o,s,a,l,c,u;return{maxSolutions:n.maxSolutions??0,timeoutMs:n.timeoutMs??0,statusIntervalMs:n.statusIntervalMs??250,pauseOnSolution:n.pauseOnSolution??!0,saveSolutions:n.saveSolutions??!1,savePath:n.savePath??"",moveOrdering:n.moveOrdering??"mostConstrainedCell",pruning:{connectivity:((e=n.pruning)==null?void 0:e.connectivity)??!0,multipleOf4:((t=n.pruning)==null?void 0:t.multipleOf4)??!0,colorResidue:((r=n.pruning)==null?void 0:r.colorResidue)??!0,neighborTouch:((i=n.pruning)==null?void 0:i.neighborTouch)??!0},pieces:n.pieces??{},view:n.view??{worldFromIJK:[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],sphereRadiusWorld:1},seed:n.seed??12345,randomizeTies:n.randomizeTies??!0,shuffleStrategy:n.shuffleStrategy??"none",restartInterval:n.restartInterval??5e4,restartIntervalSeconds:n.restartIntervalSeconds??300,maxRestarts:n.maxRestarts??10,shuffleTriggerDepth:n.shuffleTriggerDepth??8,maxSuffixShuffles:n.maxSuffixShuffles??5,tt:{enable:((o=n.tt)==null?void 0:o.enable)??!0,bytes:((s=n.tt)==null?void 0:s.bytes)??64*1024*1024,policy:((a=n.tt)==null?void 0:a.policy)??"2way"},tailSwitch:{enable:((l=n.tailSwitch)==null?void 0:l.enable)??!0,dlxThreshold:((c=n.tailSwitch)==null?void 0:c.dlxThreshold)??100,dlxTimeoutMs:((u=n.tailSwitch)==null?void 0:u.dlxTimeoutMs)??3e4},visualRevealDelayMs:n.visualRevealDelayMs??150}}const yo={HINT_THRESHOLD:100,SOLVE_THRESHOLD:100,COUNT_LIMIT:1e5,TIMEOUT_MS:3e5};async function qg(){try{console.log(" Loading pieces from pieces_orientations.py...");const e=await(await fetch("/data/Pieces/pieces_orientations.py")).text(),t=gN(e);return console.log(` Loaded ${t.size} pieces with orientations`),t}catch(n){throw console.error(" Failed to load pieces:",n),n}}function gN(n){console.log(" parsePythonPieces: Parsing Python code..."),console.log(`   Code length: ${n.length} chars`);const e=new Map,t=n.match(/PIECES\s*=\s*\{([\s\S]*)\}/);if(!t)throw console.error(" parsePythonPieces: Could not find PIECES dictionary"),new Error("Could not find PIECES dictionary in Python file");console.log(" parsePythonPieces: Found PIECES dictionary");const r=t[1],i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y"];for(const o of i){const a=new RegExp(`"${o}":\\s*\\[`).exec(r);if(!a)continue;let l=1,c=a.index+a[0].length;for(;c<r.length&&l>0;)r[c]==="["?l++:r[c]==="]"&&l--,c++;const u=r.substring(a.index+a[0].length,c-1),d=[],f=/\[\s*\[\s*(-?\d+),\s*(-?\d+),\s*(-?\d+)\s*\],\s*\[\s*(-?\d+),\s*(-?\d+),\s*(-?\d+)\s*\],\s*\[\s*(-?\d+),\s*(-?\d+),\s*(-?\d+)\s*\],\s*\[\s*(-?\d+),\s*(-?\d+),\s*(-?\d+)\s*\]\s*\]/g;let m=0,v;for(;(v=f.exec(u))!==null;){const _=[[parseInt(v[1]),parseInt(v[2]),parseInt(v[3])],[parseInt(v[4]),parseInt(v[5]),parseInt(v[6])],[parseInt(v[7]),parseInt(v[8]),parseInt(v[9])],[parseInt(v[10]),parseInt(v[11]),parseInt(v[12])]];d.push({id:m++,cells:_})}d.length>0&&(e.set(o,d),console.log(`  ${o}: ${d.length} orientations`))}return console.log(` Total pieces parsed: ${e.size} (expected 25: A-Y)`),console.log(` Piece IDs found: ${Array.from(e.keys()).join(", ")}`),e}let mn=null;function dw(n){return`${n.i},${n.j},${n.k}`}function vN(n){return Array.isArray(n)?`${n[0]},${n[1]},${n[2]}`:`${n.i},${n.j},${n.k}`}function Mo(n){let e=0;for(;n;)n&=n-1n,e++;return e}function hw(n,e){const t=Ha(e);for(let r=0;r<e;r++){const i=(1n<<64n)-1n;t[r]=n>>BigInt(r*64)&i}return t}function Wd(n,e,t,r){let i=0n;for(const o of e){const s=[o[0]+t[0],o[1]+t[1],o[2]+t[2]],a=n.bitIndex.get(vN(s));if(a===void 0)return null;const l=1n<<BigInt(a);if(r&l)return null;i|=l}return i}function Kg(n,e,t){const r=e|t;if(r===n.occMaskAll)return!0;const i=n.N;let o=-1;for(let c=0;c<i;c++){const u=1n<<BigInt(c);if((r&u)===0n){o=c;break}}if(o<0)return!0;const s=~r&n.occMaskAll;let a=0n;const l=[o];for(a|=1n<<BigInt(o);l.length;){const c=l.shift();for(const u of n.neighbors[c]){const d=1n<<BigInt(u);s&d&&!(a&d)&&(a|=d,l.push(u))}}return a===s}function xN(n,e){if((n.N-Mo(e))%4!==0)return!1;const r=~e&n.occMaskAll;let i=-1;for(let a=0;a<n.N;a++){const l=1n<<BigInt(a);if(r&l){i=a;break}}if(i<0)return!0;let o=0n;const s=[i];for(o|=1n<<BigInt(i);s.length;){const a=s.shift();for(const l of n.neighbors[a]){const c=1n<<BigInt(l);r&c&&!(o&c)&&(o|=c,s.push(l))}}return o===r}function yN(n,e,t){const r=e|t;return!((n.N-Mo(r))%4!==0||!Kg(n,e,t))}function fw(n,e,t,r){let i=-1,o=Number.POSITIVE_INFINITY;for(let s=0;s<n.N;s++){const a=1n<<BigInt(s);if(e&a)continue;let l=0;for(const[c,u]of r.entries())if(!((t[c]??0)<=0)){for(const d of u){for(const f of d.cells){const m=[n.cells[s][0]-f[0],n.cells[s][1]-f[1],n.cells[s][2]-f[2]];if(Wd(n,d.cells,m,e)!==null&&(l++,l>=o))break}if(l>=o)break}if(l>=o)break}if(l<o&&(o=l,i=s,o===0))return s}return i}function pw(n,e){let t=0n,r=0,i=0,o=0;for(const s of e){let a=0,l=0;for(const c of s.cells){r++;const u=n.bitIndex.get(dw(c));u!=null?(t|=1n<<BigInt(u),i++,a++):(o++,l++)}l>0&&console.warn(" [buildOccMask] Piece has cells outside container:",{pieceId:s.pieceId,totalCells:s.cells.length,inContainer:a,outside:l,cells:s.cells})}return console.log(" [buildOccMask] Summary:",{placedPiecesCount:e.length,totalCells:r,inContainer:i,outside:o,occBits:Mo(t),containerSize:n.N}),t}function mw(n){const e={};for(const t of n)t.remaining==="infinite"?e[t.pieceId]=999:e[t.pieceId]=Math.max(0,t.remaining);return e}function Jg(n,e,t,r,i,o){if(console.log(" dfsSolvable start",{depth:r,occ:t.occ.toString(16)}),Date.now()>o||r>i)return!1;if(t.occ===n.occMaskAll)return console.log(" Solution found at depth",r),!0;const s=fw(n,t.occ,t.remaining,e);if(s<0)return console.log(" No target cell selected (dead end)"),!1;const a=n.cells[s];if(r===0){console.log(" Debug at depth 0:"),console.log("  target:",a),console.log("  piecesDb type:",e instanceof Map?"Map":"Object"),console.log("  piecesDb keys sample:",e instanceof Map?Array.from(e.keys()).slice(0,3):Object.keys(e).slice(0,3));const f=e instanceof Map?e.values().next().value:Object.values(e)[0];f&&f[0]&&(console.log("  first orientation sample:",f[0]),console.log("  has cells?","cells"in f[0]),console.log("  has ijkOffsets?","ijkOffsets"in f[0]))}let l=0,c=0,u=0,d=0;for(const[f,m]of e.entries())if(!((t.remaining[f]??0)<=0))for(const v of m)for(const _ of v.cells){const x=[a[0]-_[0],a[1]-_[1],a[2]-_[2]],p=Wd(n,v.cells,x,t.occ);if(p===null){c++;continue}l++;const b=n.N-Mo(t.occ|p);if(b%4!==0){u++,r<=2&&console.log(" dfsSolvable prune: mod4",{depth:r,openAfter:b,occHex:t.occ.toString(16),maskHex:p.toString(16)});continue}if(!Kg(n,t.occ,p)){d++,r<=2&&console.log(" dfsSolvable prune: connectivity",{depth:r,openAfter:b,occHex:t.occ.toString(16),maskHex:p.toString(16)});continue}if(t.occ|=p,t.remaining[f]--,Jg(n,e,t,r+1,i,o))return!0;t.occ&=~p,t.remaining[f]++}return console.log(" dfsSolvable at depth",r,{targetIdx:s,candidateCount:l,prunedByMask:c,prunedByMod4:u,prunedByConnectivity:d}),!1}function gw(n,e,t,r,i,o,s=1e3){if(Date.now()>o||r>i)return 0;if(t.occ===n.occMaskAll)return 1;const a=fw(n,t.occ,t.remaining,e);if(a<0)return 0;const l=n.cells[a];let c=0;for(const[u,d]of e.entries())if(!((t.remaining[u]??0)<=0)){if(c>=s)break;for(const f of d)for(const m of f.cells){if(c>=s)break;const v=[l[0]-m[0],l[1]-m[1],l[2]-m[2]],_=Wd(n,f.cells,v,t.occ);_===null||(n.N-Mo(t.occ|_))%4!==0||Kg(n,t.occ,_)&&(t.occ|=_,t.remaining[u]--,c+=gw(n,e,t,r+1,i,o,s-c),t.occ&=~_,t.remaining[u]++)}}return c}async function vw(){return await qg()}async function _N(n,e){console.log(" [checkSolvableFromPartial] Input:",{containerCells:n.containerCells.length,placedPieces:n.placedPieces.length,placedPieceIds:n.placedPieces.map(v=>v.pieceId),remainingPieces:n.remainingPieces.length,mode:n.mode});const t=n.containerCells.map(v=>[v.i,v.j,v.k]),r=Xg({cells:t,id:n.mode},e),i=pw(r,n.placedPieces),o=mw(n.remainingPieces),s=r.N-Mo(i),a=s<=yo.SOLVE_THRESHOLD;if(console.log(" [HintEngine] partial state for solvability:",{N:r.N,mode:n.mode,remaining:o,emptyCount:s,checkMode:a?"full":"lightweight"}),a&&s<=yo.SOLVE_THRESHOLD){console.log(" [HintEngine] Using DLX for solvability check (N=",s,")");try{const v=Yg(r),_=hw(i,v.blockCount),x=pd(v.occAllMask,_);let p=0;sa(v.occAllMask,()=>{p++});let b=0;sa(_,()=>{b++});let g=0;sa(x,()=>{g++}),console.log(" [DLX Bitboard Check]:",{N:r.N,containerMaskBits:p,occBlocksBits:b,openBlocksBits:g,emptyCount:s});const y=Gg({open:x,remaining:o,bb:v,timeoutMs:yo.TIMEOUT_MS,limit:1,wantWitness:!1});if(console.log(" [DLX] Result:",{feasible:y.feasible,count:y.count,capped:y.capped,elapsedMs:y.elapsedMs}),!y.feasible){let E=0;sa(x,()=>{E++}),console.error(" [DLX] INFEASIBLE STATE:",{N:r.N,emptyCount:s,remaining:o,openCellsCount:E,containerCells:n.containerCells.length,placedPieces:n.placedPieces.length}),mn&&console.warn(" [DLX] But witness cache exists!",{witnessSize:mn.witness.length,usedPieces:mn.usedIndices.size})}return{solvable:y.feasible,mode:"full",emptyCount:s,solutionCount:y.count}}catch(v){console.warn(" [DLX] Failed, falling back to DFS:",v)}}if(!a){const v=xN(r,i);return{solvable:v,mode:"lightweight",emptyCount:s,definiteFailure:!v}}const l=Date.now(),c=l+4e3,u=100,f=Jg(r,e,{occ:i,remaining:o},0,u,c);let m;if(f){const v={occ:i,remaining:{...o}},_=l+2e3;m=gw(r,e,v,0,u,_,1e3),console.log(` [HintEngine] Found ${m}${m>=1e3?"+":""} solutions`)}return{solvable:f,mode:"full",emptyCount:s,solutionCount:m}}async function bN(n,e,t){var T,w,M,P,I;const r=n.containerCells.map(D=>[D.i,D.j,D.k]),i=Xg({cells:r,id:n.mode},t),o=pw(i,n.placedPieces),s=mw(n.remainingPieces);console.log(" [HintEngine] partial state for hint:",{N:i.N,occMask:o.toString(16),mode:n.mode,remaining:s,targetCell:e});const a=dw(e),l=i.bitIndex.get(a);if(console.log(" [HINT-ENGINE] Target cell mapping:",{targetCell:e,targetKey:a,targetIdx:l,foundInContainer:l!=null}),l==null)return console.warn(" [HintEngine] targetCell is not in container:",e),{solvable:!1};const c=i.cells[l],u=i.N-Mo(o);if(console.log(" [HintEngine] empty cell count:",u),u<=yo.HINT_THRESHOLD){console.log(" [HintEngine] Using DLX for hint (N=",u,")");try{const D=Yg(i),$=hw(o,D.blockCount),W=pd(D.occAllMask,$),H=o.toString(16),Z=JSON.stringify(s);if(mn&&mn.usedIndices.size<mn.witness.length&&mn){console.log(" [WitnessCache] Reusing cached witness (pieces used:",mn.usedIndices.size,"/",mn.witness.length,")");for(let oe=0;oe<mn.witness.length;oe++){if(mn.usedIndices.has(oe))continue;const pe=mn.witness[oe];if(pe.cellsIdx.includes(l)){mn.usedIndices.add(oe);const De=Array.isArray(pe.t)?{i:pe.t[0],j:pe.t[1],k:pe.t[2]}:pe.t;return console.log(" [WitnessCache] Found piece covering target:",{pieceId:pe.pid,ori:pe.ori,anchor:De,witnessIndex:oe,usedCount:mn.usedIndices.size,totalWitness:mn.witness.length}),{solvable:!0,hintedPieceId:pe.pid,hintedOrientationId:`${pe.pid}-${String(pe.ori).padStart(2,"0")}`,hintedAnchorCell:De}}}console.log(" [WitnessCache] No cached piece covers target - invalidating cache and recomputing"),mn=null}console.log(" [WitnessCache] Generating new witness from DLX");const Y=Gg({open:W,remaining:s,bb:D,timeoutMs:yo.TIMEOUT_MS,limit:1,wantWitness:!0});if(console.log(" [DLX Hint] Result:",{feasible:Y.feasible,witnessCount:((T=Y.witness)==null?void 0:T.length)??0,elapsedMs:Y.elapsedMs,reason:Y.reason}),Y.feasible&&Y.witness&&Y.witness.length>0){mn={witness:Y.witness,occMask:H,remainingKey:Z,usedIndices:new Set},console.log(" [WitnessCache] Cached new witness with",Y.witness.length,"pieces"),console.log(" [WITNESS] Checking coverage for targetIdx:",l),console.log(" [WITNESS] Sample witness row cellsIdx:",(M=(w=Y.witness[0])==null?void 0:w.cellsIdx)==null?void 0:M.slice(0,4));let oe=Y.witness.find((De,z)=>De.cellsIdx.includes(l)?(mn.usedIndices.add(z),console.log(" [WITNESS] Found piece covering targetIdx:",{pieceId:De.pid,ori:De.ori,idx:z}),!0):!1);if(!oe)return console.error(" [WITNESS] No piece in fresh witness covers target",{targetIdx:l,targetCell:c,witnessLength:Y.witness.length,sampleCells:(I=(P=Y.witness[0])==null?void 0:P.cellsIdx)==null?void 0:I.slice(0,5)}),{solvable:!1,reason:"No placement covers target cell"};const pe=Array.isArray(oe.t)?{i:oe.t[0],j:oe.t[1],k:oe.t[2]}:oe.t;return console.log(" [DLX Hint] Selected placement from new witness:",{pieceId:oe.pid,ori:oe.ori,anchor:pe,coversTarget:oe.cellsIdx.includes(l),witnessSize:Y.witness.length}),{solvable:!0,hintedPieceId:oe.pid,hintedOrientationId:`${oe.pid}-${String(oe.ori).padStart(2,"0")}`,hintedAnchorCell:pe}}let X="Configuration Unsolvable";return Y.reason==="timeout"?(X="No Solution Found Within Time Limit",console.log(" [DLX Hint] Timeout after",Y.elapsedMs,"ms")):Y.feasible||(X="Configuration Unsolvable",console.log(" [DLX Hint] No solution exists from this state"),console.log(" [DLX Hint] This can happen if manual placements created a dead end."),console.log(" [DLX Hint] Try: 1) Undo some pieces, or 2) Check solvability before requesting hints")),console.log(" [DLX Hint] Reason:",X),{solvable:!1,reason:X}}catch(D){console.warn(" [DLX Hint] Failed, falling back to DFS:",D)}}const d=t instanceof Map?Array.from(t.entries()):Object.entries(t),f={occ:o,remaining:s},v=Date.now()+3e3,_=100;let x=0,p=0,b=0,g=0,y=0,E=0,C=0;for(const D of Object.keys(s))C+=Math.max(0,s[D]??0);if(C===0)return console.log(" [HintEngine] Reason: Piece Inventory Exhausted"),{solvable:!1,reason:"Piece Inventory Exhausted"};for(const[D,$]of d)if(!((s[D]??0)<=0))for(const W of $){const H=W.id??0,Z=W.cells||W.ijkOffsets;if(Z)for(const F of Z){x++;const Y=typeof F=="object"&&"i"in F?F.i:F[0],X=typeof F=="object"&&"j"in F?F.j:F[1],oe=typeof F=="object"&&"k"in F?F.k:F[2],pe=[c[0]-Y,c[1]-X,c[2]-oe],De=Z.map(Pe=>typeof Pe=="object"&&"i"in Pe?[Pe.i,Pe.j,Pe.k]:Pe),z=Wd(i,De,pe,f.occ);if(z===null){g++;continue}p++;const ve={occ:f.occ|z,remaining:{...f.remaining}};ve.remaining[D]=(ve.remaining[D]??0)-1;const j=i.N-Mo(ve.occ);if(j<=yo.HINT_THRESHOLD){const Pe=Jg(i,t,ve,0,_,v),je=Date.now();if(Pe){b++;const L={i:pe[0],j:pe[1],k:pe[2]},Fe=`${D}-${String(H).padStart(2,"0")}`;return console.log(" [HintEngine] Found VERIFIED hint placement:",{pieceId:D,orientationIndex:H,orientationId:Fe,anchorCell:L,stats:{candidatesChecked:x,candidatesValidGeometry:p,candidatesSolvable:b,prunedByMaskAtHint:g,dfsReturnedFalse:y,dfsTimeouts:E}}),console.log(" [DFS] Verified state AFTER placing this hint:",{emptyCountAfter:j,remainingAfter:ve.remaining,occMask:ve.occ.toString(16)}),{solvable:!0,hintedPieceId:D,hintedOrientationId:Fe,hintedAnchorCell:L}}else{y++,Date.now()>v&&je>=v&&E++;continue}}if(!yN(i,f.occ,z))continue;const me={i:pe[0],j:pe[1],k:pe[2]},te=`${D}-${String(H).padStart(2,"0")}`;return console.warn(" [HintEngine] Lightweight hint accepted (no DFS)",{emptyCountAfter:j,pieceId:D,orientationIndex:H,anchorCell:me}),{solvable:!0,hintedPieceId:D,hintedOrientationId:te,hintedAnchorCell:me}}}let A="No Remaining Valid Moves";return E>0?A="No Solution Found Within Time Limit":p===0?A="No Remaining Valid Moves":b===0&&y>0&&(A="Configuration Unsolvable"),console.warn(" [HintEngine] No placement found covering targetCell",{targetCell:e,reason:A,stats:{candidatesChecked:x,candidatesValidGeometry:p,candidatesSolvable:b,prunedByMaskAtHint:g,dfsReturnedFalse:y,dfsTimeouts:E}}),{solvable:!1,reason:A}}async function SN(n){console.log(" DLX solvability check (via hintEngine)");try{const e=await vw(),t=await _N(n,e);return console.log(" DLX/hintEngine solvable result:",t),t}catch(e){return console.error(" DLX solvable check failed in hintEngine:",e),{solvable:!1,mode:"full",emptyCount:0,definiteFailure:!0}}}async function wN(n,e){console.log(" DLX hint (via hintEngine):",{targetCell:e});try{const t=await vw(),r=await bN(n,e,t);return console.log(" DLX/hintEngine hint result:",r),!r||!r.solvable||!r.hintedPieceId||!r.hintedAnchorCell?{solvable:!1}:{solvable:!0,hintedPieceId:r.hintedPieceId,hintedOrientationId:r.hintedOrientationId,hintedAnchorCell:r.hintedAnchorCell}}catch(t){return console.error(" DLX hint failed in hintEngine:",t),{solvable:!1}}}const xw=({puzzle:n,cells:e,mode:t,placed:r,activePiece:i,customInventory:o={},placedCountByPieceId:s={},orientationService:a,placePiece:l,setNotification:c,setNotificationType:u})=>{const[d,f]=S.useState(null),[m,v]=S.useState(null),[_,x]=S.useState(0);S.useEffect(()=>{if(!d||!m)return;const b=setTimeout(()=>{l(m),f(null),v(null)},500);return()=>clearTimeout(b)},[d,m,l]);const p=S.useCallback(async b=>{if(console.log(" [HINT-SYSTEM] handleRequestHint called",{hasPuzzle:!!n,drawingCellsLength:b.length,mode:t,placedCount:r.size,hasOrientationService:!!a}),!n){console.log(" [HINT-SYSTEM] No puzzle, returning");return}if(b.length===0){console.log(" [HINT-SYSTEM] No drawing cells"),c("Double-click a cell first, then request a hint for that cell."),u("info");return}console.log(" [HINT-SYSTEM] Starting hint solver...");const y=(()=>{const M=[],P=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y"];if(t==="oneOfEach"){const I=new Set(Array.from(r.values()).map(D=>D.pieceId));for(const D of P)M.push({pieceId:D,remaining:I.has(D)?0:1})}else if(t==="unlimited")for(const I of P)M.push({pieceId:I,remaining:"infinite"});else if(t==="single"){let I=null;const D=Array.from(r.values());if(D.length>0){if(I=D[0].pieceId,new Set(D.map(W=>W.pieceId)).size>1){console.warn(" Single mode violation in hint: multiple piece types placed");for(const W of P)M.push({pieceId:W,remaining:0});return M}}else i&&(I=i);if(!I)return console.warn(" Single mode hint: no piece type determined yet"),[];for(const $ of P)M.push({pieceId:$,remaining:$===I?"infinite":0})}else if(t==="customSet")for(const I of P){const D=o[I]??0,$=s[I]??0,W=Math.max(0,D-$);M.push({pieceId:I,remaining:W})}return M})(),E=b[0],C=`${E.i},${E.j},${E.k}`;console.log(" [HINT-SYSTEM] targetCell entering dlxGetHint",{targetCell:E,tk:C});const A=e.some(M=>`${M.i},${M.j},${M.k}`===C);if(console.log(" [HINT-SYSTEM] target in container?",{tk:C,inContainer:A,containerN:e.length,sampleContainerCells:e.slice(0,3).map(M=>`${M.i},${M.j},${M.k}`)}),t==="customSet"){const M=y.map(P=>({pieceId:P.pieceId,remaining:P.remaining,available:o[P.pieceId]??0,placed:s[P.pieceId]??0}));console.log(" [HINT-SYSTEM] CustomSet Mode - ALL PIECES:",M),console.log(" [HINT-SYSTEM] Pieces with inventory > 0:",M.filter(P=>typeof P.remaining=="number"&&P.remaining>0)),console.log(" [HINT-SYSTEM] Total available count:",y.reduce((P,I)=>P+(typeof I.remaining=="number"?I.remaining:999),0))}x(M=>M+1);const T=e.filter(M=>{const P=D=>`${D.i},${D.j},${D.k}`,I=P(M);for(const[,D]of r)if(D.cells.some($=>P($)===I))return!1;return!0}),w={containerCells:e,placedPieces:Array.from(r.values()),emptyCells:T,remainingPieces:y,mode:t};try{console.log(" [HINT-SYSTEM] Calling dlxGetHint with:",{targetCell:E,targetKey:C,mode:t,emptyCount:T.length,placedCount:r.size,remainingPiecesCount:y.length,piecesWithCount:y.filter(Y=>typeof Y.remaining=="number"&&Y.remaining>0).map(Y=>`${Y.pieceId}:${Y.remaining}`)});const M=await wN(w,E);if(console.log(" [HINT-SYSTEM] DLX hint result:",M),!M||!M.solvable||!M.hintedPieceId||!M.hintedAnchorCell){console.log(" [HINT-SYSTEM] No valid hint found",{hasResult:!!M,solvable:M==null?void 0:M.solvable,hasPieceId:!!(M!=null&&M.hintedPieceId),hasAnchor:!!(M!=null&&M.hintedAnchorCell)}),c("No hint available for this position."),u("info"),f([]);return}const P=M.hintedPieceId,I=M.hintedOrientationId??"",D=M.hintedAnchorCell,$=a==null?void 0:a.getOrientations(P);if(!$||$.length===0){console.warn(` No orientations found for hinted piece ${P}`),c("Internal hint error (no orientations)."),u("error");return}let W=$.find(Y=>Y.orientationId===I);if(!W&&(console.warn(` Orientation ${I} not found for hinted piece ${P}, falling back to first orientation`),W=$[0],!W)){c("Internal hint error (orientation mismatch)."),u("error");return}const H=W.ijkOffsets.map(Y=>({i:D.i+Y.i,j:D.j+Y.j,k:D.k+Y.k})),Z=`hint-${Date.now()}-${Math.random().toString(36).slice(2)}`,F={pieceId:P,orientationId:I,anchorSphereIndex:0,cells:H,uid:Z,placedAt:Date.now()};console.log(" [HINT-SYSTEM] Setting hint cells",{cellCount:H.length,pieceId:P,orientationId:I,cells:H}),f(H),v(F)}catch(M){console.error(" [HINT-SYSTEM] DLX hint failed:",M),c("Hint request failed"),u("error"),f([])}},[n,e,t,r,o,s,a,c,u,l]);return{hintCells:d,pendingHintPiece:m,hintsUsed:_,handleRequestHint:p}},yw=({puzzle:n,cells:e,mode:t,placed:r,activePiece:i,customInventory:o={},placedCountByPieceId:s={},setSolvableStatus:a,setNotification:l,setNotificationType:c,onCheckComplete:u})=>{const[d,f]=S.useState(0);S.useEffect(()=>{a("unknown")},[r,a]);const m=S.useCallback(async()=>{if(!n)return;const v=C=>`${C.i},${C.j},${C.k}`,_=new Set;r.forEach(C=>{C.cells.forEach(A=>_.add(v(A)))});const x=e.filter(C=>!_.has(v(C))),b=(()=>{const C=[],A=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y"];if(t==="oneOfEach"){const T=new Set(Array.from(r.values()).map(w=>w.pieceId));for(const w of A)C.push({pieceId:w,remaining:T.has(w)?0:1})}else if(t==="unlimited")for(const T of A)C.push({pieceId:T,remaining:"infinite"});else if(t==="single"){let T=null;const w=Array.from(r.values());if(w.length>0){if(T=w[0].pieceId,new Set(w.map(P=>P.pieceId)).size>1){console.warn(" Single mode violation: multiple piece types placed");for(const P of A)C.push({pieceId:P,remaining:0});return C}}else i&&(T=i);if(!T)return console.warn(" Single mode: no piece type determined yet"),[];for(const M of A)C.push({pieceId:M,remaining:M===T?"infinite":0})}else if(t==="customSet")for(const T of A){const w=o[T]??0,M=s[T]??0,P=Math.max(0,w-M);C.push({pieceId:T,remaining:P})}return C})();if(t==="customSet"&&console.log(" [SOLVABILITY-CHECK] CustomSet Mode Debug:",{mode:t,customInventory:o,placedCountByPieceId:s,remainingPieces:b.filter(C=>typeof C.remaining=="number"?C.remaining>0:!0),totalAvailable:b.reduce((C,A)=>C+(typeof A.remaining=="number"?A.remaining:999),0)}),t==="single"&&b.length===0){l("In identical pieces mode, place the first piece to define the shape before checking solvability."),c("info");return}if(t==="single"){const C=Array.from(r.values());if(C.length>0&&new Set(C.map(T=>T.pieceId)).size>1){a("unsolvable"),l(" Position uses multiple piece types - unsolvable in identical pieces mode."),c("warning"),u==null||u(!1);return}}f(C=>C+1),x.length<=30&&a("checking");const E={containerCells:e,placedPieces:Array.from(r.values()),emptyCells:x,remainingPieces:b,mode:t};try{const C=new Promise((T,w)=>{setTimeout(()=>w(new Error("Solvability check timed out after 5 seconds")),5e3)}),A=await Promise.race([SN(E),C]);if(console.log(" DLX/hintEngine solvable result:",A),A.mode==="lightweight")A.definiteFailure?(a("unsolvable"),l(` Unsolvable Configuration

A lightweight check found a definitive obstruction (e.g., mod-4 violation or disconnected region) that makes this puzzle impossible to complete.`),c("warning"),u==null||u(!1)):(a("solvable"),l(` Still Potentially Solvable

With ${A.emptyCount} empty cells, only lightweight feasibility checks were performed. No contradictions foundthis puzzle still has the potential to be solved.

Full solvability verification will activate once you reach 30 or fewer empty cells.`),c("info"),u==null||u(!0));else if(A.mode==="full")if(A.solvable){a("solvable");let T="";A.solutionCount!==void 0&&(A.solutionCount>=yo.COUNT_LIMIT?T=`

Found ${A.solutionCount.toLocaleString()}+ possible solutions (stopped counting at ${yo.COUNT_LIMIT.toLocaleString()}).`:A.solutionCount===1?T=`

There is exactly 1 solution to complete this puzzle.`:T=`

There are ${A.solutionCount.toLocaleString()} possible solutions to complete this puzzle.`),l(` Puzzle Solvable

With ${A.emptyCount} empty cells remaining, a full-depth solvability check was performed. This puzzle can be completed!${T}`),c("success"),u==null||u(!0)}else a("unsolvable"),l(` Puzzle Not Solvable

A full solvability check (DFS verification) indicates that the current configuration cannot lead to a valid solution.`),c("warning"),u==null||u(!1)}catch(C){console.error(" Solvability check failed:",C),a("unknown"),C instanceof Error&&C.message.includes("timed out")?(l(" Solvability check timed out after 5 seconds. The puzzle configuration may be too complex to verify quickly."),c("warning")):(l(" Solvability check failed"),c("error"))}},[n,e,t,r,i,o,s,a,l,c]);return{solvabilityChecksUsed:d,handleRequestSolvability:m}};async function _w(n){return new Promise((e,t)=>{n.toBlob(r=>{r?e(r):t(new Error("Failed to capture canvas screenshot"))},"image/png",.9)})}async function EN(n,e){const r=`thumbnails/${`${e}.png`}`;console.log(" Uploading thumbnail:",r);const{data:i,error:o}=await bt.storage.from("puzzle-thumbnails").upload(r,n,{contentType:"image/png",upsert:!0});if(o)throw console.error(" Failed to upload thumbnail:",o),new Error(`Failed to upload thumbnail: ${o.message}`);const{data:s}=bt.storage.from("puzzle-thumbnails").getPublicUrl(r);return console.log(" Thumbnail uploaded:",s.publicUrl),s.publicUrl}const oy=Object.freeze(Object.defineProperty({__proto__:null,captureCanvasScreenshot:_w,uploadThumbnail:EN},Symbol.toStringTag,{value:"Module"})),bw=({puzzle:n,cells:e,placed:t,solveStartTime:r,moveCount:i,solveActions:o,getSolveStats:s,setIsComplete:a,setSolveEndTime:l,setRevealK:c,setShowCompletionCelebration:u,setCurrentSolutionId:d,setShowSuccessModal:f,setNotification:m,setNotificationType:v})=>{const _=S.useRef(!1),x=S.useRef(!1);return S.useEffect(()=>{if(!n||t.size===0){_.current=!1,x.current=!1;return}const p=new Set;if(t.forEach(g=>{g.cells.forEach(y=>{const E=`${y.i},${y.j},${y.k}`;p.add(E)})}),e.every(g=>{const y=`${g.i},${g.j},${g.k}`;return p.has(y)})&&!x.current){x.current=!0,a(!0);const g=Date.now();l(g),c(t.size),u(!0),setTimeout(()=>u(!1),2e3),_.current||(_.current=!0,console.log(" Solution complete! Placed all",p.size,"cells"),console.log(" Auto-saving manual solution..."),(async()=>{try{const{data:{session:E}}=await bt.auth.getSession();if(!E){console.warn(" No user session, skipping auto-save"),m("Please log in to save solutions"),v("info");return}const C=s(),A=r?g-r:null,T=Array.from(t.values()).flatMap($=>$.cells),w=t.size*200+500;console.log(` Waiting ${w}ms for ${t.size} pieces to animate...`),await new Promise($=>setTimeout($,w));let M=null;try{const $=document.querySelector("canvas");if($){console.log(" Capturing solution screenshot...");const W=await _w($);console.log(" Screenshot captured:",(W.size/1024).toFixed(2),"KB");const Z=`thumbnails/${`${n.id}-${E.user.id}-${Date.now()}.png`}`,{error:F}=await bt.storage.from("solution-thumbnails").upload(Z,W,{contentType:"image/png",upsert:!1});if(F)console.error(" Failed to upload thumbnail:",F);else{const{data:Y}=bt.storage.from("solution-thumbnails").getPublicUrl(Z);M=Y.publicUrl,console.log(" Thumbnail uploaded:",M)}}}catch($){console.error(" Screenshot capture failed:",$)}const P={puzzle_id:n.id,created_by:E.user.id,solver_name:E.user.email||"Anonymous",solution_type:"manual",final_geometry:T,placed_pieces:Array.from(t.values()),thumbnail_url:M,total_moves:C.total_moves,undo_count:C.undo_count,hints_used:C.hints_used,solvability_checks_used:C.solvability_checks_used,duration_ms:A,solve_time_ms:A,move_count:C.total_moves},{data:I,error:D}=await bt.from("solutions").insert([P]).select().single();if(D){console.error(" Auto-save failed:",D),m(" Failed to auto-save solution"),v("error");return}console.log(" Solution auto-saved:",I.id),d(I.id),setTimeout(()=>{f(!0)},2500)}catch(E){console.error(" Auto-save error:",E),m(" Auto-save failed"),v("error")}})())}},[t,e,n,o,r,i,s,a,l,c,u,d,f,m,v]),{hasSavedRef:_,hasSetCompleteRef:x}},Vd=(n,e,t)=>{if(n.length===0||e.length===0)return null;const r=Qx(n);for(const i of e){const o=t.getOrientations(i);if(!(!o||o.length===0))for(const s of o){const a=Qx(s.ijkOffsets);if(nN(r,a))return{pieceId:i,orientationId:s.orientationId}}}return null},rs=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y"],MN=25,sy=n=>`${n.i},${n.j},${n.k}`;function TN(n,e){if(!n||!e)return{level:"Unknown",description:"Not enough data yet to estimate complexity.",orderOfMagnitude:null};const t=Math.round(n/4*Math.log10(Math.max(e,2)));let r="Medium";return t<4?r="Easy":t>7&&(r="Hard"),{level:r,description:r==="Easy"?"Likely solvable with some experimentation and a bit of patience.":r==="Medium"?"Requires careful placement and attention to symmetry.":"Large search space  expect to explore many options before finding a solution.",orderOfMagnitude:t}}function CN(n,e){const t=new Set;return e.forEach(r=>{r.cells.forEach(i=>t.add(sy(i)))}),n.filter(r=>!t.has(sy(r)))}const RN=()=>h.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#4b5563"},children:[h.jsxs("p",{children:["In manual mode you ",h.jsx("strong",{children:"draw"})," each Koos piece directly on the lattice."]}),h.jsx("p",{style:{marginTop:"0.5rem"},children:h.jsx("strong",{children:"Basic controls"})}),h.jsxs("ul",{style:{marginTop:"0.25rem",paddingLeft:"1.5rem"},children:[h.jsx("li",{children:"Double-click adjacent empty cells to draw up to 4 spheres."}),h.jsx("li",{children:"Single-click on a cell to cancel the current drawing."}),h.jsx("li",{children:"Click a placed piece to select it."}),h.jsx("li",{children:"Double-click or long-press a selected piece to delete it."}),h.jsx("li",{children:"Use Ctrl+Z / Z to undo and Shift+Ctrl+Z / Shift+Z to redo."})]}),h.jsx("p",{style:{marginTop:"0.5rem"},children:h.jsx("strong",{children:"Modes"})}),h.jsxs("ul",{style:{marginTop:"0.25rem",paddingLeft:"1.5rem"},children:[h.jsxs("li",{children:[h.jsx("strong",{children:"One of each:"})," Place each piece at most once."]}),h.jsxs("li",{children:[h.jsx("strong",{children:"Unlimited:"})," Use any piece as many times as you like."]}),h.jsxs("li",{children:[h.jsx("strong",{children:"Single piece:"})," The first piece you place becomes the only allowed piece."]})]}),h.jsxs("p",{style:{marginTop:"1rem",padding:"0.75rem",background:"#f3f4f6",borderRadius:"6px"},children:[" ",h.jsx("strong",{children:"Tip:"})," Use the gear icon () to tune lighting and materials so the structure is easier to read while you explore."]})]}),AN=({puzzle:n,mode:e,cellsCount:t,pieces:r,placedCount:i,emptyCellsCount:o,complexity:s,searchSpaceStats:a,onOpenHowTo:l})=>h.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#4b5563"},children:[h.jsxs("p",{children:[h.jsx("strong",{children:"Creator:"})," ",(n==null?void 0:n.created_by)||(n==null?void 0:n.author)||"Unknown"]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Created:"})," ",n!=null&&n.created_at?new Date(n.created_at).toLocaleString():"Unknown"]}),h.jsxs("p",{style:{marginTop:"0.75rem"},children:[h.jsx("strong",{children:"Current solve mode:"})," ",e==="oneOfEach"?"One of each piece":e==="unlimited"?"Unlimited pieces":e==="customSet"?"Custom set (inventory)":"Single piece mode"]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Container size:"})," ",t," lattice cells"]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Available pieces:"})," ",((n==null?void 0:n.allowed_piece_ids)||r).join(", ")]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Pieces already placed:"})," ",i]}),h.jsxs("p",{children:[h.jsx("strong",{children:"Remaining empty cells:"})," ",o]}),h.jsxs("div",{style:{marginTop:"0.9rem",padding:"0.75rem",background:"#f3f4f6",borderRadius:"6px"},children:[h.jsxs("p",{style:{margin:0},children:[h.jsx("strong",{children:"Estimated difficulty:"})," ",s.level]}),h.jsx("p",{style:{margin:"0.35rem 0 0 0"},children:s.description}),a?h.jsxs(h.Fragment,{children:[h.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"12px"},children:[h.jsx("strong",{children:"Search space (upper bound):"})," ",h.jsx("code",{style:{fontSize:"13px",fontWeight:600},children:a.upperBounds.fixedInventoryNoOverlap.sci})]}),h.jsxs("p",{style:{margin:"0.35rem 0 0 0",fontSize:"11px",color:"#6b7280"},children:["~10^",Math.floor(a.upperBounds.fixedInventoryNoOverlap.log10)," combinations (",a.totalPlacements.toLocaleString()," total placements)"]})]}):s.orderOfMagnitude!==null?h.jsxs("p",{style:{margin:"0.35rem 0 0 0",fontSize:"12px"},children:["Rough search space on the order of"," ",h.jsxs("code",{children:["10^",s.orderOfMagnitude]})," possible placements."]}):null]}),h.jsx("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"0.75rem"},children:h.jsx("button",{type:"button",onClick:l,style:{padding:"0.4rem 0.9rem",borderRadius:"6px",border:"none",cursor:"pointer",fontSize:"13px",background:"#e5e7eb",color:"#111827"},children:" How to puzzle"})})]}),PN=({mode:n,onOpenPieces:e,onChangeMode:t,onOpenAboutPuzzle:r,onOpenSettings:i,onGoHome:o})=>{const[s,a]=S.useState(!1);S.useEffect(()=>{if(s){const c=u=>{u.key==="Escape"&&a(!1)};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)}},[s]);const l=c=>{t(c),a(!1)};return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .solve-header {
          position: fixed;
          top: 20px;
          left: 20px;
          right: 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          z-index: 1000;
          pointer-events: none;
        }
        
        .solve-header-left {
          display: flex;
          gap: 8px;
          align-items: center;
          pointer-events: auto;
        }
        
        .solve-header-right {
          display: flex;
          gap: 8px;
          align-items: center;
          pointer-events: auto;
        }
        
        .header-btn {
          background: rgba(0, 0, 0, 0.6);
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.1);
          color: #fff;
          padding: 8px 16px;
          border-radius: 24px;
          font-size: 16px;
          cursor: pointer;
          white-space: nowrap;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 6px;
          min-height: 40px;
          transition: all 0.2s ease;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        
        .header-btn:hover {
          background: rgba(0, 0, 0, 0.8);
          border-color: rgba(255, 255, 255, 0.2);
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .header-btn:active {
          transform: translateY(0);
        }
        
        .header-btn-icon {
          color: #fff;
          border: none;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          font-size: 16px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
          transition: all 0.2s ease;
        }
        
        .header-btn-icon:hover {
          transform: translateY(-1px);
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .header-btn-icon:active {
          transform: translateY(0);
        }
        
        .dropdown-menu {
          position: absolute;
          background: #000;
          border: 2px solid #555;
          border-radius: 8px;
          padding: 8px;
          min-width: 200px;
          z-index: 10000;
          box-shadow: 0 4px 16px rgba(0,0,0,0.9);
        }
        
        .dropdown-backdrop {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          z-index: 9999;
        }
        
        .dropdown-item {
          width: 100%;
          padding: 10px 14px;
          background: transparent;
          border: none;
          color: #fff;
          text-align: left;
          cursor: pointer;
          border-radius: 4px;
          font-size: 14px;
          display: block;
        }
        
        .dropdown-item:hover {
          background: rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-item-active {
          background: rgba(255, 255, 255, 0.15);
          font-weight: 600;
        }
        
        .dropdown-header {
          cursor: default;
          user-select: none;
          color: rgba(255, 255, 255, 0.75);
          font-size: 13px;
          font-weight: 500;
          padding-top: 4px;
          padding-bottom: 6px;
        }
        
        .header-btn:focus,
        .header-btn-icon:focus,
        .header-btn-icon-menu:focus {
          outline: none;
        }
      `}),h.jsxs("div",{className:"solve-header",children:[h.jsxs("div",{className:"solve-header-left",children:[h.jsx("button",{className:"header-btn",onClick:()=>a(!s),title:n==="oneOfEach"?"Mode: Unique pieces":n==="unlimited"?"Mode: Unlimited pieces":n==="customSet"?"Mode: Custom set":"Mode: Identical pieces",children:""}),h.jsx("button",{className:"header-btn",onClick:e,title:"Inventory",children:""})]}),h.jsxs("div",{className:"solve-header-right",children:[h.jsx("button",{className:"header-btn-icon",onClick:r,title:"About this puzzle",style:{background:"linear-gradient(135deg, #3b82f6, #2563eb)"},children:""}),h.jsx("button",{className:"header-btn-icon",onClick:i,title:"Environment Settings",style:{background:"linear-gradient(135deg, #6366f1, #4f46e5)"},children:""}),h.jsx("button",{className:"header-btn-icon",onClick:o,title:"Home",style:{background:"linear-gradient(135deg, #667eea, #764ba2)"},children:""})]})]}),s&&h.jsxs(h.Fragment,{children:[h.jsx("div",{className:"dropdown-backdrop",onClick:()=>a(!1)}),h.jsxs("div",{className:"dropdown-menu",style:{position:"fixed",top:"56px",left:"12px"},children:[h.jsx("div",{className:"dropdown-item dropdown-header",children:"Puzzle with:"}),h.jsxs("button",{className:"dropdown-item"+(n==="oneOfEach"?" dropdown-item-active":""),onClick:()=>l("oneOfEach"),children:[n==="oneOfEach"?" ":"","Unique pieces"]}),h.jsxs("button",{className:"dropdown-item"+(n==="unlimited"?" dropdown-item-active":""),onClick:()=>l("unlimited"),children:[n==="unlimited"?" ":"","Unlimited pieces"]}),h.jsxs("button",{className:"dropdown-item"+(n==="single"?" dropdown-item-active":""),onClick:()=>l("single"),children:[n==="single"?" ":"","Identical pieces"]}),h.jsxs("button",{className:"dropdown-item"+(n==="customSet"?" dropdown-item-active":""),onClick:()=>l("customSet"),children:[n==="customSet"?" ":"","Custom set (inventory)"]})]})]})]})},kN=({isOpen:n,onClose:e,onViewLeaderboard:t,solveStartTime:r,solveEndTime:i,moveCount:o,pieceCount:s})=>{if(!n)return null;const a=r&&i?Math.floor((i-r)/1e3):null;return h.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #1e88e5, #42a5f5)",color:"white",padding:"32px 40px",borderRadius:"16px",fontSize:"20px",fontWeight:"bold",textAlign:"center",boxShadow:"0 12px 40px rgba(30, 136, 229, 0.5)",zIndex:1001,maxWidth:"400px",minWidth:"320px"},children:[h.jsx("button",{onClick:e,style:{position:"absolute",top:"12px",right:"12px",background:"transparent",border:"none",color:"white",fontSize:"28px",cursor:"pointer",padding:"4px 8px",lineHeight:"1",opacity:.8,fontWeight:"normal"},title:"Close",children:""}),h.jsx("div",{style:{fontSize:"64px",marginBottom:"16px"},children:""}),h.jsx("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#ffffff"},children:"Congratulations!"}),h.jsx("div",{style:{fontSize:"18px",fontWeight:600,marginBottom:"24px",opacity:.95},children:"Puzzle Solved!"}),h.jsxs("div",{style:{fontSize:"15px",fontWeight:"normal",lineHeight:"1.8",textAlign:"left",background:"rgba(0,0,0,0.2)",padding:"20px",borderRadius:"12px",marginBottom:"20px",color:"#ffffff"},children:[h.jsx("div",{style:{marginBottom:"12px",fontSize:"16px",fontWeight:600},children:" Puzzle Complete!"}),h.jsxs("div",{children:[h.jsx("strong",{children:" Date:"})," ",new Date().toLocaleDateString()]}),h.jsxs("div",{children:[h.jsx("strong",{children:" Solve Time:"})," ",a!==null?`${a}s`:"N/A"]}),h.jsxs("div",{children:[h.jsx("strong",{children:" Moves:"})," ",o]}),h.jsxs("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:"1px solid rgba(255,255,255,0.3)"},children:[h.jsx("strong",{children:" Pieces:"})," ",s]})]}),h.jsx("div",{style:{fontSize:"14px",fontWeight:"normal",opacity:.9,padding:"12px",background:"rgba(0,0,0,0.15)",borderRadius:"8px"},children:" Your solution has been automatically saved!"})]})},IN=({isOpen:n,onClose:e,draggableRef:t,draggableStyle:r,onSelectType:i})=>n?h.jsx("div",{onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent",backdropFilter:"none",zIndex:2001},children:h.jsxs("div",{ref:t,onClick:o=>o.stopPropagation(),style:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"white",padding:"32px 40px",borderRadius:"16px",maxWidth:"500px",width:"90%",boxShadow:"0 12px 40px rgba(102, 126, 234, 0.5)",position:"fixed",top:"50%",left:"50%",...r},children:[h.jsx("button",{onClick:e,style:{position:"absolute",top:"12px",right:"12px",background:"transparent",border:"none",color:"white",fontSize:"28px",cursor:"pointer",padding:"4px 8px",lineHeight:"1",opacity:.8,fontWeight:"normal"},title:"Close",children:""}),h.jsx("div",{style:{fontSize:"48px",marginBottom:"16px",textAlign:"center"},children:""}),h.jsx("h2",{style:{fontSize:"28px",fontWeight:700,marginBottom:"8px",textAlign:"center",color:"#ffffff"},children:"Make a Movie"}),h.jsx("p",{style:{fontSize:"16px",fontWeight:400,marginBottom:"24px",textAlign:"center",opacity:.9},children:"Select your movie type"}),h.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[h.jsxs("button",{onClick:()=>i("turntable"),style:{padding:"16px 24px",background:"rgba(255,255,255,0.2)",border:"2px solid rgba(255,255,255,0.4)",color:"white",borderRadius:"10px",fontSize:"18px",fontWeight:600,cursor:"pointer",transition:"all 0.2s ease",textAlign:"left",display:"flex",alignItems:"center",gap:"12px"},onMouseOver:o=>{o.currentTarget.style.background="rgba(255,255,255,0.3)",o.currentTarget.style.transform="translateX(4px)"},onMouseOut:o=>{o.currentTarget.style.background="rgba(255,255,255,0.2)",o.currentTarget.style.transform="translateX(0)"},children:[h.jsx("span",{style:{fontSize:"24px"},children:""}),h.jsx("span",{children:"Turntable"})]}),h.jsxs("button",{onClick:()=>i("reveal"),style:{padding:"16px 24px",background:"rgba(255,255,255,0.2)",border:"2px solid rgba(255,255,255,0.4)",color:"white",borderRadius:"10px",fontSize:"18px",fontWeight:600,cursor:"pointer",transition:"all 0.2s ease",textAlign:"left",display:"flex",alignItems:"center",gap:"12px"},onMouseOver:o=>{o.currentTarget.style.background="rgba(255,255,255,0.3)",o.currentTarget.style.transform="translateX(4px)"},onMouseOut:o=>{o.currentTarget.style.background="rgba(255,255,255,0.2)",o.currentTarget.style.transform="translateX(0)"},children:[h.jsx("span",{style:{fontSize:"24px"},children:""}),h.jsx("span",{children:"Reveal"})]}),h.jsxs("button",{onClick:()=>i("gravity"),style:{padding:"16px 24px",background:"rgba(255,255,255,0.2)",border:"2px solid rgba(255,255,255,0.4)",color:"white",borderRadius:"10px",fontSize:"18px",fontWeight:600,cursor:"pointer",transition:"all 0.2s ease",textAlign:"left",display:"flex",alignItems:"center",gap:"12px"},onMouseOver:o=>{o.currentTarget.style.background="rgba(255,255,255,0.3)",o.currentTarget.style.transform="translateX(4px)"},onMouseOut:o=>{o.currentTarget.style.background="rgba(255,255,255,0.2)",o.currentTarget.style.transform="translateX(0)"},children:[h.jsx("span",{style:{fontSize:"24px"},children:""}),h.jsx("span",{children:"Gravity"})]})]})]})}):null;let Vs={inputX:0,inputY:0,outputX:0,outputY:0,called:!1};const so=20;function ay(n,e,t,r){const i=n.getBoundingClientRect(),o=window.innerWidth,s=window.innerHeight,a=i.width,l=i.height,c=e-r.x,u=t-r.y,d=i.left+c,f=i.top+u,m=so,v=o-a-so,_=so,x=s-l-so,p=Math.max(m,Math.min(v,d)),b=Math.max(_,Math.min(x,f)),g=r.x+(p-i.left),y=r.y+(b-i.top);return Vs={inputX:Math.round(e),inputY:Math.round(t),outputX:Math.round(g),outputY:Math.round(y),called:!0},{x:g,y}}function gc(){const n=S.useRef(null),[e,t]=S.useState(!1),[r,i]=S.useState({x:0,y:0}),o=S.useRef({x:0,y:0}),[s,a]=S.useState(!1),l=S.useRef({x:0,y:0}),[c,u]=S.useState(!1);return S.useEffect(()=>{o.current=r},[r]),S.useEffect(()=>{n.current&&!s?a(!0):!n.current&&s&&a(!1)}),S.useEffect(()=>{const d=n.current;if(!d)return;const f=b=>{const g=d.getBoundingClientRect();b.clientY-g.top>60||(t(!0),i(y=>(l.current={x:b.clientX-y.x,y:b.clientY-y.y},y)),b.preventDefault())},m=b=>{const g=d.getBoundingClientRect(),y=b.touches[0];y.clientY-g.top>60||(t(!0),i(E=>(l.current={x:y.clientX-E.x,y:y.clientY-E.y},E)),b.preventDefault())},v=b=>{if(!e)return;const g=b.clientX-l.current.x,y=b.clientY-l.current.y,E=ay(d,g,y,o.current);i(E)},_=b=>{if(!e)return;const g=b.touches[0],y=g.clientX-l.current.x,E=g.clientY-l.current.y,C=ay(d,y,E,o.current);i(C),b.preventDefault()},x=()=>{t(!1)},p=()=>{t(!1)};return d.addEventListener("mousedown",f),document.addEventListener("mousemove",v),document.addEventListener("mouseup",x),d.addEventListener("touchstart",m,{passive:!1}),document.addEventListener("touchmove",_,{passive:!1}),document.addEventListener("touchend",p),()=>{d.removeEventListener("mousedown",f),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",x),d.removeEventListener("touchstart",m),document.removeEventListener("touchmove",_),document.removeEventListener("touchend",p)}},[e,s]),S.useEffect(()=>{if(!c)return;const d=document.createElement("div");d.id="drag-debug-frame",d.style.cssText=`
      position: fixed;
      top: 10px;
      left: 10px;
      right: 10px;
      bottom: 10px;
      border: 4px solid red;
      pointer-events: none;
      z-index: 99999;
      box-shadow: inset 0 0 0 2px yellow;
    `;const f=document.createElement("div");return f.id="drag-debug-label",f.style.cssText=`
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255,0,0,0.9);
      color: white;
      padding: 8px 12px;
      font-size: 12px;
      font-family: monospace;
      font-weight: bold;
      border-radius: 4px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      max-width: 300px;
      line-height: 1.4;
    `,f.textContent="SAFE BOUNDARY (15px margin)",d.appendChild(f),document.body.appendChild(d),()=>{document.body.removeChild(d)}},[c]),S.useEffect(()=>{if(!c||!n.current)return;const d=document.getElementById("drag-debug-label");if(!d)return;const f=n.current.getBoundingClientRect(),m=window.innerWidth,v=window.innerHeight,_=Math.round(f.width),x=Math.round(f.height),p=Math.round(f.left),b=Math.round(f.top),g=so,y=so,E=m-_-so,C=v-x-so;d.innerHTML=`Screen: ${m}x${v} Modal: ${_}x${x}<br/>
Upper-Left: (${p}, ${b})<br/>
Should be: X[${g}, ${E}] Y[${y}, ${C}]<br/>
Constraint: ${Vs.called?`in(${Vs.inputX},${Vs.inputY})out(${Vs.outputX},${Vs.outputY})`:"NOT CALLED"}`},[c,r,s]),{ref:n,style:{transform:`translate(calc(-50% + ${r.x}px), calc(-50% + ${r.y}px))`,cursor:e?"grabbing":"default"},headerStyle:{cursor:"grab"}}}const Ql=({isOpen:n,onClose:e,title:t,children:r})=>{const i=gc();return n?h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .info-modal-scrollable::-webkit-scrollbar {
          width: 12px;
        }
        .info-modal-scrollable::-webkit-scrollbar-track {
          background: rgba(59, 130, 246, 0.1);
          border-radius: 10px;
          margin: 20px 0;
        }
        .info-modal-scrollable::-webkit-scrollbar-thumb {
          background: linear-gradient(180deg, #3b82f6, #2563eb);
          border-radius: 10px;
          border: 2px solid rgba(219, 234, 254, 0.5);
        }
        .info-modal-scrollable::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(180deg, #2563eb, #1d4ed8);
        }
        .info-modal-scrollable::-webkit-scrollbar-thumb:active {
          background: #1d4ed8;
        }
        .info-modal-scrollable {
          scrollbar-width: thin;
          scrollbar-color: #3b82f6 rgba(59, 130, 246, 0.1);
        }
      `}),h.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent",backdropFilter:"none",zIndex:1e4},onClick:e}),h.jsxs("div",{ref:i.ref,className:"info-modal-scrollable",style:{position:"fixed",top:"50%",left:"50%",background:"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 50%, #93c5fd 100%)",borderRadius:"20px",padding:"0",maxWidth:"600px",width:"90%",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"3px solid rgba(59,130,246,0.6)",zIndex:10001,...i.style},onClick:o=>o.stopPropagation(),children:[h.jsxs("div",{style:{background:"linear-gradient(135deg, #3b82f6, #2563eb, #1d4ed8)",padding:"1.25rem 1.5rem",borderRadius:"17px 17px 0 0",marginBottom:"20px",borderBottom:"3px solid rgba(255,255,255,0.3)",boxShadow:"0 4px 20px rgba(59,130,246,0.4)",position:"relative",userSelect:"none",...i.headerStyle},children:[h.jsx("h3",{style:{margin:0,fontSize:"20px",color:"#fff",fontWeight:700,textShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:t}),h.jsx("button",{onClick:o=>{o.stopPropagation(),e()},onTouchEnd:o=>{o.stopPropagation(),e()},style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255,255,255,0.2)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"20px",color:"#fff",fontWeight:700,transition:"all 0.2s",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},children:""})]}),h.jsx("div",{style:{padding:"0 24px 24px",color:"#1e40af"},children:r}),h.jsx("div",{style:{padding:"0 24px 24px",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"12px"},children:h.jsx("button",{onClick:e,style:{padding:"12px 20px",background:"#fff",border:"2px solid rgba(59,130,246,0.3)",borderRadius:"10px",color:"#1e40af",fontSize:"14px",fontWeight:600,cursor:"pointer",transition:"all 0.2s ease"},children:"Close"})})]})]}):null},gf="contentStudio_v2",vf="contentStudio_presets_v1";class Sw{loadSettings(){try{const e=localStorage.getItem(gf);if(console.log(" Loading settings from localStorage:",e?"found":"not found"),e){const t=JSON.parse(e);console.log(" Parsed settings:",t);const r=this.mergeWithDefaults(t);return console.log(" Merged settings:",r),r}}catch(e){console.warn("Failed to load studio settings:",e)}return console.log(" Using default settings"),{...Ht}}saveSettings(e){try{console.log(" Saving settings to localStorage:",e);const t=JSON.stringify(e);localStorage.setItem(gf,t),console.log(" Settings saved successfully. Size:",t.length,"bytes"),localStorage.getItem(gf)===t?console.log(" Save verified - settings persisted correctly"):console.error(" Save verification failed!")}catch(t){console.error("Failed to save studio settings:",t)}}loadPresets(){try{const e=localStorage.getItem(vf);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load presets:",e)}return[]}savePreset(e,t){try{const r=this.loadPresets(),i=r.findIndex(s=>s.name===e),o={name:e,settings:{...t},createdAt:new Date().toISOString()};i>=0?r[i]=o:r.push(o),localStorage.setItem(vf,JSON.stringify(r))}catch(r){console.error("Failed to save preset:",r)}}deletePreset(e){try{const r=this.loadPresets().filter(i=>i.name!==e);localStorage.setItem(vf,JSON.stringify(r))}catch(t){console.error("Failed to delete preset:",t)}}mergeWithDefaults(e){var t,r,i;return{material:{...Ht.material,...e.material},lights:{...Ht.lights,...e.lights,hdr:(t=e.lights)!=null&&t.hdr?{...Ht.lights.hdr,...e.lights.hdr}:Ht.lights.hdr,shadows:(r=e.lights)!=null&&r.shadows?{...Ht.lights.shadows,...e.lights.shadows}:Ht.lights.shadows,directional:((i=e.lights)==null?void 0:i.directional)??Ht.lights.directional},camera:{...Ht.camera,...e.camera},effect:{...Ht.effect,...e.effect},emptyCells:e.emptyCells?{linkToEnvironment:e.emptyCells.linkToEnvironment??Ht.emptyCells.linkToEnvironment,customMaterial:{...Ht.emptyCells.customMaterial,...e.emptyCells.customMaterial}}:Ht.emptyCells}}async loadSettingsFromDB(e){try{console.log(" Loading settings from DB for user:",e);const{data:t,error:r}=await bt.from("users").select("studio_settings").eq("id",e).single();return r?(console.error(" Failed to load settings from DB:",r),null):t!=null&&t.studio_settings?(console.log(" Settings loaded from DB"),this.mergeWithDefaults(t.studio_settings)):(console.log(" No settings found in DB for user"),null)}catch(t){return console.error(" Error loading settings from DB:",t),null}}async saveSettingsToDB(e,t){try{console.log(" Saving settings to DB for user:",e);const{error:r}=await bt.from("users").update({studio_settings:t}).eq("id",e);return r?(console.error(" Failed to save settings to DB:",r),!1):(console.log(" Settings saved to DB"),!0)}catch(r){return console.error(" Error saving settings to DB:",r),!1}}}const ww=({message:n,type:e="info",onClose:t,duration:r=3e3})=>{S.useEffect(()=>{if(r>0){const s=setTimeout(t,r);return()=>clearTimeout(s)}},[r,t]);const o={info:{background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",icon:""},warning:{background:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",icon:""},error:{background:"linear-gradient(135deg, #fa709a 0%, #fee140 100%)",icon:""},success:{background:"linear-gradient(135deg, #30cfd0 0%, #330867 100%)",icon:""}}[e];return h.jsxs("div",{style:{position:"fixed",top:"80px",left:"50%",transform:"translateX(-50%)",background:o.background,color:"white",padding:"16px 24px",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0,0,0,0.3)",zIndex:1e4,minWidth:"320px",maxWidth:"500px",display:"flex",alignItems:"center",gap:"12px",fontSize:"15px",fontWeight:500,backdropFilter:"blur(10px)",animation:"slideDown 0.3s ease-out",cursor:"pointer"},onClick:t,children:[h.jsx("span",{style:{fontSize:"24px",flexShrink:0},children:o.icon}),h.jsx("div",{style:{flex:1},children:n}),h.jsx("button",{onClick:s=>{s.stopPropagation(),t()},style:{background:"rgba(255,255,255,0.2)",border:"none",color:"white",width:"28px",height:"28px",borderRadius:"50%",cursor:"pointer",fontSize:"18px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,transition:"background 0.2s"},onMouseEnter:s=>s.currentTarget.style.background="rgba(255,255,255,0.3)",onMouseLeave:s=>s.currentTarget.style.background="rgba(255,255,255,0.2)",children:""}),h.jsx("style",{children:`
        @keyframes slideDown {
          from {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
          }
          to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
          }
        }
      `})]})},LN=({isOpen:n,pieces:e,activePiece:t,settings:r=Ht,mode:i,placedCountByPieceId:o,customInventory:s={},onUpdateInventory:a,onSelectPiece:l,onClose:c})=>{const[u,d]=S.useState(0),[f,m]=S.useState(!0),[v,_]=S.useState(null),[x,p]=S.useState([]),[b,g]=S.useState(null),[y,E]=S.useState(null),[C,A]=S.useState(0),[T,w]=S.useState(null),M=[[.5,.5,0,0],[.5,0,.5,0],[0,.5,.5,0],[0,0,0,1]];S.useEffect(()=>{if(!n)return;(async()=>{try{m(!0);const oe=new $g;await oe.load(),_(oe);const pe=e.indexOf(t);d(pe>=0?pe:0)}catch(oe){console.error("Failed to load orientation service:",oe)}finally{m(!1)}})()},[n,t,e]),S.useEffect(()=>{if(!v||!n)return;const X=e[u];if(X)try{const oe=v.getOrientations(X);if(oe.length===0){console.warn(`No orientations for piece ${X}`);return}const pe=oe[0],De=pe.ijkOffsets;let z=0,ve=0,j=0;De.forEach(L=>{z+=L.i,ve+=L.j,j+=L.k});const ne=z/De.length,Ee=ve/De.length,me=j/De.length,te=De.map(L=>({i:L.i-ne,j:L.j-Ee,k:L.k-me})),Pe=vs(te,ms,M,xs);p(te),g(Pe);const je={pieceId:X,orientationId:pe.orientationId,cells:te,anchorSphereIndex:0,uid:`preview-${X}`,placedAt:Date.now()};E(je),A(L=>L+1),console.log(` Preview piece ${X}: ${te.length} cells`)}catch(oe){console.error("Failed to load piece preview:",oe)}},[v,u,e,n]),S.useEffect(()=>{if(C>0&&y&&T){console.log(" Attempting to frame piece in view...");const{camera:X,controls:oe}=T;if(!X||!oe){console.warn(" Camera or controls not available");return}const pe=y.cells;console.log(` Computing bounds for ${pe.length} cells...`);const De=[[.5,.5,0],[.5,0,.5],[0,.5,.5]];let z=1/0,ve=1/0,j=1/0,ne=-1/0,Ee=-1/0,me=-1/0;pe.forEach(Ke=>{const it=De[0][0]*Ke.i+De[0][1]*Ke.j+De[0][2]*Ke.k,N=De[1][0]*Ke.i+De[1][1]*Ke.j+De[1][2]*Ke.k,k=De[2][0]*Ke.i+De[2][1]*Ke.j+De[2][2]*Ke.k;z=Math.min(z,it),ve=Math.min(ve,N),j=Math.min(j,k),ne=Math.max(ne,it),Ee=Math.max(Ee,N),me=Math.max(me,k)});const te=ne-z,Pe=Ee-ve,je=me-j,L=.5,Fe=te+L*2,Re=Pe+L*2,Ne=je+L*2,de=Math.max(Fe,Re,Ne),Se=X.fov*(Math.PI/180),Ue=de/2/Math.tan(Se/2)*1.1,ze=Ue*.75;X.position.set(ze,ze,ze),oe.target.set(0,0,0),oe.enabled=!0,oe.enableRotate=!0,oe.enableZoom=!0,oe.enablePan=!0,oe.update(),console.log(` Camera fitted! Center: (0, 0, 0), Size: ${de.toFixed(2)}, Distance: ${Ue.toFixed(2)}`),console.log(` Camera position: (${X.position.x.toFixed(2)}, ${X.position.y.toFixed(2)}, ${X.position.z.toFixed(2)})`),console.log(` Orbit controls: enabled=${oe.enabled}, rotate=${oe.enableRotate}, zoom=${oe.enableZoom}, pan=${oe.enablePan}`)}},[C,y,T]);const P=S.useCallback(()=>{d(X=>X>0?X-1:e.length-1)},[e.length]),I=S.useCallback(()=>{d(X=>X<e.length-1?X+1:0)},[e.length]);if(S.useEffect(()=>{if(!n)return;const X=oe=>{switch(oe.key){case"ArrowLeft":oe.preventDefault(),P();break;case"ArrowRight":oe.preventDefault(),I();break;case"Escape":oe.preventDefault(),c();break}};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[n,P,I,c]),!n)return null;const D=e[u],$=x.length,W=o[D]??0,H=s[D]??0,Z=i==="customSet"?Math.max(0,H-W):0,F=i==="oneOfEach"?W>0?" Placed":" Available":i==="customSet"?`${W} placed / ${H} available`:`${W} placed`,Y=i==="oneOfEach"?W>0?"#4ade80":"#94a3b8":i==="customSet"&&Z===0?"#ef4444":"#60a5fa";return h.jsx("div",{onClick:c,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(4px)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:h.jsxs("div",{onClick:X=>X.stopPropagation(),style:{width:"90vw",height:"85vh",maxWidth:"1200px",maxHeight:"800px",display:"flex",flexDirection:"column",background:"#000",borderRadius:"12px",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)"},children:[h.jsxs("div",{style:{background:"rgba(20, 20, 25, 0.92)",backdropFilter:"blur(12px) saturate(180%)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",padding:"1rem 1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.02), inset 0 1px 0 rgba(255, 255, 255, 0.05)"},children:[h.jsxs("div",{children:[h.jsxs("div",{style:{color:"#fff",fontSize:"1.5rem",fontWeight:600},children:[" Piece ",D]}),h.jsxs("div",{style:{color:"#999",fontSize:"0.9rem",marginTop:"4px"},children:[" ",$," cells  Standard Koos piece"]})]}),h.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[h.jsx("div",{style:{padding:"0.6rem 1.5rem",fontSize:"0.95rem",fontWeight:600,background:"rgba(255, 255, 255, 0.05)",color:Y,border:`1px solid ${Y}40`,borderRadius:"6px",display:"flex",alignItems:"center",gap:"0.5rem"},children:F}),h.jsx("button",{onClick:c,style:{padding:"0.6rem 1rem",fontSize:"1.1rem",background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.7)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:X=>{X.currentTarget.style.background="rgba(255, 255, 255, 0.15)",X.currentTarget.style.color="#fff"},onMouseOut:X=>{X.currentTarget.style.background="rgba(255, 255, 255, 0.1)",X.currentTarget.style.color="rgba(255, 255, 255, 0.7)"},children:""})]})]}),i==="customSet"&&a&&h.jsxs("div",{style:{background:"rgba(30, 30, 35, 0.95)",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",padding:"1rem 1.5rem"},children:[h.jsx("div",{style:{marginBottom:"0.75rem"},children:h.jsx("div",{style:{color:"#fff",fontSize:"0.95rem",fontWeight:600},children:" Configure Inventory"})}),h.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[h.jsxs("label",{style:{color:"#999",fontSize:"0.85rem",minWidth:"80px"},children:[D,":"]}),h.jsx("button",{onClick:()=>{a({...s,[D]:Math.max(0,H-1)})},disabled:H===0,style:{width:"36px",height:"36px",padding:"0",fontSize:"1.2rem",background:H===0?"rgba(255, 255, 255, 0.05)":"rgba(255, 255, 255, 0.1)",color:H===0?"#666":"#fff",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",cursor:H===0?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:""}),h.jsx("div",{style:{minWidth:"60px",padding:"0.5rem 0.75rem",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.15)",borderRadius:"6px",color:H===99?"#4ade80":"#fff",fontSize:"0.95rem",fontWeight:600,textAlign:"center"},children:H===99?"":H}),h.jsx("button",{onClick:()=>{a({...s,[D]:Math.min(99,H+1)})},disabled:H>=99,style:{width:"36px",height:"36px",padding:"0",fontSize:"1.2rem",background:H>=99?"rgba(255, 255, 255, 0.05)":"rgba(255, 255, 255, 0.1)",color:H>=99?"#666":"#fff",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",cursor:H>=99?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"}),h.jsx("button",{onClick:()=>{a({...s,[D]:99})},style:{padding:"0.5rem 0.75rem",fontSize:"0.85rem",background:H===99?"rgba(74, 222, 128, 0.2)":"rgba(255, 255, 255, 0.1)",color:H===99?"#4ade80":"#fff",border:H===99?"1px solid #4ade80":"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",cursor:"pointer"},children:" Unlimited"}),h.jsxs("div",{style:{color:"#666",fontSize:"0.8rem",marginLeft:"0.25rem"},children:["(",Z," remaining)"]})]})]}),h.jsx("div",{style:{flex:1,position:"relative",background:"#000",minHeight:0,overflow:"hidden",pointerEvents:"auto"},children:f?h.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#fff",fontSize:"1.2rem",zIndex:10,pointerEvents:"none"},children:"Loading pieces..."}):b&&y?h.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"auto"},children:h.jsx(Ba,{cells:[],view:b,visibility:{showSpheres:!0,showBonds:!0,showConvexHull:!1,showShadows:r.lights.shadows.enabled,xray:!1,emptyOnly:!1,sliceY:null},editMode:!1,mode:"add",settings:r,onCellsChange:()=>{},onHoverCell:()=>{},onClickCell:void 0,anchor:null,placedPieces:[y],selectedPieceUid:null,onSelectPiece:()=>{},containerOpacity:0,containerColor:"#ffffff",containerRoughness:.35,puzzleMode:"oneOfEach",onCycleOrientation:void 0,onPlacePiece:void 0,onDeleteSelectedPiece:void 0,drawingCells:[],onDrawCell:void 0,hidePlacedPieces:!1,explosionFactor:0,turntableRotation:0,onInteraction:void 0,onSceneReady:X=>{console.log(" Scene ready, saving scene objects"),w(X)}})}):null}),h.jsxs("div",{style:{background:"rgba(20, 20, 25, 0.92)",backdropFilter:"blur(12px) saturate(180%)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",padding:"1rem 1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 0 0 1px rgba(255, 255, 255, 0.02), inset 0 -1px 0 rgba(255, 255, 255, 0.05)"},children:[h.jsx("button",{onClick:P,style:{padding:"0.75rem 1.5rem",fontSize:"1rem",fontWeight:500,background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:X=>{X.currentTarget.style.background="rgba(255, 255, 255, 0.15)",X.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)",X.currentTarget.style.transform="translateY(-1px)"},onMouseOut:X=>{X.currentTarget.style.background="rgba(255, 255, 255, 0.1)",X.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)",X.currentTarget.style.transform="translateY(0)"},children:" Previous"}),h.jsxs("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.95rem",fontWeight:500},children:[u+1," / ",e.length]}),h.jsx("button",{onClick:I,style:{padding:"0.75rem 1.5rem",fontSize:"1rem",fontWeight:500,background:"rgba(255, 255, 255, 0.1)",color:"rgba(255, 255, 255, 0.9)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:X=>{X.currentTarget.style.background="rgba(255, 255, 255, 0.15)",X.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)",X.currentTarget.style.transform="translateY(-1px)"},onMouseOut:X=>{X.currentTarget.style.background="rgba(255, 255, 255, 0.1)",X.currentTarget.style.borderColor="rgba(255, 255, 255, 0.2)",X.currentTarget.style.transform="translateY(0)"},children:"Next "})]})]})})};function Ew(n,e,t={}){const r=n.cells.length,i=Math.floor(r/4),o=r%4===0,s=new Map;n.cells.forEach((T,w)=>s.set(uy(T),w));const a=DN(e,t.allow),l=NN(t),c=ON({mode:l,allow:a,explicitCounts:t.counts,identicalPieceId:t.identicalPieceId,totalPieces:t.totalPieces??i}),u={},d=Array.from({length:r},()=>0),f=Math.ceil(r/64),m=Array.from({length:r},()=>new Set),v={};for(const T of a)u[T]=0,v[T]=new Set;for(const T of a){const w=e.get(T);if(w)for(const M of w)for(const P of M.cells)for(let I=0;I<r;I++){const D=n.cells[I],$=D[0]-P[0],W=D[1]-P[1],H=D[2]-P[2],Z=new BigUint64Array(f);let F=!0;for(const pe of M.cells){const De=[pe[0]+$,pe[1]+W,pe[2]+H],z=s.get(uy(De));if(z===void 0){F=!1;break}zN(Z,z)}if(!F)continue;const Y=FN(Z),X=`${T}:${M.id}:${Y}`;if(m[I].has(X))continue;m[I].add(X),d[I]++;const oe=v[T];oe.has(Y)||(oe.add(Y),u[T]++)}}const _=dy(Object.values(u)),x=d.length?Math.min(...d):0,p=d.length?Math.max(...d):0,b=d.length?d.reduce((T,w)=>T+w,0)/d.length:0,g=[];o||g.push(`Container has ${r} cells which is not divisible by 4; "piecesNeeded"=${i} is floor(N/4).`);const y=t.totalPieces??i,E=dy(Object.values(c));l!=="unlimited"&&E!==y&&g.push(`Fixed-inventory mode but counts sum to ${E} while totalPieces=${y}. Bounds use your counts as-is.`);const C=UN(c,u,y);let A;if(l==="unlimited"){const T=_,w=Math.max(0,...Object.values(u));A={sumPlacementsPowK:ly(T,y,"( placements)^K (very loose; ignores collisions & repeated-use constraints)"),maxPlacementsPowK:ly(w,y,"(max placements)^K (tighter than sum; still ignores collisions)")}}return{containerCells:r,cellsDivBy4:o,piecesNeeded:i,allow:a,counts:c,mode:l,placementsByPiece:u,totalPlacements:_,placementsPerTarget:{min:x,max:p,avg:b},upperBounds:{fixedInventoryNoOverlap:C,unlimitedNoOverlap:A},warnings:g}}function DN(n,e){const t=[...n.keys()].sort();if(!e||e.length===0)return t;const r=new Set(e);return t.filter(i=>r.has(i))}function NN(n,e){return n.counts&&Object.keys(n.counts).length>0?n.mode??"unique":n.mode?n.mode:n.identicalPieceId?"identical":"unique"}function ON(n){const{mode:e,allow:t,explicitCounts:r,identicalPieceId:i,totalPieces:o}=n;if(r&&Object.keys(r).length>0){const a={};for(const l of t)a[l]=0;for(const[l,c]of Object.entries(r))t.includes(l)&&(a[l]=Math.max(0,Math.floor(c)));return a}const s={};for(const a of t)s[a]=0;if(e==="unique"){for(const a of t)s[a]=1;return s}if(e==="identical"){const a=i??t[0];return a&&t.includes(a)&&(s[a]=Math.max(0,Math.floor(o))),s}return s}function UN(n,e,t){let r=cy(t);for(const i of Object.values(n))r-=cy(i);for(const[i,o]of Object.entries(n)){if(o<=0)continue;const s=e[i]??0;if(s<=0)return{log10:Number.NEGATIVE_INFINITY,sci:"0",note:`0 (piece ${i} has 0 placements but count=${o})`};r+=o*Math.log10(s)}return Mw(r,"(K! /  count!) *  placements(pid)^(count(pid))  [ignores overlap]")}function ly(n,e,t){if(e<=0)return{log10:0,sci:"1",note:t};if(n<=0)return{log10:Number.NEGATIVE_INFINITY,sci:"0",note:t};const r=e*Math.log10(n);return Mw(r,t)}function Mw(n,e){if(!Number.isFinite(n))return{log10:n,sci:"0",note:e};const t=Math.floor(n),i=Math.pow(10,n-t).toFixed(3);return{log10:n,sci:`${i}e${t>=0?"+":""}${t}`,note:e}}function cy(n){if(n<=1)return 0;let e=0;for(let t=2;t<=n;t++)e+=Math.log10(t);return e}function uy(n){return`${n[0]},${n[1]},${n[2]}`}function zN(n,e){const t=e/64|0,r=BigInt(e%64);n[t]|=1n<<r}function FN(n){let e="";for(let t=0;t<n.length;t++)e+=n[t].toString(16)+"|";return e}function dy(n){return n.reduce((e,t)=>e+t,0)}const jN=[[.5,.5,0,0],[.5,0,.5,0],[0,.5,.5,0],[0,0,0,1]],BN=()=>{var fe,ee,Ce,He,Ye,Qe,rt;const n=Jn(),{id:e}=ac(),{puzzle:t,loading:r,error:i}=Vg(e),{service:o,loading:s,error:a}=mc(),[l,c]=S.useState([]),[u,d]=S.useState(null),[f,m]=S.useState(!1),[v,_]=S.useState(null),[x,p]=S.useState(null),[b,g]=S.useState(0),[y,E]=S.useState(0),[C,A]=S.useState(!1),{placed:T,placedCountByPieceId:w,canUndo:M,placePiece:P,deletePieceByUid:I,undo:D,redo:$,resetPlacedState:W}=lw(),[H,Z]=S.useState(null),[F,Y]=S.useState(!1),[X,oe]=S.useState("unknown"),[pe,De]=S.useState([]),[z,ve]=S.useState("K"),[j,ne]=S.useState("oneOfEach"),[Ee,me]=S.useState({}),[te,Pe]=S.useState(!1),[je,L]=S.useState(null),[Fe,Re]=S.useState("info"),[Ne,de]=S.useState(!1),[Se,Ue]=S.useState(0),[ze,Ke]=S.useState(!1),{trackAction:it,actions:N,clearHistory:k}=QD(),{drawingCells:G,drawCell:ue,clearDrawing:Me}=cw({placed:T,onPieceDrawn:Ae=>Q(Ae)}),{hintCells:ge,hintsUsed:$e,handleRequestHint:ke}=xw({puzzle:t,cells:l,mode:j,placed:T,activePiece:z,customInventory:Ee,placedCountByPieceId:w,orientationService:o,placePiece:P,setNotification:L,setNotificationType:Re}),{solvabilityChecksUsed:We,handleRequestSolvability:Je}=yw({puzzle:t,cells:l,mode:j,placed:T,activePiece:z,customInventory:Ee,placedCountByPieceId:w,setSolvableStatus:oe,setNotification:L,setNotificationType:Re,onCheckComplete:Ae=>{Ae===!1&&(D(),L(` Unsolvable Position

The last piece made this puzzle unsolvable, so it has been removed. Try a different placement!`),Re("warning"))}}),_e=S.useCallback(()=>{const Ae=v&&x?x-v:null;return console.log(" Computing solve stats:",{solveStartTime:v,solveEndTime:x,durationMs:Ae,moveCount:b,undoCount:y,hintsUsed:$e,solvabilityChecksUsed:We}),{total_moves:b,undo_count:y,hints_used:$e,solvability_checks_used:We,duration_ms:Ae}},[b,y,$e,We,v,x]),Le=S.useMemo(()=>_e(),[_e]),[qe,re]=S.useState(!1),[ie,we]=S.useState(null);bw({puzzle:t,cells:l,placed:T,solveStartTime:v,moveCount:b,solveActions:N,getSolveStats:()=>Le,setIsComplete:Y,setSolveEndTime:p,setRevealK:Ue,setShowCompletionCelebration:Ke,setCurrentSolutionId:we,setShowSuccessModal:re,setNotification:L,setNotificationType:Re});const[U,se]=S.useState(!1),[he,Oe]=S.useState(!1),[Te,ce]=S.useState(new Set),[K,be]=S.useState(0),[Be,Ze]=S.useState(0),[lt,ut]=S.useState(!1),wt=gc(),mt=Ae=>{if(!t){console.error(" No puzzle available for movie creation");return}if(!ie){console.error(" No solution ID available for movie creation"),L("Please wait for solution to save before creating movie"),Re("warning");return}console.log(" Creating movie with effect:",Ae,"for solution:",ie),ut(!1),re(!1);const ye=`/movies/${Ae}/${ie}?mode=create`;console.log(" Navigating to:",ye),n(ye)},{user:vt}=dc(),St=S.useRef(new Sw),[Yt,Nt]=S.useState(()=>{try{const Ae=localStorage.getItem("contentStudio_v2");if(Ae){const ye=JSON.parse(Ae);if(ye&&typeof ye=="object")return{...Ht,...ye}}}catch(Ae){console.warn(" Failed to load settings from localStorage:",Ae)}return Ht}),[Zt,yn]=S.useState(!1),[ti,ni]=S.useState("metallic-light"),[Fr,ri]=S.useState(!1),[Oi,ii]=S.useState(null),[oi,si]=S.useState(null),R=Yt,B=S.useMemo(()=>({showSpheres:!0,showBonds:!0,showConvexHull:!1,showShadows:R.lights.shadows.enabled,xray:!1,emptyOnly:!1,sliceY:null}),[R.lights.shadows.enabled]);S.useEffect(()=>{vt!=null&&vt.id&&(console.log(" Loading settings from DB for user:",vt.id),St.current.loadSettingsFromDB(vt.id).then(Ae=>{Ae?(console.log(" DB settings loaded, updating state"),Nt(Ae)):console.log(" No DB settings found, keeping current settings")}))},[vt==null?void 0:vt.id]),S.useEffect(()=>{vt!=null&&vt.id&&(console.log(" Settings changed, saving to DB"),St.current.saveSettingsToDB(vt.id,Yt))},[Yt,vt==null?void 0:vt.id]),S.useEffect(()=>{if(!t)return;console.log(" Loading puzzle:",t.name),De(rs),ve(rs[0]);const Ae=t.geometry||[];console.log(" Container geometry:",Ae.length,"cells"),c(Ae);try{const ye=vs(Ae,ms,jN,xs);d(ye),setTimeout(()=>{const Ie=ye.centroid_world||ye.centroidWorld;window.setOrbitTarget&&window.setOrbitTarget(Ie)},100)}catch(ye){console.error(" Failed to compute view transforms:",ye)}m(!0)},[t]),S.useEffect(()=>{new URLSearchParams(window.location.search).get("shared")==="true"&&t&&n(`/gallery?puzzle=${t.id}&shared=true`)},[t,n]),S.useEffect(()=>{if(!t)return;const Ae=new URLSearchParams(window.location.search),ye=Ae.get("from")==="gallery",Ie=document.referrer.includes("/gallery");if(!(!ye&&!Ie)&&(de(!0),ye)){Ae.delete("from");const Ge=Ae.toString()?`${window.location.pathname}?${Ae.toString()}`:window.location.pathname;window.history.replaceState({},"",Ge)}},[t]),S.useEffect(()=>{if(!t||T.size===0){Y(!1),be(0);return}const Ae=T.size===MN;Ae&&!F&&(console.log(" Puzzle complete!"),Ke(!0),setTimeout(()=>Ke(!1),3e3),re(!0)),Y(Ae),be(T.size),Ue(T.size)},[T.size,t,F]);const J=S.useCallback(()=>{if(!H)return;const Ae=I(H);Ae&&(g(ye=>ye+1),E(ye=>ye+1),Z(null),it("REMOVE_PIECE",{pieceId:Ae.pieceId,uid:H}),console.log(" Deleted piece:",H))},[H,I,it]),Q=S.useCallback(Ae=>{if(a){console.error(" Failed to load orientations:",a),L("Failed to load piece orientations"),Re("error");return}if(s||!o){L("Loading piece orientations, please try again in a moment"),Re("info");return}const ye=Vd(Ae,pe,o);if(!ye){L("Shape not recognized - must be a valid Koos piece"),Re("warning");return}const Ie={pieceId:ye.pieceId,orientationId:ye.orientationId,cells:Ae},Ge=w[Ie.pieceId]??0;if(j==="oneOfEach"&&Ge>=1){L(`Piece "${Ie.pieceId}" is already placed in One-of-Each mode`),Re("warning");return}if(j==="customSet"){const st=Ee[Ie.pieceId]??0;if(Math.max(0,st-Ge)<=0){L(`No more "${Ie.pieceId}" pieces available in inventory (${st} total, ${Ge} already placed)`),Re("warning");return}}if(j==="single")if(T.size===0)ve(Ie.pieceId),console.log(` Single mode: First piece set to "${Ie.pieceId}"`);else{const st=Array.from(T.values())[0];if(Ie.pieceId!==st.pieceId){L(`Single Piece mode: Can only place "${st.pieceId}" (first piece placed)`),Re("warning");return}}C||(_(Date.now()),A(!0)),g(st=>st+1);const et=`pp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,Ve={pieceId:Ie.pieceId,orientationId:Ie.orientationId,anchorSphereIndex:0,cells:Ie.cells,uid:et,placedAt:Date.now()};P(Ve),it("PLACE_PIECE",{pieceId:Ie.pieceId,orientation:Ie.orientationId,ijkPosition:Ie.cells[0],cells:Ie.cells,uid:et}),he&&(ce(st=>new Set(st).add(et)),setTimeout(()=>{ce(st=>{const ot=new Set(st);return ot.delete(et),ot})},2e3)),Z(null),L(`Piece ${Ie.pieceId} added!`),Re("success")},[a,s,o,pe,w,j,T,C,he,P,it]),V=S.useCallback((Ae,ye,Ie)=>{if(console.log(" Interaction:",Ae,ye,Ie),Z(Ge=>!Ge||ye!=="single"&&ye!=="double"||Ae==="piece"&&Ie===Ge?Ge:null),Ae==="cell"){ye==="single"?G.length>0&&Me():ye==="double"&&ue(Ie);return}if(Ae==="piece"){const Ge=typeof Ie=="string"?Ie:Ie==null?void 0:Ie.uid;if(ye==="single")G.length>0&&Me(),Z(Ge===H?null:Ge);else if(ye==="double"||ye==="long"){if(Ge===H){J();return}const et=Ie==null?void 0:Ie.emptyCellUnderCursor;et&&ue(et)}return}if(Ae==="background"){ye==="single"&&(Z(null),Me());return}},[H,J,G,ue,Me]),O=S.useCallback(()=>{D(),E(Ae=>Ae+1),H&&Z(null)},[D,H]);S.useCallback(()=>{$(),H&&Z(null)},[$,H]),S.useEffect(()=>{oe("unknown")},[T]);const q=S.useMemo(()=>CN(l,T),[l,T]),le=S.useMemo(()=>TN(l.length,pe.length),[l.length,pe.length]);S.useEffect(()=>{!f||l.length===0||qg().then(Ae=>{console.log(" [ManualSolvePage] Pieces database loaded"),ii(Ae);try{const ye=l.map(Ge=>[Ge.i,Ge.j,Ge.k]),Ie=Ew({cells:ye,id:t==null?void 0:t.id},Ae,{mode:j==="oneOfEach"?"unique":j==="unlimited"?"unlimited":"unique",allow:pe,totalPieces:Math.floor(l.length/4)});console.log(" [ManualSolvePage] Search space stats computed:",Ie.upperBounds.fixedInventoryNoOverlap.sci),si(Ie)}catch(ye){console.error(" Failed to compute search space stats:",ye)}}).catch(Ae=>{console.error(" Failed to load pieces database:",Ae)})},[f,l,pe,t==null?void 0:t.id,j]),S.useEffect(()=>{if(!pe.length||!l.length)return;const Ae=Math.floor(l.length/4),ye={};switch(j){case"oneOfEach":pe.slice(0,Ae).forEach(Ie=>ye[Ie]=1),pe.slice(Ae).forEach(Ie=>ye[Ie]=0);break;case"unlimited":pe.forEach(Ie=>ye[Ie]=99);break;case"single":pe.forEach(Ie=>ye[Ie]=Ie==="A"?1:0);break;case"customSet":pe.forEach(Ie=>ye[Ie]=0);break}me(ye),console.log(` Mode changed to "${j}", inventory initialized:`,ye)},[j,pe,l.length]);const xe=S.useCallback(async()=>{if(!o){L("Hint engine is still initializing. Please try again."),Re("info");return}Me(),await ke(G)},[L,Re,o,Me,ke,G]);return S.useCallback(()=>{confirm("Reset puzzle? This will clear all placed pieces.")&&(W(),Z(null),g(0),E(0),_(null),p(null),A(!1),Y(!1),k(),console.log(" Puzzle reset"))},[k,W]),S.useEffect(()=>{console.log(" Mode changed  resetting puzzle state for mode:",j),W(),Z(null),Me(),g(0),E(0),_(null),p(null),A(!1),Y(!1)},[j,W,Me]),S.useEffect(()=>{pe.length>0&&ve(pe[0])},[pe]),S.useEffect(()=>{const Ae=ye=>{U||Fr||(ye.key==="Escape"&&(H&&(Z(null),ye.preventDefault()),G.length>0&&(Me(),ye.preventDefault())),(ye.key==="Delete"||ye.key==="Backspace")&&H&&(J(),ye.preventDefault()),ye.key==="z"&&(ye.ctrlKey||ye.metaKey)&&!ye.shiftKey&&(O(),ye.preventDefault()))};return window.addEventListener("keydown",Ae),()=>window.removeEventListener("keydown",Ae)},[U,Fr,H,G,Me,J,O]),r?h.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:h.jsx("p",{children:"Loading puzzle..."})}):i||!t?h.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[h.jsxs("p",{children:["Error loading puzzle: ",i]}),h.jsx("button",{onClick:()=>n("/gallery"),className:"btn",children:"Back to Gallery"})]}):h.jsxs("div",{style:{height:"100vh",width:"100vw",position:"fixed",top:0,left:0,right:0,bottom:0,overflow:"hidden",background:"linear-gradient(to bottom, #0a0a0a 0%, #000000 100%)"},children:[h.jsx(PN,{mode:j,onOpenPieces:()=>se(!0),onChangeMode:ne,onOpenAboutPuzzle:()=>de(!0),onOpenSettings:()=>yn(!0),onGoHome:()=>n("/")}),h.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:[f&&u?h.jsx(Ba,{cells:l,view:u,editMode:!1,mode:"add",onCellsChange:()=>{},containerOpacity:((ee=(fe=R.emptyCells)==null?void 0:fe.customMaterial)==null?void 0:ee.opacity)??1,containerColor:((He=(Ce=R.emptyCells)==null?void 0:Ce.customMaterial)==null?void 0:He.color)??"#888888",containerRoughness:(Ye=R.emptyCells)!=null&&Ye.linkToEnvironment?R.material.roughness:((rt=(Qe=R.emptyCells)==null?void 0:Qe.customMaterial)==null?void 0:rt.roughness)??.35,puzzleMode:j==="customSet"?"oneOfEach":j,placedPieces:Array.from(T.values()),selectedPieceUid:H,onSelectPiece:Z,onDeleteSelectedPiece:J,drawingCells:G,hidePlacedPieces:he,temporarilyVisiblePieces:Te,explosionFactor:Be,turntableRotation:0,settings:R,visibility:B,onInteraction:V,onSceneReady:()=>{},hintCells:ge}):h.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading 3D scene..."}),G.length>0&&h.jsxs("div",{style:{position:"absolute",top:70,left:"50%",transform:"translateX(-50%)",background:"rgba(255, 200, 0, 0.9)",color:"#000",padding:"10px 20px",borderRadius:"6px",fontSize:"14px",fontWeight:"bold",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",zIndex:1e3},children:[" Drawing ",G.length,"/4 cells - Double-click adjacent cells | Single click to cancel"]})]}),h.jsxs("div",{style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"12px",alignItems:"center",zIndex:1e3},children:[h.jsx("button",{onClick:O,disabled:!M,title:"Undo last move (Ctrl+Z)",style:{background:M?"linear-gradient(135deg, #8b5cf6, #7c3aed)":"#6b7280",color:"#fff",fontWeight:700,border:"none",fontSize:"20px",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",cursor:M?"pointer":"not-allowed",transition:"all 0.2s ease",opacity:M?1:.5},children:""}),h.jsx("button",{onClick:()=>Oe(Ae=>!Ae),title:he?"Show placed pieces":"Hide placed pieces",style:{background:he?"linear-gradient(135deg, #ef4444, #dc2626)":"linear-gradient(135deg, #10b981, #059669)",color:"#fff",fontWeight:700,border:"none",fontSize:"20px",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",cursor:"pointer",transition:"all 0.2s ease"},children:he?"":""}),h.jsx("button",{onClick:xe,title:"Get a hint",style:{background:"linear-gradient(135deg, #f59e0b, #d97706)",color:"#fff",fontWeight:700,border:"none",fontSize:"20px",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",cursor:"pointer",transition:"all 0.2s ease"},children:""}),h.jsx("button",{onClick:Je,title:"Check solvability",style:{background:X==="solvable"?"#16a34a":X==="unsolvable"?"#dc2626":"#f97316",color:"#fff",fontWeight:700,border:"none",fontSize:"20px",width:"48px",height:"48px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.4)",cursor:"pointer",transition:"all 0.2s ease"},children:"?"})]}),h.jsx(LN,{isOpen:U,onClose:()=>se(!1),pieces:pe,activePiece:z,settings:R,mode:j,placedCountByPieceId:w,customInventory:Ee,onUpdateInventory:me,onSelectPiece:()=>{}}),h.jsx(Hd,{isOpen:Zt,currentPreset:ti,onClose:()=>yn(!1),onSelectPreset:(Ae,ye)=>{Nt(Ae),ni(ye),St.current.saveSettings(Ae)}}),h.jsx(Ql,{isOpen:Fr,onClose:()=>ri(!1),title:"How to puzzle",children:h.jsx(RN,{})}),h.jsx(Ql,{isOpen:Ne,onClose:()=>de(!1),title:t!=null&&t.name?`About "${t.name}"`:"About this puzzle",children:h.jsx(AN,{puzzle:t,mode:j,cellsCount:l.length,pieces:pe,placedCount:T.size,emptyCellsCount:q.length,complexity:le,searchSpaceStats:oi,onOpenHowTo:()=>{de(!1),ri(!0)}})}),h.jsx(kN,{isOpen:qe,onClose:()=>re(!1),onViewLeaderboard:()=>{re(!1),n(`/leaderboards/${t==null?void 0:t.id}`)},solveStartTime:v,solveEndTime:x,moveCount:b,pieceCount:T.size}),h.jsx(IN,{isOpen:lt,onClose:()=>ut(!1),draggableRef:wt.ref,draggableStyle:wt.style,onSelectType:mt}),je&&h.jsx(ww,{message:je,type:Fe,onClose:()=>L(null),duration:3e3}),ze&&h.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"4rem",zIndex:999,animation:"bounce 0.5s",pointerEvents:"none"},children:""})]})},HN="#d4af37",WN="#c0c0c0";function VN(){return[{id:"gold",name:"You",color:HN,isComputer:!1},{id:"silver",name:"Computer",color:WN,isComputer:!0}]}function hy(){const n=VN(),e={},t={};for(const r of n)e[r.id]=0,t[r.id]={hintsUsed:0,solvabilityChecksUsed:0};return{players:n,currentPlayerIndex:0,scores:e,stats:t,events:[],isComplete:!1,winnerId:void 0,endReason:void 0}}function $N(n){const[e,t]=S.useState(null);S.useEffect(()=>{n&&t(hy())},[n]);const r=S.useCallback((u,d,f)=>{t(m=>{if(!m)return m;const v=m.events.length,_={id:`evt-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,turnIndex:v,playerId:u,type:d,timestamp:Date.now(),payload:f};return{...m,events:[...m.events,_]}})},[]),i=S.useCallback((u,d)=>{t(f=>{if(!f)return f;const m={...f.scores};return m[u]=(m[u]??0)+d,{...f,scores:m}})},[]),o=S.useCallback(()=>{t(u=>{if(!u)return u;const d=(u.currentPlayerIndex+1)%u.players.length;return{...u,currentPlayerIndex:d}})},[]),s=S.useCallback(u=>{t(d=>{if(!d)return d;const f={...d.stats},m=f[u]??{hintsUsed:0,solvabilityChecksUsed:0};return f[u]={...m,hintsUsed:m.hintsUsed+1},{...d,stats:f}})},[]),a=S.useCallback(u=>{t(d=>{if(!d)return d;const f={...d.stats},m=f[u]??{hintsUsed:0,solvabilityChecksUsed:0};return f[u]={...m,solvabilityChecksUsed:m.solvabilityChecksUsed+1},{...d,stats:f}})},[]),l=S.useCallback(u=>{t(d=>{var v;if(!d||d.isComplete)return d;let f;const m=Object.entries(d.scores);return m.length&&(m.sort((_,x)=>x[1]-_[1]),m[0][1]>(((v=m[1])==null?void 0:v[1])??-1/0)?f=m[0][0]:f=void 0),{...d,isComplete:!0,winnerId:f,endReason:u}})},[]),c=S.useCallback(()=>{t(hy())},[]);return{session:e,logEvent:r,applyScoreDelta:i,advanceTurn:o,resetSession:c,incrementHintsUsed:s,incrementSolvabilityChecks:a,endGame:l}}function GN({session:n,logEvent:e,applyScoreDelta:t,advanceTurn:r,incrementHintsUsed:i,incrementSolvabilityChecks:o}){const s=S.useCallback(()=>n?n.players[n.currentPlayerIndex].id:null,[n]),a=S.useCallback(d=>{const f=s();if(!f)return;const m=(d==null?void 0:d.source)==="human_hint";e(f,"place_piece",d),m||(t(f,1),r())},[s,t,e,r]),l=S.useCallback(d=>{const f=s();f&&(e(f,"remove_piece",d),r())},[s,e,r]),c=S.useCallback(d=>{const f=s();f&&(e(f,"hint",d),i(f),r())},[s,e,i,r]),u=S.useCallback(d=>{const f=s();if(!f)return;const m=d==null?void 0:d.isSolvable;e(f,"check_solvability",{...d,isSolvable:m}),o(f),m===!0&&r()},[s,e,o,r]);return{handlePlacePiece:a,handleRemovePiece:l,handleHint:c,handleSolvabilityCheck:u}}const XN=[[.5,.5,0,0],[.5,0,.5,0],[0,.5,.5,0],[0,0,0,1]];function YN(n){const[e,t]=S.useState([]),[r,i]=S.useState(null),[o,s]=S.useState(!1);return S.useEffect(()=>{if(!n)return;const a=n.geometry||[];t(a);try{const l=vs(a,ms,XN,xs);i(l),setTimeout(()=>{const c=l.centroid_world||l.centroidWorld;window.setOrbitTarget&&c&&window.setOrbitTarget(c)},100)}catch(l){console.error(" Failed to compute view transforms (game):",l)}s(!0)},[n]),{cells:e,view:r,loaded:o}}const qN=({puzzle:n,placedPieces:e,drawingCells:t,computerDrawingCells:r,selectedPieceUid:i,hidePlacedPieces:o,isHumanTurn:s,isGameComplete:a,hintCells:l,onInteraction:c})=>{var _,x,p,b,g,y,E;const{cells:u,view:d,loaded:f}=YN(n),[m]=S.useState(()=>{try{const C=localStorage.getItem("contentStudio_v2");if(C){const A=JSON.parse(C);if(A&&typeof A=="object")return{...Ht,...A}}}catch(C){console.warn(" Failed to load env settings for vs mode:",C)}return Ht}),v={showSpheres:!0,showBonds:!0,showConvexHull:!1,showShadows:m.lights.shadows.enabled,xray:!1,emptyOnly:!1,sliceY:null};return!f||!d?h.jsx("div",{style:{position:"fixed",top:"56px",left:0,right:0,bottom:0},children:h.jsx("div",{style:{padding:"1rem",textAlign:"center",fontSize:"0.9rem",opacity:.8},children:"Loading 3D board..."})}):h.jsxs("div",{style:{position:"fixed",top:"56px",left:0,right:0,bottom:0},children:[!s&&!a&&h.jsx("div",{className:"vs-board-overlay",children:h.jsx("span",{children:"Computer's turn"})}),h.jsx(Ba,{layout:"embedded",cells:u,view:d,editMode:!1,mode:"add",onCellsChange:()=>{},containerOpacity:((x=(_=m.emptyCells)==null?void 0:_.customMaterial)==null?void 0:x.opacity)??1,containerColor:((b=(p=m.emptyCells)==null?void 0:p.customMaterial)==null?void 0:b.color)??"#888888",containerRoughness:(g=m.emptyCells)!=null&&g.linkToEnvironment?m.material.roughness:((E=(y=m.emptyCells)==null?void 0:y.customMaterial)==null?void 0:E.roughness)??.35,puzzleMode:"oneOfEach",placedPieces:e,selectedPieceUid:i,onSelectPiece:()=>{},onDeleteSelectedPiece:()=>{},drawingCells:t,computerDrawingCells:r,hidePlacedPieces:o,temporarilyVisiblePieces:new Set,explosionFactor:0,turntableRotation:0,settings:m,visibility:v,onInteraction:c,onSceneReady:()=>{},hintCells:l})]})},KN=({session:n,isOpen:e,onClose:t,onPlayAgain:r,puzzleName:i})=>{if(!e)return null;const o=n.winnerId,s=o?n.players.find(f=>f.id===o):null,a=n.players.find(f=>!f.isComputer),l=a&&s&&s.id===a.id,c=!s;let u="",d="";return l?(u="",d="Victory!"):c?(u="",d="Draw!"):(u="",d="Good game!"),h.jsx("div",{className:"vs-result-backdrop",onClick:f=>f.stopPropagation(),children:h.jsxs("div",{className:"vs-result-modal",children:[h.jsx("div",{style:{fontSize:"3rem",marginBottom:"0.5rem"},children:u}),h.jsx("h2",{className:"vs-result-title",children:s?`${s.name} wins!`:"It's a draw!"}),h.jsx("p",{style:{fontSize:"1.1rem",color:"#a0a0a0",marginTop:"0.25rem"},children:d}),i&&h.jsxs("p",{className:"vs-result-subtitle",children:["Puzzle: ",i]}),h.jsx("div",{className:"vs-result-scores",children:n.players.map(f=>{var m,v;return h.jsxs("div",{className:"vs-result-card",children:[h.jsx("div",{className:"vs-result-name",children:f.name}),h.jsxs("div",{className:"vs-result-score",children:["Score: ",n.scores[f.id]??0]}),h.jsxs("div",{className:"vs-result-stats",children:["Hints: ",((m=n.stats[f.id])==null?void 0:m.hintsUsed)??0,"  Checks:"," ",((v=n.stats[f.id])==null?void 0:v.solvabilityChecksUsed)??0]})]},f.id)})}),h.jsxs("div",{className:"vs-result-actions",children:[h.jsx("button",{type:"button",className:"btn",onClick:f=>{f.stopPropagation(),r()},children:" Play again"}),h.jsx("button",{type:"button",className:"btn",onClick:f=>{f.stopPropagation(),t()},children:" Close"})]})]})})},JN=({isOpen:n,onClose:e})=>h.jsx(Ql,{isOpen:n,onClose:e,title:"How to Play",children:h.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:1.6},children:[h.jsx("p",{style:{marginTop:0},children:h.jsx("strong",{children:"Placing a Piece"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Valid placement: +1 point, turn ends."}),h.jsx("p",{style:{marginTop:"1rem"},children:h.jsx("strong",{children:"Using a Hint ( button)"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Click the lightbulb button to get a hint."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Piece may be placed for you."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" No points, and your turn ends."}),h.jsx("p",{style:{marginTop:"1rem"},children:h.jsx("strong",{children:"Hide/Show Placed Pieces (/ button)"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Toggle visibility of already-placed pieces."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Useful for seeing the empty container structure."}),h.jsx("p",{style:{marginTop:"1rem"},children:h.jsx("strong",{children:"Removing a Piece"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" No points, turn ends."}),h.jsx("p",{style:{marginTop:"1rem"},children:h.jsx("strong",{children:"Checking Solvability (? button)"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Click the question mark button to verify if the puzzle can still be solved."}),h.jsxs("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:["If the puzzle is ",h.jsx("em",{children:"still solvable"}),"  you were wrong; turn ends."]}),h.jsxs("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:["If the puzzle is ",h.jsx("em",{children:"not solvable"}),"  last piece is removed; you keep your turn."]}),h.jsx("p",{style:{marginTop:"0.5rem",marginLeft:"1rem",fontStyle:"italic"},children:"Solvability checks are a strategic risk: call it right, keep your turn; call it wrong, lose it."}),h.jsxs("p",{style:{marginTop:"1rem"},children:[h.jsx("strong",{children:"Goal:"})," Highest score when the puzzle is completed."]}),h.jsx("hr",{style:{margin:"1.5rem 0",border:"none",borderTop:"1px solid rgba(59, 130, 246, 0.3)"}}),h.jsx("p",{style:{marginTop:"1rem"},children:h.jsx("strong",{children:"How to Place, Select, and Delete Pieces"})}),h.jsx("p",{style:{marginTop:"0.75rem",marginLeft:"0"},children:h.jsx("strong",{style:{fontSize:"0.85rem"},children:"Placing a Piece:"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:"1. Click on an empty cell in the container to start drawing."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:"2. Continue clicking adjacent cells to define the shape."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:"3. The system will automatically match your drawn shape to a valid piece and place it."}),h.jsx("p",{style:{marginTop:"0.75rem",marginLeft:"0"},children:h.jsx("strong",{style:{fontSize:"0.85rem"},children:"Selecting a Piece:"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Single-click on any placed piece to select it."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Selected pieces are highlighted."}),h.jsx("p",{style:{marginTop:"0.75rem",marginLeft:"0"},children:h.jsx("strong",{style:{fontSize:"0.85rem"},children:"Deleting a Piece:"})}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Double-click on a placed piece to remove it."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Or: Select the piece (single-click), then click the delete/trash button."}),h.jsx("p",{style:{marginTop:"0.25rem",marginLeft:"1rem"},children:" Remember: Deleting a piece uses your turn but gives no points."})]})}),ZN=({onReset:n,onHowToPlay:e,onBackToHome:t})=>h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .vs-header {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          height: 56px;
          background: linear-gradient(180deg, rgba(0,0,0,0.98) 0%, rgba(0,0,0,0.95) 100%);
          border-bottom: 1px solid rgba(255, 255, 255, 0.08);
          backdrop-filter: blur(10px);
          display: flex;
          align-items: center;
          padding: 0 12px;
          gap: 12px;
          z-index: 1000;
        }
        
        .vs-header-left {
          display: flex;
          gap: 8px;
          align-items: center;
          flex: 1;
          justify-content: flex-start;
        }
        
        .vs-header-right {
          display: flex;
          gap: 8px;
          align-items: center;
          justify-content: flex-end;
        }
        
        .vs-header-btn {
          background: rgba(255,255,255,0.08);
          color: #fff;
          border: none;
          padding: 8px 12px;
          border-radius: 8px;
          font-size: 22px;
          cursor: pointer;
          white-space: nowrap;
          display: flex;
          align-items: center;
          justify-content: center;
          min-width: 40px;
          transition:
            background 0.18s ease,
            box-shadow 0.18s ease,
            transform 0.12s ease;
        }
        
        .vs-header-btn:hover {
          background: rgba(255,255,255,0.16);
          box-shadow: 0 2px 6px rgba(0,0,0,0.35);
          transform: translateY(-1px);
        }

        .vs-header-btn:active {
          transform: translateY(0);
          box-shadow: 0 1px 3px rgba(0,0,0,0.4);
        }
        
        .vs-header-btn-check {
          padding: 8px 10px;
          min-width: 36px;
        }
        
        .vs-header-btn-reset {
          background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .vs-header-btn-reset:hover {
          background: linear-gradient(135deg, #f87171, #ef4444);
        }
        
        .vs-header-btn-info {
          background: rgba(59, 130, 246, 0.15);
        }
        
        .vs-header-btn-info:hover {
          background: rgba(59, 130, 246, 0.25);
        }
        
        .vs-header-btn-home {
          background: rgba(255,255,255,0.08);
        }
        
        .vs-header-btn-home:hover {
          background: rgba(255,255,255,0.16);
        }
        
      `}),h.jsxs("header",{className:"vs-header",children:[h.jsx("div",{className:"vs-header-left",children:h.jsx("button",{className:"vs-header-btn vs-header-btn-reset",onClick:n,title:"Reset game",children:""})}),h.jsxs("div",{className:"vs-header-right",children:[h.jsx("button",{className:"vs-header-btn vs-header-btn-info",onClick:e,title:"How to Play",children:""}),h.jsx("button",{className:"vs-header-btn vs-header-btn-home",onClick:t,title:"Home",children:""})]})]})]}),QN=({hidePlaced:n,onToggleHidePlaced:e,onHint:t,onSolvability:r,solvableStatus:i})=>h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .vs-bottom-controls {
          position: fixed;
          bottom: 20px;
          left: 50%;
          transform: translateX(-50%);
          display: flex;
          gap: 12px;
          align-items: center;
          z-index: 1000;
          background: rgba(0, 0, 0, 0.85);
          backdrop-filter: blur(10px);
          padding: 12px 20px;
          border-radius: 16px;
          border: 1px solid rgba(255, 255, 255, 0.1);
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }
        
        .vs-control-btn {
          background: rgba(255, 255, 255, 0.1);
          color: #fff;
          border: none;
          padding: 10px 16px;
          border-radius: 10px;
          font-size: 24px;
          cursor: pointer;
          white-space: nowrap;
          display: flex;
          align-items: center;
          justify-content: center;
          min-width: 48px;
          min-height: 48px;
          transition:
            background 0.18s ease,
            box-shadow 0.18s ease,
            transform 0.12s ease;
        }
        
        .vs-control-btn:hover {
          background: rgba(255, 255, 255, 0.2);
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
          transform: translateY(-2px);
        }

        .vs-control-btn:active {
          transform: translateY(0);
          box-shadow: 0 1px 4px rgba(0, 0, 0, 0.5);
        }
        
        .vs-control-btn-check {
          padding: 10px 14px;
          min-width: 44px;
        }
        
        @media (max-width: 600px) {
          .vs-bottom-controls {
            padding: 10px 16px;
            gap: 10px;
          }
          
          .vs-control-btn {
            min-width: 44px;
            min-height: 44px;
            padding: 8px 12px;
            font-size: 22px;
          }
        }
      `}),h.jsxs("div",{className:"vs-bottom-controls",children:[h.jsx("button",{className:"vs-control-btn",onClick:e,title:n?"Show placed pieces":"Hide placed pieces",children:n?"":""}),h.jsx("button",{className:"vs-control-btn",onClick:t,title:"Get a hint",children:""}),h.jsx("button",{className:"vs-control-btn vs-control-btn-check",onClick:r,title:"Check if this position can still be solved",style:{background:i==="solvable"?"#16a34a":i==="unsolvable"?"#dc2626":"#f97316"},children:"?"})]})]}),eO=({userScore:n,computerScore:e})=>h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .floating-score {
          position: fixed;
          top: 72px;
          left: 50%;
          transform: translateX(-50%);
          z-index: 100;
          background: rgba(0, 0, 0, 0.75);
          backdrop-filter: blur(10px);
          border: 2px solid rgba(255, 255, 255, 0.15);
          border-radius: 12px;
          padding: 12px 24px;
          box-shadow: 
            0 4px 12px rgba(0, 0, 0, 0.5),
            0 0 0 1px rgba(0, 0, 0, 0.2),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
          pointer-events: none;
          user-select: none;
        }
        
        .floating-score-content {
          font-size: 18px;
          font-weight: 700;
          color: #fff;
          white-space: nowrap;
          text-shadow: 
            0 2px 4px rgba(0, 0, 0, 0.8),
            0 1px 2px rgba(0, 0, 0, 0.9);
          letter-spacing: 0.5px;
        }
        
        .floating-score-content .user-score {
          color: #10b981;
          text-shadow: 
            0 0 10px rgba(16, 185, 129, 0.5),
            0 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        .floating-score-content .computer-score {
          color: #ef4444;
          text-shadow: 
            0 0 10px rgba(239, 68, 68, 0.5),
            0 2px 4px rgba(0, 0, 0, 0.8);
        }
        
        .floating-score-content .separator {
          color: rgba(255, 255, 255, 0.6);
          margin: 0 8px;
        }
        
        @media (max-width: 768px) {
          .floating-score {
            top: 64px;
            padding: 10px 20px;
          }
          
          .floating-score-content {
            font-size: 16px;
          }
        }
      `}),h.jsx("div",{className:"floating-score",children:h.jsxs("div",{className:"floating-score-content",children:[h.jsxs("span",{className:"user-score",children:["You ",n]}),h.jsx("span",{className:"separator",children:""}),h.jsxs("span",{className:"computer-score",children:[e," Computer"]})]})})]}),tO=({isOpen:n,onToggle:e,children:t})=>h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .chat-drawer-container {
          position: fixed;
          top: 56px; /* Below header */
          bottom: 0; /* To bottom of viewport */
          right: 0;
          width: 320px;
          background: linear-gradient(180deg, rgba(0,0,0,0.98) 0%, rgba(0,0,0,0.95) 100%);
          border-left: 1px solid rgba(255, 255, 255, 0.08);
          backdrop-filter: blur(10px);
          transform: translateX(${n?"0":"100%"});
          transition: transform 0.3s ease;
          z-index: 999;
          display: flex;
          flex-direction: column;
          overflow: visible; /* Allow toggle button to show outside */
        }
        
        .chat-drawer-toggle {
          position: absolute;
          top: 16px;
          left: -44px;
          transform: translateY(0);
          background: linear-gradient(135deg, #8b5cf6, #7c3aed);
          color: #fff;
          border: none;
          padding: 12px 8px;
          border-radius: 8px 0 0 8px;
          cursor: pointer;
          font-size: 18px;
          writing-mode: vertical-rl;
          text-orientation: mixed;
          z-index: 1000;
          transition: background 0.2s ease;
          box-shadow: -2px 0 8px rgba(0,0,0,0.3);
        }
        
        .chat-drawer-toggle:hover {
          background: linear-gradient(135deg, #a78bfa, #8b5cf6);
        }
        
        .chat-drawer-content {
          flex: 1;
          overflow-y: auto;
          overflow-x: hidden;
          position: relative;
        }
        
        @media (max-width: 768px) {
          .chat-drawer-container {
            width: 100%;
            max-width: 320px;
          }
        }
      `}),h.jsxs("div",{className:"chat-drawer-container",children:[h.jsx("button",{className:"chat-drawer-toggle",onClick:()=>e(!n),title:n?"Close chat":"Open chat",children:n?" Close":" Chat"}),h.jsx("div",{className:"chat-drawer-content",children:t})]})]}),nO=["","","","",""],rO=({messages:n,isSending:e,onSendMessage:t,onSendEmoji:r})=>{const[i,o]=S.useState(""),s=S.useRef(null);S.useEffect(()=>{s.current&&(s.current.scrollTop=s.current.scrollHeight)},[n,e]);const a=l=>{l.preventDefault(),i.trim()&&(t(i),o(""))};return h.jsxs("section",{className:"vs-chat-panel",children:[h.jsxs("header",{className:"vs-chat-header",children:[h.jsxs("div",{children:[h.jsx("div",{className:"vs-chat-title",children:"Game chat"}),h.jsx("div",{className:"vs-chat-subtitle",children:"Talk with your AI opponent while you play."})]}),e&&h.jsxs("div",{className:"vs-chat-status",children:["Thinking",h.jsx("span",{className:"vs-chat-dot",children:""})]})]}),h.jsx("div",{className:"vs-chat-body",ref:s,children:n.length===0?h.jsx("div",{className:"vs-chat-empty",children:"No messages yet. Say hi "}):n.map(l=>h.jsx("div",{className:l.role==="user"?"vs-chat-message vs-chat-message-user":"vs-chat-message vs-chat-message-ai",children:h.jsx("div",{className:"vs-chat-bubble",children:l.content})},l.id))}),h.jsx("div",{className:"vs-chat-quick",children:nO.map(l=>h.jsx("button",{type:"button",className:"vs-chat-emoji",onClick:()=>r(l),children:l},l))}),h.jsxs("form",{className:"vs-chat-input-row",onSubmit:a,children:[h.jsx("input",{type:"text",className:"vs-chat-input",placeholder:"Send a short message or emoji to your opponent",value:i,onChange:l=>o(l.target.value)}),h.jsx("button",{type:"submit",className:"btn vs-chat-send",children:"Send"})]})]})};function iO(n={}){const{onPiecePlaced:e,onPieceRemoved:t,isHumanTurn:r=!0,hintInProgressRef:i}=n,{placed:o,placedCountByPieceId:s,placePiece:a,deletePieceByUid:l,undo:c,resetPlacedState:u}=lw(),[d,f]=S.useState(null),[m,v]=S.useState([]),[_,x]=S.useState(!1),{service:p,loading:b,error:g}=mc(),y=rs,E=S.useCallback(W=>{if(g){console.error(" Failed to load orientations:",g);return}if(b||!p){console.log(" Orientation service still loading, try again...");return}const H=Vd(W,y,p);if(!H){console.log(" Shape not recognized - must be a valid Koos piece");return}const{pieceId:Z,orientationId:F}=H;if((s[Z]??0)>=1){console.log(` Piece "${Z}" is already placed in One-of-Each mode`);return}const X=`pp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,oe={pieceId:Z,orientationId:F,anchorSphereIndex:0,cells:W,uid:X,placedAt:Date.now(),reason:"user"};a(oe),e&&e({pieceId:Z,orientationId:F,cells:W})},[g,b,p,y,s,a,e]),{drawingCells:C,drawCell:A,clearDrawing:T}=cw({placed:o,onPieceDrawn:E}),w=S.useCallback((W,H)=>{if(i!=null&&i.current&&H!=="hintCommit")return console.warn(" BLOCKED placement during hintInProgress",{reason:H,pieceId:W.pieceId}),"";const Z=`pp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,F={pieceId:W.pieceId,orientationId:W.orientationId,anchorSphereIndex:0,cells:W.cells,uid:Z,placedAt:Date.now(),reason:H==="hintCommit"?"hint":"computer"};return a(F),Z},[a,i]),M=S.useCallback((W,H)=>{if(!W.cells||W.cells.length===0)return;T(),f(null),v([]),x(!0);const Z=[...W.cells],F=180;Z.forEach((Y,X)=>{setTimeout(()=>{v(oe=>[...oe,Y]),X===Z.length-1&&setTimeout(()=>{const oe=w(W);v([]),x(!1),H({pieceId:W.pieceId,orientationId:W.orientationId,cells:W.cells,uid:oe})},180)},F*X)})},[T,f,w]),P=S.useCallback((W,H)=>{if(!W.cells||W.cells.length===0)return;T(),f(null);const Z=[...W.cells],F=150;Z.forEach((Y,X)=>{setTimeout(()=>{A(Y),X===Z.length-1&&setTimeout(()=>{const oe=w(W,"hintCommit");T(),H({pieceId:W.pieceId,orientationId:W.orientationId,cells:W.cells,uid:oe})},150)},F*X)})},[T,A,f,w]),I=S.useCallback((W,H,Z)=>{if(!r)return;const F=W==="piece"?typeof Z=="string"?Z:Z==null?void 0:Z.uid:null;if(d&&(H==="single"||H==="double")&&(W==="piece"&&F===d||f(null)),W==="cell"){H==="single"?C.length>0&&T():H==="double"&&A(Z);return}if(W==="background"){H==="single"&&T();return}if(W==="piece"){const Y=F;if(H==="single"){C.length>0&&T(),f(X=>X===Y?null:Y);return}if(H==="double"||H==="long"){if(Y===d){const oe=l(Y);oe&&(f(null),t&&t({pieceId:oe.pieceId,uid:Y}));return}const X=D(Z);X&&A(X);return}}},[r,C,T,A,l,t,d]);function D(W){return(W==null?void 0:W.emptyCellUnderCursor)??null}return{placedPieces:Array.from(o.values()),placedMap:o,placedCountByPieceId:s,drawingCells:C,clearDrawing:T,selectedPieceUid:d,handleInteraction:I,placePieceProgrammatically:w,computerDrawingCells:m,isComputerAnimating:_,animateComputerMove:M,animateUserHintMove:P,undoLastPlacement:c,resetBoard:u}}function oO({session:n,onComputerMove:e,baseDelayMs:t=1200,hintInProgressRef:r}){const i=S.useRef(null);S.useEffect(()=>()=>{i.current!==null&&(window.clearTimeout(i.current),i.current=null)},[]),S.useEffect(()=>{if(!n||n.isComplete){i.current!==null&&(window.clearTimeout(i.current),i.current=null);return}if(!n.players[n.currentPlayerIndex].isComputer){i.current!==null&&(window.clearTimeout(i.current),i.current=null);return}if(r!=null&&r.current){i.current!==null&&(window.clearTimeout(i.current),i.current=null);return}if(i.current!==null)return;const s=Math.random()*.4+.8,a=t*s;i.current=window.setTimeout(()=>{i.current=null,e()},a)},[n,e,t])}function fy(n){return`${n.i},${n.j},${n.k}`}function sO(n,e){const{service:t,loading:r,error:i}=mc();return{generateMove:S.useCallback(a=>{if(!n||r||!t||i)return null;const l=n.geometry||[];if(!l.length)return null;const c=new Set;for(const m of a)for(const v of m.cells)c.add(fy(v));const u=l.filter(m=>!c.has(fy(m)));if(u.length<4)return null;const d=e?rs.filter(m=>!e[m]||e[m]===0):rs;if(console.log(` Computer available pieces: ${d.length}/${rs.length}`),d.length===0)return console.log(" No pieces available for computer"),null;const f=200;for(let m=0;m<f;m++){const v=new Set;for(;v.size<4;){const p=Math.floor(Math.random()*u.length);v.add(p)}const _=Array.from(v).map(p=>u[p]),x=Vd(_,d,t);if(x)return{pieceId:x.pieceId,orientationId:x.orientationId,cells:_}}return null},[n,r,i,t,e]),ready:!!n&&!!t&&!r&&!i}}const aO={async chat(n,e){try{const t={messages:n};e&&(t.context=e);const{data:r,error:i}=await bt.functions.invoke("quick-responder",{body:t});if(i)throw console.error("Supabase function error:",i),i;return r.text}catch(t){return console.error("AI chat error:",t),"I'm having trouble connecting right now. Please try again."}}};function jo(n,e){return{id:`${n}-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,role:n,content:e,timestamp:Date.now()}}function lO(n){const[e,t]=S.useState([jo("ai","Hi, I'm your Koos opponent . You play the pieces, I play back  and we can chat down here while we do it.")]),[r,i]=S.useState(!1),o=S.useCallback(c=>{t(u=>[...u,c])},[]),s=S.useCallback(async c=>{const u=c.trim();if(!u)return;const d=jo("user",u);o(d),i(!0);try{let m;{const _=n?n():void 0,x=`
            You are a playful AI opponent in the Koos Puzzle versus mode.

            Current game state (JSON): ${JSON.stringify(_??{})}

            Style: friendly, competitive, playful. Keep responses to 12 sentences.
            React to the game state if relevant (like score, last move, how full the board is),
            otherwise just chat naturally with the user.
          `;m=await aO.chat([{role:"system",content:x},{role:"user",content:u}],{screen:{name:"versus_chat"}})}const v=jo("ai",m);o(v)}catch(f){console.error("AI chat error:",f);const m=jo("ai","I'm having connection trouble talking to HQ. Let's keep puzzling and try again in a bit ");o(m)}finally{i(!1)}},[o,n]),a=S.useCallback(async c=>{const u=jo("user",c);o(u),i(!0);try{const d=jo("ai",`Nice ${c}! I'll pretend that was either confidence or mild panic.`);await new Promise(f=>setTimeout(f,300)),o(d)}finally{i(!1)}},[o]),l=S.useCallback(c=>{const u=jo("ai",c);o(u)},[o]);return{messages:e,isSending:r,sendUserMessage:s,sendEmoji:a,addAIComment:l}}const cO=()=>{var Je;const n=Jn(),{id:e}=ac(),{puzzle:t,loading:r,error:i}=Vg(e),{session:o,logEvent:s,applyScoreDelta:a,advanceTurn:l,incrementHintsUsed:c,incrementSolvabilityChecks:u,endGame:d,resetSession:f}=$N(t==null?void 0:t.id),{handlePlacePiece:m,handleRemovePiece:v,handleHint:_,handleSolvabilityCheck:x}=GN({session:o,logEvent:s,applyScoreDelta:a,advanceTurn:l,incrementHintsUsed:c,incrementSolvabilityChecks:u}),[p,b]=S.useState(null),g=S.useRef(null);S.useEffect(()=>{g.current=p},[p]);const y=(p==null?void 0:p.status)==="solving"||(p==null?void 0:p.status)==="preview"||(p==null?void 0:p.status)==="committing",E=S.useRef(!1);S.useEffect(()=>{E.current=y},[y]),oO({session:o,hintInProgressRef:E,onComputerMove:()=>{if(!o||!o.players[o.currentPlayerIndex].isComputer)return;let Le=null;L&&(Le=je(X)),Le?Ee(Le,({pieceId:qe,orientationId:re,cells:ie,uid:we})=>{m({source:"computer",pieceId:qe,orientationId:re,cells:ie,uid:we}),Math.random()<.4&&G(`Your turn. Let's see what you do with that ${qe} I just placed.`)}):(m({source:"computer",noBoardMove:!0}),Math.random()<.5&&G("That board is almost out of room I couldn't find a good spot."))},baseDelayMs:1200});const[C,A]=S.useState(!1),[T,w]=S.useState(!1),[M,P]=S.useState(!1),[I,D]=S.useState(!0),[$,W]=S.useState(!1),[H,Z]=S.useState("unknown"),F=o&&o.players[o.currentPlayerIndex],Y=!!F&&!F.isComputer&&!(o!=null&&o.isComplete),{placedPieces:X,placedMap:oe,placedCountByPieceId:pe,drawingCells:De,clearDrawing:z,selectedPieceUid:ve,handleInteraction:j,computerDrawingCells:ne,animateComputerMove:Ee,animateUserHintMove:me,undoLastPlacement:te,resetBoard:Pe}=iO({hintInProgressRef:E,onPiecePlaced:({pieceId:_e,orientationId:Le,cells:qe})=>{var U;m({pieceId:_e,orientationId:Le,cells:qe});const re=((U=t.geometry)==null?void 0:U.length)??0,ie=X.length+1,we=re>0?ie/re:0;if(Math.random()<.4){const se=[`Nice placement with the ${_e} piece.`,`I saw that ${_e} drop. Interesting choice`,`You're making that ${_e} work for you.`],he=se[Math.floor(Math.random()*se.length)];G(he)}if(we>.7&&Math.random()<.5){const se=Math.round(we*100);G(`The board is about ${se}% full now. It's getting tight in here.`)}},onPieceRemoved:({pieceId:_e,uid:Le})=>{v({pieceId:_e,uid:Le,source:"human"})},isHumanTurn:Y}),{generateMove:je,ready:L}=sO(t,pe),{service:Fe,loading:Re}=mc(),Ne=la.useMemo(()=>(t==null?void 0:t.geometry)||[],[t]),{hintCells:de,handleRequestHint:Se}=xw({puzzle:t,cells:Ne,mode:"oneOfEach",placed:oe,activePiece:"",orientationService:Fe,placePiece:()=>{},setNotification:()=>{},setNotificationType:()=>{}}),{handleRequestSolvability:Ue}=yw({puzzle:t,cells:Ne,mode:"oneOfEach",placed:oe,activePiece:"",setSolvableStatus:Z,setNotification:()=>{},setNotificationType:()=>{},onCheckComplete:_e=>{x({source:"human",isSolvable:_e}),_e===!1?(te(),G("Ouch! That last move made the puzzle unsolvable. I've removed it. Try again!")):G("Good call checking solvability - the puzzle is still solvable.")}}),ze=la.useCallback(()=>{if(!o)return{puzzleId:t==null?void 0:t.id,puzzleName:t==null?void 0:t.name,status:"no_session"};const _e=o.players[o.currentPlayerIndex];return{puzzleId:t==null?void 0:t.id,puzzleName:t==null?void 0:t.name,currentPlayer:_e==null?void 0:_e.name,players:o.players.map(Le=>({name:Le.name,isComputer:Le.isComputer,score:o.scores[Le.id]??0})),placedPiecesCount:X.length}},[o,t,X]),{messages:Ke,isSending:it,sendUserMessage:N,sendEmoji:k,addAIComment:G}=lO(ze),ue=la.useCallback(async()=>{var qe;if(console.log(" [HINT] startHintTx called",{isHumanTurn:Y,orientationsLoading:Re,hasOrientationService:!!Fe,drawingCellsCount:De.length,hintTxStatus:((qe=g.current)==null?void 0:qe.status)??"null"}),g.current&&g.current.status!=="failed"){console.log(" [HINT] Blocked: hint transaction already active",{status:g.current.status});return}if(!Y){console.log(" [HINT] Blocked: not human turn");return}if(Re||!Fe){console.log(" [HINT] Blocked: orientations loading or service not ready"),G("Loading piece orientations, please try again in a moment.");return}if(De.length===0){G("Double-click a cell to choose a hint target.");return}const _e=De[0],Le=`hint-${Date.now()}-${Math.random().toString(16).slice(2)}`;console.log(" [HINT] Tx start",{id:Le,targetCell:_e}),b({id:Le,targetCell:_e,requestedAt:Date.now(),status:"solving"}),z(),await Se([_e]),console.log(" [HINT] Solver request finished (await returned)",{id:Le})},[Y,Re,Fe,De,z,Se,G]),Me=()=>{Y&&(G("Let me check if this position is still solvable..."),Ue())};if(S.useEffect(()=>{const _e=p;if(!_e||(console.log(" [HINT-TX] effect",{id:_e.id,status:_e.status,hintCellsLength:(de==null?void 0:de.length)??"null"}),_e.status!=="solving")||de==null)return;if(de.length===0){b({..._e,status:"failed",error:"No hint found"}),G("I couldn't find a good hint there. This position is tough.");return}if(!Fe){b({..._e,status:"failed",error:"Orientation service missing"});return}const Le=Vd(de,rs,Fe);if(!Le){b({..._e,status:"failed",error:"No matching piece"}),G("I tried to hint a piece, but nothing matched a valid Koos piece there.");return}const qe=U=>`${U.i},${U.j},${U.k}`,re=qe(_e.targetCell);if(!de.some(U=>qe(U)===re)){console.error(" [HINT-TX] Hint does not cover target",{targetCell:_e.targetCell,hintCells:de}),b({..._e,status:"failed",error:"Hint does not cover target"}),G("That hint didn't match your selected cell. Try another cell.");return}const we={pieceId:Le.pieceId,orientationId:Le.orientationId,cells:de};console.log(" [HINT-TX] Solved => preview",{id:_e.id,result:we}),b({..._e,status:"preview",result:we}),me(we,({uid:U})=>{const se=g.current;if(!se||se.id!==_e.id||se.status!=="preview"||!se.result){console.warn(" [HINT-TX] Commit aborted: tx changed",{latest:se});return}b({...se,status:"committing"}),m({source:"human_hint",pieceId:se.result.pieceId,orientationId:se.result.orientationId,cells:se.result.cells,uid:U}),_({source:"human"}),G(`Using a hint with ${se.result.pieceId}? Fair move. Let's see what you do next.`),b(null)})},[p,de,Fe,me,m,_,G]),S.useEffect(()=>{if(!t||!o||o.isComplete||!Ne.length)return;const _e=new Set;for(const qe of X)for(const re of qe.cells)_e.add(`${re.i},${re.j},${re.k}`);const Le=Ne.filter(qe=>!_e.has(`${qe.i},${qe.j},${qe.k}`));Le.length<4&&(console.log(` Game ending - only ${Le.length} empty cells left`),d("noMoves"))},[t,o,X,Ne,d]),S.useEffect(()=>{if(console.log(" Completion check:",{isComplete:o==null?void 0:o.isComplete,hasShownResultModal:M,willShow:(o==null?void 0:o.isComplete)&&!M}),o!=null&&o.isComplete&&!M){console.log(" Game completed! Showing result modal"),w(!0),P(!0);const _e=o.winnerId&&o.players.find(Le=>Le.id===o.winnerId);if(_e){const Le=o.scores[_e.id]??0,qe=o.players.filter(re=>re.id!==_e.id).map(re=>o.scores[re.id]??0)[0]??0;G(`GG! ${_e.name} wins this match ${Le}${qe}.`)}else G("We filled the board and ended in a draw. Nice game!")}},[o,M,G]),S.useEffect(()=>{new URLSearchParams(window.location.search).get("shared")==="true"&&t&&n(`/gallery?puzzle=${t.id}&shared=true`)},[t,n]),r)return h.jsx("div",{style:{padding:"2rem",textAlign:"center"},children:h.jsx("p",{children:"Loading puzzle game..."})});if(i||!t)return h.jsxs("div",{style:{padding:"2rem",textAlign:"center"},children:[h.jsxs("p",{children:["Error loading puzzle: ",i]}),h.jsx("button",{onClick:()=>n("/gallery"),className:"btn",children:"Back to Gallery"})]});const ge=o==null?void 0:o.players.find(_e=>!_e.isComputer),$e=o==null?void 0:o.players.find(_e=>_e.isComputer),ke=ge?(o==null?void 0:o.scores[ge.id])??0:0,We=$e?(o==null?void 0:o.scores[$e.id])??0:0;return h.jsxs("div",{className:"page-container",children:[h.jsx(ZN,{onReset:()=>{console.log(" Reset button clicked - resetting game"),P(!1),Pe(),f(),console.log(" Game reset complete")},onHowToPlay:()=>D(!0),onBackToHome:()=>n("/")}),o&&h.jsx(eO,{userScore:ke,computerScore:We}),o?h.jsxs(h.Fragment,{children:[h.jsx(qN,{puzzle:t,placedPieces:X,drawingCells:De,computerDrawingCells:ne,selectedPieceUid:ve,hidePlacedPieces:C,isHumanTurn:Y,isGameComplete:!!(o!=null&&o.isComplete),hintCells:(p==null?void 0:p.status)==="preview"||(p==null?void 0:p.status)==="committing"?((Je=p.result)==null?void 0:Je.cells)??[]:[],onInteraction:j}),h.jsx(QN,{hidePlaced:C,onToggleHidePlaced:()=>A(_e=>!_e),onHint:ue,onSolvability:Me,solvableStatus:H}),h.jsx(tO,{isOpen:$,onToggle:W,children:h.jsx(rO,{messages:Ke,isSending:it,onSendMessage:N,onSendEmoji:k})})]}):h.jsx("p",{style:{padding:"2rem",textAlign:"center"},children:"Initializing game session..."}),o&&h.jsx(KN,{session:o,isOpen:T,puzzleName:t.name,onClose:()=>w(!1),onPlayAgain:()=>{console.log(" Play Again clicked - resetting game"),w(!1),P(!1),Pe(),f(),console.log(" Game reset complete")}}),o&&h.jsx(JN,{isOpen:I,onClose:()=>D(!1)})]})},uO=({puzzle:n,loaded:e,piecesDb:t,engineSettings:r,onSolutionFound:i,onResetSolution:o,notify:s,onRunStart:a,onRunDone:l,onStatus:c,onSolution:u,pendingSeedRef:d})=>{const[f,m]=S.useState(!1),[v,_]=S.useState(null),[x,p]=S.useState(0),b=S.useRef(null),g=S.useRef(!1),y=S.useCallback(async()=>{if(!n||!t||!e){s==null||s("Puzzle or pieces not loaded","info");return}if(b.current)return;m(!0),_(null),p(0),g.current=!1,o&&o();const T=(a?a(r):{runId:""}).runId,w=n.geometry.map(M=>[M.i,M.j,M.k]);try{const M=Xg({cells:w,id:n.id},t),P=d!=null&&d.current?{...r,seed:d.current}:r;d&&(d.current=null);const I=fN(M,P,{onStatus:D=>{_(D),c&&c(T,D)},onDone:D=>{m(!1),b.current=null,l&&l(T,D)},onSolution:async D=>{console.log(" Solution callback triggered, pieces:",D.length),u&&u(T),g.current=!0,b.current&&b.current.pause(),m(!1);try{i&&await i(D),p($=>$+1)}finally{g.current=!1}}});b.current=I,I.resume()}catch(M){console.error(" Auto-solve failed:",M),s&&s(`Auto-solve error: ${(M==null?void 0:M.message)??String(M)}`,"error"),m(!1),_(null),b.current=null}},[n,t,e,r,s,i,o,a,l,c,u]),E=S.useCallback(()=>{b.current&&(b.current.pause(),b.current=null),m(!1),_(null),o&&o()},[o]),C=S.useCallback(()=>{b.current?(console.log(" Resuming auto-solve to find next solution..."),m(!0),o&&o(),b.current.resume()):y()},[y,o]);return{isAutoSolving:f,autoSolveStatus:v,autoSolutionsFound:x,handleAutoSolve:y,handleStopAutoSolve:E,handleResumeAutoSolve:C}},dO=({open:n,onClose:e,engineName:t,currentSettings:r,onSave:i,puzzleStats:o})=>{var oe,pe,De;const s=gc(),[a,l]=S.useState(null),[c,u]=S.useState((r.timeoutMs??0)/1e3),[d,f]=S.useState(r.randomizeTies??!0),[m,v]=S.useState(r.seed??12345),[_,x]=S.useState(r.shuffleStrategy??"none"),[p,b]=S.useState(r.restartInterval??5e4),[g,y]=S.useState(r.restartIntervalSeconds??300),[E,C]=S.useState(r.shuffleTriggerDepth??8),[A,T]=S.useState(r.maxSuffixShuffles??5),[w,M]=S.useState(!1),[P,I]=S.useState(((oe=r.tailSwitch)==null?void 0:oe.enable)??!0),[D,$]=S.useState(((pe=r.tailSwitch)==null?void 0:pe.dlxThreshold)??100),[W,H]=S.useState((((De=r.tailSwitch)==null?void 0:De.dlxTimeoutMs)??3e4)/1e3);if(S.useEffect(()=>{var z,ve,j;if(n){l(null),u((r.timeoutMs??0)/1e3),f(r.randomizeTies??!0);const ne=new Date,Ee=ne.getHours()*1e4+ne.getMinutes()*100+ne.getSeconds();v(Ee),x(r.shuffleStrategy??"none"),b(r.restartInterval??5e4),y(r.restartIntervalSeconds??300),C(r.shuffleTriggerDepth??8),T(r.maxSuffixShuffles??5),I(((z=r.tailSwitch)==null?void 0:z.enable)??!0),$(((ve=r.tailSwitch)==null?void 0:ve.dlxThreshold)??100),H((((j=r.tailSwitch)==null?void 0:j.dlxTimeoutMs)??3e4)/1e3)}},[n,r]),!n)return null;const Z=z=>a?a==="exhaustive"?z==="timeout"||z==="tail":a==="balanced"?!0:a==="fast"?z==="tail"||z==="restart"||z==="randomness":!1:!1,F=z=>{if(!a)return{};const ve={maxSolutions:1,pauseOnSolution:!0,statusIntervalMs:300,saveSolutions:!1,moveOrdering:"mostConstrainedCell",pruning:{connectivity:!1,multipleOf4:!0,colorResidue:!1,neighborTouch:!1},visualRevealDelayMs:150};return a==="exhaustive"?{...ve,timeoutMs:z.timeout*1e3,randomizeTies:!1,shuffleStrategy:"initial",seed:z.seed,restartInterval:0,maxRestarts:0,tt:{enable:!1},tailSwitch:{enable:z.tailEnable,dlxThreshold:z.dlxThreshold,dlxTimeoutMs:z.dlxTimeoutMs}}:a==="balanced"?{...ve,timeoutMs:z.timeout*1e3,randomizeTies:z.randomizeTies,shuffleStrategy:z.shuffleStrategy,seed:z.seed,restartInterval:Math.max(1e3,z.restartInterval),restartIntervalSeconds:Math.max(1,z.restartIntervalSeconds),maxRestarts:999999,tt:{enable:!0},tailSwitch:{enable:z.tailEnable,dlxThreshold:z.dlxThreshold,dlxTimeoutMs:z.dlxTimeoutMs}}:a==="fast"?{...ve,timeoutMs:z.timeout*1e3,randomizeTies:!0,shuffleStrategy:z.shuffleStrategy,seed:z.seed,restartInterval:Math.max(1e3,z.restartInterval),restartIntervalSeconds:Math.max(1,z.restartIntervalSeconds),maxRestarts:999999,tt:{enable:!0},tailSwitch:{enable:z.tailEnable,dlxThreshold:z.dlxThreshold,dlxTimeoutMs:z.dlxTimeoutMs}}:ve},Y=()=>{const z=[],ve=[];if(o){const me=Math.floor(o.containerCells/4);ve.push(`**${o.puzzleName}**`),ve.push(`Container: ${o.containerCells} cells (${o.totalSpheres} spheres)`),ve.push(`Available pieces: ${o.pieceTypeCount} types`),ve.push(`Target: ~${me} pieces to fill container`)}a==="exhaustive"?(z.push("**Mode:** Exhaustive  Randomized start each run (time-seeded), deterministic after start"),z.push(`**Starting seed:** ${m} (from current time)`),z.push("**Piece order:** Single shuffle at startup, then deterministic"),z.push("**Tie-breaking:** Deterministic (no randomness after start)"),z.push("**Transposition table:** Disabled (avoids false negatives)")):a==="balanced"?(z.push("**Mode:** Balanced  Smart exploration with user control"),z.push(`**Randomness:** ${d?`Enabled (seed: ${m})`:"Disabled"}`),z.push(`**Piece order:** ${_==="none"?"Alphabetical":_==="periodicRestartTime"?`Restart every ${g}s`:_==="periodicRestart"?`Restart every ${p} nodes`:_==="adaptive"?"Adaptive suffix shuffle":"Initial shuffle"}`)):a==="fast"&&(z.push("**Mode:** Fast  Aggressive path exploration"),z.push(`**Randomness:** Enabled (seed: ${m})`),z.push(`**Piece order:** ${_==="periodicRestartTime"?`Restart every ${g}s`:_==="periodicRestart"?`Restart every ${p} nodes`:"Frequent restarts"}`)),P?z.push(`**Tail solver:** DLX enabled (${D} cells, ${W}s timeout)`):z.push("**Tail solver:** Disabled");const j=typeof c=="string"?parseInt(c)||0:c;if(j>0){const me=Math.floor(j/60);z.push(`**Timeout:** ${me>0?`${me}m`:`${j}s`}`)}else z.push("**Timeout:** None (unlimited)");const ne=a==="exhaustive"?"Randomized start per run":a==="balanced"?"Smart exploration":"Aggressive search",Ee=o?`Even conservative estimates for ${o.containerCells}-cell puzzles create astronomically large search spaces. Your ${a} mode guides the search toward promising structure.`:"Puzzle search spaces are vast. Your mode and strategy guide the solver toward solutions.";return{headline:ne,bullets:z,puzzleLines:ve,wowLine:Ee}},X=()=>{if(!a)return;const z=typeof c=="string"?parseInt(c)||0:c,ve=typeof m=="string"?parseInt(m)||12345:m,j=typeof D=="string"?parseInt(D)||100:D,ne=(typeof W=="string"?parseInt(W)||30:W)*1e3,Ee=typeof p=="string"?parseInt(p)||5e4:p,me=typeof g=="string"?parseInt(g)||300:g,Pe={...F({timeout:z,tailEnable:P,dlxThreshold:j,dlxTimeoutMs:ne,randomizeTies:a==="exhaustive"?!1:d,seed:ve,shuffleStrategy:_,restartInterval:Ee,restartIntervalSeconds:me}),pieces:r.pieces,view:r.view,savePath:"",shuffleTriggerDepth:8,maxSuffixShuffles:5};i(Pe),e()};return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .engine-settings-modal-scrollable::-webkit-scrollbar {
          width: 12px;
        }
        .engine-settings-modal-scrollable::-webkit-scrollbar-track {
          background: rgba(59, 130, 246, 0.1);
          border-radius: 10px;
          margin: 20px 0;
        }
        .engine-settings-modal-scrollable::-webkit-scrollbar-thumb {
          background: linear-gradient(180deg, #f59e0b, #d97706);
          border-radius: 10px;
          border: 2px solid rgba(254, 243, 199, 0.5);
        }
        .engine-settings-modal-scrollable::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(180deg, #d97706, #b45309);
        }
        .engine-settings-modal-scrollable::-webkit-scrollbar-thumb:active {
          background: #b45309;
        }
        .engine-settings-modal-scrollable {
          scrollbar-width: thin;
          scrollbar-color: #f59e0b rgba(59, 130, 246, 0.1);
        }
      `}),h.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent",backdropFilter:"none",zIndex:1e4},onClick:e}),h.jsxs("div",{ref:s.ref,className:"engine-settings-modal-scrollable",style:{position:"fixed",top:"50%",left:"50%",background:"linear-gradient(135deg, #fef3c7 0%, #fde68a 50%, #fcd34d 100%)",borderRadius:"20px",padding:"0",maxWidth:"600px",width:"90%",maxHeight:"85vh",overflowY:"auto",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"3px solid rgba(245,158,11,0.6)",zIndex:10001,...s.style},onClick:z=>z.stopPropagation(),children:[h.jsxs("div",{style:{background:"linear-gradient(135deg, #f59e0b, #d97706, #b45309)",padding:"1.25rem 1.5rem",borderRadius:"17px 17px 0 0",marginBottom:"20px",borderBottom:"3px solid rgba(255,255,255,0.3)",boxShadow:"0 4px 20px rgba(245,158,11,0.4)",position:"relative",cursor:"move"},children:[h.jsxs("h2",{style:{color:"#fff",fontSize:"20px",fontWeight:700,margin:0,textShadow:"0 2px 4px rgba(0,0,0,0.2)",paddingRight:"80px"},children:[" ",t," Settings"]}),h.jsxs("div",{style:{position:"absolute",top:"12px",right:"12px",display:"flex",gap:"8px"},children:[h.jsx("button",{onClick:()=>M(!0),title:"Settings Help",style:{background:"rgba(255,255,255,0.2)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"18px",color:"#fff",fontWeight:700,transition:"all 0.2s"},children:""}),h.jsx("button",{onClick:e,style:{background:"rgba(255,255,255,0.2)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"24px",color:"#fff",fontWeight:700,transition:"all 0.2s"},children:""})]})]}),h.jsx("div",{style:{padding:"0 1.5rem 1.5rem"},children:a===null?h.jsxs("div",{style:{textAlign:"center",padding:"1rem 0"},children:[h.jsx("h3",{style:{fontSize:"1.2rem",fontWeight:600,marginBottom:"1.5rem",color:"#333"},children:"Choose a solving mode"}),h.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1rem"},children:[h.jsxs("button",{onClick:()=>l("exhaustive"),style:{padding:"1.25rem",background:"linear-gradient(135deg, #dbeafe, #bfdbfe)",border:"2px solid #3b82f6",borderRadius:"12px",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseEnter:z=>z.currentTarget.style.transform="translateY(-2px)",onMouseLeave:z=>z.currentTarget.style.transform="translateY(0)",children:[h.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,marginBottom:"0.5rem",color:"#1e40af"},children:" Exhaustive"}),h.jsx("div",{style:{fontSize:"0.9rem",color:"#1e3a8a"},children:"Randomized start per run  Deterministic after start  Explore different regions"})]}),h.jsxs("button",{onClick:()=>l("balanced"),style:{padding:"1.25rem",background:"linear-gradient(135deg, #dcfce7, #bbf7d0)",border:"2px solid #22c55e",borderRadius:"12px",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseEnter:z=>z.currentTarget.style.transform="translateY(-2px)",onMouseLeave:z=>z.currentTarget.style.transform="translateY(0)",children:[h.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,marginBottom:"0.5rem",color:"#15803d"},children:" Balanced (Recommended)"}),h.jsx("div",{style:{fontSize:"0.9rem",color:"#166534"},children:"Smart exploration  Good speed  Most versatile"})]}),h.jsxs("button",{onClick:()=>l("fast"),style:{padding:"1.25rem",background:"linear-gradient(135deg, #fed7aa, #fdba74)",border:"2px solid #f59e0b",borderRadius:"12px",cursor:"pointer",textAlign:"left",transition:"all 0.2s"},onMouseEnter:z=>z.currentTarget.style.transform="translateY(-2px)",onMouseLeave:z=>z.currentTarget.style.transform="translateY(0)",children:[h.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,marginBottom:"0.5rem",color:"#92400e"},children:" Fast"}),h.jsx("div",{style:{fontSize:"0.9rem",color:"#78350f"},children:"Try many paths  Aggressive restarts  Quick exploration"})]})]})]}):h.jsxs(h.Fragment,{children:[Z("timeout")&&h.jsxs("div",{style:uu,children:[h.jsx("h4",{style:du,children:" Search Timeout"}),h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Timeout (seconds)"}),h.jsx("input",{type:"number",value:c,onChange:z=>u(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)||ve<0?u(0):u(ve)},style:fi,min:"0",step:"60",placeholder:"0 = no limit"}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"0 = no timeout. Hard puzzles may need 30+ minutes (1800+ seconds)"})]})]}),Z("randomness")&&h.jsxs("div",{style:uu,children:[h.jsx("h4",{style:du,children:" Randomness"}),a==="exhaustive"&&h.jsxs("div",{style:{padding:"0.75rem",background:"#dbeafe",borderRadius:"8px",fontSize:"0.875rem",fontWeight:500,marginBottom:"0.75rem",color:"#1e40af"},children:[h.jsx("strong",{children:" Note:"})," Each Exhaustive run fully explores one search region. Different runs start from different time-seeded initial orderings. Seed: ",m]}),h.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"14px",marginBottom:"0.75rem"},children:[h.jsx("input",{type:"checkbox",checked:d,onChange:z=>f(z.target.checked),disabled:a==="exhaustive"}),h.jsx("span",{children:"Randomize tie-breaking"}),a==="exhaustive"&&h.jsx("span",{style:{fontSize:"12px",color:"#999"},children:"(disabled in Exhaustive)"})]}),h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Random Seed"}),h.jsx("input",{type:"number",value:m,onChange:z=>v(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)?v(12345):v(ve)},style:fi,disabled:!d||a==="exhaustive"}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"Different seed = different search path"})]})]}),Z("restart")&&h.jsxs("div",{style:uu,children:[h.jsx("h4",{style:du,children:" Piece Ordering Strategy"}),h.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"0.75rem"},children:"How to order pieces during search. Can dramatically affect solve time."}),h.jsx("div",{style:{marginBottom:"0.75rem"},children:h.jsxs("select",{value:_,onChange:z=>x(z.target.value),style:fi,children:[h.jsx("option",{value:"none",children:"None (Alphabetical)"}),h.jsx("option",{value:"initial",children:"Initial Shuffle (seed-based)"}),h.jsx("option",{value:"periodicRestart",children:"Periodic Restart (node-based)"}),h.jsx("option",{value:"periodicRestartTime",children:"Periodic Restart (time-based)"}),h.jsx("option",{value:"adaptive",children:"Adaptive Suffix Shuffle"})]})}),_==="periodicRestart"&&h.jsx(h.Fragment,{children:h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Restart Interval (nodes)"}),h.jsx("input",{type:"number",value:p,onChange:z=>b(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)||ve<1e3?b(5e4):b(ve)},style:fi,min:"1000",step:"10000"}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"Restart every N nodes with new piece order (default: 50,000). Unlimited restarts."})]})}),_==="periodicRestartTime"&&h.jsx(h.Fragment,{children:h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Restart Interval (seconds)"}),h.jsx("input",{type:"number",value:g,onChange:z=>y(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)||ve<1?y(300):y(ve)},style:fi,min:"1",step:"60"}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"Restart every N seconds with new piece order (default: 300 = 5 min). Unlimited restarts."})]})}),_==="adaptive"&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Trigger at depth <"}),h.jsx("input",{type:"number",value:E,onChange:z=>C(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)||ve<1?C(8):C(ve)},style:fi,min:"1",step:"1"}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"Shuffle when backtracking below this depth (default: 8)"})]}),h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Max shuffles per branch"}),h.jsx("input",{type:"number",value:A,onChange:z=>T(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)||ve<1?T(5):T(ve)},style:fi,min:"1",step:"1"}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"Max shuffles per search branch (default: 5)"})]})]})]}),Z("tail")&&h.jsxs("div",{style:uu,children:[h.jsx("h4",{style:du,children:" Tail Solver (DLX Exact Cover)"}),h.jsx("div",{style:{fontSize:"12px",color:"#666",marginBottom:"0.75rem"},children:"Use DLX exact cover algorithm for fast endgame completion"}),h.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"14px",marginBottom:"0.75rem"},children:[h.jsx("input",{type:"checkbox",checked:P,onChange:z=>I(z.target.checked)}),h.jsx("span",{children:"Enable DLX tail solver (recommended)"})]}),h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Threshold (open cells)"}),h.jsx("input",{type:"number",value:D,onChange:z=>$(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)||ve<10?$(100):$(ve)},style:fi,min:"10",step:"10",disabled:!P}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"Use DLX when open cells  this value (default: 100)"})]}),h.jsxs("div",{style:{marginBottom:"0.75rem"},children:[h.jsx("label",{style:Xi,children:"Timeout (seconds)"}),h.jsx("input",{type:"number",value:W,onChange:z=>H(z.target.value),onBlur:z=>{const ve=parseInt(z.target.value);isNaN(ve)||ve<1?H(30):H(ve)},style:fi,min:"1",step:"5",disabled:!P}),h.jsx("div",{style:{fontSize:"12px",color:"#999",marginTop:"0.25rem"},children:"Max time for DLX solver (default: 30 seconds)"})]})]})]})}),h.jsxs("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end",paddingTop:"0.75rem",borderTop:"1px solid #f0f0f0",padding:"0 1.5rem 1.5rem"},children:[h.jsx("button",{className:"btn",onClick:e,children:"Cancel"}),h.jsx("button",{className:"btn",onClick:X,disabled:a===null,style:{background:a===null?"#ccc":"#007bff",color:"#fff",cursor:a===null?"not-allowed":"pointer",opacity:a===null?.6:1},children:"Save Settings"})]})]}),h.jsx(Ql,{isOpen:w,onClose:()=>M(!1),title:"Your Solver Configuration",children:a?h.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",fontSize:"0.95rem"},children:[o&&h.jsx("div",{style:{padding:"1rem",background:"#f0f9ff",borderLeft:"3px solid #3b82f6",borderRadius:"6px",fontSize:"0.875rem"},children:Y().puzzleLines.map((z,ve)=>h.jsx("div",{style:{marginBottom:ve<Y().puzzleLines.length-1?"0.25rem":0},children:z.startsWith("**")?h.jsx("strong",{children:z.replace(/\*\*/g,"")}):z},ve))}),h.jsxs("div",{style:{padding:"1rem",background:"#fef3c7",borderLeft:"3px solid #f59e0b",borderRadius:"6px"},children:[h.jsx("h4",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:Y().headline}),Y().bullets.map((z,ve)=>h.jsx("div",{style:{fontSize:"0.875rem",marginBottom:"0.5rem"},children:z.includes("**")?h.jsxs(h.Fragment,{children:[h.jsx("strong",{children:z.split("**")[1]}),z.split("**")[2]]}):z},ve))]}),h.jsx("div",{style:{padding:"1rem",background:"#f0fdf4",borderLeft:"3px solid #22c55e",borderRadius:"6px",fontSize:"0.875rem",fontStyle:"italic"},children:Y().wowLine})]}):h.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#999"},children:"Select a solving mode to see your configuration summary."})})]})},fi={width:"100%",padding:"0.5rem",border:"1px solid #ddd",borderRadius:4,fontSize:"14px"},uu={marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid #f0f0f0"},du={fontSize:"14px",fontWeight:600,marginBottom:"0.75rem",color:"#333"},Xi={display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"14px"},hO=({isAutoSolving:n,hasPiecesDb:e,onSolveClick:t,onOpenEngineSettings:r,onOpenEnvSettings:i,onOpenInfo:o,onGoHome:s})=>h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .solve-header {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          height: 56px;
          background: linear-gradient(180deg, rgba(0,0,0,0.98) 0%, rgba(0,0,0,0.95) 100%);
          border-bottom: 1px solid rgba(255, 255, 255, 0.08);
          backdrop-filter: blur(10px);
          display: flex;
          align-items: center;
          padding: 0 12px;
          gap: 12px;
          z-index: 1000;
        }
        
        .solve-header-left {
          display: flex;
          gap: 8px;
          flex: 1;
          overflow-x: auto;
          align-items: center;
        }
        
        .solve-header-right {
          display: flex;
          gap: 8px;
          align-items: center;
        }
        
        .header-btn {
          background: rgba(255,255,255,0.1);
          color: #fff;
          border: none;
          padding: 8px 16px;
          border-radius: 8px;
          font-size: 22px;
          cursor: pointer;
          white-space: nowrap;
          transition: background 0.2s;
        }
        
        .header-btn:hover {
          background: rgba(255,255,255,0.15);
        }
        
        .header-btn-icon {
          background: linear-gradient(135deg, #8b5cf6, #7c3aed);
          color: #fff;
          border: none;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          font-size: 22px;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          flex-shrink: 0;
        }
        
        .header-btn-icon:disabled {
          opacity: 0.5;
          cursor: not-allowed;
          background: rgba(139, 92, 246, 0.3);
        }

        .header-btn-icon:focus {
          outline: none;
        }
        
        .dropdown-menu {
          position: absolute;
          background: #000;
          border: 2px solid #555;
          border-radius: 8px;
          padding: 8px;
          min-width: 180px;
          z-index: 10000;
          box-shadow: 0 4px 16px rgba(0,0,0,0.9);
        }
        
        .dropdown-backdrop {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          z-index: 9999;
        }
        
        .dropdown-item {
          width: 100%;
          padding: 12px 16px;
          background: transparent;
          border: none;
          color: #fff;
          text-align: left;
          cursor: pointer;
          border-radius: 4px;
          font-size: 14px;
          display: block;
        }
        
        .dropdown-item:hover {
          background: rgba(255, 255, 255, 0.1);
        }
        
        .dropdown-item:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }
      `}),h.jsxs("div",{className:"solve-header",children:[h.jsxs("div",{className:"solve-header-left",children:[h.jsx("button",{onClick:t,disabled:!e,title:n?"Stop solver":"Find solution",style:{background:n?"linear-gradient(135deg, #ef4444, #dc2626)":"linear-gradient(135deg, #10b981, #059669)",color:"#fff",fontWeight:700,border:"none",fontSize:"16px",padding:"10px 20px",borderRadius:"8px",cursor:e?"pointer":"not-allowed",opacity:e?1:.5,minWidth:"120px",transition:"all 0.2s ease"},children:n?" Stop":" Solve"}),h.jsx("button",{onClick:r,style:{background:"rgba(139, 92, 246, 0.9)",color:"#fff",fontWeight:600,border:"none",fontSize:"14px",padding:"10px 18px",borderRadius:"8px",cursor:"pointer",transition:"all 0.2s ease"},children:" Engine"})]}),h.jsxs("div",{className:"solve-header-right",children:[h.jsx("button",{className:"header-btn-icon",onClick:o,title:"Info",children:""}),h.jsx("button",{className:"header-btn-icon",onClick:i,title:"Environment settings",children:""}),h.jsx("button",{className:"header-btn-icon",onClick:s,title:"Home",children:""})]})]})]}),Tw=({revealK:n,revealMax:e,explosionFactor:t,revealMethod:r="global",onChangeRevealK:i,onChangeExplosionFactor:o,onChangeRevealMethod:s})=>{if(e<=0&&t<=0)return null;const a=Math.round(t*100);return h.jsxs("div",{style:{position:"fixed",bottom:0,left:0,right:0,background:"rgba(0, 0, 0, 0.85)",backdropFilter:"blur(10px)",borderTop:"1px solid rgba(255, 255, 255, 0.1)",padding:"12px 20px",display:"flex",alignItems:"center",justifyContent:"center",gap:"20px",zIndex:1e3,userSelect:"none"},children:[h.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",width:"400px"},children:[h.jsx("label",{style:{color:"#fff",fontSize:"13px",fontWeight:500,whiteSpace:"nowrap"},children:"Explosion"}),h.jsx("input",{type:"range",min:0,max:100,step:1,value:a,onChange:l=>o(parseInt(l.target.value,10)/100||0),style:{flex:1,cursor:"pointer"}})]}),e>0&&h.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[h.jsx("button",{onClick:()=>i(Math.max(1,n-1)),disabled:n<=1,style:{background:n<=1?"rgba(255, 255, 255, 0.1)":"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"4px",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:n<=1?"not-allowed":"pointer",color:n<=1?"rgba(255, 255, 255, 0.3)":"#fff",fontSize:"20px",transition:"all 0.2s",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},title:"Reveal previous piece",children:""}),h.jsx("button",{onClick:()=>i(Math.min(e,n+1)),disabled:n>=e,style:{background:n>=e?"rgba(255, 255, 255, 0.1)":"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"4px",width:"40px",height:"40px",display:"flex",alignItems:"center",justifyContent:"center",cursor:n>=e?"not-allowed":"pointer",color:n>=e?"rgba(255, 255, 255, 0.3)":"#fff",fontSize:"20px",transition:"all 0.2s",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},title:"Reveal next piece",children:""}),s&&h.jsx("button",{onClick:()=>{s(r==="global"?"connected":r==="connected"?"supported":"global")},title:r==="global"?"Global: lowest Y everywhere  Click for Connected":r==="connected"?"Connected: grows from lowest piece  Click for Supported":"Supported: most stable ground-up assembly  Click for Global",style:{background:"rgba(255, 255, 255, 0.15)",border:"1px solid rgba(255, 255, 255, 0.25)",borderRadius:"6px",padding:"8px 12px",color:"#fff",fontSize:"11px",cursor:"pointer",fontWeight:600,transition:"all 0.2s",whiteSpace:"nowrap",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onMouseEnter:l=>{l.currentTarget.style.background="rgba(255, 255, 255, 0.25)",l.currentTarget.style.borderColor="rgba(255, 255, 255, 0.4)"},onMouseLeave:l=>{l.currentTarget.style.background="rgba(255, 255, 255, 0.15)",l.currentTarget.style.borderColor="rgba(255, 255, 255, 0.25)"},children:r==="global"?" Global":r==="connected"?" Connected":" Supported"})]})]})},fO=({status:n,solutionsFound:e,isAutoSolving:t})=>{if(!n||!t)return null;const r=n.nodes??0,i=n.nodesPerSec!==void 0?n.nodesPerSec:null,o=n.elapsedMs??0,s=n.bestDepth??n.depth??0,a=n.restartCount??0,l=n.shuffleStrategy,c=n.restartInterval,u=n.restartIntervalSeconds,d=()=>l==="periodicRestartTime"&&u?`every ${u}s`:l==="periodicRestart"&&c?`every ${c.toLocaleString()} nodes`:l==="adaptive"?"when backtracking":l==="initial"?"at start only":"",f=m=>{const v=Math.floor(m/1e3),_=Math.floor(v/60),x=Math.floor(_/60);return x>0?`${x}h ${_%60}m ${v%60}s`:_>0?`${_}m ${v%60}s`:`${v}s`};return h.jsxs("div",{style:{position:"absolute",top:"20px",right:"20px",background:"rgba(0,0,0,0.8)",padding:"16px",borderRadius:"12px",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.1)",minWidth:"250px",zIndex:1e3},children:[h.jsx("div",{style:{fontSize:"14px",color:"#fff",marginBottom:"8px",fontWeight:600},children:" Solver Status"}),h.jsxs("div",{style:{fontSize:"13px",color:"rgba(255,255,255,0.7)",display:"flex",flexDirection:"column",gap:"4px"},children:[h.jsxs("div",{children:["Time: ",f(o)]}),h.jsxs("div",{children:["Depth: ",n.depth]}),h.jsxs("div",{children:["Max Depth: ",s]}),h.jsxs("div",{children:["Nodes: ",r.toLocaleString()]}),a>0&&h.jsxs("div",{children:["Shuffles: ",a," ",d()&&`(${d()})`]}),i!==null&&h.jsxs("div",{children:["Speed: ",i.toLocaleString()," nodes/sec"]}),e>0&&h.jsxs("div",{style:{color:"#10b981",fontWeight:600,marginTop:"4px"},children:[" ",e," solution",e>1?"s":""," found"]})]})]})},pO=({isOpen:n,stats:e,onClose:t,draggableRef:r,draggableStyle:i,draggableHeaderStyle:o})=>!n||!e?null:h.jsxs("div",{ref:r,style:{position:"fixed",top:"50%",left:"50%",background:"linear-gradient(135deg, #1e88e5, #42a5f5)",color:"white",padding:"32px 40px",borderRadius:"16px",fontSize:"20px",fontWeight:"bold",textAlign:"center",boxShadow:"0 12px 40px rgba(30, 136, 229, 0.5)",zIndex:2e3,maxWidth:"400px",minWidth:"320px",...i},children:[h.jsx("div",{style:{position:"absolute",top:"8px",left:"50%",transform:"translateX(-50%)",width:"60px",height:"4px",background:"rgba(255, 255, 255, 0.4)",borderRadius:"2px",...o}}),h.jsx("button",{onClick:t,style:{position:"absolute",top:"12px",right:"12px",background:"transparent",border:"none",color:"white",fontSize:"28px",cursor:"pointer",padding:"4px 8px",lineHeight:"1",opacity:.8,fontWeight:"normal"},title:"Close",children:""}),h.jsx("div",{style:{fontSize:"64px",marginBottom:"16px"},children:""}),h.jsx("div",{style:{fontSize:"32px",fontWeight:700,marginBottom:"8px",color:"#ffffff"},children:"Solution Found!"}),h.jsx("div",{style:{fontSize:"18px",fontWeight:600,marginBottom:"24px",opacity:.95},children:"Puzzle Solved by Engine 2"}),h.jsxs("div",{style:{fontSize:"15px",fontWeight:"normal",lineHeight:"1.8",textAlign:"left",background:"rgba(0,0,0,0.2)",padding:"20px",borderRadius:"12px",marginBottom:"20px",color:"#ffffff"},children:[h.jsx("div",{style:{marginBottom:"12px",fontSize:"16px",fontWeight:600},children:" Auto-Solve Complete!"}),h.jsxs("div",{children:[h.jsx("strong",{children:" Date:"})," ",new Date().toLocaleDateString()]}),h.jsxs("div",{children:[h.jsx("strong",{children:" Pieces:"})," ",e.pieceCount]}),h.jsxs("div",{children:[h.jsx("strong",{children:" Cells:"})," ",e.cellCount]})]}),h.jsx("div",{style:{fontSize:"14px",fontWeight:"normal",opacity:.9,padding:"12px",background:"rgba(0,0,0,0.15)",borderRadius:"8px"},children:" Your solution has been automatically saved!"})]}),Zg="solve.autoSolveStats";function mO(n){try{const e=Cw();e.push(n),localStorage.setItem(Zg,JSON.stringify(e)),console.log(" Auto-solve run stats appended:",n)}catch(e){console.error("Failed to append auto-solve run stats:",e)}}function Cw(){try{const n=localStorage.getItem(Zg);return n?JSON.parse(n):[]}catch(n){return console.error("Failed to load auto-solve run stats:",n),[]}}function gO(){try{localStorage.removeItem(Zg),console.log(" Auto-solve run stats cleared")}catch(n){console.error("Failed to clear auto-solve run stats:",n)}}function vO(n){const e=Cw();if(e.length===0){console.warn("No auto-solve runs to export");return}const t=["timestampIso","puzzleId","puzzleName","mode","seed","timeoutSec","success","stopReason","timeToSolutionMs","elapsedMs","nodes","nodesToSolution","bestPlaced","totalPiecesTarget","tailTriggered","tailSize","restartCount","shuffleStrategy","randomizeTies","nodesPerSecAvg"],r=c=>{if(c==null||c==="")return"";const u=String(c);return u.includes(",")||u.includes('"')||u.includes(`
`)?`"${u.replace(/"/g,'""')}"`:u},i=e.map(c=>t.map(u=>r(c[u])).join(",")),o=[t.join(","),...i].join(`
`),s=new Blob([o],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),l=URL.createObjectURL(s);a.setAttribute("href",l),a.setAttribute("download",n||`autosolve-stats-${new Date().toISOString().split("T")[0]}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(l),console.log(` Downloaded CSV with ${e.length} runs`)}function xO(n){const{mode:e,stopReason:t,success:r,tailTriggered:i}=n,o={exhaustive:"High coverage",balanced:"Best trade-off",fast:"Fast exploration"};let s;r?s=" Solution found":t==="timeout"?s=" No solution found in the allotted time":t==="complete"?s=" Search completed with no solution found":t==="canceled"?s=" Search canceled":s=" Search stopped";let a;e==="exhaustive"?r?a="Exhaustive mode searches one path thoroughly without restarting or skipping ahead. This run found a solution by continuing steadily until the puzzle could be completed.":t==="complete"?a="Exhaustive mode is designed for high coverage. It avoids restarts and avoids randomness that could skip possibilities. If it finishes with no solution, that result is meaningful within the solver's current rules and piece set.":a="Exhaustive mode prioritizes coverage over speed. If you want faster exploration, try Balanced with restarts, or increase the timeout.":e==="balanced"?r?a="Balanced mode explores multiple promising regions. It uses controlled randomness and optional restarts to avoid getting stuck in one part of the search. A solution was found in one of these regions.":a='Balanced mode does not guarantee full coverage. Restarts start the search over and do not "remember" which parts were already explored. If you believe a solution exists, try Exhaustive for higher confidence.':r?a="Fast mode samples the search space aggressively. It's designed to try many different starts quickly. Great for finding some solution fast, but not meant for guarantees.":a="Fast mode does not prove anything. It intentionally skips large parts of the search space to explore variety quickly. If you want reliability, switch to Balanced or Exhaustive.";let l;i===!0?l="Endgame turbo activated: When the remaining open cells became small, the solver switched to a fast exact-cover endgame search to finish efficiently.":i===!1&&!r&&(l='Endgame turbo did not activate in this run. The search did not reach the small "endgame" threshold before stopping.');let c;r?c=["Run again to look for another solution.","Export stats (CSV) if you're comparing modes."]:e==="fast"?c=["Run again with a new seed.","Try Balanced for better consistency.","Try Exhaustive for maximum confidence."]:e==="balanced"?c=["Increase timeout if the puzzle is hard.","Try Exhaustive to avoid missing solutions.","Try Fast if you want more variety quickly."]:c=["Increase timeout (Exhaustive can be slow).","Try Balanced to explore alternative regions sooner."];const u=[];return e!=="balanced"&&u.push({label:"Try Balanced",action:"switchMode",mode:"balanced"}),e!=="exhaustive"&&!r&&u.push({label:"Try Exhaustive",action:"switchMode",mode:"exhaustive"}),e!=="fast"&&u.push({label:"Try Fast",action:"switchMode",mode:"fast"}),{title:s,truthLabel:o[e],body:a,tailNote:l,suggestions:c,actions:{primary:{label:"Run again (new seed)",action:"runAgain"},secondary:u,utility:[{label:"Export stats (CSV)",action:"exportCSV"},{label:"Close",action:"close"}]}}}function aa(n){if(n==null||!isFinite(n))return"";if(n<1e3)return`${n.toFixed(0)} ms`;const e=n/1e3;if(e<60)return`${e.toFixed(1)} s`;const t=Math.floor(e/60),r=e%60;return`${t}m ${r.toFixed(0)}s`}function qi(n){return n==null||!isFinite(n)?"":n.toLocaleString()}function yO(n){return n==null||!isFinite(n)?"":n>=1e6?`${(n/1e6).toFixed(2)} M/s`:n>=1e3?`${(n/1e3).toFixed(1)} K/s`:`${n.toFixed(0)} /s`}function _O(n,e){return n==null||e==null?"":`${n} / ${e}`}const bO=({open:n,onClose:e,result:t,onRunAgain:r,onSwitchMode:i,onExportCSV:o})=>{const s=gc();if(!n||!t)return null;const a=xO({mode:t.mode,stopReason:t.stopReason,success:t.success,tailTriggered:t.tailTriggered}),l=c=>c==="exhaustive"?"#3b82f6":c==="fast"?"#f59e0b":"#22c55e";return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .autosolver-modal-scrollable::-webkit-scrollbar {
          width: 12px;
        }
        .autosolver-modal-scrollable::-webkit-scrollbar-track {
          background: rgba(59, 130, 246, 0.1);
          border-radius: 10px;
          margin: 20px 0;
        }
        .autosolver-modal-scrollable::-webkit-scrollbar-thumb {
          background: linear-gradient(180deg, #3b82f6, #2563eb);
          border-radius: 10px;
          border: 2px solid rgba(219, 234, 254, 0.5);
        }
        .autosolver-modal-scrollable::-webkit-scrollbar-thumb:hover {
          background: linear-gradient(180deg, #2563eb, #1d4ed8);
        }
        .autosolver-modal-scrollable::-webkit-scrollbar-thumb:active {
          background: #1d4ed8;
        }
        .autosolver-modal-scrollable {
          scrollbar-width: thin;
          scrollbar-color: #3b82f6 rgba(59, 130, 246, 0.1);
        }
      `}),h.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"transparent",backdropFilter:"none",zIndex:1e4},onClick:e}),h.jsxs("div",{ref:s.ref,className:"autosolver-modal-scrollable",style:{position:"fixed",top:"50%",left:"50%",background:"linear-gradient(135deg, #dbeafe 0%, #bfdbfe 50%, #93c5fd 100%)",borderRadius:"20px",padding:"0",maxWidth:"600px",width:"90%",maxHeight:"85vh",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",border:"3px solid rgba(59,130,246,0.6)",zIndex:10001,...s.style},onClick:c=>c.stopPropagation(),children:[h.jsxs("div",{style:{background:t.success?"linear-gradient(135deg, #10b981, #059669, #047857)":"linear-gradient(135deg, #ef4444, #dc2626, #b91c1c)",padding:"1.25rem 1.5rem",borderRadius:"17px 17px 0 0",borderBottom:"3px solid rgba(255,255,255,0.3)",boxShadow:t.success?"0 4px 20px rgba(16,185,129,0.4)":"0 4px 20px rgba(239,68,68,0.4)",position:"relative",userSelect:"none",flexShrink:0,...s.headerStyle},children:[h.jsx("h2",{style:{margin:0,fontSize:"1.5rem",color:"#fff",fontWeight:700,textShadow:"0 2px 4px rgba(0,0,0,0.2)"},children:a.title}),h.jsxs("div",{style:{fontSize:"0.875rem",marginTop:"0.5rem",color:"rgba(255,255,255,0.95)"},children:["Mode: ",t.mode.charAt(0).toUpperCase()+t.mode.slice(1)," (",a.truthLabel,")  Seed: ",t.seed,t.success&&t.timeToSolutionMs?h.jsxs(h.Fragment,{children:["  Found in: ",aa(t.timeToSolutionMs),"  Total: ",aa(t.elapsedMs)]}):h.jsxs(h.Fragment,{children:["  Total: ",aa(t.elapsedMs)]})]}),h.jsx("button",{onClick:c=>{c.stopPropagation(),e()},onTouchEnd:c=>{c.stopPropagation(),e()},style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255,255,255,0.2)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"20px",color:"#fff",fontWeight:700,transition:"all 0.2s",touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},children:""})]}),h.jsxs("div",{style:{padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem",overflowY:"auto",flex:1,color:"#1e40af"},children:[h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[h.jsxs("div",{style:{padding:"1rem",background:"#f0f9ff",borderLeft:"3px solid #3b82f6",borderRadius:"6px"},children:[h.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,marginBottom:"0.5rem",color:"#3b82f6"},children:"PUZZLE"}),h.jsx("div",{style:{fontSize:"0.875rem",marginBottom:"0.25rem"},children:h.jsx("strong",{children:t.puzzleName})}),h.jsxs("div",{style:{fontSize:"0.75rem",color:"#666"},children:[t.totalPiecesTarget," pieces target"]})]}),h.jsxs("div",{style:{padding:"1rem",background:"#fef3c7",borderLeft:`3px solid ${l(t.mode)}`,borderRadius:"6px"},children:[h.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600,marginBottom:"0.5rem",color:l(t.mode)},children:"STRATEGY"}),h.jsxs("div",{style:{fontSize:"0.875rem",marginBottom:"0.25rem"},children:[h.jsx("strong",{children:t.mode.charAt(0).toUpperCase()+t.mode.slice(1)}),"  ",a.truthLabel]}),h.jsxs("div",{style:{fontSize:"0.75rem",color:"#666",marginBottom:"0.25rem"},children:["Tail: ",t.tailTriggered?"Yes":"No","  Restarts: ",t.shuffleStrategy,"  Random: ",t.randomizeTies?"Yes":"No"]}),h.jsxs("div",{style:{fontSize:"0.75rem",color:"#999",fontStyle:"italic"},children:["Stopped: ",t.stopReason]})]})]}),h.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[h.jsxs("div",{style:{flex:1,minWidth:"120px",padding:"0.75rem",background:"#f0fdf4",borderRadius:"6px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"0.7rem",fontWeight:600,color:"#16a34a"},children:"BEST PROGRESS"}),h.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,marginTop:"0.25rem"},children:_O(t.bestPlaced,t.totalPiecesTarget)})]}),h.jsxs("div",{style:{flex:1,minWidth:"120px",padding:"0.75rem",background:"#fef3c7",borderRadius:"6px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"0.7rem",fontWeight:600,color:"#f59e0b"},children:"ELAPSED"}),h.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,marginTop:"0.25rem"},children:aa(t.elapsedMs)})]}),h.jsxs("div",{style:{flex:1,minWidth:"120px",padding:"0.75rem",background:"#f0f9ff",borderRadius:"6px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"0.7rem",fontWeight:600,color:"#3b82f6"},children:"NODES"}),h.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,marginTop:"0.25rem"},children:qi(t.nodes)})]}),h.jsxs("div",{style:{flex:1,minWidth:"120px",padding:"0.75rem",background:"#f0fdf4",borderRadius:"6px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"0.7rem",fontWeight:600,color:"#16a34a"},children:"SPEED"}),h.jsx("div",{style:{fontSize:"1.1rem",fontWeight:700,marginTop:"0.25rem"},children:yO(t.nodesPerSecAvg)})]})]}),h.jsx("div",{style:{padding:"1rem",background:t.success?"#f0fdf4":"#fef3c7",borderRadius:"6px",fontSize:"0.875rem",lineHeight:"1.5",color:"#333"},children:a.body}),a.tailNote&&h.jsx("div",{style:{padding:"0.75rem",background:"#f0f9ff",borderRadius:"6px",fontSize:"0.75rem",color:"#666",fontStyle:"italic"},children:a.tailNote}),h.jsxs("div",{children:[h.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,marginBottom:"0.5rem",color:"#666"},children:"What should I do next?"}),h.jsx("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.875rem",color:"#333"},children:a.suggestions.map((c,u)=>h.jsx("li",{style:{marginBottom:"0.25rem"},children:c},u))})]}),h.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginTop:"1rem"},children:[h.jsx("button",{onClick:r,style:{padding:"0.75rem 1rem",background:"#3b82f6",color:"#fff",border:"none",borderRadius:"6px",fontSize:"0.9rem",fontWeight:600,cursor:"pointer"},children:a.actions.primary.label}),a.actions.secondary.map((c,u)=>h.jsx("button",{onClick:()=>i&&i(c.mode),style:{padding:"0.75rem 1rem",background:l(c.mode),color:"#fff",border:"none",borderRadius:"6px",fontSize:"0.9rem",fontWeight:600,cursor:"pointer"},children:c.label},u)),h.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:a.actions.utility.map((c,u)=>h.jsx("button",{onClick:c.action==="exportCSV"?o:e,style:{flex:1,padding:"0.75rem 1rem",background:c.action==="exportCSV"?"#f59e0b":"#6b7280",color:"#fff",border:"none",borderRadius:"6px",fontSize:"0.9rem",fontWeight:600,cursor:"pointer"},children:c.label},u))})]})]})]})]})},py="solve.anonSessionId";function SO(){try{const n=localStorage.getItem(py);if(n&&n.length>=20)return n;const e=crypto.randomUUID();return localStorage.setItem(py,e),console.log(" Generated new anonymous session ID:",e),e}catch(n){return console.error("Failed to get/create anonymous session ID:",n),crypto.randomUUID()}}async function wO(n){try{const{data:e,error:t}=await bt.from("puzzle_stats").select("*").eq("puzzle_id",n).single();if(t){if(t.code==="PGRST116")return console.log("No puzzle_stats row found for",n),null;throw t}return e}catch(e){return console.error("Error fetching puzzle stats:",e),null}}function EO(n){return n?{nodesPerSolution:n.auto_solutions_found>0?Math.round(n.auto_nodes_total/n.auto_solutions_found):0,avgTimePerAutoRun:n.auto_runs_count>0?Math.round(n.auto_elapsed_ms_total/n.auto_runs_count):0,avgTimePerManualSolve:n.manual_solutions_count>0?Math.round(n.manual_solve_time_ms_total/n.manual_solutions_count):0,avgMovesPerManualSolve:n.manual_solutions_count>0?Math.round(n.manual_move_count_total/n.manual_solutions_count):0,autoSuccessRate:n.auto_runs_count>0?Math.round(n.auto_success_count/n.auto_runs_count*100):0}:{nodesPerSolution:0,avgTimePerAutoRun:0,avgTimePerManualSolve:0,avgMovesPerManualSolve:0,autoSuccessRate:0}}const MO=({stats:n,loading:e})=>{if(e)return h.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#666",fontSize:"0.875rem"},children:"Loading community stats..."});if(!n)return h.jsx("div",{style:{padding:"1rem",textAlign:"center",color:"#666",fontSize:"0.875rem"},children:"No community stats available yet. Be the first to try this puzzle!"});const t=EO(n);return h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.4)",borderRadius:"12px",padding:"1.25rem",marginTop:"1rem"},children:[h.jsxs("div",{style:{fontSize:"1rem",fontWeight:700,marginBottom:"0.75rem",color:"#1e40af",display:"flex",alignItems:"center",gap:"0.5rem"},children:[h.jsx("span",{children:""}),h.jsx("span",{children:"Community Effort"})]}),h.jsx("div",{style:{fontSize:"0.75rem",color:"#64748b",marginBottom:"1rem",fontStyle:"italic"},children:"This is the combined effort of everyone who tried this puzzle"}),n.auto_runs_count>0&&h.jsxs("div",{style:{marginBottom:"1rem"},children:[h.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,marginBottom:"0.5rem",color:"#3b82f6"},children:" Auto-Solve Attempts"}),h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem",fontSize:"0.8rem",color:"#475569"},children:[h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#1e40af"},children:qi(n.auto_runs_count)}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Total attempts"})]}),h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#10b981"},children:qi(n.auto_solutions_found)}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Solutions found"})]}),h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#3b82f6"},children:qi(n.auto_nodes_total)}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Total nodes searched"})]}),h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#8b5cf6"},children:aa(n.auto_elapsed_ms_total)}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Total time spent"})]})]}),n.auto_solutions_found>0&&h.jsxs("div",{style:{marginTop:"0.75rem",padding:"0.75rem",background:"rgba(59, 130, 246, 0.1)",borderRadius:"8px",fontSize:"0.8rem",color:"#1e40af",borderLeft:"3px solid #3b82f6"},children:[h.jsx("div",{style:{fontWeight:600,marginBottom:"0.25rem"},children:" Solution Scarcity"}),h.jsxs("div",{style:{fontSize:"0.75rem"},children:["1 solution per ~",qi(t.nodesPerSolution)," nodes explored"]})]}),n.auto_solutions_found===0&&h.jsxs("div",{style:{marginTop:"0.75rem",padding:"0.75rem",background:"rgba(239, 68, 68, 0.1)",borderRadius:"8px",fontSize:"0.8rem",color:"#991b1b",borderLeft:"3px solid #ef4444"},children:[h.jsx("div",{style:{fontWeight:600},children:" No auto solutions recorded yet"}),h.jsx("div",{style:{fontSize:"0.75rem",marginTop:"0.25rem"},children:"This is a challenging puzzle! Be the first to solve it."})]})]}),n.manual_solutions_count>0&&h.jsxs("div",{children:[h.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,marginBottom:"0.5rem",color:"#10b981"},children:" Manual Solutions"}),h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.5rem",fontSize:"0.8rem",color:"#475569"},children:[h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#10b981"},children:qi(n.manual_solutions_count)}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Completed solves"})]}),h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#8b5cf6"},children:aa(n.manual_solve_time_ms_total)}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Total time"})]}),h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#3b82f6"},children:qi(n.manual_move_count_total)}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Total moves"})]}),h.jsxs("div",{children:[h.jsx("div",{style:{fontWeight:600,color:"#f59e0b"},children:t.avgMovesPerManualSolve}),h.jsx("div",{style:{fontSize:"0.7rem",color:"#64748b"},children:"Avg moves/solve"})]})]})]}),n.solutions_total>0&&h.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"rgba(16, 185, 129, 0.1)",borderRadius:"8px",fontSize:"0.8rem",color:"#047857",textAlign:"center",fontWeight:600},children:[" ",qi(n.solutions_total)," total solution",n.solutions_total===1?"":"s"," discovered"]})]})},TO=()=>{var Oi,ii,oi,si,R,B,J,Q,V;const n=Jn(),{id:e}=ac(),{puzzle:t,loading:r,error:i}=Vg(e),{service:o,loading:s,error:a}=mc(),l=[[.5,.5,0,0],[.5,0,.5,0],[0,.5,.5,0],[0,0,0,1]],[c,u]=S.useState([]),[d,f]=S.useState(null),[m,v]=S.useState(!1),[_,x]=S.useState(!1),[p,b]=S.useState(null),[g,y]=S.useState(null),[E,C]=S.useState(0),[A,T]=S.useState([]),[w,M]=S.useState(()=>{const q=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?1e3:250,le=localStorage.getItem("solve.autoSolveSettings");if(le)try{const xe=JSON.parse(le);return xe.statusIntervalMs||(xe.statusIntervalMs=q),xe}catch{return{timeoutMs:6e4,statusIntervalMs:q}}return{timeoutMs:6e4,statusIntervalMs:q}}),P=S.useRef(null),{user:I}=dc(),D=S.useRef(new Sw),[$,W]=S.useState(Ht),[H,Z]=S.useState(!1),[F,Y]=S.useState("metallic-light"),[X,oe]=S.useState(!1),[pe,De]=S.useState(null),[z,ve]=S.useState("info"),[j,ne]=S.useState(null),[Ee,me]=S.useState(!1),[te,Pe]=S.useState(null),[je,L]=S.useState(0),[Fe,Re]=S.useState(0),[Ne,de]=S.useState(0),Se=1;S.useEffect(()=>{I!=null&&I.id&&(console.log(" [AutoSolvePage] Loading settings from DB for user:",I.id),D.current.loadSettingsFromDB(I.id).then(O=>{O&&(console.log(" [AutoSolvePage] DB settings loaded"),W(O))}))},[I==null?void 0:I.id]),S.useEffect(()=>{I!=null&&I.id&&(console.log(" [AutoSolvePage] Saving settings to DB"),D.current.saveSettingsToDB(I.id,$))},[$,I==null?void 0:I.id]);const Ue=S.useRef(0),ze=S.useRef("balanced"),Ke=S.useRef(0),it=S.useRef(0),N=S.useRef(20),k=S.useRef(!0),G=S.useRef(0),ue=S.useRef(!1),Me=S.useRef(null),ge=S.useRef(null),$e=S.useRef(!1),ke=S.useRef(""),We=S.useRef(null),Je=S.useRef(!1),_e=S.useRef(null),[Le,qe]=S.useState(null),[re,ie]=S.useState(!1),[we,U]=S.useState(null),[se,he]=S.useState(!1),[Oe,Te]=S.useState(null),ce=gc();S.useEffect(()=>{if(t){console.log(" Loading puzzle for auto-solve:",t.name);try{const O=t.geometry;u(O);const q=vs(O,ms,l,xs);f(q),v(!0),console.log(` Puzzle loaded: ${O.length} cells`)}catch(O){console.error("Failed to load puzzle:",O),De("Failed to load puzzle geometry"),ve("error")}}},[t]),S.useEffect(()=>{m&&qg().then(O=>{if(console.log(" Pieces database loaded"),b(O),t!=null&&t.geometry&&O)try{const q=t.geometry.map(xe=>Array.isArray(xe)?xe:[xe.i,xe.j,xe.k]),le=Ew({cells:q,id:t.id},O,{mode:"unique",totalPieces:Math.floor(t.geometry.length/4)});console.log(" [AutoSolvePage] Search space stats computed:",le.upperBounds.fixedInventoryNoOverlap.sci),Te(le)}catch(q){console.error(" Failed to compute search space stats:",q)}}).catch(O=>{console.error(" Failed to load pieces:",O),De("Failed to load pieces database"),ve("error")})},[m,t]),S.useEffect(()=>{if(!(t!=null&&t.id)||!X)return;(async()=>{he(!0);try{const q=await wO(t.id);U(q),console.log(" Loaded puzzle stats:",q)}catch(q){console.error("Failed to load puzzle stats:",q),U(null)}finally{he(!1)}})()},[t==null?void 0:t.id,X]);const K=async O=>{const{GoldOrientationService:q}=await So(async()=>{const{GoldOrientationService:fe}=await Promise.resolve().then(()=>eN);return{GoldOrientationService:fe}},void 0),le=new q;await le.load();const xe=[];for(const fe of O){const ee=le.getOrientations(fe.pieceId);if(!ee||fe.ori>=ee.length)continue;const Ce=ee[fe.ori],He={i:fe.t[0],j:fe.t[1],k:fe.t[2]},Ye=Ce.ijkOffsets.map(Qe=>({i:He.i+Qe.i,j:He.j+Qe.j,k:He.k+Qe.k}));xe.push({pieceId:fe.pieceId,orientationId:Ce.orientationId,anchorSphereIndex:0,cells:Ye,uid:`auto-${fe.pieceId}-${xe.length}`,placedAt:Date.now()+xe.length})}return xe},be=async O=>{const q=await K(O);y(q),C(0),ne({solutionId:null,pieceCount:q.length,cellCount:q.flatMap(le=>le.cells).length,savedAt:new Date().toLocaleString()})},Be=()=>{y(null),C(0),T([]),ne(null)},Ze=O=>{var le,xe;try{ke.current=crypto.randomUUID()}catch{ke.current=`run-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}const q=ke.current;return console.log(" Run started - initializing context, runId:",q),Ue.current=performance.now(),$e.current=!1,We.current=null,Je.current=!1,Ke.current=O.seed??0,it.current=(O.timeoutMs??0)/1e3,N.current=((le=O.tailSwitch)==null?void 0:le.tailSize)??20,k.current=((xe=O.tailSwitch)==null?void 0:xe.enable)??!0,G.current=0,ue.current=!1,Me.current=null,ge.current=null,O.randomizeTies===!1&&O.shuffleStrategy==="none"?ze.current="exhaustive":O.randomizeTies===!0&&O.shuffleStrategy!=="none"?ze.current="fast":ze.current="balanced",{runId:q}},lt=(O,q)=>{var xe,fe,ee,Ce,He,Ye;if(O!==ke.current){console.log(" Ignoring onDone from stale run:",O,"current:",ke.current);return}if($e.current){console.log(" Run already logged, skipping");return}console.log(" DONE summary:",q);const le={timestampIso:new Date().toISOString(),puzzleId:(t==null?void 0:t.id)??"unknown",puzzleName:(t==null?void 0:t.name)??"Unknown",mode:ze.current,seed:Ke.current,timeoutSec:it.current,success:(q.solutions??0)>0,stopReason:q.reason??"complete",timeToSolutionMs:ge.current,elapsedMs:Math.round(q.elapsedMs??0),nodes:q.nodes??0,nodesToSolution:Me.current,bestPlaced:((xe=We.current)==null?void 0:xe.bestPlaced)??((fe=We.current)==null?void 0:fe.placed)??0,totalPiecesTarget:((ee=We.current)==null?void 0:ee.totalPiecesTarget)??Math.floor((((Ce=t==null?void 0:t.geometry)==null?void 0:Ce.length)??100)/4),tailTriggered:((He=We.current)==null?void 0:He.tailTriggered)??!1,tailSize:N.current,restartCount:((Ye=We.current)==null?void 0:Ye.restartCount)??G.current,shuffleStrategy:w.shuffleStrategy??"none",randomizeTies:w.randomizeTies??!1,nodesPerSecAvg:q.elapsedMs>0?Math.round(q.nodes/q.elapsedMs*1e3):0};mO(le),$e.current=!0,ut(le).catch(Qe=>{console.error("Failed to insert solver_runs telemetry:",Qe)}),qe(le),ie(!0)},ut=async O=>{var q;try{const{data:{session:le}}=await bt.auth.getSession(),xe=((q=le==null?void 0:le.user)==null?void 0:q.id)||null,fe=xe?null:SO(),{data:ee,error:Ce}=await bt.from("solver_runs").insert({puzzle_id:(t==null?void 0:t.id)??null,solution_id:null,user_id:xe,anon_session_id:fe,app_version:"50.14.0",engine_name:"engine2",mode:O.mode,seed:Math.round(O.seed),timeout_ms:Math.round(O.timeoutSec*1e3),tail_enable:O.tailSize>0,tail_size:Math.round(O.tailSize),shuffle_strategy:O.shuffleStrategy,randomize_ties:O.randomizeTies,success:O.success,stop_reason:O.stopReason,solutions_found:O.success?1:0,elapsed_ms:Math.round(O.elapsedMs),time_to_solution_ms:O.timeToSolutionMs?Math.round(O.timeToSolutionMs):null,nodes_total:Math.round(O.nodes),nodes_to_solution:O.nodesToSolution?Math.round(O.nodesToSolution):null,best_placed:Math.round(O.bestPlaced),total_pieces_target:Math.round(O.totalPiecesTarget),tail_triggered:O.tailTriggered,restart_count:Math.round(O.restartCount)}).select("id").single();if(Ce){console.error(" Telemetry insert error:",Ce),console.error(" Error details:",JSON.stringify(Ce,null,2)),console.error(" Attempted insert data:",{puzzle_id:t==null?void 0:t.id,user_id:xe,anon_session_id:fe,mode:O.mode,stop_reason:O.stopReason});return}ee!=null&&ee.id&&(_e.current=ee.id,console.log(" Telemetry logged, solver_run_id:",ee.id))}catch(le){console.error(" Exception inserting telemetry:",le)}},wt=()=>{const O=Date.now()%1e6;M({...w,seed:O}),ie(!1),setTimeout(()=>{ti()},100)},mt=O=>{ie(!1),x(!0)},vt=(O,q)=>{O===ke.current&&(We.current=q)},St=O=>{var q;O===ke.current&&(Je.current=!0,Me.current=((q=We.current)==null?void 0:q.nodes)??null,ge.current=performance.now()-Ue.current)},Yt=()=>{window.confirm("Clear all auto-solve statistics? This cannot be undone.")&&(gO(),De("Statistics cleared"),ve("info"))},{isAutoSolving:Nt,autoSolveStatus:Zt,autoSolutionsFound:yn,handleAutoSolve:ti,handleStopAutoSolve:ni,handleResumeAutoSolve:Fr}=uO({puzzle:t,loaded:m,piecesDb:p,engineSettings:w,onSolutionFound:be,onResetSolution:Be,notify:(O,q)=>{De(O),ve(q)},onRunStart:Ze,onRunDone:lt,onStatus:vt,onSolution:St,pendingSeedRef:P});bw({puzzle:t,cells:c,placed:new Map((g==null?void 0:g.map(O=>[O.uid,O]))||[]),solveStartTime:(j==null?void 0:j.startTime)||null,moveCount:0,solveActions:[],getSolveStats:()=>({total_moves:0,undo_count:0,hints_used:0,solvability_checks_used:0,duration_ms:(j==null?void 0:j.solveTimeMs)||0}),setIsComplete:()=>{},setSolveEndTime:()=>{},setRevealK:()=>{},setShowCompletionCelebration:()=>{},setCurrentSolutionId:Pe,setShowSuccessModal:me,setNotification:De,setNotificationType:ve}),S.useEffect(()=>{if(!g||E>=g.length)return;const O=setInterval(()=>{C(q=>Math.min(q+1,g.length))},200/Se);return()=>clearInterval(O)},[g,E,Se]),S.useEffect(()=>{if(!(!g||!j)&&E>=g.length&&E>0){const O=setTimeout(()=>{me(!0)},3e3);return()=>clearTimeout(O)}},[E,g,j]),S.useEffect(()=>{g&&g.length>0?(Re(g.length),L(g.length)):(Re(0),L(0))},[g]),S.useEffect(()=>{if(!Nt||!(Zt!=null&&Zt.stack)||!o){T([]);return}try{const O=o,q=[];for(const le of Zt.stack){const xe=O.getOrientations(le.pieceId);if(!xe||le.ori>=xe.length){console.warn(` Missing orientations for ${le.pieceId} ori ${le.ori}`);continue}const fe=xe[le.ori],ee={i:le.t[0],j:le.t[1],k:le.t[2]},Ce=fe.ijkOffsets.map(rt=>({i:ee.i+rt.i,j:ee.j+rt.j,k:ee.k+rt.k}));if(Ce.some(rt=>!isFinite(rt.i)||!isFinite(rt.j)||!isFinite(rt.k))){console.warn(` Skipping piece ${le.pieceId} with invalid cells:`,Ce);continue}const Ye=new Set;let Qe=!1;for(const rt of Ce){const Ae=`${rt.i},${rt.j},${rt.k}`;if(Ye.has(Ae)){console.warn(` Piece ${le.pieceId} has duplicate cell: ${Ae}`),Qe=!0;break}Ye.add(Ae)}Qe||q.push({pieceId:le.pieceId,orientationId:fe.orientationId,anchorSphereIndex:0,cells:Ce,uid:`intermediate-${le.pieceId}-${q.length}`,placedAt:Date.now()+q.length})}T(q)}catch(O){console.error("Failed to convert stack to pieces:",O)}},[Nt,Zt,o]);const ri=S.useMemo(()=>{if(g){const O=g.slice(0,E);return Fe>0?O.slice(0,je):O}return Nt&&A.length>0?A:[]},[g,E,je,Fe,Nt,A]);return r?h.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",color:"#fff"},children:"Loading puzzle..."}):i||!t?h.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",color:"#fff",gap:"1rem"},children:[h.jsxs("div",{children:[" ",i||"Puzzle not found"]}),h.jsx("button",{className:"pill",onClick:()=>n("/gallery"),style:{background:"rgba(255,255,255,0.1)"},children:" Back to Gallery"})]}):h.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100vh",overflow:"hidden"},children:[h.jsx(hO,{isAutoSolving:Nt,hasPiecesDb:!!p,onSolveClick:()=>{if(Nt)ni();else{if(w.shuffleStrategy==="initial"&&w.randomizeTies===!1){const O=new Date,q=O.getHours()*1e4+O.getMinutes()*100+O.getSeconds();console.log(" SEED:",q),P.current=q,M(le=>({...le,seed:q}))}Fr()}},onOpenEngineSettings:()=>x(!0),onOpenEnvSettings:()=>Z(!0),onOpenInfo:()=>oe(!0),onGoHome:()=>n("/")}),h.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:[m&&d&&h.jsx(Ba,{cells:c,view:d,editMode:!1,mode:"add",onCellsChange:()=>{},placedPieces:ri,hidePlacedPieces:!1,explosionFactor:Ne,alwaysShowContainer:!0,settings:$,visibility:{xray:!1,emptyOnly:!1,sliceY:{center:.5,thickness:1}},containerOpacity:(Oi=$.emptyCells)!=null&&Oi.linkToEnvironment?$.material.opacity:((oi=(ii=$.emptyCells)==null?void 0:ii.customMaterial)==null?void 0:oi.opacity)??.45,containerColor:(si=$.emptyCells)!=null&&si.linkToEnvironment?$.material.color:((B=(R=$.emptyCells)==null?void 0:R.customMaterial)==null?void 0:B.color)??"#ffffff",containerRoughness:(J=$.emptyCells)!=null&&J.linkToEnvironment?$.material.roughness:((V=(Q=$.emptyCells)==null?void 0:Q.customMaterial)==null?void 0:V.roughness)??.35,puzzleMode:"oneOfEach",onSelectPiece:()=>{}}),h.jsx(Tw,{revealK:je,revealMax:Fe,explosionFactor:Ne,onChangeRevealK:O=>L(O),onChangeExplosionFactor:O=>de(O)}),h.jsx(fO,{status:Zt,solutionsFound:yn,isAutoSolving:Nt}),h.jsx(pO,{isOpen:Ee,stats:j,onClose:()=>me(!1),draggableRef:ce.ref,draggableStyle:ce.style,draggableHeaderStyle:ce.headerStyle})]}),_&&h.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:9999,pointerEvents:"none"},children:h.jsx("div",{style:{pointerEvents:"auto"},children:h.jsx(dO,{open:_,engineName:"Engine 2",currentSettings:w,onClose:()=>x(!1),onSave:O=>{M(O),localStorage.setItem("solve.autoSolveSettings",JSON.stringify(O)),x(!1),console.log(" Auto-solve settings saved:",O)},puzzleStats:t&&p?{puzzleName:t.name,containerCells:t.geometry.length,totalSpheres:t.sphere_count,pieceTypeCount:p.size}:void 0})})}),h.jsx(Hd,{isOpen:H,currentPreset:F,onClose:()=>Z(!1),onSelectPreset:(O,q)=>{W(O),Y(q),D.current.saveSettings(O)}}),h.jsxs(Ql,{isOpen:X,onClose:()=>oe(!1),title:"Auto-Solve Page",children:[h.jsxs("div",{style:{fontSize:"14px",lineHeight:"1.6",color:"#4b5563"},children:[h.jsx("p",{children:h.jsx("strong",{children:"Automated Puzzle Solving"})}),h.jsx("p",{children:"This page uses the Engine 2 solver to automatically find solutions to the puzzle."}),h.jsxs("ul",{style:{marginLeft:"20px"},children:[h.jsxs("li",{children:["Click ",h.jsx("strong",{children:"Start Auto-Solve"})," to begin searching"]}),h.jsxs("li",{children:["Use ",h.jsx("strong",{children:"Engine Settings"})," to configure timeout and algorithms"]}),h.jsx("li",{children:"Solutions are automatically saved to the database"}),h.jsxs("li",{children:["Use the ",h.jsx("strong",{children:"Speed"})," slider to control playback speed"]}),h.jsxs("li",{children:["Click ",h.jsx("strong",{children:"Next Solution"})," to find additional solutions"]})]})]}),Oe&&h.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"#f3f4f6",borderRadius:"6px"},children:[h.jsx("p",{style:{margin:0,fontWeight:600},children:" Search Space Complexity"}),h.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"12px"},children:[h.jsx("strong",{children:"Upper bound (no overlap):"})," ",h.jsx("code",{style:{fontSize:"13px",fontWeight:600},children:Oe.upperBounds.fixedInventoryNoOverlap.sci})]}),h.jsxs("p",{style:{margin:"0.35rem 0 0 0",fontSize:"11px",color:"#6b7280"},children:["~10^",Math.floor(Oe.upperBounds.fixedInventoryNoOverlap.log10)," combinations (",Oe.totalPlacements.toLocaleString()," total placements)"]})]}),h.jsx(MO,{stats:we,loading:se})]}),h.jsx(bO,{open:re,onClose:()=>ie(!1),result:Le,onRunAgain:wt,onSwitchMode:mt,onExportCSV:vO,onClearStats:Yt}),pe&&h.jsx(ww,{message:pe,type:z,onClose:()=>De(null)})]})};function CO({puzzle:n,onSelect:e,onEdit:t,onDelete:r,showManagementButtons:i=!1}){const[o,s]=S.useState(!1),[a,l]=S.useState(!1),c=S.useRef(null),u=()=>{s(!0)},d=()=>{s(!1)},f=()=>{e(n.id)},m=()=>{const v=["#4a9eff","#ff6b9d","#ffd93d","#6bcf7f","#a78bfa","#ff8c42"],_=parseInt(n.id,36)%v.length;return v[_]};return h.jsxs("div",{ref:c,onMouseEnter:u,onMouseLeave:d,onClick:f,style:{position:"relative",background:"rgba(30, 30, 30, 0.8)",borderRadius:"12px",overflow:"hidden",cursor:"pointer",transition:"all 0.3s ease",border:o?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(255, 255, 255, 0.1)",transform:o?"translateY(-4px)":"translateY(0)",boxShadow:o?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 4px 16px rgba(0, 0, 0, 0.2)"},children:[h.jsx("div",{style:{width:"100%",aspectRatio:"1",background:n.thumbnailUrl&&!a?"#1a1a1a":`linear-gradient(135deg, ${m()} 0%, ${m()}88 100%)`,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:n.thumbnailUrl&&!a?h.jsx("img",{src:n.thumbnailUrl,alt:n.name,onError:()=>{l(!0)},onLoad:()=>{},style:{width:"100%",height:"100%",objectFit:"cover",display:"block"}}):h.jsxs("div",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"3rem",fontWeight:700,textShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[h.jsx("div",{children:""}),h.jsx("div",{style:{fontSize:"1.5rem"},children:n.cellCount||n.cells.length})]})}),h.jsx("div",{style:{padding:"16px",background:"rgba(20, 20, 20, 0.6)"},children:h.jsx("h3",{style:{color:"#fff",fontSize:"1.1rem",fontWeight:600,margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},children:n.name})}),i&&(t||r)&&h.jsxs("div",{style:{position:"absolute",bottom:"12px",left:"12px",display:"flex",gap:"8px",zIndex:20,opacity:o?1:.9},children:[t&&h.jsx("button",{onClick:v=>{v.stopPropagation(),t(n.id)},style:{background:"linear-gradient(135deg, #2196F3 0%, #1976D2 100%)",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",padding:"6px 10px",fontSize:"0.85rem",fontWeight:600,display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s",boxShadow:"0 2px 8px rgba(33, 150, 243, 0.3)"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 4px 12px rgba(33, 150, 243, 0.5)",v.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 2px 8px rgba(33, 150, 243, 0.3)",v.currentTarget.style.transform="translateY(0)"},title:"Edit puzzle",children:" Edit"}),r&&h.jsx("button",{onClick:v=>{v.stopPropagation(),r(n.id)},style:{background:"linear-gradient(135deg, #f44336 0%, #d32f2f 100%)",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",padding:"6px 10px",fontSize:"0.85rem",fontWeight:600,display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s",boxShadow:"0 2px 8px rgba(244, 67, 54, 0.3)"},onMouseEnter:v=>{v.currentTarget.style.boxShadow="0 4px 12px rgba(244, 67, 54, 0.5)",v.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:v=>{v.currentTarget.style.boxShadow="0 2px 8px rgba(244, 67, 54, 0.3)",v.currentTarget.style.transform="translateY(0)"},title:"Delete puzzle",children:" Delete"})]})]})}function RO({solution:n,onSelect:e,onEdit:t,onDelete:r,showManagementButtons:i=!1}){const[o,s]=S.useState(!1),[a,l]=S.useState(!1),[c,u]=S.useState(!1);return h.jsxs("div",{onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),onClick:()=>e(n.id),style:{position:"relative",background:"rgba(30, 30, 30, 0.8)",borderRadius:"12px",overflow:"hidden",cursor:"pointer",transition:"all 0.3s ease",border:o?"2px solid rgba(255, 255, 255, 0.3)":"2px solid rgba(255, 255, 255, 0.1)",transform:o?"translateY(-4px)":"translateY(0)",boxShadow:o?"0 8px 32px rgba(0, 0, 0, 0.4)":"0 4px 16px rgba(0, 0, 0, 0.2)"},children:[h.jsx("div",{style:{width:"100%",aspectRatio:"16/9",background:n.thumbnail_url&&!a&&c?"#000":n.thumbnail_url&&!a?"#1a1a1a":"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:n.thumbnail_url&&!a?h.jsxs(h.Fragment,{children:[h.jsx("img",{src:n.thumbnail_url,alt:n.title,onLoad:()=>u(!0),onError:()=>l(!0),style:{width:"100%",height:"100%",objectFit:"cover",display:"block",position:"absolute",top:0,left:0,zIndex:10}}),!c&&h.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",color:"#fff",fontSize:"0.8rem",zIndex:15,pointerEvents:"none"},children:"Loading..."})]}):h.jsx("div",{style:{fontSize:"4rem",opacity:.8,filter:"drop-shadow(0 4px 12px rgba(0,0,0,0.3))"},children:""})}),h.jsx("div",{style:{padding:"16px",background:"rgba(20, 20, 20, 0.6)"},children:h.jsx("h3",{style:{color:"#fff",fontSize:"1.1rem",fontWeight:600,margin:0,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"center"},children:n.title})}),i&&(t||r)&&h.jsxs("div",{style:{position:"absolute",bottom:"12px",left:"12px",display:"flex",gap:"8px",zIndex:20,opacity:o?1:.9},children:[t&&h.jsx("button",{onClick:d=>{d.stopPropagation(),t(n.id)},style:{background:"linear-gradient(135deg, #2196F3 0%, #1976D2 100%)",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",padding:"6px 10px",fontSize:"0.85rem",fontWeight:600,display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s",boxShadow:"0 2px 8px rgba(33, 150, 243, 0.3)"},onMouseEnter:d=>{d.currentTarget.style.boxShadow="0 4px 12px rgba(33, 150, 243, 0.5)",d.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:d=>{d.currentTarget.style.boxShadow="0 2px 8px rgba(33, 150, 243, 0.3)",d.currentTarget.style.transform="translateY(0)"},title:"Edit solution",children:" Edit"}),r&&h.jsx("button",{onClick:d=>{d.stopPropagation(),r(n.id)},style:{background:"linear-gradient(135deg, #f44336 0%, #d32f2f 100%)",border:"none",borderRadius:"6px",color:"#fff",cursor:"pointer",padding:"6px 10px",fontSize:"0.85rem",fontWeight:600,display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s",boxShadow:"0 2px 8px rgba(244, 67, 54, 0.3)"},onMouseEnter:d=>{d.currentTarget.style.boxShadow="0 4px 12px rgba(244, 67, 54, 0.5)",d.currentTarget.style.transform="translateY(-1px)"},onMouseLeave:d=>{d.currentTarget.style.boxShadow="0 2px 8px rgba(244, 67, 54, 0.3)",d.currentTarget.style.transform="translateY(0)"},title:"Delete solution",children:" Delete"})]})]})}function AO({isOpen:n,solution:e,onClose:t,onSave:r}){const[i,o]=S.useState(e.title),[s,a]=S.useState(e.description||""),[l,c]=S.useState(e.challenge_text),[u,d]=S.useState(e.is_public),[f,m]=S.useState(!1);if(!n)return null;const v=async()=>{m(!0);try{await r({title:i,description:s,challenge_text:l,is_public:u}),t()}catch(_){console.error("Failed to save movie:",_),alert("Failed to save changes. Check console for details.")}finally{m(!1)}};return h.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px"},children:h.jsxs("div",{style:{background:"#1a1a1a",borderRadius:"12px",padding:"24px",maxWidth:"500px",width:"100%",maxHeight:"90vh",overflow:"auto",border:"1px solid rgba(255, 255, 255, 0.1)",position:"relative"},children:[h.jsx("button",{onClick:_=>{_.stopPropagation(),t()},onTouchEnd:_=>{_.stopPropagation(),t()},disabled:f,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255,255,255,0.1)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:f?"not-allowed":"pointer",fontSize:"20px",color:"#fff",fontWeight:700,transition:"all 0.2s",opacity:f?.5:1,touchAction:"manipulation",WebkitTapHighlightColor:"transparent"},onMouseEnter:_=>!f&&(_.currentTarget.style.background="rgba(255,255,255,0.2)"),onMouseLeave:_=>!f&&(_.currentTarget.style.background="rgba(255,255,255,0.1)"),title:"Close",children:""}),h.jsx("h2",{style:{color:"#fff",fontSize:"1.5rem",fontWeight:600,margin:"0 0 20px 0"},children:" Edit Movie"}),h.jsxs("div",{style:{marginBottom:"16px"},children:[h.jsx("label",{style:{display:"block",color:"#aaa",fontSize:"0.875rem",fontWeight:600,marginBottom:"6px"},children:"Title *"}),h.jsx("input",{type:"text",value:i,onChange:_=>o(_.target.value),style:{width:"100%",padding:"10px",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",color:"#fff",fontSize:"0.95rem"},placeholder:"Movie title"})]}),h.jsxs("div",{style:{marginBottom:"16px"},children:[h.jsx("label",{style:{display:"block",color:"#aaa",fontSize:"0.875rem",fontWeight:600,marginBottom:"6px"},children:"Description"}),h.jsx("textarea",{value:s,onChange:_=>a(_.target.value),rows:3,style:{width:"100%",padding:"10px",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",color:"#fff",fontSize:"0.95rem",resize:"vertical"},placeholder:"Optional description"})]}),h.jsxs("div",{style:{marginBottom:"16px"},children:[h.jsx("label",{style:{display:"block",color:"#aaa",fontSize:"0.875rem",fontWeight:600,marginBottom:"6px"},children:"Challenge Text *"}),h.jsx("textarea",{value:l,onChange:_=>c(_.target.value),rows:2,style:{width:"100%",padding:"10px",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",color:"#fff",fontSize:"0.95rem",resize:"vertical"},placeholder:"Challenge for viewers"})]}),h.jsxs("div",{style:{marginBottom:"24px"},children:[h.jsx("label",{style:{display:"block",color:"#aaa",fontSize:"0.875rem",fontWeight:600,marginBottom:"6px"},children:"Visibility"}),h.jsxs("select",{value:u?"public":"private",onChange:_=>d(_.target.value==="public"),style:{width:"100%",padding:"10px",background:"rgba(255, 255, 255, 0.05)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",color:"#fff",fontSize:"0.95rem"},children:[h.jsx("option",{value:"public",children:"Public - Visible to everyone"}),h.jsx("option",{value:"private",children:"Private - Only visible to you"})]})]}),h.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[h.jsx("button",{onClick:t,disabled:f,style:{padding:"10px 20px",background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"6px",color:"#fff",fontSize:"0.95rem",fontWeight:600,cursor:f?"not-allowed":"pointer",opacity:f?.5:1},children:"Cancel"}),h.jsx("button",{onClick:v,disabled:f||!i.trim()||!l.trim(),style:{padding:"10px 20px",background:i.trim()&&l.trim()?"#2196F3":"rgba(33, 150, 243, 0.5)",border:"none",borderRadius:"6px",color:"#fff",fontSize:"0.95rem",fontWeight:600,cursor:f||!i.trim()||!l.trim()?"not-allowed":"pointer"},children:f?"Saving...":"Save Changes"})]})]})})}const PO=({isOpen:n,onClose:e,puzzle:t})=>{var o;if(!n)return null;const r=t.cellCount||((o=t.cells)==null?void 0:o.length)||0,i={solveCount:Math.floor(Math.random()*500)+50,averageTime:`${Math.floor(Math.random()*20)+5} min`,fastestTime:`${Math.floor(Math.random()*5)+1} min ${Math.floor(Math.random()*60)} sec`,difficulty:r<30?"Easy ":r<50?"Medium ":"Hard "};return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .about-puzzle-modal-content::-webkit-scrollbar {
          width: 8px;
        }
        .about-puzzle-modal-content::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 10px;
        }
        .about-puzzle-modal-content::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.3);
          border-radius: 10px;
        }
        .about-puzzle-modal-content::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.5);
        }
        .about-puzzle-modal-content {
          scrollbar-width: thin;
          scrollbar-color: rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.1);
        }
      `}),h.jsx("div",{onClick:e,style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(8px)",zIndex:10002},children:h.jsxs("div",{onClick:s=>s.stopPropagation(),className:"about-puzzle-modal-content",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #4a9eff 0%, #357abd 100%)",borderRadius:"20px",padding:"0",width:"90%",maxWidth:"440px",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"3px solid rgba(255, 255, 255, 0.2)",zIndex:10003},children:[h.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"20px",borderRadius:"17px 17px 0 0",position:"relative"},children:[h.jsx("button",{onClick:e,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"18px",color:"#fff",transition:"all 0.2s"},onMouseEnter:s=>{s.currentTarget.style.background="rgba(255, 255, 255, 0.3)"},onMouseLeave:s=>{s.currentTarget.style.background="rgba(255, 255, 255, 0.2)"},children:""}),h.jsx("div",{style:{fontSize:"3rem",marginBottom:"8px",textAlign:"center"},children:""}),h.jsx("h2",{style:{color:"#fff",fontSize:"1.5rem",fontWeight:700,margin:"0 0 4px 0",textShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",textAlign:"center"},children:t.name}),h.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"0.9rem",margin:0,textAlign:"center"},children:["by ",t.creator]})]}),h.jsxs("div",{style:{padding:"20px"},children:[h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"20px"},children:[h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"16px",borderRadius:"12px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"1.8rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"1.2rem",fontWeight:700},children:r}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"},children:"Cells"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"16px",borderRadius:"12px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"1.8rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"1.2rem",fontWeight:700},children:i.solveCount}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"},children:"Times Solved"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"16px",borderRadius:"12px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"1.8rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.95rem",fontWeight:700},children:i.fastestTime}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"},children:"Fastest Solve"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"16px",borderRadius:"12px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"1.8rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"1rem",fontWeight:700},children:i.averageTime}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"},children:"Avg. Time"})]})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"12px",borderRadius:"12px",textAlign:"center",marginBottom:"20px"},children:[h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"0.85rem",marginBottom:"4px"},children:"Difficulty Rating"}),h.jsx("div",{style:{color:"#fff",fontSize:"1.3rem",fontWeight:700},children:i.difficulty})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.1)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[h.jsx("div",{style:{color:"#fff",fontSize:"0.95rem",fontWeight:600,marginBottom:"8px"},children:" Did you know?"}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"0.85rem",lineHeight:"1.5"},children:"This puzzle has been attempted by puzzlers from around the world! Think you can beat the fastest time?"})]})]})]})})]})},kO=({isOpen:n,onClose:e,puzzle:t})=>{const r=Jn(),[i,o]=S.useState(!1),[s,a]=S.useState(!1);if(!n)return null;const l=()=>{r(`/manual/${t.id}`)},c=()=>{r(`/game/${t.id}`)},u=()=>{r(`/auto/${t.id}`)},d=async()=>{const f=`${window.location.origin}/gallery?puzzle=${t.id}&shared=true`;if(typeof navigator.share=="function")try{await navigator.share({title:t.name,text:`Check out this puzzle: ${t.name}`,url:f});return}catch(m){if(m instanceof Error&&m.name==="AbortError")return;console.error("Share failed:",m)}try{await navigator.clipboard.writeText(f),o(!0),setTimeout(()=>o(!1),2e3)}catch(m){console.error("Clipboard error:",m),alert(`Share this puzzle:
${f}`)}};return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        @keyframes modalSlideIn {
          from {
            opacity: 0;
            transform: translate(-50%, -45%);
          }
          to {
            opacity: 1;
            transform: translate(-50%, -50%);
          }
        }
        
        @keyframes actionButtonPop {
          0% { transform: scale(1); }
          50% { transform: scale(1.05); }
          100% { transform: scale(1); }
        }
      `}),h.jsxs("div",{onClick:e,style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(8px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center"},children:[h.jsxs("div",{onClick:f=>f.stopPropagation(),style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"24px",padding:"0",width:"90%",maxWidth:"420px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"3px solid rgba(255, 255, 255, 0.2)",animation:"modalSlideIn 0.3s ease-out",zIndex:10001},children:[h.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"20px 24px",borderRadius:"21px 21px 0 0",textAlign:"center",position:"relative"},children:[h.jsx("button",{onClick:e,style:{position:"absolute",top:"16px",right:"16px",background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"20px",color:"#fff",transition:"all 0.2s"},onMouseEnter:f=>{f.currentTarget.style.background="rgba(255, 255, 255, 0.3)",f.currentTarget.style.transform="rotate(90deg)"},onMouseLeave:f=>{f.currentTarget.style.background="rgba(255, 255, 255, 0.2)",f.currentTarget.style.transform="rotate(0deg)"},children:""}),h.jsx("h2",{style:{color:"#fff",fontSize:"1.3rem",fontWeight:700,margin:0,textShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:"What would you like to do?"})]}),h.jsxs("div",{style:{padding:"24px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[h.jsxs("button",{onClick:l,style:{background:"linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(76, 175, 80, 0.4)"},onMouseEnter:f=>{f.currentTarget.style.transform="translateY(-2px)",f.currentTarget.style.boxShadow="0 6px 20px rgba(76, 175, 80, 0.6)"},onMouseLeave:f=>{f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.boxShadow="0 4px 12px rgba(76, 175, 80, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"Solve This Puzzle"})]}),h.jsxs("button",{onClick:u,style:{background:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4)"},onMouseEnter:f=>{f.currentTarget.style.transform="translateY(-2px)",f.currentTarget.style.boxShadow="0 6px 20px rgba(139, 92, 246, 0.6)"},onMouseLeave:f=>{f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.boxShadow="0 4px 12px rgba(139, 92, 246, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"Auto Solve"})]}),h.jsxs("button",{onClick:c,style:{background:"linear-gradient(135deg, #FF9800 0%, #F57C00 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(255, 152, 0, 0.4)"},onMouseEnter:f=>{f.currentTarget.style.transform="translateY(-2px)",f.currentTarget.style.boxShadow="0 6px 20px rgba(255, 152, 0, 0.6)"},onMouseLeave:f=>{f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.boxShadow="0 4px 12px rgba(255, 152, 0, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"Play VS Computer"})]}),h.jsxs("button",{onClick:d,style:{background:i?"linear-gradient(135deg, #4CAF50 0%, #45a049 100%)":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:i?"0 4px 12px rgba(76, 175, 80, 0.4)":"0 4px 12px rgba(33, 150, 243, 0.4)"},onMouseEnter:f=>{i||(f.currentTarget.style.transform="translateY(-2px)",f.currentTarget.style.boxShadow="0 6px 20px rgba(33, 150, 243, 0.6)")},onMouseLeave:f=>{i||(f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.boxShadow="0 4px 12px rgba(33, 150, 243, 0.4)")},children:[h.jsx("span",{style:{fontSize:"2rem"},children:i?"":""}),h.jsx("span",{children:i?"Link Copied!":"Share Puzzle"})]}),h.jsxs("button",{onClick:()=>a(!0),style:{background:"linear-gradient(135deg, #9333ea 0%, #7e22ce 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(147, 51, 234, 0.4)"},onMouseEnter:f=>{f.currentTarget.style.transform="translateY(-2px)",f.currentTarget.style.boxShadow="0 6px 20px rgba(147, 51, 234, 0.6)"},onMouseLeave:f=>{f.currentTarget.style.transform="translateY(0)",f.currentTarget.style.boxShadow="0 4px 12px rgba(147, 51, 234, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"About This Puzzle"})]})]}),h.jsx("div",{style:{padding:"0 24px 24px"},children:h.jsx("button",{onClick:e,style:{background:"rgba(255, 255, 255, 0.1)",border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"12px",fontSize:"0.9rem",fontWeight:600,width:"100%",textAlign:"center",transition:"all 0.2s"},onMouseEnter:f=>{f.currentTarget.style.background="rgba(255, 255, 255, 0.15)",f.currentTarget.style.borderColor="rgba(255, 255, 255, 0.5)"},onMouseLeave:f=>{f.currentTarget.style.background="rgba(255, 255, 255, 0.1)",f.currentTarget.style.borderColor="rgba(255, 255, 255, 0.3)"},children:"Back to Gallery"})})]}),h.jsx(PO,{isOpen:s,onClose:()=>a(!1),puzzle:t})]})]})},IO=({isOpen:n,onClose:e,solution:t})=>{if(!n)return null;const r=i=>i>=1e3?`${(i/1e3).toFixed(1)}k`:i.toString();return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        .about-solution-modal-content::-webkit-scrollbar {
          width: 8px;
        }
        .about-solution-modal-content::-webkit-scrollbar-track {
          background: rgba(255, 255, 255, 0.1);
          border-radius: 10px;
        }
        .about-solution-modal-content::-webkit-scrollbar-thumb {
          background: rgba(255, 255, 255, 0.3);
          border-radius: 10px;
        }
        .about-solution-modal-content::-webkit-scrollbar-thumb:hover {
          background: rgba(255, 255, 255, 0.5);
        }
        .about-solution-modal-content {
          scrollbar-width: thin;
          scrollbar-color: rgba(255, 255, 255, 0.3) rgba(255, 255, 255, 0.1);
        }
      `}),h.jsx("div",{onClick:e,style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(8px)",zIndex:10002},children:h.jsxs("div",{onClick:i=>i.stopPropagation(),className:"about-solution-modal-content",style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",borderRadius:"20px",padding:"0",width:"90%",maxWidth:"440px",maxHeight:"80vh",overflowY:"auto",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"3px solid rgba(255, 255, 255, 0.2)",zIndex:10003},children:[h.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"20px",borderRadius:"17px 17px 0 0",position:"relative"},children:[h.jsx("button",{onClick:e,style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"18px",color:"#fff",transition:"all 0.2s"},onMouseEnter:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.3)"},onMouseLeave:i=>{i.currentTarget.style.background="rgba(255, 255, 255, 0.2)"},children:""}),h.jsx("div",{style:{fontSize:"3rem",marginBottom:"8px",textAlign:"center"},children:""}),h.jsx("h2",{style:{color:"#fff",fontSize:"1.5rem",fontWeight:700,margin:"0 0 4px 0",textShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",textAlign:"center"},children:t.title}),h.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"0.9rem",margin:0,textAlign:"center"},children:["by ",t.creator_name]})]}),h.jsxs("div",{style:{padding:"20px"},children:[h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px",marginBottom:"20px"},children:[h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"16px",borderRadius:"12px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"1.8rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"1.2rem",fontWeight:700},children:r(t.view_count)}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"},children:"Views"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"16px",borderRadius:"12px",textAlign:"center"},children:[h.jsx("div",{style:{fontSize:"1.8rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"1.2rem",fontWeight:700},children:r(t.like_count)}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.8)",fontSize:"0.75rem"},children:"Likes"})]})]}),t.puzzle_name&&h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.15)",padding:"12px",borderRadius:"12px",textAlign:"center",marginBottom:"20px"},children:[h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"0.85rem",marginBottom:"4px"},children:"Featured Puzzle"}),h.jsxs("div",{style:{color:"#fff",fontSize:"1.1rem",fontWeight:700},children:[" ",t.puzzle_name]})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.1)",padding:"16px",borderRadius:"12px",border:"1px solid rgba(255, 255, 255, 0.2)"},children:[h.jsx("div",{style:{color:"#fff",fontSize:"0.95rem",fontWeight:600,marginBottom:"8px"},children:" About this Solution"}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.9)",fontSize:"0.85rem",lineHeight:"1.5"},children:"This solution demonstrates one way to solve the puzzle. Get inspired and try it yourself!"})]})]})]})})]})},LO=({isOpen:n,onClose:e,solution:t})=>{const r=Jn(),[i,o]=S.useState(!1);if(!n)return null;const s=()=>{t.puzzle_id?r(`/manual/${t.puzzle_id}`):alert("Puzzle not available for this solution")},a=()=>{t.puzzle_id?r(`/game/${t.puzzle_id}`):alert("Puzzle not available for this solution")},l=()=>{t.puzzle_id?r(`/solutions/${t.puzzle_id}`):alert("Solution not available for this solution")},c=()=>{t.puzzle_id?r(`/auto/${t.puzzle_id}`):alert("Puzzle not available for this solution")};return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        @keyframes modalSlideIn {
          from {
            opacity: 0;
            transform: translate(-50%, -45%);
          }
          to {
            opacity: 1;
            transform: translate(-50%, -50%);
          }
        }
      `}),h.jsxs("div",{onClick:e,style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.75)",backdropFilter:"blur(8px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center"},children:[h.jsxs("div",{onClick:u=>u.stopPropagation(),style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"24px",padding:"0",width:"90%",maxWidth:"420px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"3px solid rgba(255, 255, 255, 0.2)",animation:"modalSlideIn 0.3s ease-out",zIndex:10001},children:[h.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"20px 24px",borderRadius:"21px 21px 0 0",textAlign:"center",position:"relative"},children:[h.jsx("button",{onClick:e,style:{position:"absolute",top:"16px",right:"16px",background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"36px",height:"36px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"20px",color:"#fff",transition:"all 0.2s"},onMouseEnter:u=>{u.currentTarget.style.background="rgba(255, 255, 255, 0.3)",u.currentTarget.style.transform="rotate(90deg)"},onMouseLeave:u=>{u.currentTarget.style.background="rgba(255, 255, 255, 0.2)",u.currentTarget.style.transform="rotate(0deg)"},children:""}),h.jsx("h2",{style:{color:"#fff",fontSize:"1.15rem",fontWeight:700,margin:0,paddingRight:"50px",paddingLeft:"10px",textShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:"What would you like to do?"})]}),h.jsxs("div",{style:{padding:"24px",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"12px"},children:[t.puzzle_id&&h.jsxs("button",{onClick:l,style:{background:"linear-gradient(135deg, #06b6d4 0%, #0891b2 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(6, 182, 212, 0.4)"},onMouseEnter:u=>{u.currentTarget.style.transform="translateY(-2px)",u.currentTarget.style.boxShadow="0 6px 20px rgba(6, 182, 212, 0.6)"},onMouseLeave:u=>{u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.boxShadow="0 4px 12px rgba(6, 182, 212, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"Analyze Solution"})]}),t.puzzle_id&&h.jsxs("button",{onClick:s,style:{background:"linear-gradient(135deg, #4CAF50 0%, #45a049 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(76, 175, 80, 0.4)"},onMouseEnter:u=>{u.currentTarget.style.transform="translateY(-2px)",u.currentTarget.style.boxShadow="0 6px 20px rgba(76, 175, 80, 0.6)"},onMouseLeave:u=>{u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.boxShadow="0 4px 12px rgba(76, 175, 80, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"Solve This Puzzle"})]}),t.puzzle_id&&h.jsxs("button",{onClick:c,style:{background:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(139, 92, 246, 0.4)"},onMouseEnter:u=>{u.currentTarget.style.transform="translateY(-2px)",u.currentTarget.style.boxShadow="0 6px 20px rgba(139, 92, 246, 0.6)"},onMouseLeave:u=>{u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.boxShadow="0 4px 12px rgba(139, 92, 246, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"Auto Solve"})]}),t.puzzle_id&&h.jsxs("button",{onClick:a,style:{background:"linear-gradient(135deg, #FF9800 0%, #F57C00 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(255, 152, 0, 0.4)"},onMouseEnter:u=>{u.currentTarget.style.transform="translateY(-2px)",u.currentTarget.style.boxShadow="0 6px 20px rgba(255, 152, 0, 0.6)"},onMouseLeave:u=>{u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.boxShadow="0 4px 12px rgba(255, 152, 0, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"Play VS Computer"})]}),h.jsxs("button",{onClick:()=>o(!0),style:{background:"linear-gradient(135deg, #9333ea 0%, #7e22ce 100%)",border:"none",borderRadius:"12px",color:"#fff",cursor:"pointer",padding:"20px 16px",fontSize:"0.9rem",fontWeight:700,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s",boxShadow:"0 4px 12px rgba(147, 51, 234, 0.4)"},onMouseEnter:u=>{u.currentTarget.style.transform="translateY(-2px)",u.currentTarget.style.boxShadow="0 6px 20px rgba(147, 51, 234, 0.6)"},onMouseLeave:u=>{u.currentTarget.style.transform="translateY(0)",u.currentTarget.style.boxShadow="0 4px 12px rgba(147, 51, 234, 0.4)"},children:[h.jsx("span",{style:{fontSize:"2rem"},children:""}),h.jsx("span",{children:"About This Solution"})]})]})]}),h.jsx(IO,{isOpen:i,onClose:()=>o(!1),solution:t})]})]})};async function my(){const{data:n,error:e}=await bt.from("puzzles").select(`
      *,
      contracts_shapes(size)
    `).eq("visibility","public").order("created_at",{ascending:!1});if(e)throw console.error("Failed to fetch public puzzles:",e),new Error(`Failed to fetch puzzles: ${e.message}`);return(n||[]).map(r=>{var i;return{...r,shape_size:((i=r.contracts_shapes)==null?void 0:i.size)||r.sphere_count,contracts_shapes:void 0}})}async function DO(){return[]}async function NO(n){const{error:e}=await bt.from("puzzles").delete().eq("id",n);if(e)throw console.error("Failed to delete puzzle:",e),new Error(`Failed to delete puzzle: ${e.message}`)}async function xf(){const{data:n,error:e}=await bt.from("solutions").select(`
      *,
      puzzles!inner(name)
    `).order("created_at",{ascending:!1});if(e)throw console.error("Failed to fetch public solutions:",e),new Error(`Failed to fetch solutions: ${e.message}`);return(n||[]).map(r=>{var i;return{...r,puzzle_name:(i=r.puzzles)==null?void 0:i.name,puzzles:void 0}})}async function OO(n){const{error:e}=await bt.from("solutions").delete().eq("id",n);if(e)throw console.error("Failed to delete solution:",e),new Error(`Failed to delete solution: ${e.message}`)}async function UO(n,e){const{error:t}=await bt.from("solutions").update(e).eq("id",n);if(t)throw console.error("Failed to update solution:",t),new Error(`Failed to update solution: ${t.message}`)}const zO=[{id:"1",name:"Simple Cube",creator:"Demo",creatorId:"user123",cells:[{i:0,j:0,k:0},{i:1,j:0,k:0},{i:0,j:1,k:0},{i:1,j:1,k:0},{i:0,j:0,k:1},{i:1,j:0,k:1},{i:0,j:1,k:1},{i:1,j:1,k:1}]},{id:"2",name:"Tower",creator:"Demo",creatorId:"user123",cells:[{i:0,j:0,k:0},{i:0,j:1,k:0},{i:0,j:2,k:0},{i:0,j:0,k:1},{i:0,j:1,k:1},{i:0,j:2,k:1}]},{id:"3",name:"L-Shape",creator:"Alice",creatorId:"other-user",cells:[{i:0,j:0,k:0},{i:1,j:0,k:0},{i:2,j:0,k:0},{i:0,j:1,k:0},{i:0,j:2,k:0}]}];function FO(){const[n]=_M(),e=n.get("tab")||"public",[t,r]=S.useState(e),[i,o]=S.useState([]),[s,a]=S.useState([]),[l,c]=S.useState(!0),[u,d]=S.useState(null),[f,m]=S.useState(null),[v,_]=S.useState(null),[x,p]=S.useState(null),[b,g]=S.useState(!1);S.useEffect(()=>{const E=C=>{if(C.key==="m"||C.key==="M"){const A=C.target;if(A.tagName==="INPUT"||A.tagName==="TEXTAREA")return;g(T=>{const w=!T;return console.log(` Management mode ${w?"ENABLED":"DISABLED"}`),w})}};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[]),S.useEffect(()=>{const E=n.get("tab");E&&E!==t&&(r(E),console.log(" Gallery tab changed via URL:",E))},[n]),S.useEffect(()=>{const E=n.get("puzzle"),C=n.get("movie"),A=n.get("shared")==="true";if(A&&E&&i.length>0){const T=i.find(w=>w.id===E);T&&_(T)}else if(A&&C&&s.length>0){const T=s.find(w=>w.id===C);T&&(p(T),t!=="movies"&&r("movies"))}},[n,i,s,t]),S.useEffect(()=>{(async()=>{console.log(" Gallery loading content for tab:",t),c(!0),d(null);try{if(t==="movies"){console.log(" Loading movies...");const C=await xf();console.log(" Loaded",C.length,"movies"),a(C),o([])}else{console.log(" Loading puzzles for tab:",t);const C=new Promise((w,M)=>setTimeout(()=>M(new Error("Database query timeout")),5e3));let A;try{t==="mine"?(console.log(" Fetching user puzzles..."),A=await Promise.race([DO(),C])):(console.log(" Fetching public puzzles..."),A=await Promise.race([my(),C])),console.log(" Loaded",A.length,"puzzle records")}catch(w){throw w.message==="Database query timeout"?(console.warn(" Database query timed out - using mock data"),new Error("Database unavailable - showing sample puzzles")):w}const T=A.map(w=>({id:w.id,name:w.name,creator:w.creator_name,creatorId:w.creator_name,cells:[],thumbnailUrl:w.thumbnail_url,cellCount:w.shape_size}));console.log(" Transformed",T.length,"puzzles"),o(T),a([])}}catch(C){console.error(" Failed to load content:",C),d(C instanceof Error?C.message:"Failed to load content"),t!=="movies"&&(console.log(" Using mock puzzles as fallback"),o(zO))}finally{c(!1),console.log(" Gallery loading complete")}})()},[t]);const y=i;return h.jsxs("div",{className:"gallery-page",style:{minHeight:"100vh",height:"100vh",background:"linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%)",padding:"80px 20px 40px 20px",overflowY:"auto",overflowX:"hidden",position:"relative"},children:[h.jsx("button",{onClick:()=>window.location.href="/",style:{position:"fixed",top:"20px",right:"40px",background:"rgba(255,255,255,0.3)",backdropFilter:"blur(10px)",border:"2px solid rgba(255,255,255,0.5)",borderRadius:"12px",padding:"0.75rem 1.5rem",color:"#fff",fontSize:"1rem",fontWeight:600,cursor:"pointer",transition:"all 0.2s",boxShadow:"0 4px 16px rgba(255,255,255,0.2)",textShadow:"0 2px 4px rgba(0,0,0,0.2)",zIndex:1e3},onMouseEnter:E=>{E.currentTarget.style.background="rgba(255,255,255,0.5)",E.currentTarget.style.transform="scale(1.05)"},onMouseLeave:E=>{E.currentTarget.style.background="rgba(255,255,255,0.3)",E.currentTarget.style.transform="scale(1)"},children:" Home"}),h.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto 40px auto"},children:[h.jsx("h1",{style:{color:"#fff",fontSize:"2.5rem",fontWeight:700,marginBottom:"8px",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:t==="movies"?"KOOS Solutions Gallery":"KOOS Puzzle Gallery"}),h.jsx("p",{style:{color:"rgba(255,255,255,0.9)",fontSize:"1.1rem",marginBottom:"24px",textShadow:"0 2px 8px rgba(0,0,0,0.2)"},children:t==="movies"?"Watch amazing puzzle solutions and challenges":"Explore and solve community puzzles"}),h.jsx("div",{className:"gallery-header-tabs",style:{display:"flex",gap:"8px",borderBottom:"2px solid rgba(255, 255, 255, 0.3)",alignItems:"center",justifyContent:"flex-start",flexWrap:"wrap",paddingBottom:"8px"},children:h.jsxs("div",{style:{display:"flex",gap:"8px",flex:"0 0 auto"},children:[h.jsx("button",{onClick:()=>r("public"),style:{background:"none",border:"none",color:t==="public"?"#fff":"rgba(255,255,255,0.6)",fontSize:"1rem",fontWeight:600,padding:"12px 24px",cursor:"pointer",borderBottom:t==="public"?"3px solid #feca57":"2px solid transparent",marginBottom:"-2px",transition:"all 0.2s ease",textShadow:t==="public"?"0 2px 8px rgba(0,0,0,0.3)":"none"},children:t==="movies"?"Public Solutions":"Public Puzzles"}),h.jsx("button",{onClick:()=>r("mine"),style:{background:"none",border:"none",color:t==="mine"?"#fff":"rgba(255,255,255,0.6)",fontSize:"1rem",fontWeight:600,padding:"12px 24px",cursor:"pointer",borderBottom:t==="mine"?"3px solid #feca57":"2px solid transparent",marginBottom:"-2px",transition:"all 0.2s ease",textShadow:t==="mine"?"0 2px 8px rgba(0,0,0,0.3)":"none"},children:t==="movies"?"My Solutions":"My Puzzles"})]})})]}),l&&h.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",textAlign:"center",padding:"60px 20px",color:"#888"},children:[h.jsx("div",{style:{fontSize:"2rem",marginBottom:"16px"},children:""}),h.jsx("p",{style:{fontSize:"1.1rem"},children:t==="movies"?"Loading solutions...":"Loading puzzles..."})]}),u&&!l&&h.jsxs("div",{style:{maxWidth:"1400px",margin:"0 auto",textAlign:"center",padding:"60px 20px",color:"#ff6b6b"},children:[h.jsxs("p",{style:{fontSize:"1.1rem",marginBottom:"8px"},children:[" ",u]}),h.jsx("p",{style:{fontSize:"0.9rem",color:"#888"},children:"Showing sample puzzles instead"})]}),!l&&h.jsx("div",{style:{maxWidth:"1400px",margin:"0 auto",display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"24px",paddingBottom:"120px"},children:t==="movies"?s.map(E=>h.jsx(RO,{solution:E,onSelect:()=>p(E),onEdit:b?()=>m(E):void 0,onDelete:b?async()=>{try{await OO(E.id);const C=await xf();a(C)}catch(C){console.error(" Failed to delete solution:",C),d("Failed to delete solution")}}:void 0,showManagementButtons:b},E.id)):y.map(E=>h.jsx(CO,{puzzle:E,onSelect:()=>_(E),onDelete:b?async()=>{if(window.confirm("Delete this puzzle?"))try{await NO(E.id);const A=(await my()).map(T=>({id:T.id,name:T.name,creator:T.creator_name,cells:[],cellCount:T.shape_size}));o(A)}catch(C){console.error(" Failed to delete puzzle:",C),d("Failed to delete puzzle")}}:void 0,showManagementButtons:b},E.id))}),f&&h.jsx(AO,{isOpen:!0,solution:f,onClose:()=>m(null),onSave:async E=>{try{await UO(f.id,E);const C=await xf();a(C),m(null)}catch(C){console.error(" Failed to update solution:",C),d("Failed to update solution")}}}),x&&h.jsx(LO,{isOpen:!0,onClose:()=>p(null),solution:x}),v&&h.jsx(kO,{isOpen:!0,onClose:()=>_(null),puzzle:v})]})}async function jO(n,e=50){const{data:t,error:r}=await bt.from("solutions").select(`
      id,
      created_by,
      solver_name,
      puzzle_id,
      duration_ms,
      total_moves,
      undo_count,
      hints_used,
      solvability_checks_used,
      created_at
      `).eq("puzzle_id",n).not("duration_ms","is",null).order("duration_ms",{ascending:!0}).limit(e);return r?(console.error(" Error loading leaderboard:",r),[]):t??[]}function gy(n){if(n==null)return"-";const e=Math.round(n/1e3),t=Math.floor(e/60),i=(e%60).toString().padStart(2,"0");return`${t}:${i}`}const BO=()=>{const{puzzleId:n}=ac(),e=Jn(),[t,r]=S.useState([]),[i,o]=S.useState(!0),[s,a]=S.useState(null);return la.useEffect(()=>{const l=document.createElement("style");return l.textContent=`
      @media (max-width: 768px) {
        .desktop-leaderboard {
          display: none !important;
        }
        .mobile-leaderboard {
          display: block !important;
        }
      }
      @media (min-width: 769px) {
        .mobile-leaderboard {
          display: none !important;
        }
      }
    `,document.head.appendChild(l),()=>{document.head.removeChild(l)}},[]),S.useEffect(()=>{if(!n){o(!1);return}let l=!1;async function c(){o(!0);const u=await jO(n);l||(r(u),o(!1))}return c(),()=>{l=!0}},[n]),S.useEffect(()=>{if(!n)return;let l=!1;async function c(){const{data:u,error:d}=await bt.from("puzzles").select("id, name").eq("id",n).single();!l&&!d&&u&&a(u)}return c(),()=>{l=!0}},[n]),n?h.jsx("div",{style:{minHeight:"100vh",background:"linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%)",padding:"clamp(1rem, 5vw, 2rem)"},children:h.jsxs("div",{style:{maxWidth:"900px",margin:"0 auto"},children:[h.jsxs("div",{style:{marginBottom:"2rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[h.jsxs("div",{style:{flex:"1 1 auto",minWidth:"200px"},children:[h.jsx("h1",{style:{fontSize:"clamp(1.5rem, 5vw, 2.5rem)",fontWeight:700,color:"#fff",marginBottom:"0.5rem",textShadow:"0 2px 10px rgba(0,0,0,0.3)"},children:" Leaderboard"}),h.jsx("p",{style:{fontSize:"clamp(0.9rem, 3vw, 1.2rem)",color:"rgba(255,255,255,0.9)",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:(s==null?void 0:s.name)??n})]}),h.jsx("button",{onClick:()=>e(-1),style:{padding:"0.75rem 1.5rem",background:"rgba(255,255,255,0.2)",border:"2px solid rgba(255,255,255,0.3)",borderRadius:"12px",color:"#fff",fontSize:"1rem",fontWeight:600,cursor:"pointer",backdropFilter:"blur(10px)",transition:"all 0.2s",whiteSpace:"nowrap"},onMouseOver:l=>l.currentTarget.style.background="rgba(255,255,255,0.3)",onMouseOut:l=>l.currentTarget.style.background="rgba(255,255,255,0.2)",children:" Back"})]}),i?h.jsx("div",{style:{background:"rgba(255,255,255,0.1)",backdropFilter:"blur(20px)",borderRadius:"16px",padding:"3rem",textAlign:"center",color:"#fff",fontSize:"1.2rem"},children:"Loading leaderboard..."}):t.length===0?h.jsxs("div",{style:{background:"rgba(255,255,255,0.1)",backdropFilter:"blur(20px)",borderRadius:"16px",padding:"3rem",textAlign:"center",color:"#fff",fontSize:"1.2rem"},children:["No solves recorded yet for this puzzle.",h.jsx("br",{}),h.jsx("span",{style:{fontSize:"0.9rem",opacity:.8},children:"Be the first to solve it!"})]}):h.jsx("div",{style:{background:"rgba(255,255,255,0.95)",borderRadius:"16px",overflow:"hidden",boxShadow:"0 20px 60px rgba(0,0,0,0.3)"},children:t.map((l,c)=>{var m,v;const u=c===0?"":c===1?"":c===2?"":"",d=c<3,f=c===0?"linear-gradient(135deg, #ffd700 0%, #ffed4e 100%)":c===1?"linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%)":c===2?"linear-gradient(135deg, #cd7f32 0%, #e8a87c 100%)":c%2===0?"#f9fafb":"#fff";return h.jsxs("div",{style:{padding:"clamp(0.75rem, 3vw, 1.5rem)",background:f,borderBottom:"1px solid rgba(0,0,0,0.05)",fontWeight:d?600:400,transition:"all 0.2s"},onMouseOver:_=>{d||(_.currentTarget.style.background="#e0f2fe")},onMouseOut:_=>{d||(_.currentTarget.style.background=c%2===0?"#f9fafb":"#fff")},children:[h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"60px 2fr 1fr 80px 80px 80px 1.5fr",gap:"1rem",alignItems:"center"},className:"desktop-leaderboard",children:[h.jsx("div",{style:{fontSize:"1.5rem",textAlign:"center"},children:u||`#${c+1}`}),h.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"#1f2937",fontSize:"0.95rem"},children:((m=l.solver_name)==null?void 0:m.split("@")[0])??"Unknown"}),h.jsxs("div",{style:{fontSize:"1.1rem",fontWeight:700,color:"#3b82f6"},children:[" ",gy(l.duration_ms)]}),h.jsxs("div",{style:{textAlign:"center",color:"#6b7280"},children:[" ",l.hints_used??0]}),h.jsxs("div",{style:{textAlign:"center",color:"#6b7280"},children:[" ",l.undo_count??0]}),h.jsxs("div",{style:{textAlign:"center",color:"#6b7280"},children:[" ",l.total_moves??0]}),h.jsx("div",{style:{fontSize:"0.85rem",color:"#9ca3af",textAlign:"right"},children:new Date(l.created_at).toLocaleDateString()})]}),h.jsxs("div",{className:"mobile-leaderboard",style:{display:"none"},children:[h.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[h.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[h.jsx("span",{style:{fontSize:"1.5rem"},children:u||`#${c+1}`}),h.jsx("span",{style:{color:"#1f2937",fontSize:"1rem",fontWeight:600},children:((v=l.solver_name)==null?void 0:v.split("@")[0])??"Unknown"})]}),h.jsxs("div",{style:{fontSize:"1.2rem",fontWeight:700,color:"#3b82f6"},children:[" ",gy(l.duration_ms)]})]}),h.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.9rem",color:"#6b7280"},children:[h.jsxs("span",{children:[" ",l.hints_used??0]}),h.jsxs("span",{children:[" ",l.undo_count??0]}),h.jsxs("span",{children:[" ",l.total_moves??0]}),h.jsx("span",{style:{marginLeft:"auto",fontSize:"0.8rem",color:"#9ca3af"},children:new Date(l.created_at).toLocaleDateString()})]})]})]},l.id)})})]})}):h.jsx("div",{className:"page-container",style:{padding:"2rem"},children:h.jsx("p",{children:"No puzzle selected."})})},HO=({isOpen:n,onClose:e,solution:t,puzzleStats:r})=>{if(!n)return null;const i=s=>new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}),o=s=>{if(!s)return"Unknown";const a=Math.floor(s/60),l=Math.floor(s%60);return a>0?`${a}m ${l}s`:`${l}s`};return h.jsxs(h.Fragment,{children:[h.jsx("style",{children:`
        @keyframes modalFadeIn {
          from {
            opacity: 0;
            transform: translate(-50%, -45%);
          }
          to {
            opacity: 1;
            transform: translate(-50%, -50%);
          }
        }
      `}),h.jsx("div",{onClick:e,style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(8px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center"},children:h.jsxs("div",{onClick:s=>s.stopPropagation(),style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",borderRadius:"24px",padding:"0",width:"90%",maxWidth:"480px",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)",border:"3px solid rgba(255, 255, 255, 0.2)",animation:"modalFadeIn 0.3s ease-out",zIndex:10001},children:[h.jsxs("div",{style:{background:"rgba(0, 0, 0, 0.3)",padding:"16px 20px 12px",borderRadius:"21px 21px 0 0",position:"relative",display:"flex",alignItems:"center",gap:"12px"},children:[h.jsx("div",{style:{fontSize:"2rem"},children:""}),h.jsxs("div",{style:{flex:1},children:[h.jsx("h2",{style:{color:"#fff",fontSize:"1.1rem",fontWeight:700,margin:0,textShadow:"0 2px 8px rgba(0, 0, 0, 0.3)"},children:"Solution Info"}),t.puzzle_name&&h.jsx("p",{style:{color:"rgba(255, 255, 255, 0.75)",fontSize:"0.8rem",margin:"2px 0 0 0"},children:t.puzzle_name})]}),h.jsx("button",{onClick:e,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",fontSize:"18px",color:"#fff",transition:"all 0.2s"},onMouseEnter:s=>{s.currentTarget.style.background="rgba(255, 255, 255, 0.3)",s.currentTarget.style.transform="rotate(90deg)"},onMouseLeave:s=>{s.currentTarget.style.background="rgba(255, 255, 255, 0.2)",s.currentTarget.style.transform="rotate(0deg)"},children:""})]}),h.jsxs("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"10px"},children:[h.jsxs("div",{style:{background:t.is_auto_solved?"rgba(139, 92, 246, 0.3)":"rgba(76, 175, 80, 0.3)",border:t.is_auto_solved?"2px solid rgba(139, 92, 246, 0.6)":"2px solid rgba(76, 175, 80, 0.6)",borderRadius:"10px",padding:"10px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[h.jsx("span",{style:{fontSize:"1.1rem"},children:t.is_auto_solved?"":""}),h.jsxs("span",{style:{color:"#fff",fontSize:"0.85rem",fontWeight:600},children:["Solved by ",t.solver_name]})]}),h.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px"},children:[h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.12)",borderRadius:"10px",padding:"10px"},children:[h.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.75rem",fontWeight:600,lineHeight:"1.3"},children:i(t.created_at)})]}),t.time_to_solve_sec!==void 0&&h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.12)",borderRadius:"10px",padding:"10px"},children:[h.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.85rem",fontWeight:600},children:o(t.time_to_solve_sec)}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.65rem"},children:"Solve Time"})]}),r&&h.jsxs(h.Fragment,{children:[h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.12)",borderRadius:"10px",padding:"10px"},children:[h.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.85rem",fontWeight:600},children:r.cellCount}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.65rem"},children:"Cells"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.12)",borderRadius:"10px",padding:"10px"},children:[h.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.85rem",fontWeight:600},children:r.totalSolutions}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.65rem"},children:"Solutions"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.12)",borderRadius:"10px",padding:"10px"},children:[h.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.85rem",fontWeight:600},children:r.autoSolveCount}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.65rem"},children:"Auto-Solved"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.12)",borderRadius:"10px",padding:"10px"},children:[h.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.85rem",fontWeight:600},children:r.manualSolveCount}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.65rem"},children:"Manual"})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.12)",borderRadius:"10px",padding:"10px"},children:[h.jsx("div",{style:{fontSize:"1.2rem",marginBottom:"4px"},children:""}),h.jsx("div",{style:{color:"#fff",fontSize:"0.85rem",fontWeight:600},children:r.gamesPlayed}),h.jsx("div",{style:{color:"rgba(255, 255, 255, 0.7)",fontSize:"0.65rem"},children:"Games"})]})]})]}),r&&h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.1)",borderRadius:"10px",padding:"10px",border:"1px solid rgba(255, 255, 255, 0.15)",fontSize:"0.75rem",color:"rgba(255, 255, 255, 0.8)",textAlign:"center",lineHeight:"1.5"},children:[h.jsx("div",{style:{marginBottom:"4px",opacity:.7},children:"Puzzle Shape Credits"}),h.jsx("div",{children:h.jsx("strong",{children:r.creatorName})}),h.jsx("div",{style:{fontSize:"0.7rem",opacity:.7},children:i(r.createdAt)})]}),h.jsxs("div",{style:{background:"rgba(255, 255, 255, 0.08)",borderRadius:"10px",padding:"10px",fontSize:"0.75rem",color:"rgba(255, 255, 255, 0.8)",lineHeight:"1.4",display:"flex",gap:"8px"},children:[h.jsx("span",{children:""}),h.jsx("span",{children:"Use explosion slider and reveal arrows to study the assembly"})]})]})]})})]})};async function WO(n){const{data:e,error:t}=await bt.from("solutions").select("*").eq("puzzle_id",n).order("created_at",{ascending:!0}).limit(1).maybeSingle();if(t)throw console.error("Solution query error:",t),t;if(!e)return null;const{data:r}=await bt.from("puzzles").select("name").eq("id",n).single();return{...e,puzzle_name:r==null?void 0:r.name,time_to_solve_sec:e.solve_time_ms?Math.round(e.solve_time_ms/1e3):void 0,is_auto_solved:e.solution_type==="auto"}}const VO=[[.5,.5,0,0],[.5,0,.5,0],[0,.5,.5,0],[0,0,0,1]],$O=({isOpen:n,onClose:e,piece:t,settings:r})=>{const[i,o]=S.useState(null),[s,a]=S.useState(null),[l,c]=S.useState(0),u=S.useMemo(()=>{var g;if(!((g=t==null?void 0:t.cells)!=null&&g.length))return[];let f=0,m=0,v=0;for(const y of t.cells)f+=y.i,m+=y.j,v+=y.k;const _=t.cells.length,x=f/_,p=m/_,b=v/_;return t.cells.map(y=>({i:y.i-x,j:y.j-p,k:y.k-b}))},[t]),d=S.useMemo(()=>!t||!u.length?null:{...t,cells:u},[t,u]);return S.useEffect(()=>{if(n){if(!u.length){o(null);return}try{const f=vs(u,ms,VO,xs);o(f),c(m=>m+1)}catch{o(null)}}},[n,u]),S.useEffect(()=>{if(!n||!s||!u.length||l<=0)return;const{camera:f,controls:m}=s,v=[[.5,.5,0],[.5,0,.5],[0,.5,.5]];let _=1/0,x=1/0,p=1/0,b=-1/0,g=-1/0,y=-1/0;for(const D of u){const $=v[0][0]*D.i+v[0][1]*D.j+v[0][2]*D.k,W=v[1][0]*D.i+v[1][1]*D.j+v[1][2]*D.k,H=v[2][0]*D.i+v[2][1]*D.j+v[2][2]*D.k;_=Math.min(_,$),x=Math.min(x,W),p=Math.min(p,H),b=Math.max(b,$),g=Math.max(g,W),y=Math.max(y,H)}const E=b-_,C=g-x,A=y-p,w=Math.max(E,C,A)+.5*2,M=f.fov*(Math.PI/180),I=w/2/Math.tan(M/2)*1.25*.75;f.position.set(I,I,I),m.target.set(0,0,0),m.enabled=!0,m.enableRotate=!0,m.enableZoom=!0,m.enablePan=!0,m.update()},[n,s,u,l]),!n||!t?null:h.jsx("div",{onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.55)",backdropFilter:"blur(4px)",zIndex:1e4,display:"flex",alignItems:"center",justifyContent:"center"},children:h.jsxs("div",{onClick:f=>f.stopPropagation(),style:{width:"min(760px, 92vw)",height:"min(560px, 76vh)",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, rgba(255,255,255,0.92) 0%, rgba(236,233,255,0.90) 45%, rgba(219,234,254,0.88) 100%)",borderRadius:"16px",overflow:"hidden",boxShadow:"0 20px 60px rgba(0, 0, 0, 0.45)",border:"1px solid rgba(255, 255, 255, 0.35)"},children:[h.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(99,102,241,0.20), rgba(59,130,246,0.16))",backdropFilter:"blur(12px) saturate(180%)",borderBottom:"1px solid rgba(15, 23, 42, 0.12)",padding:"0.85rem 1.1rem",display:"flex",justifyContent:"space-between",alignItems:"center",boxShadow:"0 0 0 1px rgba(15, 23, 42, 0.05), inset 0 1px 0 rgba(255, 255, 255, 0.35)"},children:[h.jsx("div",{children:h.jsxs("div",{style:{color:"#0f172a",fontSize:"1.25rem",fontWeight:700},children:[" Piece ",t.pieceId]})}),h.jsx("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:h.jsx("button",{onClick:e,style:{padding:"0.55rem 0.85rem",fontSize:"1.1rem",background:"rgba(255, 255, 255, 0.55)",color:"#0f172a",border:"1px solid rgba(15, 23, 42, 0.18)",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s ease"},onMouseOver:f=>{f.currentTarget.style.background="rgba(255, 255, 255, 0.75)"},onMouseOut:f=>{f.currentTarget.style.background="rgba(255, 255, 255, 0.55)"},children:""})})]}),h.jsx("div",{style:{flex:1,position:"relative",background:"rgba(0,0,0,0.92)"},children:i&&d?h.jsx(Ba,{cells:u,view:i,editMode:!1,mode:"add",onCellsChange:()=>{},layout:"embedded",placedPieces:[d],hidePlacedPieces:!1,explosionFactor:0,settings:r,puzzleMode:"unlimited",showBonds:!0,containerOpacity:0,containerColor:"#888888",alwaysShowContainer:!1,onSelectPiece:()=>{},onSceneReady:f=>{a({camera:f.camera,controls:f.controls}),c(m=>m+1)}}):h.jsx("div",{style:{color:"#fff",padding:"1.5rem"},children:"Unable to render piece preview."})})]})})},GO={...Ht,lights:{...Ht.lights,brightness:2.7}},XO=[[.5,.5,0,0],[.5,0,.5,0],[0,.5,.5,0],[0,0,0,1]],YO=()=>{const{puzzleId:n}=ac(),e=Jn(),[t,r]=S.useState(null),[i,o]=S.useState(!0),[s,a]=S.useState(null),[l,c]=S.useState([]),[u,d]=S.useState(null),[f,m]=S.useState([]),[v,_]=S.useState(()=>{try{return localStorage.getItem("solutions.environmentPreset")||""}catch{return""}}),[x,p]=S.useState(()=>{try{const z=localStorage.getItem("solutions.environmentPreset");if(z&&fd[z])return fd[z]}catch{}return GO}),[b,g]=S.useState(!1),[y,E]=S.useState(null),[C,A]=S.useState(0),[T,w]=S.useState(0),[M,P]=S.useState("global"),[I,D]=S.useState(0),[$,W]=S.useState(!1),[H,Z]=S.useState(null),[F,Y]=S.useState(!1);S.useEffect(()=>{(async()=>{var ve,j,ne,Ee;if(!n){a("No puzzle ID provided"),o(!1);return}try{o(!0),console.log(" Loading solution for puzzle:",n);const me=await WO(n);if(!me){console.warn(" No solution found for puzzle:",n),a("No solution found for this puzzle"),o(!1);return}console.log(" Solution loaded:",{id:me.id,solver:me.solver_name,type:me.solution_type,placed_pieces:((ve=me.placed_pieces)==null?void 0:ve.length)||0,final_geometry:me.final_geometry?"present":"missing",actions:((j=me.actions)==null?void 0:j.length)||0});const te=me.final_geometry;if(!te||te.length===0){a("Solution has no geometry"),o(!1);return}c(te);let Pe;try{Pe=vs(te,ms,XO,xs),d(Pe),console.log(` View computed: ${te.length} cells`)}catch(L){console.error("Failed to compute view:",L),a("Failed to process geometry"),o(!1);return}const je=me.placed_pieces||[];m(je),w(je.length),A(je.length),console.log(` Loaded ${je.length} placed pieces, revealing all`),je.length>0&&console.log(" First piece structure:",{keys:Object.keys(je[0]),sample:je[0],hasCells:!!je[0].cells,hasUid:!!je[0].uid,cellsLength:(ne=je[0].cells)==null?void 0:ne.length}),r(me);try{const{data:L}=await bt.from("movies").select("credits_config").eq("puzzle_id",n).order("created_at",{ascending:!1}).limit(1).maybeSingle();if((Ee=L==null?void 0:L.credits_config)!=null&&Ee.scene_settings){const Fe=L.credits_config.scene_settings,Re={...Fe,lights:{...Fe.lights,brightness:Math.max(Fe.lights.brightness,2)}};p(Re),console.log(" Loaded movie scene settings with brightness:",Re.lights.brightness)}else console.log(" No movie settings found, using default analysis settings")}catch(L){console.log(" Could not load movie settings, using defaults:",L)}try{const{data:L}=await bt.from("puzzles").select("creator_name, created_at").eq("id",n).single(),{count:Fe}=await bt.from("solutions").select("*",{count:"exact",head:!0}).eq("puzzle_id",n),{count:Re}=await bt.from("solutions").select("*",{count:"exact",head:!0}).eq("puzzle_id",n).eq("solution_type","auto"),{count:Ne}=await bt.from("solutions").select("*",{count:"exact",head:!0}).eq("puzzle_id",n).eq("solution_type","manual"),{count:de}=await bt.from("game_sessions").select("*",{count:"exact",head:!0}).eq("puzzle_id",n);E({cellCount:te.length,createdAt:(L==null?void 0:L.created_at)||"",creatorName:(L==null?void 0:L.creator_name)||"Unknown",totalSolutions:Fe||0,autoSolveCount:Re||0,manualSolveCount:Ne||0,gamesPlayed:de||0}),console.log(" Loaded puzzle stats:",{cells:te.length,solutions:Fe,games:de})}catch(L){console.log(" Could not load puzzle stats:",L)}o(!1)}catch(me){console.error(" Failed to load solution:",me);const te=me instanceof Error?me.message:"Unknown error";a(`Failed to load solution: ${te}`),o(!1)}})()},[n]);const X=()=>{e("/gallery?tab=movies")},oe=la.useMemo(()=>{var j,ne;if(!u||f.length===0)return f;const z=f.map((Ee,me)=>{const te=Ee.cells.map(L=>u.M_world[1][0]*L.i+u.M_world[1][1]*L.j+u.M_world[1][2]*L.k+u.M_world[1][3]),Pe=Math.min(...te),je=te.reduce((L,Fe)=>L+Fe,0)/te.length;return{piece:Ee,minY:Pe,centroidY:je,originalIdx:me}});let ve;if(M==="connected"){const me=new Map;for(let Re=0;Re<z.length;Re++)me.set(Re,new Set);let te=0;for(let Re=0;Re<z.length;Re++)for(let Ne=Re+1;Ne<z.length;Ne++){const de=z[Re].piece,Se=z[Ne].piece;let Ue=!1;for(const ze of de.cells){const Ke=u.M_world[0][0]*ze.i+u.M_world[0][1]*ze.j+u.M_world[0][2]*ze.k+u.M_world[0][3],it=u.M_world[1][0]*ze.i+u.M_world[1][1]*ze.j+u.M_world[1][2]*ze.k+u.M_world[1][3],N=u.M_world[2][0]*ze.i+u.M_world[2][1]*ze.j+u.M_world[2][2]*ze.k+u.M_world[2][3];for(const k of Se.cells){const G=u.M_world[0][0]*k.i+u.M_world[0][1]*k.j+u.M_world[0][2]*k.k+u.M_world[0][3],ue=u.M_world[1][0]*k.i+u.M_world[1][1]*k.j+u.M_world[1][2]*k.k+u.M_world[1][3],Me=u.M_world[2][0]*k.i+u.M_world[2][1]*k.j+u.M_world[2][2]*k.k+u.M_world[2][3];if(Math.sqrt((Ke-G)**2+(it-ue)**2+(N-Me)**2)<1.15){Ue=!0;break}}if(Ue)break}Ue&&(me.get(Re).add(Ne),me.get(Ne).add(Re),te++)}console.log(` Connected reveal: ${te} connections found between ${z.length} pieces`);let Pe=0,je=z[0].minY;for(let Re=1;Re<z.length;Re++)z[Re].minY<je&&(je=z[Re].minY,Pe=Re);const L=new Set,Fe=new Set([Pe]);for(ve=[],console.log(` Starting BFS from piece ${Pe} (pieceId: ${z[Pe].piece.pieceId}, minY: ${z[Pe].minY.toFixed(2)})`);Fe.size>0;){let Re=-1,Ne=1/0,de=1/0,Se=1/0;for(const Ke of Fe){const it=z[Ke],N=it.minY<Ne-1e-6||Math.abs(it.minY-Ne)<1e-6&&it.centroidY<de-1e-6||Math.abs(it.minY-Ne)<1e-6&&Math.abs(it.centroidY-de)<1e-6&&it.originalIdx<Se;(Re===-1||N)&&(Re=Ke,Ne=it.minY,de=it.centroidY,Se=it.originalIdx)}const Ue=z[Re];console.log(`   Revealing piece ${Re} (${Ue.piece.pieceId}), minY: ${Ue.minY.toFixed(2)}, ${me.get(Re).size} neighbors`),ve.push(Ue),L.add(Re),Fe.delete(Re);const ze=[];for(const Ke of me.get(Re))!L.has(Ke)&&!Fe.has(Ke)&&(Fe.add(Ke),ze.push(Ke));ze.length>0&&console.log(`     Added ${ze.length} new pieces to frontier: ${ze.map(Ke=>z[Ke].piece.pieceId).join(", ")}`)}if(console.log(` Connected reveal complete: revealed ${ve.length} pieces`),ve.length<z.length){const Re=z.map((Ne,de)=>({item:Ne,idx:de})).filter(({idx:Ne})=>!L.has(Ne)).sort((Ne,de)=>Math.abs(Ne.item.minY-de.item.minY)>1e-6?Ne.item.minY-de.item.minY:Math.abs(Ne.item.centroidY-de.item.centroidY)>1e-6?Ne.item.centroidY-de.item.centroidY:Ne.item.originalIdx-de.item.originalIdx);for(const{item:Ne}of Re)ve.push(Ne)}}else if(M==="supported"){const Ee=Math.min(...z.map(K=>K.minY)),me=.1,te=new Map;for(let K=0;K<z.length;K++)te.set(K,new Set);console.log(" Building IJK lattice adjacency graph...");for(let K=0;K<z.length;K++)for(let be=K+1;be<z.length;be++){const Be=z[K].piece,Ze=z[be].piece;let lt=!1;for(const ut of Be.cells){for(const wt of Ze.cells){const mt=Math.abs(ut.i-wt.i),vt=Math.abs(ut.j-wt.j),St=Math.abs(ut.k-wt.k);if(mt+vt+St===1){lt=!0;break}}if(lt)break}lt&&(te.get(K).add(be),te.get(be).add(K))}const Pe=z.map((K,be)=>{const Be=K.piece.cells.filter(Ze=>u.M_world[1][0]*Ze.i+u.M_world[1][1]*Ze.j+u.M_world[1][2]*Ze.k+u.M_world[1][3]<=Ee+me).length;return{idx:be,contacts:Be,pieceId:K.piece.pieceId}}),je=Pe.filter(K=>K.contacts>0).sort((K,be)=>be.contacts-K.contacts);console.log(` Pieces with ground contact: ${je.map(K=>`${K.pieceId}(${K.contacts})`).join(", ")}`);const L=new Map;for(let K=0;K<z.length;K++)for(let be=K+1;be<z.length;be++){if(!te.get(K).has(be))continue;let Be=0;for(const Ze of z[K].piece.cells)for(const lt of z[be].piece.cells){const ut=Math.abs(Ze.i-lt.i),wt=Math.abs(Ze.j-lt.j),mt=Math.abs(Ze.k-lt.k);ut+wt+mt===1&&Be++}Be>0&&(L.set(`${K},${be}`,Be),L.set(`${be},${K}`,Be))}const Fe=Array.from(te.values()).reduce((K,be)=>K+be.size,0)/te.size,Re=Array.from(L.values()).reduce((K,be)=>K+be,0)/L.size;console.log(` Adjacency graph built: avg ${Fe.toFixed(1)} neighbors per piece, avg ${Re.toFixed(1)} contacts per connection`);let Ne=0,de=Pe[0].contacts;for(let K=1;K<Pe.length;K++)Pe[K].contacts>de&&(de=Pe[K].contacts,Ne=K);const Se=z[Ne].piece.pieceId,Ue=((j=te.get(Ne))==null?void 0:j.size)||0;console.log(` Starting piece: ${Se} (idx ${Ne}) with ${de} ground contacts and ${Ue} lattice neighbors`);const ze=K=>`${K.i},${K.j},${K.k}`,Ke=K=>{const[be,Be,Ze]=K.split(",").map(Number);return{i:be,j:Be,k:Ze}},it=K=>{const be=u.M_world,Be=be[0][0]*K.i+be[0][1]*K.j+be[0][2]*K.k+be[0][3],Ze=be[1][0]*K.i+be[1][1]*K.j+be[1][2]*K.k+be[1][3],lt=be[2][0]*K.i+be[2][1]*K.j+be[2][2]*K.k+be[2][3];return{x:Be,y:Ze,z:lt}},N=K=>`${K.di},${K.dj},${K.dk}`,k=[],G=new Set;for(let K=0;K<z.length;K++)for(const be of z[K].piece.cells){const Be=ze(be);G.has(Be)||(G.add(Be),k.push(Be))}console.log(` Deriving contact deltas from full solution (${z.length} pieces, ${k.length} spheres)...`);const ue=2,Me=new Set;for(const K of k){const be=Ke(K);for(let Be=-ue;Be<=ue;Be++)for(let Ze=-ue;Ze<=ue;Ze++)for(let lt=-ue;lt<=ue;lt++){if(Be===0&&Ze===0&&lt===0)continue;const ut=`${be.i+Be},${be.j+Ze},${be.k+lt}`;G.has(ut)&&Me.add(N({di:Be,dj:Ze,dk:lt}))}}const ge=Array.from(Me).map(K=>{const[be,Be,Ze]=K.split(",").map(Number);return{di:be,dj:Be,dk:Ze}});console.log(` Derived ${ge.length} support deltas in IJK space`),console.log(` Sample deltas: ${ge.slice(0,10).map(N).join(" | ")}`);const $e=[],ke=new Map;for(const K of k){const be=Ke(K),Be=it(be).y;$e.push(Be),ke.set(K,Be)}$e.sort((K,be)=>K-be);let We=1/0;for(let K=1;K<$e.length;K++){const be=$e[K]-$e[K-1];be>1e-6&&be<We&&(We=be)}const _e=(isFinite(We)?We:.1)*.5,Le=[];let qe=[$e[0]];for(let K=1;K<$e.length;K++)if($e[K]-$e[K-1]>_e){const be=qe.reduce((Be,Ze)=>Be+Ze,0)/qe.length;Le.push(be),qe=[$e[K]]}else qe.push($e[K]);if(qe.length){const K=qe.reduce((be,Be)=>be+Be,0)/qe.length;Le.push(K)}const re=new Map;for(const K of k){const be=ke.get(K);let Be=0,Ze=Math.abs(be-Le[0]);for(let lt=1;lt<Le.length;lt++){const ut=Math.abs(be-Le[lt]);ut<Ze&&(Ze=ut,Be=lt)}re.set(K,Be)}console.log(` Identified ${Le.length} layers`);const ie=new Set,we=K=>{const be=z[K].piece,Be=new Set(ie);for(const ut of be.cells)Be.add(ze(ut));let Ze=0,lt=0;for(const ut of be.cells){const wt=ze(ut),mt=re.get(wt);if(mt===void 0)continue;if(mt===0){lt++,Ze++;continue}let vt=0;for(const St of ge){const Yt={i:ut.i+St.di,j:ut.j+St.dj,k:ut.k+St.dk},Nt=ze(Yt);if(!Be.has(Nt))continue;re.get(Nt)===mt-1&&vt++}vt>=3&&Ze++}return{ok:Ze===4,supportedSpheres:Ze,groundSpheres:lt}},U=[];console.log(` Pre-sorting all ${z.length} pieces by FCC support and clustering...`);for(let K=0;K<z.length;K++){const be=z[K],Be=be.piece,Ze=Pe[K].contacts,lt=((ne=te.get(K))==null?void 0:ne.size)||0;let ut=0,wt=0;for(const St of Be.cells){const Yt=re.get(ze(St));Yt!==void 0&&(ut+=Yt,wt++)}const mt=wt>0?ut/wt:0,vt=Ze*1e3+lt*100-mt;U.push({item:be,idx:K,groundSpheres:Ze,totalNeighbors:lt,avgLayer:mt,score:vt})}const se=new Map;U.forEach(K=>se.set(K.idx,K)),console.log(` Pre-scored pieces. Top 5 by intrinsic score: ${U.slice(0,5).map(K=>`${K.item.piece.pieceId}(ground:${K.groundSpheres}, neighbors:${K.totalNeighbors})`).join(", ")}`);const he=new Set,Oe=new Set;ve=[];const Te=z[Ne];ve.push(Te),he.add(Ne);for(const K of Te.piece.cells)ie.add(ze(K));for(const K of te.get(Ne))Oe.add(K);const ce=Pe[Ne].contacts;for(console.log(` Starting cluster assembly with piece ${Ne} (${Te.piece.pieceId}), ground: ${ce}`),console.log(" Each subsequent piece will connect to the ENTIRE assembled cluster");Oe.size>0;){ie.clear();for(const mt of he){const vt=z[mt].piece;for(const St of vt.cells)ie.add(ze(St))}let K=-1,be=-1/0;const Be=ve.length<10;for(const mt of Oe){const{ok:vt}=we(mt);if(vt){const St=se.get(mt);let Yt=0;for(const Zt of he){const yn=L.get(`${mt},${Zt}`)||0;yn>0&&(Yt+=yn)}const Nt=St.score+Yt*500;Nt>be&&(K=mt,be=Nt)}}if(K===-1){if(console.log(` No valid supported pieces in frontier of ${Oe.size} candidates`),console.log(" Requirement: ALL 4 spheres must be supported (no floating spheres allowed)"),Be)for(const mt of Oe){const{supportedSpheres:vt,groundSpheres:St}=we(mt);console.log(`     Piece ${mt} (${z[mt].piece.pieceId}): ${vt}/4 spheres supported, ${St} on ground - ${vt<4?"REJECTED (not all spheres supported)":"OK"}`)}break}const Ze=z[K],{supportedSpheres:lt,groundSpheres:ut}=we(K),wt=`ALL spheres supported (${ut} on ground, ${lt-ut} via neighbors)`;if(ve.length<=10){let mt=0;const vt=[];for(const Nt of he){const Zt=L.get(`${K},${Nt}`)||0;if(Zt>0){mt+=Zt;const yn=z[Nt].piece.pieceId;vt.push(`${yn}(${Zt})`)}}const St=se.get(K),Yt=mt*500;console.log(`   Placing #${ve.length+1}: piece ${K} (${Ze.piece.pieceId}), ${wt}`),console.log(`       Score: base=${St.score.toFixed(0)} + cluster_contacts=${Yt.toFixed(0)} = ${be.toFixed(0)}`),vt.length>0&&console.log(`       Connects to cluster: ${vt.join(", ")}`)}ve.push(Ze),he.add(K),Oe.delete(K);for(const mt of te.get(K))!he.has(mt)&&!Oe.has(mt)&&Oe.add(mt)}if(console.log(` Connected assembly complete: placed ${ve.length}/${z.length} pieces`),ve.length<z.length){const K=z.map((be,Be)=>({item:be,idx:Be})).filter(({idx:be})=>!he.has(be)).sort((be,Be)=>{const Ze=Pe[be.idx].contacts,lt=Pe[Be.idx].contacts;return Ze!==lt?lt-Ze:Math.abs(be.item.minY-Be.item.minY)>1e-6?be.item.minY-Be.item.minY:be.item.originalIdx-Be.item.originalIdx});for(const{item:be}of K)ve.push(be)}}else ve=z.slice().sort((Ee,me)=>Math.abs(Ee.minY-me.minY)>1e-6?Ee.minY-me.minY:Math.abs(Ee.centroidY-me.centroidY)>1e-6?Ee.centroidY-me.centroidY:Ee.originalIdx-me.originalIdx);return T===0?ve.map(Ee=>Ee.piece):ve.slice(0,C).map(Ee=>Ee.piece)},[f,C,T,M,u]),pe=la.useMemo(()=>H&&f.find(z=>z.uid===H)||null,[f,H]),De=T>0&&C<f.length?0:.15;return i?h.jsx("div",{style:{width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"#000",color:"#fff",fontSize:"1.2rem"},children:"Loading solution..."}):s||!t?h.jsxs("div",{style:{width:"100vw",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#000",color:"#fff",gap:"20px"},children:[h.jsx("div",{style:{fontSize:"1.2rem"},children:s||"Solution not found"}),h.jsx("button",{onClick:X,style:{background:"rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.3)",borderRadius:"8px",color:"#fff",padding:"12px 24px",fontSize:"1rem",cursor:"pointer"},children:"Back to Gallery"})]}):h.jsxs("div",{style:{width:"100vw",height:"100vh",position:"relative",overflow:"hidden",background:"#000"},children:[h.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",display:"flex",gap:"8px",zIndex:1e3},children:[h.jsx("button",{className:"pill",onClick:()=>g(!0),title:"Environment",style:{background:"linear-gradient(135deg, #6366f1, #4f46e5)",color:"#fff",fontWeight:700,border:"none",fontSize:"16px",width:"40px",height:"40px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease",cursor:"pointer"},children:""}),h.jsx("button",{className:"pill pill--chrome",onClick:()=>W(!0),title:"Solution Information",style:{width:"44px",padding:0,background:"rgba(0, 0, 0, 0.35)",border:"1px solid rgba(0, 0, 0, 0.25)",color:"#ffffff",fontWeight:800,fontSize:"18px"},children:"i"}),h.jsx("button",{className:"pill",onClick:()=>e("/"),title:"Home",style:{background:"linear-gradient(135deg, #667eea, #764ba2)",color:"#fff",fontWeight:700,border:"none",fontSize:"16px",width:"40px",height:"40px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.3)",transition:"all 0.2s ease",cursor:"pointer"},children:""})]}),h.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",zIndex:0},children:u&&l.length>0?h.jsxs(h.Fragment,{children:[console.log(" Rendering SceneCanvas:",{cellsCount:l.length,viewPresent:!!u,visiblePiecesCount:oe.length,explosionFactor:I,brightness:x.lights.brightness}),h.jsx(Ba,{cells:l,view:u,editMode:!1,mode:"add",onCellsChange:()=>{},layout:"fullscreen",placedPieces:oe,hidePlacedPieces:!1,explosionFactor:I,settings:x,puzzleMode:"unlimited",showBonds:!0,containerOpacity:De,containerColor:"#888888",alwaysShowContainer:!0,visibility:{xray:!1,emptyOnly:!1,sliceY:{center:.5,thickness:1}},onSelectPiece:()=>{},onInteraction:(z,ve,j)=>{if(z!=="piece"||ve!=="double")return;const ne=typeof j=="string"?j:j==null?void 0:j.uid;ne&&(Z(ne),Y(!0))}})]}):h.jsx(h.Fragment,{children:console.log(" NOT rendering SceneCanvas:",{viewPresent:!!u,cellsCount:l.length,reason:u?"no cells":"no view"})})}),h.jsx(Tw,{revealK:C,revealMax:T,explosionFactor:I,revealMethod:M,onChangeRevealK:A,onChangeExplosionFactor:D,onChangeRevealMethod:P}),h.jsx(Hd,{isOpen:b,currentPreset:v,onClose:()=>g(!1),onSelectPreset:(z,ve)=>{p(z),_(ve);try{localStorage.setItem("solutions.environmentPreset",ve)}catch{}}}),$&&t&&h.jsx(HO,{isOpen:$,onClose:()=>W(!1),solution:t,puzzleStats:y||void 0}),h.jsx($O,{isOpen:F&&!!pe,onClose:()=>{Y(!1),Z(null)},piece:pe,settings:x})]})};function qO(){return h.jsx(u5,{children:h.jsx(RM,{children:h.jsxs(mM,{children:[h.jsx(v5,{}),h.jsxs($2,{children:[h.jsx(mr,{path:"/",element:h.jsx(x5,{})}),h.jsx(mr,{path:"/login",element:h.jsx(y5,{})}),h.jsx(mr,{path:"/signup",element:h.jsx(b5,{})}),h.jsx(mr,{path:"/auth/callback",element:h.jsx(S5,{})}),h.jsx(mr,{path:"/gallery",element:h.jsx("div",{style:{minHeight:"100vh",width:"100%",backgroundColor:"#0a0a0a"},children:h.jsx(FO,{})})}),h.jsx(mr,{path:"/create",element:h.jsx("div",{style:{minHeight:"100vh",width:"100%",backgroundColor:"#1a1a1a"},children:h.jsx(YD,{})})}),h.jsx(mr,{path:"/manual/:id",element:h.jsx("div",{style:{minHeight:"100vh",width:"100%",backgroundColor:"#000"},children:h.jsx(BN,{})})}),h.jsx(mr,{path:"/game/:id",element:h.jsx("div",{style:{minHeight:"100vh",width:"100%",backgroundColor:"#000"},children:h.jsx(cO,{})})}),h.jsx(mr,{path:"/auto/:id",element:h.jsx("div",{style:{minHeight:"100vh",width:"100%",backgroundColor:"#000"},children:h.jsx(TO,{})})}),h.jsx(mr,{path:"/leaderboards/:puzzleId",element:h.jsx("div",{style:{minHeight:"100vh",width:"100%",backgroundColor:"#0a0a0a"},children:h.jsx(BO,{})})}),h.jsx(mr,{path:"/solutions/:puzzleId",element:h.jsx("div",{style:{minHeight:"100vh",width:"100%",backgroundColor:"#000"},children:h.jsx(YO,{})})})]})]})})})}const KO=S.createContext(void 0),JO=({children:n})=>{const[e,t]=S.useState(!0);S.useEffect(()=>{localStorage.getItem("auth_v1")!=="false"&&t(!0)},[]),S.useEffect(()=>{localStorage.setItem("auth_v1",e.toString())},[e]);const o={isLoggedIn:e,login:()=>{t(!0)},logout:()=>{t(!1)}};return h.jsx(KO.Provider,{value:o,children:n})};yf.createRoot(document.getElementById("root")).render(h.jsx(JO,{children:h.jsx(qO,{})}));
